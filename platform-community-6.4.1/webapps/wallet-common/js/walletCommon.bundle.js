define((()=>(()=>{"use strict";var t={d:(e,a)=>{for(var s in a)t.o(a,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:a[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{components:()=>aa});var a={};t.r(a),t.d(a,{refreshWallet:()=>m,saveAddressLabel:()=>b,saveNewAddress:()=>u,searchAddress:()=>p,searchSpaces:()=>g,searchUsers:()=>v,searchWalletByAddress:()=>f,searchWalletByTypeAndId:()=>h,searchWallets:()=>w,switchInternalProvider:()=>_,switchProvider:()=>y});var s={};t.r(s),t.d(s,{ERROR_WALLET_DISCONNECTED:()=>K,ERROR_WALLET_NOT_CONFIGURED:()=>R,ERROR_WALLET_SETTINGS_NOT_LOADED:()=>U,FIAT_CURRENCIES:()=>B,NETWORK_NAMES:()=>F,OK:()=>O});var l={};t.r(l),t.d(l,{createNewContractInstanceByName:()=>H,createNewContractInstanceByNameAndAddress:()=>G,estimateContractDeploymentGas:()=>V,getContractDeploymentTransactionsInProgress:()=>Q,getContractDetails:()=>q,getContractInstance:()=>J,getSavedContractDetails:()=>X,getTransactionCount:()=>tt,newContractInstance:()=>z,reloadContractDetails:()=>j,removeContractDeploymentTransactionsInProgress:()=>Y,sendContractTransaction:()=>Z});var n={};t.r(n),t.d(n,{getGasPrice:()=>ot,getNonce:()=>rt,getSavedTransactionByHash:()=>dt,getStoredTransactions:()=>it,getTransactionsAmounts:()=>nt,loadTransactions:()=>at,refreshTransactionDetail:()=>st,saveTransactionDetails:()=>lt});var i={};t.r(i),t.d(i,{checkFundRequestStatus:()=>Ft,connectToMetamask:()=>Zt,convertTokenAmountReceived:()=>jt,convertTokenAmountToSend:()=>Kt,deleteWallet:()=>Gt,enableWallet:()=>Ut,estimateTransactionFeeEther:()=>qt,estimateTransactionFeeFiat:()=>zt,etherToFiat:()=>mt,gasToEther:()=>pt,gasToFiat:()=>gt,getAddressEtherscanlink:()=>Pt,getCurrentBrowserWallet:()=>Et,getMetamaskSelectedAccount:()=>Vt,getMetamaskSelectedNetworkId:()=>Qt,getNetworkLink:()=>It,getTokenEtherscanlink:()=>At,getTransactionEtherscanlink:()=>Tt,getTransactionExplorerName:()=>Ct,getWallets:()=>Ot,hashCode:()=>Mt,initEmptyWeb3Instance:()=>bt,initSettings:()=>_t,initWeb3:()=>yt,isMetamaskConnected:()=>Jt,isMetamaskInstalled:()=>Yt,lockBrowserWallet:()=>Dt,markFundRequestAsSent:()=>Bt,rememberPassword:()=>$t,removeServerSideBackup:()=>ft,removeWalletAssociation:()=>Rt,retrievePrivateKeyFromServer:()=>vt,saveBrowserWallet:()=>kt,saveBrowserWalletInstance:()=>xt,saveWalletInitializationStatus:()=>Ht,sendPrivateKeyToServer:()=>ht,setWalletBackedUp:()=>Lt,switchMetamaskAccount:()=>te,switchMetamaskNetwork:()=>ee,toFixed:()=>Xt,truncateError:()=>Nt,unlockBrowserWallet:()=>Wt,watchTransactionStatus:()=>St});var r=function(){var t=this,e=t._self._c;return e("exo-drawer",{ref:"accountDetail",attrs:{"allow-expand":"",right:!t.$vuetify.rtl}},[e("template",{slot:"title"},[t.wallet?e("span",{staticClass:"ps-4"},[t.isAdministration?[t._v("\n        "+t._s(t.$t("exoplatform.wallet.label.transactionsOfWallet"))+":\n        "),e("wallet-reward-profile-chip",{ref:"profileChip",attrs:{"profile-technical-id":t.wallet.technicalId,"profile-id":t.wallet.id,"profile-type":t.wallet.type,"space-id":t.wallet.spaceId,avatar:t.wallet.avatar,"display-name":t.wallet.name,address:t.wallet.address}})]:"reward"===t.selectedContractMethodName?[t._v("\n        "+t._s(t.$t("exoplatform.wallet.label.rewardTransactionsList"))+"\n      ")]:[t._v("\n        "+t._s(t.$t("exoplatform.wallet.label.lastTransaction"))+"\n      ")]],2):e("span",{staticClass:"ps-4"},[t._v("\n      "+t._s(t.contractTitle)+"\n    ")])]),t._v(" "),e("template",{slot:"content"},[e("wallet-reward-transactions-list",{ref:"transactionsList",staticClass:"lastTransactionsList overflow-x-hidden",attrs:{id:"transactionsList",wallet:t.wallet,"contract-details":t.contractDetails,"fiat-symbol":t.fiatSymbol,administration:t.isAdministration,"selected-transaction-hash":t.selectedTransactionHash,"selected-contract-method-name":t.selectedContractMethodName,"display-full-transaction":t.isAdministration,error:t.error},on:{error:function(e){t.error=e}}})],1)],2)};function o(t,e,a,s,l,n,i,r){var o,d="function"==typeof t?t.options:t;if(e&&(d.render=e,d.staticRenderFns=a,d._compiled=!0),s&&(d.functional=!0),n&&(d._scopeId="data-v-"+n),i?(o=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),l&&l.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(i)},d._ssrRegister=o):l&&(o=r?function(){l.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:l),o)if(d.functional){d._injectStyles=o;var c=d.render;d.render=function(t,e){return o.call(e),c(t,e)}}else{var w=d.beforeCreate;d.beforeCreate=w?[].concat(w,o):[o]}return{exports:t,options:d}}r._withStripped=!0;const d=o({props:{wallet:{type:Object,default:function(){return null}},fiatSymbol:{type:String,default:function(){return"$"}},selectedTransactionHash:{type:String,default:function(){return null}},selectedContractMethodName:{type:String,default:function(){return null}},contractDetails:{type:Object,default:function(){return{}}},isAdministration:{type:Boolean,default:function(){return!1}}},data:()=>({error:null}),watch:{contractDetails(){this.error=null}},computed:{contractTitle(){return this.contractDetails&&this.contractDetails.title}},methods:{open(){this.$refs.accountDetail.open()}}},r,[],!1,null,null,null).exports;var c=function(){var t=this,e=t._self._c;return e("v-flex",{staticClass:"contactAutoComplete",attrs:{id:t.id}},[e("v-autocomplete",{ref:"selectAutoComplete",staticClass:"contactAutoComplete",attrs:{items:t.items,loading:t.isLoadingSuggestions,"search-input":t.searchTerm,label:t.inputLabel,disabled:t.disabled,placeholder:t.inputPlaceholder,"content-class":`contactAutoCompleteContent ${t.bigField&&"bigContactAutoComplete"}`,filter:t.filterIgnoredItems,required:t.required,"max-width":"100%","item-text":"name","item-value":"id_type","hide-details":"","hide-selected":"",chips:"","cache-items":"",dense:"",flat:""},on:{"update:searchInput":function(e){t.searchTerm=e},"update:search-input":function(e){t.searchTerm=e},click:function(t){t.stopPropagation()}},scopedSlots:t._u([{key:"selection",fn:function({item:a,selected:s}){return[a.avatar?e("v-chip",{staticClass:"autocompleteSelectedItem",attrs:{"input-value":s,title:"error"===t.addressLoad?t.$t("exoplatform.wallet.warning.walletRecipientIsInvalid"):""},on:{"update:active":function(e){return t.selectItem(a)}}},["loading"===t.addressLoad?e("v-progress-circular",{staticClass:"me-2",attrs:{indeterminate:"",color:"white"}}):!1===a.enabled||a.deletedUser||a.disabledUser?e("v-icon",{staticClass:"me-2",attrs:{title:a.disabledUser&&t.$t("exoplatform.wallet.label.disabledUser")||a.deletedUser&&t.$t("exoplatform.wallet.label.deletedIdentity")||!1===a.enabled&&t.$t("exoplatform.wallet.label.disabledWallet"),color:"orange",size:"15"}},[t._v("\n          warning\n        ")]):"error"===t.addressLoad?e("v-icon",{staticClass:"me-2",attrs:{title:t.$t("exoplatform.wallet.warning.invalidAddress"),color:"red",size:"15"}},[t._v("\n          warning\n        ")]):t._e(),t._v(" "),e("span",[t._v("\n          "+t._s(a.name)+"\n        ")])],1):e("v-label",{staticClass:"black--text",attrs:{selected:s,solo:""},on:{input:function(e){return t.selectItem(a)}}},[t._v("\n        "+t._s(a.name)+"\n      ")])]}},{key:"item",fn:function({item:a}){return[a.avatar?e("v-list-item-avatar",{attrs:{size:"20"}},[e("img",{attrs:{src:a.avatar}})]):t._e(),t._v(" "),e("v-list-item-title",{domProps:{textContent:t._s(a.name)}})]}}]),model:{value:t.selectedValue,callback:function(e){t.selectedValue=e},expression:"selectedValue"}},[e("template",{slot:"no-data"},[e("v-list-item",[t.noDataLabel?e("v-list-item-title",[t._v("\n          "+t._s(t.noDataLabel)+"\n        ")]):e("v-list-item-title",[t._v("\n          "+t._s(t.$t("exoplatform.wallet.label.searchForWallet"))+"\n        ")])],1)],1)],2)],1)};function w(t){let e=null;return v(t).then((t=>e=t&&t.length?t:[])).then((()=>g(t))).then((t=>e=e.concat(t))).catch((t=>{console.error("searchWallets method - error",t)}))}function u(t,e,a){return a=a.toLowerCase(),fetch("/portal/rest/wallet/api/account/saveAddress",{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({type:e,id:t,address:a,enabled:!0})})}function m(t,e){if(!(t||t.address||t.id&&t.type))return console.error("can't refresh wallet with empty identifiers",t),Promise.resolve(null);let a=null;return a=e?fetch(`/portal/rest/wallet/api/account/refreshWalletFromBlockchain?address=${t.address}`,{credentials:"include"}).then((t=>t&&t.ok)):Promise.resolve(null),a.then((()=>t.address?f(t.address,!0).then((e=>e&&Object.assign(t,e))):h(t.id,t.type).then((e=>e&&Object.assign(t,e)))))}function p(t,e){return h(t,e).then((t=>t&&t.address&&t.address.length&&0===t.address.indexOf("0x")?t.address:null))}function h(t,e){return window.walletSettings&&window.walletSettings.wallet&&window.walletSettings.wallet.id===t&&window.walletSettings.wallet.type===e?Promise.resolve(window.walletSettings.wallet):fetch(`/portal/rest/wallet/api/account/detailsById?id=${t}&type=${e}`,{credentials:"include"}).then((t=>t&&t.ok?t.json():null))}function f(t,e){return t?(t=t.toLowerCase(),!e&&window.walletSettings&&window.walletSettings.userPreferences&&window.walletSettings.wallet&&window.walletSettings.wallet.address&&window.walletSettings.wallet.address.toLowerCase()===t?Promise.resolve(window.walletSettings.wallet):fetch(`/portal/rest/wallet/api/account/detailsByAddress?address=${t}`,{credentials:"include"}).then((t=>t.ok?t.json():null)).then((t=>{if(t&&t.name&&t.name.length)return!t.id_type&&t.type&&t.id&&(t.id_type=`${t.type}_${t.id}`),t})).catch((t=>{console.error("searchFullName method - error",t)}))):Promise.resolve(null)}function v(t,e){const a=$.param({nameToSearch:t,typeOfRelation:"mention_activity_stream",currentUser:e?"":eXo.env.portal.userName,spaceURL:window.walletSettings.accessPermission&&window.walletSettings.accessPermission.length?window.walletSettings.accessPermission:null});return fetch(`/portal/rest/social/people/suggest.json?${a}`,{credentials:"include"}).then((t=>t.ok?t.json():null)).then((t=>(t?(t.options&&(t=t.options),t.forEach((t=>{t.id&&0===t.id.indexOf("@")&&(t.id=t.id.substring(1),t.id_type=`user_${t.id}`)}))):t=[],t)))}function g(t,e){const a=$.param({fields:["id","prettyName","displayName","avatarUrl"],keyword:t});return fetch(`/portal/rest/space/user/searchSpace?${a}`,{credentials:"include"}).then((t=>t.ok?t.json():null)).then((t=>{const a=[];return t.forEach((t=>{a.push({avatar:t.avatarUrl?t.avatarUrl:`/portal/rest/v1/social/spaces/${t.prettyName}/avatar`,name:t.displayName,id:t.prettyName,id_type:`space_${t.prettyName}`,technicalId:t.id,members:e?t.members:null})})),a}))}function b(t){return fetch("/portal/rest/wallet/api/account/saveOrDeleteAddressLabel",{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.json();throw console.error("Error saving address label",t),new Error("Error saving address label")}))}function y(t,e,a,s){const l=new FormData;return l.append("address",e),l.append("provider",t),l.append("rawMessage",a),l.append("signedMessage",s),fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/wallet/api/account/provider`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(l).toString()}).then((t=>{if(!t||!t.ok)throw new Error("Error saving new provider label")}))}function _(){const t=new FormData;return t.append("provider","INTERNAL_WALLET"),fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/wallet/api/account/provider`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(t).toString()}).then((t=>{if(!t||!t.ok)throw new Error("Error saving new provider label")}))}c._withStripped=!0;const S=o({props:{inputLabel:{type:String,default:function(){return null}},inputPlaceholder:{type:String,default:function(){return null}},noDataLabel:{type:String,default:function(){return null}},autofocus:{type:Boolean,default:function(){return!0}},noAddress:{type:Boolean,default:function(){return!1}},disabled:{type:Boolean,default:function(){return!1}},bigField:{type:Boolean,default:function(){return!1}},required:{type:Boolean,default:function(){return!1}},ignoreItems:{type:Array,default:function(){return[]}},ignoreCurrentUser:{type:Boolean,default:function(){return!1}}},data:()=>({items:[],id:`AutoComplete${parseInt(1e4*Math.random()).toString().toString()}`,selectedValue:null,searchTerm:null,address:null,isLoadingSuggestions:!1,addressLoad:"",currentUserItem:null,error:null}),watch:{autofocus(){this.autofocus&&this.$refs.selectAutoComplete.focus()},searchTerm(t){if(!t)return;const e=window.localWeb3&&window.localWeb3.utils.isAddress(t);if(e&&!this.noAddress)this.items.push({address:t,name:t,id:t});else if(e&&window.walletSettings&&window.walletSettings.contractDetail&&t.trim().toLowerCase()===window.walletSettings.contractAddress)this.items.push({address:t,name:window.walletSettings.contractDetail.name,id:t});else{if(t.length)return this.isLoadingSuggestions=!0,w(t).then((t=>{this.items=t,this.items?this.currentUserItem&&!this.ignoreCurrentUser&&this.items.push(this.currentUserItem):this.currentUserItem&&!this.ignoreCurrentUser?this.items=[this.currentUserItem]:this.items=[]})).finally((()=>{this.isLoadingSuggestions=!1}));this.currentUserItem&&!this.ignoreCurrentUser?this.items=[this.currentUserItem]:this.items=[]}},selectedValue(){if(this.addressLoad="loading",this.selectedValue){const t=this.selectedValue.indexOf("_")<0,e=t?null:this.selectedValue.substring(0,this.selectedValue.indexOf("_")),a=t?this.selectedValue:this.selectedValue.substring(this.selectedValue.indexOf("_")+1);return!this.noAddress&&t?f(this.selectedValue).then((t=>{t&&t.type?(this.addressLoad="success",this.$emit("item-selected",{id:t.id,type:t.type,address:t.address,enabled:t.enabled,name:t.name,id_type:`${t.type}_${t.id}`})):(this.addressLoad="success",this.$emit("item-selected",{id:a,type:null,address:a}))})):h(a,e).then((t=>{const s=t&&t.address&&t.address.length&&0===t.address.indexOf("0x")&&t.address;s&&s.length?(this.addressLoad="success",this.$emit("item-selected",{id:a,type:e,name:t.name,id_type:`${e}_${a}`,address:s})):(this.addressLoad="error",this.$emit("item-selected",{id:a,type:e,name:t&&t.name,id_type:`${e}_${a}`,address:null}))})).catch((t=>{console.error("searchAddress method - error",t),this.addressLoad="error"}))}}},created(){h(eXo.env.portal.userName,"user").then((t=>{t&&(t.id_type=`${t.type}_${t.id}`,this.currentUserItem=t)}))},methods:{focus(){this.$nextTick((()=>this.$refs.selectAutoComplete.focus()))},clear(){!this.ignoreCurrentUser&&this.currentUserItem?this.items=[this.currentUserItem]:this.items=[],this.selectedValue=null,this.searchTerm=null,this.address=null,this.isLoadingSuggestions=!1,this.addressLoad="",this.error=null,this.$refs.selectAutoComplete.blur()},canAddItem(t){return!t||!t.id||this.ignoreItems.indexOf(t.id)<0},filterIgnoredItems(t,e,a){return!(e&&a.toLowerCase().indexOf(e.toLowerCase())<0)&&(!this.ignoreItems||!this.ignoreItems.length||this.canAddItem(t))},selectItem(t,e){const a=t&&window.localWeb3&&window.localWeb3.utils.isAddress(t),s=window.walletSettings&&window.walletSettings.contractAddress;if(t)if(a&&s&&t.trim().toLowerCase()===s.trim().toLowerCase()){const t={address:s,id_type:s,name:window.walletSettings.contractDetail.name,id:s};this.items.push(t),this.$refs.selectAutoComplete&&this.$refs.selectAutoComplete.selectItem(t)}else{if(e)return h(t,e).then((t=>{t.id_type=t.type&&t.id?`${t.type}_${t.id}`:null,this.items.push(t),this.$refs.selectAutoComplete&&this.$refs.selectAutoComplete.selectItem(t)}));{const e={id_type:t,name:t};this.items.push(e),this.$refs.selectAutoComplete&&this.$refs.selectAutoComplete.selectItem(e)}}else this.$refs.selectAutoComplete.selectItem(null)}}},c,[],!1,null,null,null).exports;var x=function(){var t=this,e=t._self._c;return e("v-dialog",{attrs:{width:t.width,"content-class":"uiPopup walletDialog","max-width":"100vw","hide-overlay":""},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.close.apply(null,arguments)}},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[e("v-card",{staticClass:"elevation-12"},[e("div",{staticClass:"ignore-vuetify-classes popupHeader ClearFix"},[e("a",{staticClass:"uiIconClose pull-right",attrs:{"aria-hidden":"true"},on:{click:t.close}}),t._v(" "),e("span",{staticClass:"ignore-vuetify-classes PopupTitle popupTitle",class:t.titleClass},[t._v("\n        "+t._s(t.title)+"\n      ")])]),t._v(" "),e("v-card-text",{domProps:{innerHTML:t._s(t.message)}}),t._v(" "),t.hideActions?t._e():e("v-card-actions",[e("v-spacer"),t._v(" "),e("button",{staticClass:"ignore-vuetify-classes btn btn-primary me-2",attrs:{disabled:t.loading,loading:t.loading},on:{click:t.ok}},[t._v("\n        "+t._s(t.okLabel)+"\n      ")]),t._v(" "),e("button",{staticClass:"ignore-vuetify-classes btn ms-2",attrs:{disabled:t.loading,loading:t.loading},on:{click:t.close}},[t._v("\n        "+t._s(t.cancelLabel)+"\n      ")]),t._v(" "),e("v-spacer")],1)],1)],1)};x._withStripped=!0;const k=o({props:{loading:{type:Boolean,default:function(){return!1}},title:{type:String,default:function(){return null}},titleClass:{type:String,default:function(){return""}},message:{type:String,default:function(){return null}},okLabel:{type:String,default:function(){return"ok"}},cancelLabel:{type:String,default:function(){return"Cancel"}},hideActions:{type:Boolean,default:function(){return!1}},width:{type:String,default:function(){return"290px"}}},data:()=>({dialog:!1}),watch:{dialog(){this.dialog?this.$emit("dialog-opened"):this.$emit("dialog-closed")}},methods:{ok(){this.$emit("ok"),this.dialog=!1},open(){this.dialog=!0},close(){this.$emit("closed"),this.dialog=!1}}},x,[],!1,null,null,null).exports;var C=function(){var t=this,e=t._self._c;return e("v-dialog",{attrs:{"content-class":t.title?"uiPopup walletDialog":"walletDialog","hide-overlay":"",width:"300px","max-width":"100vw"},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"]))return null;t.dialog=!1}},scopedSlots:t._u([{key:"activator",fn:function(){return[t._t("default")]},proxy:!0}],null,!0),model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[t._v(" "),e("v-card",{staticClass:"elevation-12"},[t.title?e("div",{staticClass:"ignore-vuetify-classes popupHeader ClearFix"},[e("a",{staticClass:"uiIconClose pull-right",attrs:{"aria-hidden":"true"},on:{click:function(e){t.dialog=!1}}}),t._v(" "),e("span",{staticClass:"ignore-vuetify-classes PopupTitle popupTitle"},[t._v("\n          "+t._s(t.title)+"\n        ")])]):t._e(),t._v(" "),e("v-card-text",[t._t("content")],2)],1)],1)};C._withStripped=!0;const P=o({props:{title:{type:String,default:function(){return null}}},data:()=>({dialog:!1})},C,[],!1,null,null,null).exports;var A=function(){var t=this,e=t._self._c;return e("wallet-reward-information-bubble",[e("template",{slot:"content"},[t._t("bubble-content")],2),t._v(" "),e("v-btn",{staticClass:"mt-0 mb-2",attrs:{title:t.content,icon:"",small:""}},[e("v-icon",{attrs:{small:"",color:"orange"}},[t._v("fa-exclamation-circle")])],1)],2)};A._withStripped=!0;const T=o({props:{content:{type:String,default:function(){return null}}}},A,[],!1,null,null,null).exports;var I=function(){var t=this,e=t._self._c;return t.profileId?e("a",{attrs:{id:t.id,title:t.address,href:t.url,rel:"nofollow",target:"_blank"}},[t.noStatus?[t._v("\n    "+t._s(t.displayName)+"\n  ")]:t.deletedUser?[e("del",{staticClass:"red--text"},[t._v(t._s(t.displayName))]),t._v(" ("+t._s(t.$t("exoplatform.wallet.label.deletedIdentity"))+")\n  ")]:t.disabledUser?[e("del",{staticClass:"red--text"},[t._v(t._s(t.displayName))]),t._v(" ("+t._s(t.$t("exoplatform.wallet.label.disabledUser"))+")\n  ")]:t.displayNoAddress&&!t.address?[e("del",{staticClass:"red--text"},[t._v(t._s(t.displayName))]),t._v(" ("+t._s(t.$t("exoplatform.wallet.label.noWallet"))+")\n  ")]:t.enabled?t.disabledInRewardPool?[t._v("\n    "+t._s(t.displayName)+" "),e("span",{staticClass:"red--text"},[t._v("("+t._s(t.$t("exoplatform.wallet.label.disabledPool"))+")")])]:t.isNotInitialized?[t._v("\n    "+t._s(t.displayName)+" "),e("span",{staticClass:"orange--text"},[t._v("("+t._s(t.$t("exoplatform.wallet.label.notInitialized"))+")")])]:[t._v("\n    "+t._s(t.displayName)+"\n  ")]:[e("del",{staticClass:"red--text"},[t._v(t._s(t.displayName))]),t._v(" ("+t._s(t.$t("exoplatform.wallet.label.disabledWallet"))+")\n  ")]],2):t.displayName?e("code",[t.enabled?[t._v("\n    "+t._s(t.displayName)+"\n  ")]:e("span",[e("del",{staticClass:"red--text"},[t._v(t._s(t.displayName))]),t._v(" ("+t._s(t.$t("exoplatform.wallet.label.disabledWallet"))+")\n  ")])],2):e("wallet-reward-wallet-address",{attrs:{value:t.address,"display-label":""}})};I._withStripped=!0;const E=o({props:{profileId:{type:String,default:function(){return null}},profileType:{type:String,default:function(){return null}},displayName:{type:String,default:function(){return null}},address:{type:String,default:function(){return null}},enabled:{type:Boolean,default:function(){return!0}},disabledInRewardPool:{type:Boolean,default:function(){return!1}},displayNoAddress:{type:Boolean,default:function(){return!1}},deletedUser:{type:Boolean,default:function(){return!1}},disabledUser:{type:Boolean,default:function(){return!1}},noStatus:{type:Boolean,default:function(){return!1}},initializationState:{type:String,default:function(){return"INITIALIZED"}}},data:()=>({id:`chip${parseInt(1e4*Math.random()).toString().toString()}`}),computed:{url(){return this.profileType&&"user"!==this.profileType?"space"===this.profileType?`${eXo.env.portal.context}/g/:spaces:${this.profileId}/`:"#":`${eXo.env.portal.context}/${eXo.env.portal.portalName}/profile/${this.profileId}`},isNotInitialized(){return"INITIALIZED"!==this.initializationState&&"MODIFIED"!==this.initializationState}}},I,[],!1,null,null,null).exports;var D=function(){var t=this,e=t._self._c;return e("v-flex",[t.information?e("div",{staticClass:"alert alert-info"},[e("i",{staticClass:"uiIconInfo"}),t._v(" "+t._s(t.information)+"\n  ")]):t._e(),t._v(" "),e("div",{staticClass:"text-center",attrs:{id:t.id}})])};D._withStripped=!0;const W=o({props:{netId:{type:String,default:function(){return null}},information:{type:String,default:function(){return null}},amount:{type:Number,default:function(){return 0}},from:{type:String,default:function(){return null}},to:{type:String,default:function(){return null}},isContract:{type:Boolean,default:function(){return!1}},functionName:{type:String,default:function(){return null}},functionPayable:{type:Boolean,default:function(){return!1}},argsNames:{type:Array,default:function(){return[]}},argsTypes:{type:Array,default:function(){return[]}},argsValues:{type:Array,default:function(){return[]}}},data:()=>({qr:null,id:null}),watch:{id(){this.computeCanvas()}},created(){this.id=`QRCode${parseInt(1e4*Math.random()).toString()}`},methods:{computeCanvas(){this.qr||(this.qr=new window.EthereumQRPlugin);const t={};if(this.amount&&(t.value=parseInt(window.localWeb3.utils.toWei(this.amount.toString(),"ether"))),this.netId&&(t.chainId=this.netId),this.to&&(t.to=this.to),this.from&&(t.from=this.from),(window.walletSettings.network&&window.walletSettings.network.gasLimit&&this.isContract||this.amount>0)&&(t.gas=window.walletSettings.network.gasLimit),this.isContract&&(t.mode="contract_function",t.functionSignature={},t.functionSignature.name=this.functionName,t.functionSignature.payable=this.functionPayable,this.argsNames.length===this.argsTypes.length&&this.argsTypes.length===this.argsValues.length)){t.functionSignature.args=[],t.argsDefaults=[];for(let e=0;e<this.argsNames.length;e++){const a=this.argsNames[e],s=this.argsTypes[e],l=this.argsValues[e];t.functionSignature.args.push({name:a,type:s}),t.argsDefaults.push({name:a,value:l})}}return this.qr.toCanvas(t,{selector:`#${this.id}`}).then(((t,e)=>{e&&console.error("qrCode",e)}))}}},D,[],!1,null,null,null).exports;var L=function(){var t=this,e=t._self._c;return e("v-dialog",{attrs:{"content-class":"uiPopup with-overflow walletDialog",width:"500px","max-width":"100vw"},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"]))return null;t.dialog=!1}},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[e("v-card",{staticClass:"elevation-12"},[e("div",{staticClass:"ignore-vuetify-classes popupHeader ClearFix"},[e("a",{staticClass:"uiIconClose pull-right",attrs:{"aria-hidden":"true"},on:{click:function(e){t.dialog=!1}}}),t._v(" "),e("span",{staticClass:"ignore-vuetify-classes PopupTitle popupTitle"},[t._v("\n          "+t._s(t.title)+"\n        ")])]),t._v(" "),e("v-card-text",[e("wallet-reward-qr-code",{ref:"qrCode",attrs:{"net-id":t.netId,from:t.from,to:t.to,"is-contract":t.isContract,"function-payable":t.functionPayable,"function-name":t.functionName,"args-names":t.argsNames,"args-types":t.argsTypes,"args-values":t.argsValues,amount:t.amount,open:t.open,information:t.information}})],1)],1)],1)};L._withStripped=!0;const M=o({props:{title:{type:String,default:function(){return null}},information:{type:String,default:function(){return null}},open:{type:Boolean,default:function(){return!1}},amount:{type:Number,default:function(){return 0}},from:{type:String,default:function(){return null}},to:{type:String,default:function(){return null}},isContract:{type:Boolean,default:function(){return!1}},functionName:{type:String,default:function(){return null}},functionPayable:{type:Boolean,default:function(){return!1}},argsNames:{type:Array,default:function(){return[]}},argsTypes:{type:Array,default:function(){return[]}},argsValues:{type:Array,default:function(){return[]}}},data:()=>({dialog:!1,netId:null}),watch:{open(){this.open&&(this.dialog=!0,this.computeCanvas())},dialog(){this.dialog||(this.netId=null,this.$emit("close"))}},methods:{computeCanvas(){this.$refs&&this.$refs.qrCode&&this.$refs.qrCode.computeCanvas()}}},L,[],!1,null,null,null).exports;var N=function(){var t=this,e=t._self._c;return e("exo-drawer",{ref:"sendTokensForm",attrs:{right:!t.$vuetify.rtl}},[e("template",{slot:"title"},[e("div",[e("i",{staticClass:"uiIcon uiArrowBAckIcon",on:{click:t.close}}),t._v(" "),e("span",[t._v(" "+t._s(t.$t("exoplatform.wallet.button.sendfunds"))+" ")])])]),t._v(" "),e("template",{slot:"content"},[e("v-card",{staticClass:"mt-6",attrs:{id:"sendTokenForm",flat:""}},[e("v-card-text",{staticClass:"pt-0"},[t.error&&!t.loading?e("div",{staticClass:"alert alert-error v-content"},[e("i",{staticClass:"uiIconError"}),t._v(t._s(t.error)+"\n        ")]):t._e(),t._v(" "),!t.error&&t.warning&&t.warning.length?e("div",{staticClass:"alert alert-warning v-content"},[e("i",{staticClass:"uiIconWarning"}),t._v(t._s(t.warning)+"\n        ")]):t._e(),t._v(" "),e("v-form",{ref:"form",on:{submit:function(t){t.preventDefault(),t.stopPropagation()}}},[e("wallet-reward-address-auto-complete",{ref:"autocomplete",attrs:{disabled:t.loading||t.disabledRecipient,"input-label":t.$t("exoplatform.wallet.label.recipient"),"input-placeholder":t.$t("exoplatform.wallet.label.recipientPlaceholder"),"ignore-current-user":!t.isSpace,autofocus:"true",required:"","validate-on-blur":""},on:{"item-selected":function(e){t.recipient=e.address,t.$emit("receiver-selected",e)}}}),t._v(" "),e("p",{staticClass:"amountLabel mb-0 mt-2"},[t._v(" "+t._s(t.$t("exoplatform.wallet.label.amount"))+" ")]),t._v(" "),e("v-text-field",{ref:"amount",staticClass:"mt-n4",attrs:{disabled:t.loading||t.transaction,placeholder:t.$t("exoplatform.wallet.label.amountPlaceholder"),type:"number",name:"amount",required:"","validate-on-blur":""},on:{input:function(e){return t.$emit("amount-selected",t.amount)}},model:{value:t.amount,callback:function(e){t.amount=t._n(e)},expression:"amount"}}),t._v(" "),!t.storedPassword&&t.isInternalWallet?e("p",{staticClass:"amountLabel mb-0 mt-2"},[t._v(t._s(t.$t("exoplatform.wallet.label.walletPassword")))]):t.isInternalWallet?t._e():e("p",{staticClass:"amountLabel mb-0 mt-2"},[t._v(t._s(t.$t("exoplatform.wallet.label.settings.internal")))]),t._v(" "),t.isInternalWallet?t._e():e("v-row",{staticClass:"pl-5"},[e("v-col",{staticClass:"d-flex align-center ml-n5",attrs:{cols:"12",sm:"6"}},[e("img",{staticClass:"mt-n1",attrs:{src:"/wallet-common/images/metamask.svg",alt:"Metamask",width:"18"}}),t._v(" "),e("span",{staticClass:"pl-2 amountLabel"},[t._v(t._s(t.$t("exoplatform.wallet.label.metamask")))])]),t._v(" "),e("v-col",{attrs:{cols:"12",sm:"6",align:"right"}},[e("v-chip",{staticClass:"grey-background"},[e("span",{staticClass:"mr-3 dark-grey-color walletTitle"},[t._v("\n                  "+t._s(t.metamaskAddressPreview)+"\n                ")]),t._v(" "),e("wallet-settings-jdenticon",{attrs:{address:t.walletAddress}})],1)],1)],1),t._v(" "),!t.storedPassword&&t.isInternalWallet?e("v-text-field",{ref:"walletPassword",staticClass:"mt-n4",attrs:{"append-icon":t.walletPasswordShow?"mdi-eye":"mdi-eye-off",type:t.walletPasswordShow?"text":"password",disabled:t.loading,rules:t.mandatoryRule,placeholder:t.$t("exoplatform.wallet.label.walletPasswordPlaceholder"),name:"walletPassword",required:"","validate-on-blur":"",autocomplete:"current-password"},on:{"click:append":function(e){t.walletPasswordShow=!t.walletPasswordShow}},model:{value:t.walletPassword,callback:function(e){t.walletPassword=e},expression:"walletPassword"}}):t._e(),t._v(" "),e("v-text-field",{attrs:{disabled:t.loading||t.transaction,label:t.$t("exoplatform.wallet.label.transactionLabel"),placeholder:t.$t("exoplatform.wallet.label.transactionLabelPlaceholder"),type:"text",name:"transactionLabel"},model:{value:t.transactionLabel,callback:function(e){t.transactionLabel=e},expression:"transactionLabel"}}),t._v(" "),e("v-textarea",{attrs:{disabled:t.loading||t.transaction,label:t.$t("exoplatform.wallet.label.transactionMessage"),placeholder:t.$t("exoplatform.wallet.label.transactionMessagePlaceholder"),name:"tokenTransactionMessage",flat:"","no-resize":""},model:{value:t.transactionMessage,callback:function(e){t.transactionMessage=e},expression:"transactionMessage"}})],1)],1)],1)],1),t._v(" "),e("template",{slot:"footer"},[t.displayMetamaskWarnings?e("div",[e("wallet-metamask-warnings",{attrs:{"not-installed":!t.metamaskInstalled,"not-connected":!t.metamaskConnected,"invalid-network":t.invalidMetamaskNetwork,"invalid-account":t.invalidMetamaskAccount}})],1):e("div",{staticClass:"VuetifyApp flex d-flex"},[e("v-spacer"),t._v(" "),e("button",{staticClass:"ignore-vuetify-classes btn mx-1",attrs:{disabled:t.disabled,color:"secondary"},on:{click:function(e){t.showQRCodeModal=!0}}},[t._v("\n        "+t._s(t.$t("exoplatform.wallet.button.qrCode"))+"\n      ")]),t._v(" "),e("button",{staticClass:"ignore-vuetify-classes btn btn-primary",attrs:{disabled:t.disabled,loading:t.loading},on:{click:t.sendTokens}},[t._v("\n        "+t._s(t.$t("exoplatform.wallet.button.send"))+"\n      ")]),t._v(" "),e("wallet-reward-qr-code-modal",{ref:"qrCodeModal",attrs:{to:t.recipient,from:t.walletAddress,amount:0,"is-contract":!0,"args-names":["_to","_value"],"args-types":["address","uint256"],"args-values":[t.recipient,t.amount],open:t.showQRCodeModal,"function-payable":!1,title:t.$t("exoplatform.wallet.title.sendTokenQRCode"),information:t.$t("exoplatform.wallet.message.sendTokenQRCodeMessage"),"function-name":"transfer"},on:{close:function(e){t.showQRCodeModal=!1}}})],1)])],2)};N._withStripped=!0;const B={aud:{value:"aud",text:"Australia Dollar (AUD)",symbol:"$ (AUD)"},brl:{value:"brl",text:"Brazil Real (R$)",symbol:"R$"},cad:{value:"cad",text:"Canadian dollar (CAD)",symbol:"$ (CAD)"},chf:{value:"chf",text:"Switzerland Franc (CHF)",symbol:"CHF"},clp:{value:"clp",text:"Chile Peso (CLP)",symbol:"$ (CLP)"},cny:{value:"cny",text:"China Yuan Renminbi (CNY)",symbol:"¥ (CNY)"},czk:{value:"czk",text:"Czech Republic Koruna (Kč)",symbol:"Kč"},dkk:{value:"dkk",text:"Denmark Krone (DKK)",symbol:"kr (DKK)"},eur:{value:"eur",text:"Euro Member Countries (€)",symbol:"€"},gbp:{value:"gbp",text:"United Kingdom Pound (£)",symbol:"£"},hkd:{value:"hkd",text:"Hong Kong Dollar (HKD)",symbol:"$ (HKD)"},huf:{value:"huf",text:"Hungary Forint (Ft)",symbol:"Ft"},idr:{value:"idr",text:"Indonesia Rupiah (Rp)",symbol:"Rp"},inr:{value:"inr",text:"India Rupee (INR)",symbol:"INR"},jpy:{value:"jpy",text:"Japan Yen (¥)",symbol:"¥"},krw:{value:"krw",text:"Korea (South) Won (₩)",symbol:"₩"},mxn:{value:"mxn",text:"Mexico Peso (MXN)",symbol:"$ (MXN)"},myr:{value:"myr",text:"Malaysia Ringgit (RM)",symbol:"RM"},nok:{value:"nok",text:"Norway Krone (NOK)",symbol:"kr (NOK)"},nzd:{value:"nzd",text:"New Zealand Dollar (NZD)",symbol:"$ (NZD)"},php:{value:"php",text:"Philippines Piso (₱)",symbol:"₱"},pkr:{value:"pkr",text:"Pakistan Rupee (₨)",symbol:"₨"},pln:{value:"pln",text:"Poland Zloty (zł)",symbol:"zł"},usd:{value:"usd",text:"United States Dollar ($)",symbol:"$"},rub:{value:"rub",text:"Russia Ruble (₽)",symbol:"₽"},sek:{value:"sek",text:"Sweden Krona (SEK)",symbol:"kr (SEK)"},sgd:{value:"sgd",text:"Singapore Dollar (SGD)",symbol:"$ (SGD)"},thb:{value:"thb",text:"Thailand Baht (THB)",symbol:"฿ (THB)"},try:{value:"try",text:"Turkey Lira (TRY)",symbol:"TRY"},twd:{value:"twd",text:"Taiwan New Dollar (NT$)",symbol:"NT$"},zar:{value:"zar",text:"South Africa Rand (ZAR)",symbol:"R (ZAR)"}},F={0:"",1:"Ethereum Main",2:"Ethereum Classic main",3:"Ropsten",4:"Rinkeby",42:"Kovan"},O="OK",R="ERROR_WALLET_NOT_CONFIGURED",U="ERROR_WALLET_SETTINGS_NOT_LOADED",K="ERROR_WALLET_DISCONNECTED";function j(t){const e=window.walletSettings&&window.walletSettings.contractDetail;if(e&&e.address)return X(e.address).then((a=>(Object.assign(e,a),q(t))))}function q(t){const e=window.walletSettings.contractDetail;if(e&&!e.icon){if(e.icon="fa-file-contract",e.title=e.name,e.isContract=!0,e.fiatBalance=e.fiatBalance||e.etherBalance&&mt(e.etherBalance),!e.contract&&t)try{e.contract=J(t,e.address)}catch(t){!function(t,e){t.icon="warning",t.title=t.address,t.error="Error retrieving contract at specified address "}(e),console.error("getContractDetails method - error retrieving contract instance",e.address,new Error(t))}window.walletContractsDetails||(window.walletContractsDetails={}),window.walletContractsDetails[e.address]=e,window.walletContractsDetails[e.address.toLowerCase()]=e}return e}function z(t,e,...a){return t&&e?a&&a.length?new window.localWeb3.eth.Contract(t).deploy({data:e,arguments:a}):new window.localWeb3.eth.Contract(t).deploy({data:e}):null}function X(t){return fetch(`/portal/rest/wallet/api/contract?address=${t}`,{method:"GET",credentials:"include"}).then((e=>{if(e&&e.ok)return e.json();throw new Error(`Error getting contract details from server with address ${t}`)})).then((t=>(t&&(t.fiatBalance=t.fiatBalance||t.etherBalance&&mt(t.etherBalance)),t&&t.address?t:null))).catch((t=>(console.error("Error getting contract details from server",t),null)))}function H(t,...e){let a;return et(t).then((t=>a=t)).then((()=>z(a.abi,a.bin,...e))).then((t=>(t.abi=a.abi,t.bin=a.bin,t)))}function G(t,e){let a;return et(t).then((t=>a=t)).then((()=>J(window.localWeb3.eth.defaultAccount,e,!1,a.abi,a.bin))).then((t=>(t.abi=a.abi,t.bin=a.bin,t)))}function V(t){return t.estimateGas(((t,e)=>{if(t)throw new Error(`Error while estimating contract deployment gas ${t}`);return e}))}function Q(){const t=`exo-wallet-contract-deployment-progress-${window.walletSettings.network.id}`,e=localStorage.getItem(t);return null===e?{}:JSON.parse(e)}function Y(t){const e=`exo-wallet-contract-deployment-progress-${window.walletSettings.network.id}`;let a=localStorage.getItem(e);null!==a&&(a=JSON.parse(a),a[t]&&(delete a[t],localStorage.setItem(e,JSON.stringify(a))))}function J(t,e,a,s,l){try{const n=new window.localWeb3.eth.Contract(s||JSON.parse(window.walletSettings.contractAbi),e,{from:t&&t.toLowerCase(),gas:window.walletSettings.network.gasLimit,gasPrice:window.walletSettings.network.normalGasPrice,data:l||window.walletSettings.contractBin});return a?Promise.resolve(n):n}catch(t){return console.error("An error occurred while retrieving contract instance",new Error(t)),a?Promise.reject(t):null}}function Z(t,e,a){let s=0;const l=t.boost?Promise.resolve(t.nonce):tt(n=t.from,"pending").then((t=>rt(n).then((e=>Math.max(Number(t),Number(e)))))).catch((t=>{console.error("Error getting last nonce of wallet address",n,t)}));var n;return l.then((l=>{s=l;const n={nonce:s,to:t.contractAddress,gasPrice:t.gasPrice,gas:t.gas,value:t&&t.value&&window.localWeb3.utils.toWei(String(t.value),"ether")||0,data:e(...a).encodeABI()};return window.localWeb3.eth.accounts.signTransaction(n,window.localWeb3.eth.accounts.wallet[0].privateKey)})).then((e=>{if(!e.rawTransaction)throw new Error("Can't generate a transaction to send");return t.nonce=s,t.rawTransaction=e.rawTransaction,lt(t)}))}function tt(t,e){return window.localWeb3.eth.getTransactionCount(t,e||"latest")}function et(t){let e;return fetch(`/portal/rest/wallet/api/contract/bin/${t}`,{method:"GET",credentials:"include"}).then((e=>{if(e&&e.ok)return e.text();throw new Error(`Cannot find contract BIN with name ${t}`)})).then((t=>e=0===t.indexOf("0x")?t:`0x${t}`)).then((()=>fetch(`/portal/rest/wallet/api/contract/abi/${t}`,{method:"GET",credentials:"include"}))).then((e=>{if(e&&e.ok)return e.json();throw new Error(`Cannot find contract ABI with name ${t}`)})).then((t=>({abi:t,bin:e})))}function at(t,e,a,s,l,n,i){return l||(l=10),it(t,e&&e.isContract&&e.address,l,n,s,i).then((e=>(e&&e.length&&e.forEach((e=>{!function(t,e,a,s){if(s){if(s.type=s.contractAddress?"contract":"ether",s.contractAddress){const e=window.walletContractsDetails[s.contractAddress];e?ct(t,s,e):X(s.contractAddress).then((e=>{ct(t,s,e)}))}else!function(t,e){t=t&&t.toLowerCase(),!e.fee&&e.gasUsed&&e.gasPrice&&(e.fee=e.gasUsed&&e.gasPrice&&window.localWeb3.utils.fromWei(String(e.gasUsed*e.gasPrice),"ether")),!e.feeFiat&&e.fee&&(e.feeFiat=mt(e.fee)),wt(e,"from"),wt(e,"to"),e.isReceiver=t===e.to,e.amountFiat=e.amountFiat||e.value&&mt(e.value),e.timestamp&&(e.dateFormatted=`${new Date(e.timestamp).toLocaleString(eXo.env.portal.language,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})}`),e.sentTimestamp&&(e.sentDateFormatted=`${new Date(e.sentTimestamp).toLocaleString(eXo.env.portal.language,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})}`)}(t,s);a[s.hash]=s}}(t,0,a,e)})),e)))}function st(t){return fetch(`/portal/rest/wallet/api/transaction/refreshTransactionFromBlockchain?hash=${t}`,{method:"GET",credentials:"include",headers:{Accept:"application/json"}}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error while sending transaction")}))}function lt(t){return fetch("/portal/rest/wallet/api/transaction/saveTransactionDetails",{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error while sending transaction")}))}function nt(t,e,a){const s=window&&window.eXo&&window.eXo.env&&window.eXo.env.portal&&window.eXo.env.portal.language||"en";return fetch(`/portal/rest/wallet/api/transaction/getTransactionsAmounts?address=${t}&periodicity=${e||""}&date=${a||""}&lang=${s}`,{credentials:"include"}).then((t=>t&&t.ok?t.json():null))}function it(t,e,a,s,l,n){const i=s&&s.hash,r=s&&s.contractMethodName;return fetch(`/portal/rest/wallet/api/transaction/getTransactions?address=${t||""}&contractAddress=${e||""}&contractMethodName=${r||""}&limit=${a}&hash=${i||""}&pending=${l||!1}&administration=${n||!1}`,{credentials:"include"}).then((t=>t&&t.ok?t.json():null)).then((t=>t&&t.length?t:[])).catch((t=>{throw new Error("Error retrieving transactions list",t)}))}function rt(t){return fetch(`/portal/rest/wallet/api/transaction/getNonce?from=${t}`,{credentials:"include"}).then((t=>t&&t.ok?t.text():null))}function ot(){return fetch("/portal/rest/wallet/api/transaction/getGasPrice",{credentials:"include"}).then((t=>t&&t.ok?t.text():null))}function dt(t){return fetch(`/portal/rest/wallet/api/transaction/getSavedTransactionByHash?hash=${t}`,{credentials:"include"}).then((t=>{if(t&&t.ok){const e=t.headers&&t.headers.get("content-type");return e&&-1!==e.indexOf("application/json")?t.json():null}return null}))}function ct(t,e,a){a&&function(t,e){e&&(t.type="contract",t.contractName=e.name,t.contractAddress=e.address,t.contractAmountLabel=t.contractAmountLabel||"Amount",t.contractSymbol=t.contractSymbol||e.symbol,t.contractDecimals=t.contractDecimals||e.decimals||0)}(e,a),t=t&&t.toLowerCase(),!e.fee&&e.gasUsed&&e.gasPrice&&(e.fee=window.localWeb3.utils.fromWei(String(e.gasUsed*e.gasPrice),"ether")),!e.feeFiat&&e.fee&&(e.feeFiat=mt(e.fee)),"addAdmin"===e.contractMethodName?(e.contractSymbol="",e.contractAmountLabel="Admin level"):"setSellPrice"===e.contractMethodName?(e.contractSymbol="eth",e.contractAmountLabel="New sell price"):"upgradeData"===e.contractMethodName||"upgradeImplementation"===e.contractMethodName?(e.contractSymbol="",e.contractAmountLabel="Version"):"transformToVested"===e.contractMethodName?e.contractAmountLabel="Initialization amount":"reward"===e.contractMethodName&&(e.contractAmountLabel="Rewarded amount"),wt(e,"from"),wt(e,"to"),wt(e,"by"),e.amountFiat=e.amountFiat||e.value&&mt(e.value),e.isReceiver=t===e.to,e.timestamp&&(e.dateFormatted=`${new Date(e.timestamp).toLocaleString(eXo.env.portal.language,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})}`),e.sentTimestamp&&(e.sentDateFormatted=`${new Date(e.sentTimestamp).toLocaleString(eXo.env.portal.language,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})}`),e.adminIcon=e.adminIcon||e.contractMethodName&&"transfer"!==e.contractMethodName&&"initializeAccount"!==e.contractMethodName&&"transferFrom"!==e.contractMethodName&&"approve"!==e.contractMethodName&&"reward"!==e.contractMethodName}function wt(t,e){if(!t[`${e}DisplayName`]){const a=t[e]&&t[e].toLowerCase();if(!a||t.contractAddress&&a===t.contractAddress.toLowerCase())return;if(t[`${e}Address`]=a.toLowerCase(),window.walletSettings.contractAddress&&t[`${e}Address`]===window.walletSettings.contractAddress.toLowerCase())return void(t[`${e}DisplayName`]="Admin");t[`${e}Wallet`]&&(t[`${e}TechnicalId`]=t[`${e}Wallet`].technicalId,t[`${e}SpaceId`]=t[`${e}Wallet`].spaceId,t[`${e}Username`]=t[`${e}Wallet`].id,t[`${e}Type`]=t[`${e}Wallet`].type,t[`${e}Avatar`]=t[`${e}Wallet`].avatar,t[`${e}DisplayName`]=t[`${e}Wallet`].name)}}const ut={137:{chainName:"Polygon Mainnet",chainId:"0x89",nativeCurrency:{decimals:18,name:"MATIC",symbol:"MATIC"},rpcUrls:["https://polygon-rpc.com/","https://rpc-mainnet.matic.network","https://matic-mainnet.chainstacklabs.com","https://rpc-mainnet.maticvigil.com","https://rpc-mainnet.matic.quiknode.pro","https://matic-mainnet-full-rpc.bwarelabs.com"],blockExplorerUrls:["https://polygonscan.com"]},80001:{chainName:"Mumbai",chainId:"0x13881",nativeCurrency:{decimals:18,name:"MATIC",symbol:"MATIC"},rpcUrls:["https://matic-mumbai.chainstacklabs.com","https://rpc-mumbai.maticvigil.com","https://matic-testnet-archive-rpc.bwarelabs.com"],blockExplorerUrls:["https://mumbai.polygonscan.com"]}};function mt(t){return window.walletSettings.fiatPrice&&t?Xt(window.walletSettings.fiatPrice*t):0}function pt(t,e){return e&&t?e*t:0}function ht(t){return(t=t||window.walletSettings.wallet.address)?(t=t.toLowerCase(),localStorage.getItem(t)?fetch("/portal/rest/wallet/api/account/savePrivateKey",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:$.param({address:t,privateKey:localStorage.getItem(t)})}).then((e=>{if(e&&e.ok)return vt(t);throw new Error("Error saving keys on server")})):Promise.reject(new Error("No private key was found"))):Promise.reject(new Error("Can't find current wallet address"))}function ft(t){return(t=t||window.walletSettings.wallet.address)?(t=t.toLowerCase(),fetch(`/portal/rest/wallet/api/account/removePrivateKey?address=${t}`,{credentials:"include"}).then((t=>t&&t.ok))):Promise.reject(new Error("Can't find current wallet address"))}function vt(t){return(t=t||window.walletSettings.wallet.address)?fetch(`/portal/rest/wallet/api/account/getPrivateKey?address=${t}`,{credentials:"include"}).then((t=>{if(t&&t.ok)return t.text()})).then((e=>{if(!e)throw new Error("No private key was found on server");return localStorage.setItem(t,e),!0})):Promise.reject(new Error("Can't find current wallet address"))}function gt(t,e){return window.walletSettings&&window.walletSettings.fiatPrice&&e&&t?Xt(e*window.walletSettings.fiatPrice*t):0}function bt(){window.localWeb3=new LocalWeb3}function yt(t){if(!window.walletSettings||!window.walletSettings.userPreferences)throw new Error(U);return function(t){if(!(window.walletSettings&&window.walletSettings.network&&window.walletSettings.wallet&&window.walletSettings.network.providerURL))throw bt(),new Error(R);{const e=new LocalWeb3.providers.HttpProvider(window.walletSettings.network.providerURL);window.localWeb3=new LocalWeb3(e),window.walletSettings.wallet?.address&&(window.localWeb3.eth.defaultAccount=window.walletSettings.wallet.address.toLowerCase()),t&&!window.walletSettings.wallet.spaceAdministrator?window.walletSettings.isReadOnly=!0:window.walletSettings.isReadOnly=!window.walletSettings.browserWalletExists}}(t)}function _t(t,e,a){const s=t&&eXo.env.portal.spaceId||"";return a=a||!1,Object.keys(sessionStorage).forEach((t=>{0===t.indexOf("exo-wallet-address-")&&sessionStorage.removeItem(t)})),fetch(`/portal/rest/wallet/api/settings?spaceId=${s}&administration=${a}`,{credentials:"include"}).then((t=>t&&t.ok?t.json():null)).then((t=>{if(t&&t.walletEnabled){if(window.walletSettings=window.walletSettings||{},window.walletSettings.userPreferences={currency:"usd"},window.walletSettings.wallet={},window.walletSettings.network={},window.walletSettings.contractDetail={},window.walletSettings=$.extend(window.walletSettings,t),window.walletSettings=$.extend(window.walletSettings,t),e&&!window.walletComedDInitialized&&(window.walletComedDInitialized=!0,document.addEventListener("exo.wallet.transaction.minedAndUpdated",ae),function(t){const e=window.location;cCometd.configure({url:`${e.protocol}//${e.hostname}${e.port?":":""}${e.port||""}/${t.cometdContext}/cometd`,exoId:eXo.env.portal.userName,exoToken:t.cometdToken}),cCometd.subscribe(t.cometdChannel,null,(t=>{const e=t.data&&JSON.parse(t.data);document.dispatchEvent(new CustomEvent(e.eventId,{detail:e&&e.message}))}))}(window.walletSettings)),"METAMASK"===window.walletSettings?.wallet?.provider){const t=Jt(),e=Yt();window.walletSettings.metamask={connected:t,installed:e},e&&(t&&(Vt(),Qt()),window.ethereum.on("connect",(()=>{window.walletSettings.metamask.connected=!0,Qt().finally((()=>document.dispatchEvent(new CustomEvent("wallet-metamask-chainChanged",{detail:window.walletSettings.metamask.networkId})))),Vt().finally((()=>document.dispatchEvent(new CustomEvent("wallet-metamask-accountsChanged",{detail:window.walletSettings.metamask.address})))),document.dispatchEvent(new CustomEvent("wallet-metamask-connected"))})),window.ethereum.on("disconnect",(()=>{window.walletSettings.metamask.connected=!1,window.walletSettings.metamask.networkId=null,window.walletSettings.metamask.address=null,document.dispatchEvent(new CustomEvent("wallet-metamask-disconnected"))})),window.ethereum.on("accountsChanged",(()=>{Vt().finally((()=>document.dispatchEvent(new CustomEvent("wallet-metamask-accountsChanged",{detail:window.walletSettings.metamask.address}))))})),window.ethereum.on("chainChanged",(()=>{Qt().finally((()=>document.dispatchEvent(new CustomEvent("wallet-metamask-chainChanged",{detail:window.walletSettings.metamask.networkId}))))})))}}else window.walletSettings={walletEnabled:!1}})).then((()=>{if(window.walletSettings.userPreferences&&window.walletSettings.userPreferences.hasKeyOnServerSide&&window.walletSettings.wallet.address&&"INTERNAL_WALLET"===window.walletSettings.wallet.provider)return vt(window.walletSettings.wallet.address).then((t=>{})).catch((t=>{console.error("Error retrieving wallet private key from server",t)}))})).then((()=>{if("INTERNAL_WALLET"===window.walletSettings.wallet.provider){window.walletSettings.browserWalletExists=le(window.walletSettings.wallet.address);const t=window.walletSettings.wallet.address;t&&(window.walletSettings.userP=localStorage.getItem(`exo-wallet-${t}-userp`),window.walletSettings.storedPassword=window.walletSettings.userP&&window.walletSettings.userP.length>0)}else window.walletSettings.browserWalletExists=!0;const e=function(t){return t?window.walletSpaceGroup:eXo.env.portal.userName}(t);if(t&&e)return h(e,"space").then(((t,e)=>{if(e)throw e;return t&&t.spaceAdministrator?window.walletSettings.wallet.spaceAdministrator=!0:(window.walletSettings.isReadOnly=!0,window.walletSettings.wallet.spaceAdministrator=!1)}))})).catch((t=>{throw console.error("initSettings method - error",t),t}))}function St(t,e){e&&t&&(t=t.toLowerCase(),window.watchingTransactions||(window.watchingTransactions={}),window.watchingTransactions[t]?window.watchingTransactions[t].push(e):window.watchingTransactions[t]=[e])}function xt(t,e,a,s,l){const n=window.localWeb3.eth.accounts.wallet.add(t).address.toLowerCase();let i=null;return i=window.walletSettings&&window.walletSettings.wallet&&window.walletSettings.wallet.address&&"DELETED"!==window.walletSettings.wallet.initializationState?Promise.resolve():u(a?window.walletSpaceGroup:eXo.env.portal.userName,a?"space":"user",n).then(((t,e)=>{if(e)throw e;if(t&&t.ok)return t.text();throw new Error("Error saving new Wallet address")})).then((t=>{window.walletSettings.userPreferences=window.walletSettings.userPreferences||{},window.walletSettings.userPreferences.phrase=t})),i.then((()=>(kt(e,null,n,s),ht(n)))).then((()=>{l&&Lt()}))}function kt(t,e,a,s){if(e||(e=window.walletSettings.userPreferences.phrase),a||(a=window.walletSettings.wallet.address),!t||!t.length)throw new Error("Password is mandatory");if(!e||!e.length)throw new Error("Empty user settings");if(!a||!a.length)throw new Error("Address is empty");if(t=Mt(t),!window.localWeb3.eth.accounts.wallet.save(t+e,a)||!le(a))throw new Error("An unknown error occrred while saving new wallet");if($t(s,t,a),!Wt(t,e,a))throw new Error("An unknown error occrred while unlocking newly saved wallet");Dt(a)}function $t(t,e,a){if(!(a=a||window.walletSettings.wallet.address))throw new Error("Can't find address of user");t?(localStorage.setItem(`exo-wallet-${a}-userp`,e),window.walletSettings.userP=e,window.walletSettings.storedPassword=!0):(localStorage.removeItem(`exo-wallet-${a}-userp`),window.walletSettings.userP=null,window.walletSettings.storedPassword=!1)}function Ct(){switch(window.walletSettings.network.id){case 1:return"Etherscan";case 3:return"Ropsten Etherscan";case 5:return"Goerli Etherscan";case 137:return"Polygonscan";case 80001:return"Mumbai Polygonscan";default:return"#"}}function Pt(){switch(window.walletSettings.network.id){case 1:return"https://etherscan.io/address/";case 3:return"https://ropsten.etherscan.io/address/";case 5:return"https://goerli.etherscan.io/address/";case 137:return"https://polygonscan.com/address/";case 80001:return"https://mumbai.polygonscan.com/address/";default:return"#"}}function At(){switch(window.walletSettings.network.id){case 1:return"https://etherscan.io/token/";case 3:return"https://ropsten.etherscan.io/token/";case 5:return"https://goerli.etherscan.io/token/";case 137:return"https://polygonscan.com/token/";case 80001:return"https://mumbai.polygonscan.com/token/";default:return"#"}}function Tt(){switch(window.walletSettings.network.id){case 1:return"https://etherscan.io/tx/";case 3:return"https://ropsten.etherscan.io/tx/";case 5:return"https://goerli.etherscan.io/tx/";case 137:return"https://polygonscan.com/tx/";case 80001:return"https://mumbai.polygonscan.com/tx/";default:return"#"}}function It(){switch(window.walletSettings.network.id){case 1:return"https://etherscan.io";case 3:return"https://ropsten.etherscan.io";case 5:return"https://goerli.etherscan.io";case 80001:case 137:return"https://polygon.technology";default:return"#"}}function Et(){return window&&window.localWeb3&&window.localWeb3.eth.accounts.wallet&&window.walletSettings.wallet.address&&window.localWeb3.eth.accounts.wallet[window.walletSettings.wallet.address]}function Dt(t){(t=t||window.walletSettings.wallet.address)&&window.localWeb3.eth.accounts.wallet.remove(t)}function Wt(t,e,a){if(e&&e.length||(e=window.walletSettings.userPreferences.phrase),a&&a.length||(a=window.walletSettings.wallet.address),t&&t.length||(t=window.walletSettings.userP),!(t&&t.length&&e&&e.length&&a&&a.length))return!1;try{se(a)&&Dt(a),window.localWeb3.eth.accounts.wallet.load(t+e,a)}catch(t){return console.error("error while unlocking wallet",t),!1}return se(a)}function Lt(){return fetch("/portal/rest/wallet/api/account/saveBackupState",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:$.param({walletId:window.walletSettings.wallet.technicalId,backedUp:!0})}).then((t=>{if(t&&t.ok)return t.json();throw new Error})).then((t=>window.walletSettings.wallet=t))}function Mt(t){let e=0,a=0;if(t&&t.length>0)for(;a<t.length;)e=(e<<5)-e+t.charCodeAt(a++)|0;return String(e)}function Nt(t){return t?((t=String(t)).indexOf(" at ")>=0&&(t=t.substring(0,t.indexOf(" at "))),(String(t).indexOf("transaction underpriced")>=0||String(t).indexOf("nonce too low")>=0||String(t).indexOf("known transaction")>=0)&&(t="Another transaction is in progress please wait until the first transaction is finished"),t):""}function Bt(t){return fetch(`/portal/rest/wallet/api/account/markFundRequestAsSent?notificationId=${t}`,{credentials:"include"}).then((t=>t&&t.ok))}function Ft(t){return fetch(`/portal/rest/wallet/api/account/fundRequestSent?notificationId=${t}`,{credentials:"include"}).then((t=>{if(t&&t.ok)return t.text();throw new Error("Error checking fund request status")})).then((t=>"true"===t))}function Ot(){return fetch("/portal/rest/wallet/api/account/list",{credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error retrieving wallets")}))}function Rt(t){return fetch(`/portal/rest/wallet/api/account/remove?address=${t}`,{credentials:"include"}).then((t=>t&&t.ok))}function Ut(t,e){return fetch(`/portal/rest/wallet/api/account/enable?address=${t}&enable=${e}`,{credentials:"include"}).then((t=>t&&t.ok))}function Kt(t,e){if(0===e)return t;const a=LocalWeb3.utils.toBN,s=a(10).pow(a(e)),l="-"===String(t).substring(0,1);l&&(t=t.substring(1));const n=String(t).split(".");let i=n[0],r=n[1]?n[1]:"0";if(r.length>e)throw new Error(`number Fractions ${r.length} exceed number of decimals ${e}`);for(;r.length<e;)r+="0";i=a(i),r=a(r);let o=i.mul(s).add(r);return l&&(o=o.mul(-1)),o.toString(10)}function jt(t,e){if(0===e)return t;const a=LocalWeb3.utils.toBN;let s=a(t);const l=s.lt(0),n=a(10).pow(a(e));l&&(s=s.mul(-1));let i=s.mod(n).toString(10);for(;i.length<e;)i=`0${i}`;i=i.match(/^([0-9]*[1-9]|0)(0*)/)[1];let r=`${s.div(n).toString(10)}${"0"===i?"":`.${i}`}`;return l&&(r=`-${r}`),r}function qt(t,e){if(!e||!t)return 0;const a=LocalWeb3.utils.toBN(t).mul(LocalWeb3.utils.toBN(e));return LocalWeb3.utils.fromWei(a.toString(),"ether")}function zt(t,e){return e&&t?mt(qt(t,e)):0}function Xt(t,e){e||(e=3);try{return Number.parseFloat(t).toFixed(e).replace(/(\..*[1-9])0+$/,"$1").replace(/\.0*$/,"")}catch(e){return console.error("Error parsing value ",t," same value will be retruned",e),t}}function Ht(t,e){return fetch(`/portal/rest/wallet/api/account/setInitializationStatus?address=${t}&status=${e}`,{credentials:"include"}).then((t=>{if(!t||!t.ok)throw new Error("Error while changing initialization status of wallet")}))}function Gt(t){return fetch(`/portal/rest/wallet/api/account/deleteWallet?address=${t}`,{credentials:"include"}).then((t=>{if(!t||!t.ok)throw new Error("Error while deleting wallet")}))}function Vt(){return window.ethereum?.request({method:"eth_accounts"}).then((t=>window.walletSettings.metamask.address=t&&t.length&&t[0]||null))}function Qt(){return window.ethereum?.request({method:"eth_chainId"}).then((t=>window.walletSettings.metamask.networkId=Number(t)))}function Yt(){return window.ethereum&&window.ethereum.isMetaMask}function Jt(){return Yt()&&window.ethereum.isConnected()}function Zt(){return window.ethereum.request({method:"eth_requestAccounts"})}function te(){return window.ethereum?.request({method:"wallet_requestPermissions",params:[{eth_accounts:{}}]})||Promise.reject(new Error("No Metamask installed"))}function ee(){const t=ut[window.walletSettings.network.id],e=t?.chainId;return e?window.ethereum&&window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:e}]}).catch((e=>{if(4902===e.code)return window.ethereum.request({method:"wallet_addEthereumChain",params:[t]});throw e}))||Promise.reject(new Error("No Metamask installed")):Promise.reject(new Error("Unexpected Network id"))}function ae(t){return function(t){if(window.watchingTransactions&&window.watchingTransactions[t])return dt(t).then((e=>{window.watchingTransactions[t].forEach((t=>{t(e)})),window.watchingTransactions[t]=null}))}(t&&t.detail&&t.detail.string)}function se(t){return window.localWeb3.eth.accounts.wallet.length>0&&window.localWeb3.eth.accounts.wallet[t]&&window.localWeb3.eth.accounts.wallet[t].privateKey}function le(t){let e=localStorage.getItem(t);return e&&(e=JSON.parse(e)),null!==e&&e.length>0&&null!=e[0]&&e[0].address&&(e[0].address.toLowerCase()===t.toLowerCase()||`0x${e[0].address.toLowerCase()}`===t.toLowerCase())}const ne=o({props:{wallet:{type:Object,default:function(){return null}},transaction:{type:Object,default:function(){return null}},contractDetails:{type:Object,default:function(){return null}},defaultLabel:{type:String,default:function(){return null}},defaultMessage:{type:String,default:function(){return null}}},data(){return{loading:!1,showQRCodeModal:!1,storedPassword:!1,transactionLabel:"",transactionMessage:"",walletPassword:"",walletPasswordShow:!1,recipient:null,notificationId:null,disabledRecipient:!1,canSendToken:!0,amount:null,isSpace:!1,gasPrice:0,estimatedGas:0,fiatSymbol:null,warning:null,error:null,mandatoryRule:[t=>!!t||this.$t("exoplatform.wallet.warning.requiredField")],metamaskAddress:null,metamaskNetworkId:null,metamaskConnected:!1}},computed:{walletAddress(){return this.wallet&&this.wallet.address},metamaskAddressPreview(){return this.walletAddress&&`${this.walletAddress.substring(0,5)}...${this.walletAddress.substring(this.walletAddress.length-4,this.walletAddress.length)}`},disabled(){return!this.walletAddress||this.loading||!this.gasPrice||!this.recipient||!this.amount||!this.canSendToken||this.isInternalWallet&&!this.storedPassword&&(!this.walletPassword||!this.walletPassword.trim().length)},invalidMetamaskAccount(){return!this.metamaskAddress||(this.metamaskAddress||"").toLowerCase()!==(this.walletAddress||"").toLowerCase()},invalidMetamaskNetwork(){return this.metamaskNetworkId!==window.walletSettings?.network?.id},displayMetamaskWarnings(){return this.isMetamaskWallet&&(this.invalidMetamaskNetwork||this.invalidMetamaskAccount||!this.metamaskConnected)},transactionFeeInWei(){return this.estimatedGas&&this.gasPrice?parseInt(this.estimatedGas*this.gasPrice):0},transactionFeeEther(){return this.transactionFeeInWei?window.localWeb3.utils.fromWei(String(this.transactionFeeInWei),"ether"):0},transactionFeeFiat(){return this.transactionFeeEther?mt(this.transactionFeeEther):0},isInternalWallet:()=>"INTERNAL_WALLET"===window.walletSettings.wallet?.provider,isMetamaskWallet:()=>"METAMASK"===window.walletSettings.wallet?.provider},watch:{amount(){this.checkErrors()},recipient(t,e){e!==t&&this.checkErrors()}},created(){this.init(),document.addEventListener("wallet-metamask-accountsChanged",this.updateSelectedMetamaskAddress),document.addEventListener("wallet-metamask-chainChanged",this.updateSelectedMetamaskNetworkId),document.addEventListener("wallet-metamask-connected",this.updateSelectedMetamaskInformation),document.addEventListener("wallet-metamask-disconnected",this.updateSelectedMetamaskInformation)},beforeDestroy(){document.removeEventListener("wallet-metamask-accountsChanged",this.updateSelectedMetamaskAddress),document.removeEventListener("wallet-metamask-chainChanged",this.updateSelectedMetamaskNetworkId),document.removeEventListener("wallet-metamask-chainChanged",this.updateSelectedMetamaskInformation),document.removeEventListener("wallet-metamask-chainChanged",this.updateSelectedMetamaskInformation)},methods:{updateSelectedMetamaskNetworkId(){this.metamaskNetworkId=window.walletSettings.metamask?.networkId},updateSelectedMetamaskAddress(){this.metamaskAddress=window.walletSettings.metamask?.address},updateSelectedMetamaskInformation(){this.metamaskInstalled=window.walletSettings.metamask?.installed,this.metamaskConnected=window.walletSettings.metamask?.connected,this.updateSelectedMetamaskNetworkId(),this.updateSelectedMetamaskAddress()},init(){this.$nextTick((()=>{this.$refs.autocomplete&&(this.$refs.autocomplete.clear(),this.$refs.autocomplete.focus())})),this.$refs.walletPassword&&this.$refs.walletPassword.blur(),this.$refs.amount&&this.$refs.amount.blur(),this.transactionUtils.getGasPrice().then((t=>this.gasPrice=t)),this.recipient=null,this.amount=null,this.notificationId=null,this.warning=null,this.error=null,this.transactionLabel="",this.walletPassword="",this.walletPasswordShow=!1,this.loading=!1,this.disabledRecipient=!!this.transaction,this.showQRCodeModal=!1,this.isSpace=window.walletSettings&&window.walletSettings.wallet&&"space"===window.walletSettings.wallet.type,this.transaction?(this.transactionLabel=this.transaction.label||"",this.transactionMessage=this.transaction.message||"",this.gasPrice=this.transaction.gasPrice+1):(this.transactionLabel=this.defaultLabel,this.transactionMessage=this.defaultMessage),this.fiatSymbol=window.walletSettings.fiatSymbol,this.storedPassword=window.walletSettings.storedPassword&&window.walletSettings.browserWalletExists,this.$nextTick((()=>this.estimateTransactionFee()))},estimateTransactionFee(){if(this.contractDetails&&this.wallet.tokenBalance&&this.wallet.etherBalance)return this.contractDetails.contract.methods.transfer("0x0000000000000000000000000000000000000001",String(Math.pow(10,this.contractDetails.decimals?this.contractDetails.decimals:0))).estimateGas({from:this.walletAddress,gas:window.walletSettings.network.gasLimit,gasPrice:this.gasPrice}).then((t=>{this.estimatedGas=parseInt(1.1*t)})).catch((t=>{console.error("Error while estimating gas",t)}))},finalizeSendTransaction(t,e,a){this.$emit("sent",t,e),this.$emit("close"),this.showAlert("success",this.$t("exoplatform.wallet.metamask.message.transactionSent"),t.hash),this.close(),a&&Bt(a)},sendTokens(){if(this.error=null,!this.$refs.form.validate())return;if(!window.localWeb3.utils.isAddress(this.recipient))return void(this.error=this.$t("exoplatform.wallet.warning.invalidReciepientAddress"));if(!this.amount||isNaN(parseFloat(this.amount))||!isFinite(this.amount)||this.amount<=0)return void(this.error=this.$t("exoplatform.wallet.warning.invalidAmount"));if(this.isInternalWallet){if(!(this.storedPassword||this.walletPassword&&this.walletPassword.length))return void(this.error=this.$t("exoplatform.wallet.warning.requiredPassword"));if(!Wt(this.storedPassword?window.walletSettings.userP:Mt(this.walletPassword)))return void(this.error=this.$t("exoplatform.wallet.warning.wrongPassword"))}if(this.wallet.tokenBalance<this.amount)return void(this.error=this.$t("exoplatform.wallet.warning.unsufficientFunds"));if(!this.canSendToken)return;const t=this.contractDetails.contract.options.from,e=this.recipient,a=this.contractDetails.contract.methods.transfer;this.loading=!0;const s={from:t.toLowerCase(),to:e,value:0,pending:!0,contractAddress:this.contractDetails.address,contractMethodName:"transfer",contractAmount:this.amount,label:this.transactionLabel,message:this.transactionMessage,timestamp:Date.now()};if(this.isInternalWallet)return Object.assign(s,{gas:window.walletSettings.network.gasLimit,gasPrice:this.gasPrice,fee:this.transactionFeeEther,feeFiat:this.transactionFeeFiat}),this.transaction&&Object.assign(s,{nonce:this.transaction.nonce,label:this.transaction.label||"",message:this.transaction.message||"",contractAmount:this.transaction.contractAmount,to:this.transaction.toWallet.address,boost:!0}),a(s.to,Kt(s.contractAmount,this.contractDetails.decimals).toString()).estimateGas({from:s.from,gas:s.gas,gasPrice:s.gasPrice}).catch((t=>(console.error("Error estimating necessary gas",t),0))).then((t=>{if(!(this.isInternalWallet&&t>window.walletSettings.network.gasLimit))return Z(s,a,[e,Kt(this.amount,this.contractDetails.decimals).toString()]);this.warning=this.$t("exoplatform.wallet.warning.lowConfiguredTransactionGas",{0:window.walletSettings.network.gasLimit,1:t})})).then(((t,e)=>{if(e)throw e;t&&this.finalizeSendTransaction(t,this.contractDetails,this.notificationId)})).catch((t=>{console.error("Web3 contract.transfer method - error",t),this.showAlert("error",this.$t("exoplatform.wallet.metamask.error.transactionFailed"))})).finally((()=>{this.loading=!1,Dt()}));if(this.isMetamaskWallet){if(window.ethereum?.isMetaMask){const l={to:this.contractDetails.address.toLowerCase(),from:t.toLowerCase(),data:a(e,Kt(this.amount,this.contractDetails.decimals).toString()).encodeABI()};return window.ethereum.request({method:"eth_sendTransaction",params:[l]}).then((t=>(Object.assign(s,{hash:t}),lt(s)))).then(((t,e)=>{if(e)throw e;t&&this.finalizeSendTransaction(t,this.contractDetails,this.notificationId)})).catch((t=>{t&&4001===t.code||(console.error("Web3 contract.transfer method - error",t),this.$root.$emit("wallet-notification-alert",{type:"error",message:this.$t("exoplatform.wallet.error.errorSendingTransaction")}))})).finally((()=>{this.loading=!1,Dt()}))}}else console.error("Error getting provider")},checkErrors(){if(this.error=null,this.recipient&&this.recipient.toLowerCase()===this.walletAddress.toLowerCase())return this.error=this.$t("exoplatform.wallet.warning.receiverMustBeDifferentFromSender"),void(this.canSendToken=!1);this.amount&&(isNaN(parseFloat(this.amount))||!isFinite(this.amount)||this.amount<=0)?this.error=this.$t("exoplatform.wallet.warning.invalidAmount"):this.amount&&$.isNumeric(this.amount)&&(this.error=!this.wallet||this.wallet.tokenBalance>=this.amount?null:this.$t("exoplatform.wallet.warning.unsufficientFunds"))},open(){this.isMetamaskWallet&&this.updateSelectedMetamaskInformation(),this.$refs.sendTokensForm.open()},close(){this.$refs.sendTokensForm.close()},showAlert(t,e,a){this.$root.$emit("wallet-notification-alert",{type:t,message:e,transactionHash:a})}}},N,[],!1,null,null,null).exports;var ie=function(){var t=this,e=t._self._c;return e("div",[e("v-btn",{staticClass:"btn btn-primary",attrs:{disabled:t.isReadOnly,block:""},on:{click:t.openSendTokenDrawer}},[e("v-icon",{staticClass:"mr-8",attrs:{color:"white"}},[t._v("\n      mdi-cash-refund\n    ")]),t._v("\n    "+t._s(t.$t("exoplatform.wallet.button.sendfunds"))+"\n  ")],1),t._v(" "),e("wallet-reward-send-tokens-form",{ref:"sendTokensForm",attrs:{wallet:t.wallet,transaction:t.transaction,"contract-details":t.contractDetails},on:{sent:function(e){return t.$emit("sent",e,t.contractDetails)},error:function(e){return t.$emit("error",e)}}})],1)};ie._withStripped=!0;const re=o({props:{wallet:{type:Object,default:function(){return null}},transaction:{type:Object,default:function(){return null}},contractDetails:{type:Object,default:function(){return{}}},isReadOnly:{type:Boolean,default:function(){return!1}},open:{type:Boolean,default:function(){return!1}}},data:()=>({firstPendingTransaction:!1}),computed:{tokenBalance(){return this.wallet&&this.wallet.tokenBalance},etherBalance(){return this.wallet&&this.wallet.etherBalance},showBoostButton(){return this.canBoostTransaction&&this.firstPendingTransaction},canBoostTransaction(){return this.transaction&&this.wallet&&("user"===this.wallet.type&&this.wallet.id===eXo.env.portal.userName||"space"===this.wallet.type&&this.wallet.spaceAdministrator)},disabled(){return this.isReadOnly||this.wallet||!this.tokenBalance||0===this.tokenBalance||"string"==typeof this.tokenBalance&&(!this.tokenBalance.length||"0"===this.tokenBalance.trim())||!this.etherBalance||0===this.etherBalance||"string"==typeof this.etherBalance&&(!this.etherBalance.length||"0"===this.etherBalance.trim())}},created(){this.canBoostTransaction&&((0===this.wallet.lastMinedNonce||this.wallet.lastMinedNonce>0)&&(this.firstPendingTransaction=this.wallet.nextNonceToMine===this.transaction.nonce),tt(this.wallet.address).then((t=>{this.wallet.nextNonceToMine=t,this.firstPendingTransaction=this.wallet.nextNonceToMine===this.transaction.nonce})))},methods:{prepareSendForm(t,e,a,s){if(this.contractDetails)if(t&&s)e=e||"user",Ft(s).then((()=>(this.openSendTokenDrawer(),this.$nextTick().then((()=>{t&&(this.$refs.sendTokensForm.$refs.autocomplete.selectItem(t,e),this.$refs.sendTokensForm.disabledRecipient=!0,this.$refs.sendTokensForm.amount=a&&Number(a)||"",this.$refs.sendTokensForm.notificationId=s)})))));else{if(t)return this.$nextTick().then((()=>{t&&(e=e||"user",this.$refs.sendTokensForm.$refs.autocomplete.selectItem(t,e),this.$refs.sendTokensForm.disabledRecipient=!0,this.$refs.sendTokensForm.amount=a&&Number(a)||"",this.$refs.sendTokensForm.notificationId=s)}));this.$refs.sendTokensForm.init()}else console.error("prepareSendForm error - no accounts found")},openSendTokenDrawer(){this.$refs.sendTokensForm.open(),this.$refs.sendTokensForm.init()}}},ie,[],!1,null,null,null).exports;var oe=function(){var t=this,e=t._self._c;return e("v-flex",{staticClass:"transactionsList"},[e("v-card",{staticClass:"card--flex-toolbar",attrs:{flat:""}},[t.error&&!t.loading?e("div",{staticClass:"alert alert-error"},[e("i",{staticClass:"uiIconError"}),t._v(t._s(t.error)+"\n    ")]):t._e(),t._v(" "),t.loading?e("div",{staticClass:"grey--text"},[t._v("\n      "+t._s(t.$t("exoplatform.wallet.message.loadingRecentTransactions"))+"...\n    ")]):t._e(),t._v(" "),t.loading?e("v-progress-linear",{staticClass:"mb-0 mt-0",attrs:{indeterminate:"",color:"primary"}}):t._e(),t._v(" "),e("v-divider"),t._v(" "),Object.keys(t.sortedTransactions).length?e("v-expansion-panels",{attrs:{accordion:"",focusable:""}},[t._l(t.sortedTransactions,(function(a,s){return e("v-expansion-panel",{key:s,attrs:{id:`transaction-${a.hash}`,value:a.selected}},[e("v-expansion-panel-header",{staticClass:"border-box-sizing px-0 py-0"},[e("v-list",{staticClass:"px-2 py-0 transactions",class:a.selected&&"blue lighten-5",attrs:{"two-line":"",ripple:""}},[e("v-list-item",{key:a.hash,staticClass:"transactionDetailItem autoHeight",attrs:{ripple:""}},[a.pending?e("v-progress-circular",{staticClass:"me-4",attrs:{indeterminate:"",color:"primary"}}):e("v-list-item-avatar",[e("v-icon",{attrs:{color:a.succeeded?"primary":"red"}},[t._v("\n                  "+t._s(a.adminIcon?"fa-cog":a.isReceiver?"fa-arrow-down":"fa-arrow-up")+"\n                ")])],1),t._v(" "),e("v-list-item-content",{staticClass:"transactionDetailContent"},[a.isContractCreation?e("v-list-item-title",[e("span",[t._v("\n                    "+t._s(t.$t("exoplatform.wallet.label.createdContract"))+"\n                  ")]),t._v(" "),e("wallet-reward-wallet-address",{attrs:{value:a.contractAddress,name:a.contractName,"display-label":""}})],1):"ether"===a.type?e("v-list-item-title",{staticClass:"text-truncated"},[t.displayFullTransaction&&a.isReceiver?e("wallet-reward-profile-chip",{attrs:{address:a.toAddress,"profile-id":a.toUsername,"profile-technical-id":a.toTechnicalId,"space-id":a.toSpaceId,"profile-type":a.toType,"display-name":a.toDisplayName,avatar:a.toAvatar}}):t.displayFullTransaction?e("wallet-reward-profile-chip",{attrs:{address:a.fromAddress,"profile-id":a.fromUsername,"profile-technical-id":a.fromTechnicalId,"space-id":a.fromSpaceId,"profile-type":a.fromType,"display-name":a.fromDisplayName,avatar:a.fromAvatar}}):t._e(),t._v(" "),a.isReceiver?e("span",[t._v("\n                    "+t._s(a.pending||a.succeeded?t.$t("exoplatform.wallet.label.receivedFrom"):t.$t("exoplatform.wallet.label.errorReceivedFrom"))+"\n                  ")]):e("span",[t._v("\n                    "+t._s(a.pending||a.succeeded?t.$t("exoplatform.wallet.label.sentTo"):t.$t("exoplatform.wallet.label.errorSentTo"))+"\n                  ")]),t._v(" "),a.isReceiver?e("wallet-reward-profile-chip",{attrs:{address:a.fromAddress,"profile-id":a.fromUsername,"profile-technical-id":a.fromTechnicalId,"space-id":a.fromSpaceId,"profile-type":a.fromType,"display-name":a.fromDisplayName,avatar:a.fromAvatar}}):e("wallet-reward-profile-chip",{attrs:{address:a.toAddress,"profile-id":a.toUsername,"profile-technical-id":a.toTechnicalId,"space-id":a.toSpaceId,"profile-type":a.toType,"display-name":a.toDisplayName,avatar:a.toAvatar}})],1):"transferFrom"===a.contractMethodName?e("v-list-item-title",[e("span",[t._v("\n                    "+t._s(t.$t("exoplatform.wallet.label.sentTo"))+"\n                  ")]),t._v(" "),e("wallet-reward-profile-chip",{attrs:{address:a.toAddress,"profile-id":a.toUsername,"profile-technical-id":a.toTechnicalId,"space-id":a.toSpaceId,"profile-type":a.toType,"display-name":a.toDisplayName,avatar:a.toAvatar}}),t._v(" "),e("span",[t._v("\n                    "+t._s(t.$t("exoplatform.wallet.label.by"))+"\n                  ")]),t._v(" "),e("wallet-reward-profile-chip",{attrs:{address:a.byAddress,"profile-id":a.byUsername,"profile-technical-id":a.byTechnicalId,"space-id":a.bySpaceId,"profile-type":a.byType,"display-name":a.byDisplayName,avatar:a.byAvatar}}),t._v(" "),e("span",[t._v("\n                    "+t._s(t.$t("exoplatform.wallet.label.onBehalfOf"))+"\n                  ")]),t._v(" "),e("wallet-reward-profile-chip",{attrs:{address:a.fromAddress,"profile-id":a.fromUsername,"profile-technical-id":a.fromTechnicalId,"space-id":a.fromSpaceId,"profile-type":a.fromType,"display-name":a.fromDisplayName,avatar:a.fromAvatar}})],1):"transfer"===a.contractMethodName||"approve"===a.contractMethodName?e("v-list-item-title",[t.displayFullTransaction&&a.isReceiver?e("wallet-reward-profile-chip",{attrs:{address:a.toAddress,"profile-id":a.toUsername,"profile-technical-id":a.toTechnicalId,"space-id":a.toSpaceId,"profile-type":a.toType,"display-name":a.toDisplayName,avatar:a.toAvatar}}):t.displayFullTransaction?e("wallet-reward-profile-chip",{attrs:{address:a.fromAddress,"profile-id":a.fromUsername,"profile-technical-id":a.fromTechnicalId,"space-id":a.fromSpaceId,"profile-type":a.fromType,"display-name":a.fromDisplayName,avatar:a.fromAvatar}}):t._e(),t._v(" "),"transfer"===a.contractMethodName&&a.isReceiver?e("span",[t._v("\n                    "+t._s(t.$t("exoplatform.wallet.label.receivedFrom"))+"\n                  ")]):"transfer"!==a.contractMethodName||a.isReceiver?e("span",[t._v("\n                    "+t._s(t.$t("exoplatform.wallet.label.delegatedTo"))+"\n                  ")]):e("span",[t._v("\n                    "+t._s(t.$t("exoplatform.wallet.label.sentTo"))+"\n                  ")]),t._v(" "),a.isReceiver?e("wallet-reward-profile-chip",{attrs:{address:a.fromAddress,"profile-id":a.fromUsername,"profile-technical-id":a.fromTechnicalId,"space-id":a.fromSpaceId,"profile-type":a.fromType,"display-name":a.fromDisplayName,avatar:a.fromAvatar}}):e("wallet-reward-profile-chip",{attrs:{address:a.toAddress,"profile-id":a.toUsername,"profile-technical-id":a.toTechnicalId,"space-id":a.toSpaceId,"profile-type":a.toType,"display-name":a.toDisplayName,avatar:a.toAvatar}})],1):a.value&&Number(a.value)&&a.amountFiat?e("v-list-item-title",[t.displayFullTransaction?e("wallet-reward-profile-chip",{attrs:{address:a.fromAddress,"profile-id":a.fromUsername,"profile-technical-id":a.fromTechnicalId,"space-id":a.fromSpaceId,"profile-type":a.fromType,"display-name":a.fromDisplayName,avatar:a.fromAvatar}}):t._e(),t._v(" "),e("span",[t._v("\n                    "+t._s(t.$t("exoplatform.wallet.label.sentEtherToContract"))+"\n                  ")])],1):e("v-list-item-title",[e("span",[t._v("\n                    "+t._s(t.$t("exoplatform.wallet.label.contractTransaction"))+"\n                  ")]),t._v(" "),e("wallet-reward-wallet-address",{attrs:{value:a.contractAddress,name:a.contractName,"display-label":""}})],1),t._v(" "),e("v-list-item-subtitle",[a.pending||a.succeeded?t._e():e("v-icon",{attrs:{title:t.$t("exoplatform.wallet.label.transactionFailed"),color:"orange"}},[t._v("\n                    warning\n                  ")]),t._v(" "),a.dateFormatted?e("v-list-item-action-text",[t._v("\n                    "+t._s(a.dateFormatted)+"\n                  ")]):t._e()],1)],1),t._v(" "),"ether"===a.type&&a.value&&Number(a.value)?e("v-list-item-content",{staticClass:"transactionDetailActions"},[e("v-list-item-title",{class:a.adminIcon?"":a.pending||a.succeeded?"primary--text":"red--text"},[e("span",[t._v("\n                    "+t._s(t.toFixed(a.value))+" ether\n                  ")])]),t._v(" "),a.amountFiat?e("v-list-item-subtitle",[e("v-list-item-action-text",[t._v("\n                    "+t._s(t.toFixed(a.amountFiat))+" "+t._s(t.fiatSymbol)+"\n                  ")])],1):t._e()],1):e("v-list-item-content",{staticClass:"transactionDetailActions"},[a.contractAmount?e("v-list-item-title",{class:a.pending||a.succeeded?"primary--text":"red--text"},[e("span",[t._v("\n                    "+t._s(t.toFixed(a.contractAmount))+" "+t._s(a.contractSymbol)+"\n                  ")])]):a.value&&Number(a.value)?e("v-list-item-title",{class:a.pending||a.succeeded?"primary--text":"red--text"},[e("span",[t._v("\n                    "+t._s(t.toFixed(a.value))+" ether\n                  ")])]):t._e(),t._v(" "),"reward"===a.contractMethodName?e("v-list-item-subtitle",[e("v-list-item-action-text",[t._v("\n                    "+t._s(t.toFixed(a.value))+" "+t._s(a.contractSymbol)+"\n                  ")])],1):a.amountFiat?e("v-list-item-subtitle",[e("v-list-item-action-text",[t._v("\n                    "+t._s(t.toFixed(a.amountFiat))+" "+t._s(t.fiatSymbol)+"\n                  ")])],1):t._e()],1)],1)],1)],1),t._v(" "),e("v-expansion-panel-content",[e("v-list",{staticClass:"px-0",attrs:{dense:""}},[a.pending||a.succeeded?t._e():e("v-list-item",[e("v-list-item-content",[e("div",{staticClass:"alert alert-warning ignore-vuetify-classes"},[e("i",{staticClass:"uiIconWarning"}),t._v("\n                  "+t._s(a.adminIcon?t.$t("exoplatform.wallet.label.transactionFailed"):a.isReceiver?t.$t("exoplatform.wallet.label.transactionReceptionFailed",{0:t.contractName}):t.$t("exoplatform.wallet.label.transactionSendingFailed",{0:t.contractName}))+"\n                ")])])],1),t._v(" "),a.pending&&a.contractAddress&&a.sentTimestamp&&!a.boost?e("v-list-item",[e("v-list-item-content",[e("wallet-reward-send-tokens-modal",{ref:"boostTransactionModal",refInFor:!0,attrs:{wallet:t.wallet,transaction:a,"contract-details":t.contractDetails},on:{sent:t.transactionSent}})],1)],1):t._e(),t._v(" "),t.administration&&!a.refreshed&&a.pending&&!a.succeeded?e("v-list-item",[e("v-list-item-content",[e("v-btn",{staticClass:"btn ignore-vuetify-classes",attrs:{loading:a.refreshing},on:{click:function(e){return t.refreshFromBlockchain(a)}}},[t._v("\n                  "+t._s(t.$t("exoplatform.wallet.button.refresh"))+"\n                ")])],1)],1):t._e(),t._v(" "),a.succeeded||a.pending||a.resent?t._e():e("v-list-item",[e("v-list-item-content",[e("v-btn",{staticClass:"btn ignore-vuetify-classes",attrs:{loading:a.resending},on:{click:function(e){return t.resendToBlockchain(a)}}},[t._v("\n                  "+t._s(t.$t("exoplatform.wallet.button.resend"))+"\n                ")])],1)],1),t._v(" "),t.administration&&a.issuer?e("v-list-item",[e("v-list-item-content",[t._v("\n                "+t._s(t.$t("exoplatform.wallet.label.issuer"))+"\n              ")]),t._v(" "),e("v-list-item-content",{staticClass:"align-end text-end"},[e("wallet-reward-profile-chip",{attrs:{address:a.issuer.address,"profile-id":a.issuer.id,"profile-technical-id":a.issuer.technicalId,"space-id":a.issuer.spaceId,"profile-type":a.issuer.type,"display-name":a.issuer.name,avatar:a.issuer.avatar}})],1)],1):t._e(),t._v(" "),a.label?e("v-list-item",{staticClass:"dynamic-height"},[e("v-list-item-content",[t._v("\n                "+t._s(t.$t("exoplatform.wallet.label.transactionLabel"))+"\n              ")]),t._v(" "),e("v-list-item-content",{staticClass:"align-end text-end paragraph text-truncate"},[t._v("\n                "+t._s(a.label)+"\n              ")])],1):t._e(),t._v(" "),a.message?e("v-list-item",{staticClass:"dynamic-height"},[e("v-list-item-content",[t._v("\n                "+t._s(t.$t("exoplatform.wallet.label.transactionMessage"))+"\n              ")]),t._v(" "),e("v-list-item-content",{staticClass:"align-end text-end paragraph text-truncate"},[t._v("\n                "+t._s(a.message)+"\n              ")])],1):t._e(),t._v(" "),Number(a.contractAmount)?e("v-list-item",[e("v-list-item-content",[t._v("\n                "+t._s(a.contractAmountLabel)+"\n              ")]),t._v(" "),e("v-list-item-content",{staticClass:"align-end text-end"},[e("div",{staticClass:"no-wrap"},[t._v("\n                  "+t._s(t.toFixed(a.contractAmount))+" "+t._s(a.contractSymbol)+"\n                ")])])],1):[Number(a.amountFiat)?e("v-list-item",[e("v-list-item-content",[t._v("\n                  "+t._s(t.$t("exoplatform.wallet.label.fiatAmount"))+"\n                ")]),t._v(" "),e("v-list-item-content",{staticClass:"align-end text-end"},[e("div",{staticClass:"no-wrap"},[t._v("\n                    "+t._s(t.toFixed(a.amountFiat))+" "+t._s(t.fiatSymbol)+"\n                  ")])])],1):t._e(),t._v(" "),Number(a.value)?e("v-list-item",[e("v-list-item-content",[t._v("\n                  "+t._s(t.$t("exoplatform.wallet.label.etherAmount"))+"\n                ")]),t._v(" "),e("v-list-item-content",{staticClass:"align-end text-end"},[e("div",{staticClass:"no-wrap"},[t._v("\n                    "+t._s(t.toFixed(a.value))+" ether\n                  ")])])],1):t._e()],t._v(" "),a.fromAddress?e("v-list-item",[e("v-list-item-content",[t._v("\n                "+t._s(t.$t("exoplatform.wallet.label.fromAddress"))+"\n              ")]),t._v(" "),e("v-list-item-content",{staticClass:"align-end text-end text-truncate"},[t.addressEtherscanLink?e("a",{attrs:{href:`${t.addressEtherscanLink}${a.fromAddress}`,title:t.$t("exoplatform.wallet.label.openOnEtherscan"),target:"_blank"}},[t._v("\n                  "+t._s(a.fromAddress)+"\n                ")]):t._e()])],1):t._e(),t._v(" "),a.toAddress?e("v-list-item",[e("v-list-item-content",[t._v("\n                "+t._s(t.$t("exoplatform.wallet.label.toAddress"))+"\n              ")]),t._v(" "),e("v-list-item-content",{staticClass:"align-end text-end text-truncate"},[t.addressEtherscanLink?e("a",{attrs:{href:`${t.addressEtherscanLink}${a.toAddress}`,title:t.$t("exoplatform.wallet.label.openOnEtherscan"),target:"_blank"}},[t._v("\n                  "+t._s(a.toAddress)+"\n                ")]):t._e()])],1):t._e(),t._v(" "),a.contractName?e("v-list-item",[e("v-list-item-content",[t._v("\n                "+t._s(t.$t("exoplatform.wallet.label.contractName"))+"\n              ")]),t._v(" "),e("v-list-item-content",{staticClass:"align-end text-end"},[e("div",{staticClass:"no-wrap"},[t._v("\n                  "+t._s(a.contractName)+"\n                ")])])],1):t._e(),t._v(" "),a.contractAddress?e("v-list-item",[e("v-list-item-content",[t._v("\n                "+t._s(t.$t("exoplatform.wallet.label.contractAddress"))+"\n              ")]),t._v(" "),e("v-list-item-content",{staticClass:"align-end text-end text-truncate"},[t.tokenEtherscanLink?e("a",{attrs:{href:`${t.tokenEtherscanLink}${a.contractAddress}`,title:t.$t("exoplatform.wallet.label.openOnEtherscan"),target:"_blank"}},[t._v("\n                  "+t._s(a.contractAddress)+"\n                ")]):t._e()])],1):t._e(),t._v(" "),a.fee?e("v-list-item",[e("v-list-item-content",[t._v("\n                "+t._s(t.$t("exoplatform.wallet.label.transactionFee"))+"\n              ")]),t._v(" "),a.tokenFee?e("v-list-item-content",{staticClass:"align-end text-end"},[e("div",{staticClass:"no-wrap"},[t._v("\n                  "+t._s(t.toFixed(a.tokenFee))+" "+t._s(a.contractSymbol)+"\n                ")])]):e("v-list-item-content",{staticClass:"align-end text-end"},[e("div",{staticClass:"no-wrap"},[t._v("\n                  "+t._s(t.toFixed(a.feeFiat))+" "+t._s(t.fiatSymbol)+"\n                  "),a.noContractFunds?e("v-icon",{attrs:{color:"orange",title:"You financed transaction fee with ether instead of Token."}},[t._v("\n                    warning\n                  ")]):t._e()],1)])],1):t._e(),t._v(" "),e("v-list-item",[e("v-list-item-content",[t._v("\n                "+t._s(t.$t("exoplatform.wallet.label.transactionHash"))+"\n              ")]),t._v(" "),e("v-list-item-content",{staticClass:"align-end text-end text-truncate"},[t.transactionEtherscanLink?e("a",{attrs:{href:`${t.transactionEtherscanLink}${a.hash}`,title:t.$t("exoplatform.wallet.label.openOnEtherscan"),target:"_blank"}},[t._v("\n                  "+t._s(a.hash)+"\n                ")]):t._e()])],1),t._v(" "),t.administration?[a.nonce?e("v-list-item",[e("v-list-item-content",[t._v("\n                  Nonce\n                ")]),t._v(" "),e("v-list-item-content",{staticClass:"align-end text-end"},[e("strong",[t._v(t._s(a.nonce))])])],1):t._e(),t._v(" "),a.sentDateFormatted?e("v-list-item",[e("v-list-item-content",[t._v("\n                  "+t._s(t.$t("exoplatform.wallet.label.sentDate"))+"\n                ")]),t._v(" "),e("v-list-item-content",{staticClass:"align-end text-end"},[e("strong",[t._v(t._s(a.sentDateFormatted))])])],1):t._e(),t._v(" "),a.sendingAttemptCount?e("v-list-item",[e("v-list-item-content",[t._v("\n                  "+t._s(t.$t("exoplatform.wallet.label.sendingAttemptCount"))+"\n                ")]),t._v(" "),e("v-list-item-content",{staticClass:"align-end text-end"},[e("strong",[t._v(t._s(-200===a.sendingAttemptCount?1:a.sendingAttemptCount))])])],1):t._e()]:t._e()],2)],1)],1)})),t._v(" "),t.limitReached?t._e():e("div",{staticClass:"loadMoreTransaction"},[e("v-btn",{staticClass:"mt-3",attrs:{loading:t.loading,color:"primary",block:"",text:""},on:{click:function(e){t.transactionsLimit+=t.transactionsPerPage}}},[t._v("\n          "+t._s(t.$t("exoplatform.wallet.button.loadMore"))+"\n        ")])],1)],2):t.loading?t._e():e("v-flex",{staticClass:"text-center"},[e("span",[t._v("\n        "+t._s(t.$t("exoplatform.wallet.label.noRecentTransactions"))+"\n      ")])])],1)],1)};oe._withStripped=!0;const de=o({props:{wallet:{type:Object,default:function(){return null}},contractDetails:{type:Object,default:function(){return{}}},error:{type:String,default:function(){return null}},displayFullTransaction:{type:Boolean,default:function(){return!1}},selectedTransactionHash:{type:String,default:function(){return null}},selectedContractMethodName:{type:String,default:function(){return null}},administration:{type:Boolean,default:function(){return!1}},fiatSymbol:{type:String,default:function(){return null}}},data:()=>({refreshIndex:1,currentUser:eXo.env.portal.userName,loading:!1,settings:null,transactionsLimit:10,transactionsPerPage:10,limitReached:!1,transactions:{}}),computed:{walletAddress(){return this.wallet&&this.wallet.address},isSpaceWallet(){return this.wallet&&"space"===this.wallet.type},contractName(){return this.contractDetails&&this.contractDetails.name||this.settings&&this.settings.contractDetail&&this.settings.contractDetail.name},sortedTransactions(){if(!this.refreshIndex)return{};const t=this.transactions,e={};return Object.values(t).filter((t=>t&&!t.ignore)).sort(((t,e)=>(e.timestamp||0)-(t.timestamp||0))).forEach((t=>{e[t.hash]=t})),e}},watch:{transactionsLimit(){this.transactionsLimit===this.transactionsPerPage||this.loading||this.init(!0).catch((t=>{this.loading=!1,this.$emit("error",`Account loading error: ${t}`)}))},contractDetails(){this.contractDetails&&(this.limitReached=!1,this.transactions={},this.transactionsLimit=this.transactionsPerPage,this.init().catch((t=>{console.error("account field change event - error",t),this.loading=!1,this.$emit("error",`${this.$t("exoplatform.wallet.error.accountLoadingError")}: ${t}`)})))}},created(){this.transactionEtherscanLink=Tt(),this.addressEtherscanLink=Pt(),this.tokenEtherscanLink=At(),this.init().catch((t=>{console.error("init method - error",t),this.loading=!1,this.$emit("error",`${this.$t("exoplatform.wallet.error.accountInitializationError")}: ${t}`)}))},methods:{transactionSent(){this.$emit("refresh"),this.init()},init(t){return this.loading=!0,this.error=null,this.settings=window.walletSettings,this.loadRecentTransaction(this.transactionsLimit).then((()=>{if(!t&&this.selectedTransactionHash){const t=this.transactions[this.selectedTransactionHash]||this.transactions[this.selectedTransactionHash.toLowerCase()];t&&(this.$set(t,"selected",!0),this.$nextTick((()=>{setTimeout((()=>{const e=document.getElementById(`transaction-${t.hash}`);e&&e.scrollIntoView()}),200)})))}this.loading=!1,this.forceUpdateList()})).catch((t=>{console.error("loadRecentTransaction - method error",t),this.loading=!1,this.$emit("error",`${t}`)})).finally((()=>{this.$emit("loaded",this.sortedTransactions,this.transactions?Object.keys(this.transactions).length:0)}))},loadRecentTransaction(t){const e={hash:this.selectedTransactionHash,contractMethodName:this.selectedContractMethodName};return at(this.walletAddress,this.contractDetails,this.transactions,!1,t,e,this.administration).then((()=>{const t=Object.keys(this.transactions).length;this.limitReached=t<=this.transactionsLimit&&t%this.transactionsPerPage>0||t<this.transactionsLimit,Object.values(this.transactions).filter((t=>t.pending)).forEach((t=>{St(t.hash,(e=>{Object.assign(t,e),this.forceUpdateList()}))}))})).catch((t=>{console.error("loadTransactions - method error",t),this.$emit("error",`${t}`)}))},refreshFromBlockchain(t){t&&t.hash&&(this.$set(t,"refreshing",!0),this.$forceUpdate(),st(t.hash).then((e=>{e&&(Object.assign(t,e),this.$set(t,"refreshed",!0))})).finally((()=>{this.$set(t,"refreshing",!1),this.$forceUpdate()})))},resendToBlockchain(t){t&&t.hash&&(this.$set(t,"resending",!0),this.$forceUpdate(),this.error=null,this.warning=null,t.sendingAttemptCount=0,t.id=0,t.pending=!0,t.sentTimestamp=0,t.boost=!0,lt(t).then((e=>{e&&(Object.assign(t,e),this.$set(t,"boost",!0))})).finally((()=>{this.$set(t,"resending",!1),this.$set(t,"resent",!0),this.$forceUpdate()})))},forceUpdateList(){try{this.refreshIndex++,this.$forceUpdate()}catch(t){console.error("forceUpdateList - method error",t)}},toFixed:t=>Xt(t)}},oe,[],!1,null,null,null).exports;var ce=function(){var t=this,e=t._self._c;return e("v-dialog",{staticClass:"fixLinkHeight",attrs:{id:"walletBackupModal",disabled:t.disabled,"content-class":"uiPopup with-overflow walletDialog",width:"500px","max-width":"100vw","hide-overlay":""},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"]))return null;t.dialog=!1}},scopedSlots:t._u([t.noButton?null:{key:"activator",fn:function({on:a}){return[e("a",t._g({attrs:{href:"javascript:void(0);"}},a),[t._v("\n      "+t._s(t.$t("exoplatform.wallet.title.backupWalletModal"))+"\n    ")])]}}],null,!0),model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[t._v(" "),e("v-card",{staticClass:"elevation-12"},[e("div",{staticClass:"ignore-vuetify-classes popupHeader ClearFix",attrs:{draggable:"true"}},[e("a",{staticClass:"uiIconClose pull-right",attrs:{"aria-hidden":"true"},on:{click:function(e){t.dialog=!1}}}),t._v(" "),e("span",{staticClass:"ignore-vuetify-classes PopupTitle popupTitle"},[t._v("\n          "+t._s(t.$t("exoplatform.wallet.button.backupWallet"))+"\n        ")])]),t._v(" "),e("v-card-text",[t.error?e("div",{staticClass:"alert alert-error"},[e("i",{staticClass:"uiIconError"}),t._v(" "+t._s(t.error)+"\n      ")]):t._e(),t._v(" "),e("div",{staticClass:"alert alert-warning v-content",attrs:{id:"walletBackupDetailedWarning"}},[e("p",[e("i",{staticClass:"uiIconWarning"}),t._v("\n          "+t._s(t.$t("exoplatform.wallet.warning.backupWalletPart1"))+" "),e("br"),t._v("\n          "+t._s(t.$t("exoplatform.wallet.warning.backupWalletPart2"))+" "),e("br"),t._v("\n          "+t._s(t.$t("exoplatform.wallet.warning.backupWalletPart3"))+" "),e("br")])]),t._v(" "),e("v-form",{ref:"form",on:{submit:function(t){t.preventDefault(),t.stopPropagation()}}},[t.dialog&&!t.walletPrivateKey?e("v-text-field",{ref:"walletPassword",attrs:{"append-icon":t.walletPasswordShow?"mdi-eye":"mdi-eye-off",rules:[t.rules.min],type:t.walletPasswordShow?"text":"password",name:"walletPassword",label:"Current wallet password",placeholder:"Enter your current wallet password",autocomplete:"current-passord",autofocus:"","validate-on-blur":""},on:{"click:append":function(e){t.walletPasswordShow=!t.walletPasswordShow}},model:{value:t.walletPassword,callback:function(e){t.walletPassword=e},expression:"walletPassword"}}):t._e()],1)],1),t._v(" "),t.walletPrivateKey?e("v-card-text",{staticClass:"text-center"},[e("code",{domProps:{textContent:t._s(t.walletPrivateKey)}})]):t._e(),t._v(" "),e("v-card-actions",[e("v-spacer"),t._v(" "),t.walletPrivateKey?e("button",{staticClass:"ignore-vuetify-classes btn btn-primary me-1",on:{click:t.walletBackedUp}},[t._v("\n        "+t._s(t.$t("exoplatform.wallet.button.backedUp"))+"!\n      ")]):t._e(),t._v(" "),t.walletPrivateKey?t._e():e("button",{staticClass:"ignore-vuetify-classes btn btn-primary me-1",attrs:{disabled:t.loading},on:{click:t.showPrivateKey}},[t._v("\n        "+t._s(t.$t("exoplatform.wallet.button.displayPrivateKey"))+"!\n      ")]),t._v(" "),t.walletPrivateKey?t._e():e("button",{staticClass:"ignore-vuetify-classes btn",attrs:{disabled:t.loading},on:{click:function(e){t.dialog=!1}}},[t._v("\n        "+t._s(t.$t("exoplatform.wallet.button.close"))+"!\n      ")]),t._v(" "),e("v-spacer")],1)],1)],1)};ce._withStripped=!0;const we=o({props:{noButton:{type:Boolean,default:function(){return!1}}},data(){return{dialog:!1,error:null,walletPassword:"",walletPasswordShow:!1,walletPrivateKey:null,loading:!1,rules:{min:t=>t&&t.length>=8||this.$t("exoplatform.wallet.warning.atLeast8Chars")}}},watch:{dialog(){this.dialog&&(this.$refs.form&&this.$refs.form.reset(),this.init())}},created(){this.init()},methods:{init(){this.error=null,this.walletPrivateKey=null,this.walletPassword="",this.walletPasswordShow=!1,this.loading=!1},walletBackedUp(){this.error=null,Lt().then((()=>{this.$emit("backed-up"),this.dialog=!1})).catch((t=>{this.error=String(t)})).finally((()=>{this.loading=!1}))},showPrivateKey(){this.error=null,this.$refs.form.validate()&&(this.loading=!0,window.setTimeout(this.unlockBrowserWallet,200))},unlockBrowserWallet(){const t=Wt(Mt(this.walletPassword));try{if(t){const t=Et();if(!t||!t.privateKey)return void(this.error=this.$t("exoplatform.wallet.error.walletNotFound"));this.loading=!1,this.walletPrivateKey=t.privateKey}else this.error=this.$t("exoplatform.wallet.warning.wrongPassword")}finally{this.loading=!1,t&&Dt()}}}},ce,[],!1,null,null,null).exports;var ue=function(){var t=this,e=t._self._c;return e("v-flex",{staticClass:"text-center white"},[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.loading,expression:"!loading"}],staticClass:"mt-3 mb-3",attrs:{id:"walletBrowserSetup"}},[t.walletAddress&&"DELETED"!==this.initializationState?[e("wallet-reward-import-key-modal",{ref:"walletImportKeyModal",attrs:{"is-space":t.isSpace,"wallet-address":t.walletAddress},on:{configured:function(e){return t.$emit("configured")}}})]:[e("v-row",{attrs:{"no-gutters":""}},[e("v-col",{attrs:{cols:"12",sm:"6"}},[e("v-row",[e("div",{staticClass:"title px-4 py-4 styleTitle"},[t._v(t._s(t.$t("exoplatform.wallet.label.createWalletInvitation")))]),t._v(" "),e("div",{staticClass:"d-flex flex-column pl-4"},[e("div",{staticClass:"subtitle px-4 py-4 walletInformation"},[t._v(t._s(t.$t("exoplatform.wallet.label.createWalletInvitation.description")))]),t._v(" "),e("div",{staticClass:"subtitle px-4 py-4 walletInformation"},[t._v(t._s(t.$t("exoplatform.wallet.label.createWalletInvitation.spendDescription")))]),t._v(" "),e("div",{staticClass:"subtitle px-4 py-4 walletInformation"},[t._v(t._s(t.$t("exoplatform.wallet.label.createWalletInvitation.secure")))]),t._v(" "),e("ul",{staticClass:"ml-8"},[e("li",{staticClass:"subtitle walletInformation"},[e("div",{staticClass:"px-4 py-4"},[t._v(t._s(t.$t("exoplatform.wallet.label.createWalletInvitation.firstDescription")))])]),t._v(" "),e("li",{staticClass:"subtitle walletInformation"},[e("div",{staticClass:"px-4 py-4"},[t._v(t._s(t.$t("exoplatform.wallet.label.createWalletInvitation.lastDescription")))])])])])])],1),t._v(" "),e("v-col",{attrs:{cols:"12",sm:"6"}},[e("div",{staticClass:"walletSetup"},[e("v-form",{ref:"form",on:{submit:function(t){t.preventDefault(),t.stopPropagation()}}},[t.loading?t._e():e("v-text-field",{attrs:{rules:[t.rules.min],type:"password",disabled:t.loading||t.loadingWalletBrowser,placeholder:t.$t("exoplatform.wallet.label.setWalletPasswordPlaceholder"),name:"walletPassword",required:"",outlined:"",autocomplete:"new-password"},model:{value:t.walletPassword,callback:function(e){t.walletPassword=e},expression:"walletPassword"}}),t._v(" "),t.loading?t._e():e("v-text-field",{attrs:{rules:[t.rules.passwordMatching],type:"password",disabled:t.loading||t.loadingWalletBrowser,placeholder:t.$t("exoplatform.wallet.label.confirmWalletPasswordPlaceholder"),name:"confirmWalletPassword",required:"",outlined:"",autocomplete:"new-password"},model:{value:t.confirmWalletPassword,callback:function(e){t.confirmWalletPassword=e},expression:"confirmWalletPassword"}})],1),t._v(" "),e("v-btn",{staticClass:"ignore-vuetify-classes btn btn-primary justify-center px-4 py-4 mt-4",attrs:{block:"",disabled:t.loadingWalletBrowser},on:{click:function(e){return t.createWallet()}}},[t._v("\n              "+t._s(t.$t("exoplatform.wallet.button.createNewWallet"))+"\n            ")])],1)])],1)]],2)])};ue._withStripped=!0;const me=o({props:{initializationState:{type:String,default:function(){return null}},isSpace:{type:Boolean,default:function(){return!1}},isSpaceAdministrator:{type:Boolean,default:function(){return!1}},isAdministration:{type:Boolean,default:function(){return!1}},loading:{type:Boolean,default:function(){return!1}},wallet:{type:Object,default:function(){return null}},refreshIndex:{type:Number,default:function(){return 0}}},data(){return{walletPassword:null,urlPerkStore:`${eXo.env.portal.context}/${eXo.env.portal.portalName}/perkstore`,confirmWalletPassword:null,walletPasswordShow:null,loadingWalletBrowser:!1,rules:{min:t=>t&&t.length>=8||this.$t("exoplatform.wallet.warning.atLeast8Chars"),passwordMatching:t=>t&&t===this.walletPassword||this.$t("exoplatform.wallet.warning.passwordNotMatching")}}},computed:{walletAddress(){return this.wallet&&this.wallet.address}},watch:{refreshIndex(t,e){t>e&&this.$nextTick(this.init)}},created(){this.init()},methods:{init(){this.walletPassword=null,this.loadingWalletBrowser=!1,window.localWeb3||bt()},createWallet(){this.$refs.form.validate()&&(this.loadingWalletBrowser=!0,window.setTimeout(this.createWalletInstance,200))},createWalletInstance(){const t=this.walletPassword+Math.random(),e=window.localWeb3.eth.accounts.wallet.create(1,t);return e&&e[0]&&e[0].address?xt(e[0],this.walletPassword,this.isSpace,!0).then((()=>{this.$emit("configured"),this.loadingWalletBrowser=!1})).catch((t=>{console.error("saveBrowserWalletInstance method - error",t),this.$emit("error",this.$t("exoplatform.wallet.error.errorSavingWallet")),this.loadingWalletBrowser=!1})):(console.error("saveBrowserWalletInstance method - error: no address in created wallet",e),void this.$emit("error",this.$t("exoplatform.wallet.error.errorCreatingWallet")))}}},ue,[],!1,null,null,null).exports;var pe=function(){var t=this,e=t._self._c;return e("exo-drawer",{ref:"walletImportKeyModal",attrs:{right:!t.$vuetify.rtl},on:{closed:t.close}},[e("template",{slot:"title"},[e("span",{staticClass:"pb-2"},[t._v(" "+t._s(t.$t("exoplatform.wallet.title.restoreWalletModal"))+" ")])]),t._v(" "),e("template",{slot:"content"},[e("v-card-text",{staticClass:"walletRequestFundsModal"},[e("div",{staticClass:"text-sub-title",attrs:{id:"walletBackupDetailedWarning"}},[t._v("\n        "+t._s(t.$t("exoplatform.wallet.message.restoreWalletPart1"))+"\n        "),t.walletAddress?e("span",[t._v(" "+t._s(t.$t("exoplatform.wallet.message.restoreWalletPart2",{0:t.walletAddress}))+" "),e("br")]):t._e()]),t._v(" "),e("v-form",{ref:"form",on:{submit:function(t){t.preventDefault(),t.stopPropagation()}}},[e("v-text-field",{attrs:{rules:[t.rules.priv],type:t.password,disabled:t.loading,label:t.$t("exoplatform.wallet.label.walletPrivateKey"),placeholder:t.$t("exoplatform.wallet.label.walletPrivateKeyPlaceholder"),name:"walletPrivateKey",autocomplete:"off",autofocus:"","validate-on-blur":""},model:{value:t.walletPrivateKey,callback:function(e){t.walletPrivateKey=e},expression:"walletPrivateKey"}}),t._v(" "),e("v-text-field",{attrs:{"append-icon":t.walletPasswordShow?"mdi-eye":"mdi-eye-off",rules:[t.rules.min],type:t.walletPasswordShow?"text":"password",disabled:t.loading,label:t.$t("exoplatform.wallet.label.newWalletPassword"),placeholder:t.$t("exoplatform.wallet.label.walletPasswordPlaceholder"),name:"walletPassword",autocomplete:"current-passord"},on:{"click:append":function(e){t.walletPasswordShow=!t.walletPasswordShow}},model:{value:t.walletPassword,callback:function(e){t.walletPassword=e},expression:"walletPassword"}}),t._v(" "),e("v-text-field",{attrs:{"append-icon":t.newWalletPasswordShow?"mdi-eye":"mdi-eye-off",rules:[t.rules.passwordMatching],type:t.newWalletPasswordShow?"text":"password",disabled:t.loading,label:t.$t("exoplatform.wallet.label.newWalletPasswordConfirm"),placeholder:t.$t("exoplatform.wallet.label.walletPasswordPlaceholderConfirm"),name:"confirmNewWalletPassword",autocomplete:"new-passord"},on:{"click:append":function(e){t.newWalletPasswordShow=!t.newWalletPasswordShow}},model:{value:t.confirmNewWalletPassword,callback:function(e){t.confirmNewWalletPassword=e},expression:"confirmNewWalletPassword"}})],1)],1)],1),t._v(" "),e("template",{slot:"footer"},[e("div",{staticClass:"d-flex mr-2"},[e("v-spacer"),t._v(" "),e("button",{staticClass:"ignore-vuetify-classes btn mx-1",attrs:{disabled:t.loading},on:{click:t.close}},[t._v("\n        "+t._s(t.$t("exoplatform.wallet.button.cancel"))+"\n      ")]),t._v(" "),e("button",{staticClass:"ignore-vuetify-classes btn btn-primary",attrs:{disabled:t.loading},on:{click:t.importWallet}},[t._v("\n        "+t._s(t.$t("exoplatform.wallet.button.import"))+"\n      ")])],1)])],2)};pe._withStripped=!0;const he=o({props:{isSpace:{type:Boolean,default:function(){return!1}},walletAddress:{type:String,default:function(){return null}}},data(){return{walletPrivateKey:"",walletPrivateKeyShow:!1,loading:!1,walletPassword:null,confirmNewWalletPassword:null,walletPasswordShow:!1,rules:{min:t=>t&&t.length>=8||"At least 8 characters",priv:t=>t&&(66===t.length||64===t.length)||'Exactly 64 or 66 (with "0x") characters are required',passwordMatching:t=>t&&t===this.walletPassword||this.$t("exoplatform.wallet.warning.passwordNotMatching")}}},created(){this.walletUtils.initSettings(this.isSpace,!0,!0).then((()=>this.walletUtils.initWeb3(this.isSpace,!0))),this.resetForm()},methods:{resetForm(){this.walletPrivateKey=null,this.walletPrivateKeyShow=!1,this.walletPassword=null,this.walletPasswordShow=!1,this.error=null,this.loading=!1,this.$refs.form&&this.$refs.form.reset()},importWallet(){if(this.error=null,!this.$refs.form.validate())return;this.loading=!0;const t=this;window.setTimeout((()=>{try{t.walletPrivateKey.indexOf("0x")<0&&(t.walletPrivateKey=`0x${t.walletPrivateKey}`);const e=window.localWeb3.eth.accounts.wallet.add(t.walletPrivateKey);t.walletAddress&&e.address.toLowerCase()!==t.walletAddress.toLowerCase()?(t.loading=!1,this.$root.$emit("wallet-notification-alert",{type:"error",message:this.$t("exoplatform.wallet.error.wrongPrivateKey",{0:t.walletAddress})})):xt(e,this.walletPassword,t.isSpace,!0,!0).then((()=>{t.loading=!1,this.$root.$emit("wallet-notification-alert",{type:"success",message:this.$t("exoplatform.wallet.success.walletImportedSuccessfully")}),t.close(),t.$nextTick((()=>{t.$emit("configured")}))})).catch((e=>{t.loading=!1,console.error("saveBrowserWalletInstance method - error",e),this.$root.$emit("wallet-notification-alert",{type:"error",message:this.$t("exoplatform.wallet.error.errorProcessingNewKeys")})}))}catch(e){t.loading=!1,console.error("Error importing private key",e),this.$root.$emit("wallet-notification-alert",{type:"error",message:this.$t("exoplatform.wallet.error.errorImportingPrivateKey")})}}),200)},open(){this.$refs.walletImportKeyModal.open()},close(){this.$refs.walletImportKeyModal.close(),this.resetForm()}}},pe,[],!1,null,null,null).exports;var fe=function(){var t=this,e=t._self._c;return e("v-app",[t.displayed?[e("v-card",{staticClass:"walletManagePassword",attrs:{flat:""}},[e("v-card-title",{staticClass:"px-0"},[e("div",{staticClass:"d-flex flex-row border-box-sizing"},[e("v-btn",{staticClass:"mx-1",attrs:{icon:"",height:"36",width:"36"},on:{click:function(e){return t.$emit("back")}}},[e("v-icon",{attrs:{size:"20"}},[t._v("\n              "+t._s(t.$vuetify.rtl?"mdi-arrow-right":"mdi-arrow-left")+"\n            ")])],1),t._v("\n          "+t._s(t.$t("exoplatform.wallet.label.managePassword"))+"\n        ")],1)]),t._v(" "),e("v-list",{staticClass:"mt-n5"},[e("v-list-item",[e("v-list-item-content",[e("v-list-item-title",{staticClass:"title text-color"},[t._v("\n              "+t._s(t.$t("exoplatform.wallet.label.rememberPasswordInBrowser"))+"\n            ")]),t._v(" "),e("v-list-item-subtitle",[t._v("\n              "+t._s(t.$t("exoplatform.wallet.message.rememberMyPassword"))+"\n            ")])],1),t._v(" "),e("v-list-item-action",[e("v-switch",{on:{change:t.changeRememberMe},model:{value:t.rememberPasswordStored,callback:function(e){t.rememberPasswordStored=e},expression:"rememberPasswordStored"}})],1)],1),t._v(" "),e("v-divider"),t._v(" "),e("v-list-item",[e("v-list-item-content",[e("v-list-item-title",{staticClass:"title text-color"},[t._v("\n              "+t._s(t.$t("exoplatform.wallet.button.changeWalletPassword"))+"\n            ")]),t._v(" "),e("v-list-item-subtitle",[t._v("\n              "+t._s(t.$t("exoplatform.wallet.message.managePassword"))+"\n            ")])],1),t._v(" "),e("v-list-item-action",[e("v-btn",{attrs:{small:"",icon:""},on:{click:t.openDrawer}},[e("i",{staticClass:"uiIconEdit uiIconLightBlue pb-2"})])],1)],1)],1)],1),t._v(" "),e("exo-drawer",{ref:"ManagePasswordDrawer",attrs:{right:""},on:{closed:t.closeDrawer}},[e("template",{slot:"title"},[e("span",{staticClass:"ignore-vuetify-classes PopupTitle popupTitle"},[t._v("\n          "+t._s(t.rememberPasswordToChange?t.$t("exoplatform.wallet.warning.requiredPassword"):t.$t("exoplatform.wallet.button.changeWalletPassword"))+"\n        ")])]),t._v(" "),e("template",{slot:"content"},[e("v-card-text",{staticClass:"walletManagePasswordDrawer"},[t.error?e("div",{staticClass:"alert alert-error"},[e("i",{staticClass:"uiIconError"}),t._v(" "+t._s(t.error)+"\n          ")]):t._e(),t._v(" "),e("v-form",{ref:"form",on:{submit:function(t){t.preventDefault(),t.stopPropagation()}}},[e("div",{staticClass:"managePasswordLabels mb-5"},[e("v-text-field",{attrs:{"append-icon":t.walletPasswordShow?"mdi-eye":"mdi-eye-off",rules:[t.rules.min],type:t.walletPasswordShow?"text":"password",disabled:t.loading,label:t.rememberPasswordToChange?t.$t("exoplatform.wallet.label.walletPassword"):t.$t("exoplatform.wallet.label.currentWalletPassword"),placeholder:t.$t("exoplatform.wallet.label.walletExistingPasswordPlaceholder"),name:"walletPassword",autocomplete:"current-passord",autofocus:"","validate-on-blur":""},on:{"click:append":function(e){t.walletPasswordShow=!t.walletPasswordShow}},model:{value:t.walletPassword,callback:function(e){t.walletPassword=e},expression:"walletPassword"}}),t._v(" "),t.rememberPasswordToChange?t._e():e("v-text-field",{attrs:{"append-icon":t.newWalletPasswordShow?"mdi-eye":"mdi-eye-off",rules:[t.rules.min],type:t.newWalletPasswordShow?"text":"password",disabled:t.loading,label:t.$t("exoplatform.wallet.label.newWalletPassword"),placeholder:t.$t("exoplatform.wallet.label.walletPasswordPlaceholder"),name:"newWalletPassword",autocomplete:"new-passord"},on:{"click:append":function(e){t.newWalletPasswordShow=!t.newWalletPasswordShow}},model:{value:t.newWalletPassword,callback:function(e){t.newWalletPassword=e},expression:"newWalletPassword"}}),t._v(" "),t.rememberPasswordToChange?t._e():e("v-text-field",{attrs:{"append-icon":t.newWalletPasswordShow?"mdi-eye":"mdi-eye-off",rules:[t.rules.passwordMatching],type:t.newWalletPasswordShow?"text":"password",disabled:t.loading,label:t.$t("exoplatform.wallet.label.newWalletPasswordConfirm"),placeholder:t.$t("exoplatform.wallet.label.walletPasswordPlaceholderConfirm"),name:"confirmNewWalletPassword",autocomplete:"new-passord"},on:{"click:append":function(e){t.newWalletPasswordShow=!t.newWalletPasswordShow}},model:{value:t.confirmNewWalletPassword,callback:function(e){t.confirmNewWalletPassword=e},expression:"confirmNewWalletPassword"}})],1),t._v(" "),e("v-switch",{staticClass:"v-input--reverse mt-2",attrs:{label:t.$t("exoplatform.wallet.message.rememberMyPassword")},model:{value:t.rememberPassword,callback:function(e){t.rememberPassword=e},expression:"rememberPassword"}})],1)],1)],1),t._v(" "),e("template",{slot:"footer"},[e("div",{staticClass:"d-flex mr-2"},[e("v-spacer"),t._v(" "),e("button",{staticClass:"ignore-vuetify-classes btn",attrs:{disabled:t.loading},on:{click:t.closeDrawer}},[t._v("\n            "+t._s(t.$t("exoplatform.wallet.button.cancel"))+"\n          ")]),t._v(" "),e("button",{staticClass:"ignore-vuetify-classes btn btn-primary me-1 mx-1",attrs:{disabled:t.loading},on:{click:function(e){return t.resetWallet()}}},[t._v("\n            "+t._s(t.$t("exoplatform.wallet.button.save"))+"\n          ")])],1)])],2)]:t._e()],2)};fe._withStripped=!0;const ve=o({props:{displayRememberMe:{type:Boolean,default:function(){return!1}},wallet:{type:Object,default:function(){return null}},buttonLabel:{type:String,default:function(){return null}},isSpace:{type:Boolean,default:!1}},data(){return{id:`WalletManagePassword${parseInt(1e4*Math.random())}`,displayed:!0,loading:!1,browserWalletExists:!1,hasKeyOnServerSide:!1,error:null,walletPassword:null,walletPasswordShow:!1,newWalletPassword:null,confirmNewWalletPassword:null,newWalletPasswordShow:!1,browserWalletDecrypted:!1,rememberPasswordStored:!1,rememberPasswordToChange:!1,rememberPassword:!0,rules:{min:t=>t&&t.length>=8||this.$t("exoplatform.wallet.warning.atLeast8Chars"),passwordMatching:t=>t&&t===this.newWalletPassword||this.$t("exoplatform.wallet.warning.passwordNotMatching")}}},computed:{backedUp(){return this.wallet&&this.wallet.backedUp}},created(){this.init()},methods:{init(){return this.error=null,this.walletPassword=null,this.walletPasswordShow=!1,this.newWalletPassword=null,this.newWalletPasswordShow=!1,this.rememberPassword=!0,this.rememberPasswordToChange=!1,this.walletUtils.initSettings(this.isSpace,!0,!0).then((()=>{if(!window.walletSettings)throw this.forceUpdate(),new Error(this.$t("exoplatform.wallet.error.emptySettings"));this.hasKeyOnServerSide=window.walletSettings&&window.walletSettings.userPreferences&&window.walletSettings.userPreferences.hasKeyOnServerSide,this.browserWalletExists=window.walletSettings.browserWalletExists,this.rememberPasswordStored=this.browserWalletExists&&!0===window.walletSettings.storedPassword})).then((()=>this.walletUtils.initWeb3(this.isSpace,!0)))},changeRememberMe(){this.loading||(this.rememberPasswordStored?(this.rememberPasswordToChange=!0,this.openDrawer()):$t(!1))},resetWallet(){if(this.error=null,!this.$refs.form.validate())return;this.loading=!0;const t=this;window.setTimeout((()=>{if(Wt(Mt(t.walletPassword)))try{t.rememberPasswordToChange?$t(!0,Mt(t.walletPassword)):(kt(t.newWalletPassword,null,null,t.rememberPassword),this.hasKeyOnServerSide&&ht(null,this.walletPassword,this.newWalletPassword).then(((t,e)=>{if(e)throw e;this.rememberPassword&&$t(!0,Mt(this.newWalletPassword)),this.$emit("reseted"),this.closeDrawer()})).catch((t=>{console.error("Error saving private key on server",t),this.error=String(t)})).finally((()=>{this.loading=!1})),t.$emit("reseted")),t.closeDrawer(),t.loading=!1}catch(e){return t.loading=!1,console.error("saveWallet method error",e),void(t.error=String(e))}else t.loading=!1,t.error=this.$t("exoplatform.wallet.warning.wrongPassword")}),200)},openDrawer(){this.$refs.ManagePasswordDrawer.open()},closeDrawer(){this.init(),this.$forceUpdate(),this.$refs.ManagePasswordDrawer.close()}}},fe,[],!1,null,null,null).exports;var ge=function(){var t=this,e=t._self._c;return e("exo-drawer",{ref:"sendTokensForm",attrs:{right:!t.$vuetify.rtl}},[e("template",{slot:"title"},[e("div",[e("i",{staticClass:"uiIcon uiArrowBAckIcon",on:{click:t.close}}),t._v(" "),e("span",{staticClass:"pb-2"},[t._v(" "+t._s(t.$t("exoplatform.wallet.button.requestFunds"))+" ")])])]),t._v(" "),e("template",{slot:"content"},[t.error&&!t.loading?e("div",{staticClass:"alert alert-error v-content"},[e("i",{staticClass:"uiIconError"}),t._v(t._s(t.error)+"\n    ")]):t._e(),t._v(" "),e("v-card-text",{staticClass:"walletRequestFundsModal"},[e("v-form",{ref:"form",on:{submit:function(t){t.preventDefault(),t.stopPropagation()}}},[e("wallet-reward-address-auto-complete",{ref:"autocomplete",attrs:{disabled:t.loading,autofocus:"","input-label":t.$t("exoplatform.wallet.label.recipient"),"input-placeholder":t.$t("exoplatform.wallet.label.recipientPlaceholder"),required:"","ignore-current-user":"","no-address":"","validate-on-blur":""},on:{"item-selected":function(e){t.recipient=e}}}),t._v(" "),e("v-text-field",{attrs:{disabled:t.loading,rules:t.amoutRules,label:t.$t("exoplatform.wallet.label.amount"),placeholder:t.$t("exoplatform.wallet.label.amountPlaceholder"),name:"amount"},model:{value:t.amount,callback:function(e){t.amount=t._n(e)},expression:"amount"}}),t._v(" "),e("v-textarea",{attrs:{id:"requestMessage",disabled:t.loading,label:t.$t("exoplatform.wallet.label.requestFundsMessage"),placeholder:t.$t("exoplatform.wallet.label.requestFundsMessagePlaceholder"),name:"requestMessage",rows:"7",flat:"","no-resize":""},model:{value:t.requestMessage,callback:function(e){t.requestMessage=e},expression:"requestMessage"}})],1)],1)],1),t._v(" "),e("template",{slot:"footer"},[e("div",{staticClass:"VuetifyApp flex d-flex"},[e("v-spacer"),t._v(" "),e("button",{staticClass:"ignore-vuetify-classes btn mx-1",on:{click:t.close}},[t._v("\n        "+t._s(t.$t("exoplatform.wallet.button.close"))+"\n      ")]),t._v(" "),e("button",{staticClass:"ignore-vuetify-classes btn btn-primary",attrs:{disabled:t.disabled},on:{click:t.requestFunds}},[t._v("\n        "+t._s(t.$t("exoplatform.wallet.button.sendRequest"))+"\n      ")])],1)])],2)};ge._withStripped=!0;const be=o({props:{walletAddress:{type:String,default:function(){return null}},contractDetails:{type:String,default:function(){return null}},disabledButton:{type:Boolean,default:function(){return!1}}},data(){return{recipient:null,amount:null,error:null,requestMessage:"",loading:!1,amoutRules:[t=>!!t||this.$t("exoplatform.wallet.warning.requiredField"),t=>!isNaN(parseFloat(t))&&isFinite(t)&&t>0||this.$t("exoplatform.wallet.warning.invalidAmount")]}},computed:{disabled(){return!this.walletAddress||this.loading||!this.recipient||!this.amount}},created(){this.init()},methods:{init(){this.requestMessage="",this.recipient=null,this.amount=null,this.$refs&&this.$refs.autocomplete&&(this.$refs.autocomplete.clear(),this.$refs.autocomplete.focus())},requestFunds(){this.$refs.form.validate()&&(this.contractDetails?this.recipient?(this.loading=!0,fetch("/portal/rest/wallet/api/account/requestFunds",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",body:JSON.stringify({address:this.walletAddress,receipient:this.recipient.id,receipientType:this.recipient.type,contract:this.contractDetails&&this.contractDetails.address,amount:this.amount,message:this.requestMessage})}).then((t=>{t&&t.ok?this.close():this.error=this.$t("exoplatform.wallet.error.errorRequestingFunds"),this.loading=!1})).catch((t=>{console.error("requestFunds method - error",t),this.error=`this.$t('exoplatform.wallet.error.errorProceeding'): ${t}`,this.loading=!1}))):this.error=this.t("exoplatform.wallet.warning.invalidReciepientAddress"):this.error=this.t("exoplatform.wallet.warning.contractIsMandatory"))},open(){this.$refs.sendTokensForm.open()},close(){this.$refs.sendTokensForm.close()}}},ge,[],!1,null,null,null).exports;var ye=function(){var t=this,e=t._self._c;return e("v-chip",{staticClass:"walletAddressCmp"},[t.allowCopy?e("v-btn",{staticClass:"ms-0 me-0 mb-0 mt-0",attrs:{id:"copy",title:t.$t("exoplatform.wallet.label.copyAddress"),icon:"",small:""},on:{click:t.copyToClipboard}},[e("v-icon",{attrs:{size:"12",dark:""}},[t._v("\n      fa-copy\n    ")])],1):t._e(),t._v(" "),t.isEditing&&t.allowEdit?e("input",{directives:[{name:"model",rawName:"v-model",value:t.labelDetail.label,expression:"labelDetail.label"}],ref:"labelDetailEditInput",staticClass:"walletAddressLabelInput me-2",attrs:{disabled:t.loading,name:"addressLabel",placeholder:"Label",autofocus:"","validate-on-blur":""},domProps:{value:t.labelDetail.label},on:{click:t.ignoreDefaultActions,keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.reset.apply(null,arguments)},keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.save.apply(null,arguments)},input:function(e){e.target.composing||t.$set(t.labelDetail,"label",e.target.value)}}}):t.isLink?e("a",{staticClass:"walletAddressLabel text-truncate me-2",class:!t.allowCopy&&"me-4",attrs:{href:t.addressEtherscanLink&&`${t.addressEtherscanLink}${t.value}`||"#",title:t.addressEtherscanLink&&t.$t("exoplatform.wallet.label.openOnEtherscan")||"",target:"_blank"}},[t.displayLabel&&t.labelDetail&&t.labelDetail.label?[t._v("\n      "+t._s(t.labelDetail.label)+"\n    ")]:t.name?[t._v("\n      "+t._s(t.name)+"\n    ")]:[t._v("\n      "+t._s(t.value)+"\n    ")]],2):e("span",{staticClass:"text-truncate"},[t._v(" "+t._s(t.value)+" ")]),t._v(" "),t.allowEdit&&t.displayLabel?e("v-slide-x-reverse-transition",{attrs:{mode:"out-in"}},[e("v-icon",{key:`icon-${t.isEditing}`,staticClass:"walletAddressEdit",attrs:{id:"walletAddressEdit",color:t.isEditing?"success":"info",title:t.$t("exoplatform.wallet.label.editAddressLabel"),size:"16"},on:{click:t.editOrSave}},[t._v("\n      "+t._s(t.isEditing?"fa-check-circle":"fa-pencil-alt")+"\n    ")])],1):t._e(),t._v(" "),t.allowCopy?e("input",{directives:[{name:"model",rawName:"v-model",value:t.value,expression:"value"}],ref:"clipboardInput",staticClass:"copyToClipboardInput",attrs:{type:"text"},domProps:{value:t.value},on:{input:function(e){e.target.composing||(t.value=e.target.value)}}}):t._e()],1)};ye._withStripped=!0;const _e=o({props:{name:{type:String,default:function(){return null}},value:{type:String,default:function(){return null}},allowCopy:{type:Boolean,default:function(){return!0}},allowEdit:{type:Boolean,default:function(){return!0}},isLink:{type:Boolean,default:function(){return!0}},displayLabel:{type:Boolean,default:function(){return!1}}},data:()=>({isEditing:!1,loading:!1,addressEtherscanLink:null,labelDetail:{},labelDetailToEdit:{}}),created(){this.init(),document.addEventListener("exo-wallet-label-changed",this.refresh)},methods:{init(){this.refresh()},refresh(){if(!this.value)return;if(this.isLink&&(this.addressEtherscanLink=Pt(window.walletSettings&&window.walletSettings.network&&window.walletSettings.network.id)),!window.walletSettings.userPreferences||!window.walletSettings.userPreferences.addresesLabels)return void(this.labelDetail={address:this.value.toLowerCase()});const t=this.value.toLowerCase();this.labelDetail=window.walletSettings.userPreferences.addresesLabels.find((e=>e&&e.address&&e.address.toLowerCase()===t))||{address:t},this.labelDetail=Object.assign({},this.labelDetail)},ignoreDefaultActions(t){t.preventDefault(),t.stopPropagation()},editOrSave(t){if(this.ignoreDefaultActions(t),this.allowEdit)return this.isEditing?this.save():(this.isEditing=!this.isEditing,void this.$nextTick((()=>this.$refs.labelDetailEditInput&&this.$refs.labelDetailEditInput.focus())))},reset(){this.refresh(),this.isEditing=!1},save(){if(this.allowEdit)return this.loading=!0,b(this.labelDetail).then((t=>{this.labelDetail=t,window.walletSettings.userPreferences.addresesLabels||(window.walletSettings.userPreferences.addresesLabels=[]);const e=this.value.toLowerCase(),a=window.walletSettings.userPreferences.addresesLabels.find((t=>t&&t.address&&t.address.toLowerCase()===e));a?Object.assign(a,t):window.walletSettings.userPreferences.addresesLabels.push(this.labelDetail),this.isEditing=!1,document.dispatchEvent(new CustomEvent("exo-wallet-label-changed"))})).finally((()=>{this.loading=!1}))},copyToClipboard(t){if(this.ignoreDefaultActions(t),this.$refs.clipboardInput.select(),document.execCommand)try{document.execCommand("copy")}catch(t){console.error("Error executing document.execCommand",t)}}}},ye,[],!1,null,null,null).exports;var Se=function(){var t=this,e=t._self._c;return e("v-flex",{staticClass:"text-center",attrs:{id:"walletSetup"}},[t.displayWelcomeScreen&&t.displayWalletBrowserSetup&&!t.isSpace?e("div",{staticClass:"backToWelcomeScreen"},[e("i",{staticClass:"uiIcon uiArrowBAckIcon",on:{click:function(e){t.displayWalletBrowserSetup=!1}}})]):t._e(),t._v(" "),e("wallet-reward-backup-modal",{ref:"walletBackupModal",staticClass:"me-3",attrs:{"display-complete-message":"","no-button":""},on:{"backed-up":function(e){return t.$emit("backed-up")}}}),t._v(" "),t.displayWalletCreationToolbar?e("div",{staticClass:"walletBackupDetailedWarning alert alert-info"},[e("i",{staticClass:"uiIconInfo"}),t._v(" "),t.isSpace?e("span",[t._v("\n      "+t._s(t.$t("exoplatform.wallet.warning.notPrivateKey"))+".\n      "),e("strong",[t._v("\n        "+t._s(t.$t("exoplatform.wallet.title.spaceWallet"))+"\n      ")]),t._v(" "+t._s(t.$t("exoplatform.wallet.warning.isReadOnlyMode"))+".\n    ")]):e("span",[t._v("\n      "+t._s(t.$t("exoplatform.wallet.warning.notPrivateKey"))+".\n      "),e("strong",[t._v("\n        "+t._s(t.$t("exoplatform.wallet.title.yourWallet"))+"\n      ")]),t._v(" "+t._s(t.$t("exoplatform.wallet.warning.isReadOnlyMode"))+".\n    ")]),t._v(" "),t.displayWalletSetup?t._e():e("a",{attrs:{href:"javascript:void(0);"},on:{click:function(e){return t.displayWalletSetupActions()}}},[t._v("\n      "+t._s(t.$t("exoplatform.wallet.label.moreOptions"))+"\n    ")])]):t._e(),t._v(" "),t.displayWalletNotExistingYet?e("div",{staticClass:"alert alert-info"},[e("i",{staticClass:"uiIconInfo"}),t._v(" "+t._s(t.$t("exoplatform.wallet.info.spaceWalletNotCreatedYet"))+"\n  ")]):t._e(),t._v(" "),t.displayWelcomeScreen&&!t.displayWalletBrowserSetup&&!t.isSpace&&t.metamaskFeatureEnabled?e("wallet-welcome-screen",{on:{"create-internal-wallet":function(e){t.displayWalletBrowserSetup=!0},configured:function(e){return t.refresh()}}}):t._e(),t._v(" "),t.displayWalletBrowserSetup||t.isSpace||!t.metamaskFeatureEnabled?e("wallet-reward-browser-setup",{ref:"walletBrowserSetup",attrs:{"is-space":t.isSpace,"is-space-administrator":t.isSpaceAdministrator,wallet:t.wallet,"refresh-index":t.refreshIndex,"is-administration":t.isAdministration,loading:t.loading,"initialization-state":t.initializationState},on:{configured:function(e){return t.refresh()},loading:function(e){return t.$emit("loading")},"end-loading":function(e){return t.$emit("end-loading")},error:function(e){return t.$emit("error",e)}}}):t._e()],1)};Se._withStripped=!0;const xe=o({props:{isSpace:{type:Boolean,default:function(){return!1}},loading:{type:Boolean,default:function(){return!1}},isAdministration:{type:Boolean,default:function(){return!1}},wallet:{type:Object,default:function(){return null}},initializationState:{type:String,default:function(){return null}},isMinimized:{type:Boolean,default:function(){return!1}}},data:()=>({isReadOnly:!1,browserWalletExists:!1,displayWalletSetup:!1,displayWalletBrowserSetup:!1}),computed:{backedUp(){return this.wallet&&this.wallet.backedUp},displayWalletNotExistingYet(){return!this.loading&&!this.isAdministration&&this.isSpace&&!this.isSpaceAdministrator&&!this.walletAddress},isSpaceAdministrator(){return this.wallet&&this.wallet.spaceAdministrator},walletAddress(){return this.wallet&&this.wallet.address},displayWalletCreationToolbar(){return this.wallet&&"INTERNAL_WALLET"===this.wallet.provider&&!this.loading&&this.walletAddress&&!this.browserWalletExists&&this.isReadOnly&&(!this.isSpace||this.isSpaceAdministrator)},displayWalletBackup(){return!this.loading&&!this.isAdministration&&this.walletAddress&&this.browserWalletExists&&!this.backedUp&&"DELETED"!==this.initializationState&&this.wallet&&"INTERNAL_WALLET"===this.wallet.provider},displayWelcomeScreen(){return this.displayWalletSetup&&(this.wallet&&!this.wallet.address||"DELETED"===this.initializationState)},metamaskFeatureEnabled:()=>window.walletSettings&&window.walletSettings.metamaskEnabled},watch:{refreshIndex(){this.init()},displayWalletBackup(){this.displayWalletBackup&&this.$refs&&this.$refs.walletBackupModal&&(this.$refs.walletBackupModal.dialog=!0)}},methods:{refresh(){this.$emit("refresh")},init(){window.walletSettings&&(this.isReadOnly=window.walletSettings.isReadOnly,this.browserWalletExists=window.walletSettings.browserWalletExists,this.displayWalletSetup=!this.walletAddress&&(!this.isSpace||this.isSpaceAdministrator)||"DELETED"===this.initializationState,this.$nextTick((()=>{this.$refs.walletBrowserSetup&&this.$refs.walletBrowserSetup.init()})))},displayWalletSetupActions(){this.displayWalletSetup=!0}}},Se,[],!1,null,null,null).exports;var ke=function(){var t=this,e=t._self._c;return e("exo-drawer",{ref:"walletBackup",attrs:{right:!t.$vuetify.rtl},on:{closed:t.close}},[e("template",{slot:"title"},[e("span",{staticClass:"pb-2"},[t._v(" "+t._s(t.$t("exoplatform.wallet.title.backupWalletModal"))+" ")])]),t._v(" "),e("template",{slot:"content"},[e("v-card-text",[e("div",{staticClass:"text-sub-title mx-2",attrs:{id:"walletBackupDetailedWarning"}},[t._v("\n        "+t._s(t.$t("exoplatform.wallet.warning.backupWalletPart1"))+"\n        "+t._s(t.$t("exoplatform.wallet.warning.backupWalletPart2"))+" "),e("br"),t._v("\n        "+t._s(t.$t("exoplatform.wallet.warning.backupWalletPart3"))+" "),e("br")]),t._v(" "),t.walletPrivateKey?t._e():e("p",{staticClass:"backupWalletText mx-2"},[t._v(" "+t._s(t.$t("exoplatform.wallet.warning.backupWalletPart4"))+" "),e("br")]),t._v(" "),e("v-form",{ref:"form",staticClass:"mx-2",on:{submit:function(t){t.preventDefault(),t.stopPropagation()}}},[t.walletPrivateKey?t._e():e("v-text-field",{ref:"walletPassword",attrs:{"append-icon":t.walletPasswordShow?"mdi-eye":"mdi-eye-off",rules:[t.rules.min],type:t.walletPasswordShow?"text":"password",name:"walletPassword",label:"Current wallet password",placeholder:"Enter your current wallet password",autocomplete:"current-passord",autofocus:"","validate-on-blur":""},on:{"click:append":function(e){t.walletPasswordShow=!t.walletPasswordShow}},model:{value:t.walletPassword,callback:function(e){t.walletPassword=e},expression:"walletPassword"}})],1)],1),t._v(" "),t.walletPrivateKey?e("v-card-text",[e("wallet-reward-address",{staticClass:"mx-2",attrs:{value:t.walletPrivateKey,"allow-edit":!1,"is-link":!1}})],1):t._e()],1),t._v(" "),e("template",{slot:"footer"},[e("div",{staticClass:"d-flex mr-2"},[e("v-spacer"),t._v(" "),e("button",{staticClass:"ignore-vuetify-classes btn",attrs:{disabled:t.loading},on:{click:t.close}},[t._v("\n        "+t._s(t.$t("exoplatform.wallet.button.close"))+"\n      ")]),t._v(" "),t.walletPrivateKey?e("button",{staticClass:"ignore-vuetify-classes btn btn-primary me-1 mx-1",on:{click:t.walletBackedUp}},[t._v("\n        "+t._s(t.$t("exoplatform.wallet.button.backedUp"))+"\n      ")]):t._e(),t._v(" "),t.walletPrivateKey?t._e():e("button",{staticClass:"ignore-vuetify-classes btn btn-primary me-1 mx-1",attrs:{disabled:t.loading},on:{click:t.showPrivateKey}},[t._v("\n        "+t._s(t.$t("exoplatform.wallet.button.displayPrivateKey"))+"\n      ")])],1)])],2)};ke._withStripped=!0;const $e=o({props:{noButton:{type:Boolean,default:function(){return!1}}},data(){return{walletPassword:"",walletPasswordShow:!1,walletPrivateKey:null,loading:!1,rules:{min:t=>t&&t.length>=8||this.$t("exoplatform.wallet.warning.atLeast8Chars")}}},created(){this.init()},methods:{init(){this.walletPrivateKey=null,this.walletPassword="",this.walletPasswordShow=!1,this.loading=!1},walletBackedUp(){Lt().then((()=>{this.$emit("backed-up"),this.close()})).catch((t=>{this.$root.$emit("wallet-notification-alert",{type:"error",message:String(t)})})).finally((()=>{this.loading=!1}))},showPrivateKey(){this.$refs.form.validate()&&(this.loading=!0,window.setTimeout(this.unlockBrowserWallet,200))},unlockBrowserWallet(){const t=Wt(Mt(this.walletPassword));try{if(t){const t=Et();if(!t||!t.privateKey)return void this.$root.$emit("wallet-notification-alert",{type:"error",message:this.$t("exoplatform.wallet.error.walletNotFound")});this.loading=!1,this.walletPrivateKey=t.privateKey}else this.$root.$emit("wallet-notification-alert",{type:"error",message:this.$t("exoplatform.wallet.warning.wrongPassword")})}finally{this.loading=!1,t&&Dt()}},open(){this.$refs.walletBackup.open()},close(){this.$refs.walletBackup.close(),this.init()}}},ke,[],!1,null,null,null).exports;var Ce=function(){var t=this,e=t._self._c;return t.displayed?e("v-card",{staticClass:"walletSetting",attrs:{flat:""}},[t.hideContent?t._e():[e("v-card-title",{staticClass:"px-0 pt-2"},[e("v-toolbar",{staticClass:"border-box-sizing",attrs:{flat:""}},[e("v-btn",{staticClass:"mx-1",attrs:{icon:"",height:"36",width:"36"},on:{click:function(e){return t.$emit("back")}}},[e("v-icon",{attrs:{size:"20"}},[t._v("\n            "+t._s(t.$vuetify.rtl?"mdi-arrow-right":"mdi-arrow-left")+"\n          ")])],1),t._v(" "),e("v-toolbar-title",{staticClass:"ps-0"},[t._v("\n          "+t._s(t.title)+"\n        ")]),t._v(" "),e("v-spacer")],1)],1),t._v(" "),e("v-card-subtitle",{staticClass:"mx-12"},[t._v("\n      "+t._s(t.description)+"\n    ")])],t._v(" "),e("v-list",{staticClass:"mx-4"},[t.isInternalWallet?e("wallet-settings-internal-details",{attrs:{"is-space":t.isSpace,"wallet-settings":t.walletSettings},on:{"close-details":function(e){t.hideContent=!0},"open-details":function(e){t.hideContent=!1}}}):t._e(),t._v(" "),t.isDeleted||t.hideContent||!t.walletAddress?t._e():e("v-list-item",{staticClass:"manageKey"},[e("v-list-item-content",[e("v-list-item-title",{staticClass:"title text-color"},[t._v("\n          "+t._s(t.$t("exoplatform.wallet.label.ethereumAddress"))+"\n        ")]),t._v(" "),e("v-list-item-subtitle",[t._v("\n          "+t._s(t.messageDigitalKey)+"\n        ")])],1),t._v(" "),t.walletAddress?e("v-list-item-action",[e("wallet-reward-qr-code",{ref:"qrCode",attrs:{to:t.walletAddress,title:t.$t("exoplatform.wallet.title.addressQRCode")}}),t._v(" "),e("wallet-reward-address",{attrs:{value:t.walletAddress,"allow-edit":!1}})],1):t._e()],1)],1)],2):t._e()};Ce._withStripped=!0;const Pe=o({props:{walletSettings:{type:Object,default:null},title:{type:String,default:null},description:{type:String,default:null},messageDigitalKey:{type:String,default:null},isSpace:{type:Boolean,default:!1}},data:()=>({id:`WalletSettingsDetails${parseInt(1e4*Math.random())}`,displayed:!0,hideContent:!1}),computed:{wallet(){return this.walletSettings.wallet},provider(){return this.wallet&&this.wallet.provider},walletAddress(){return this.wallet&&this.wallet.address},initializationState(){return this.walletAddress&&this.wallet.initializationState},isDeleted(){return"DELETED"===this.initializationState},isInternalWallet(){return!this.provider||"INTERNAL_WALLET"===this.provider}}},Ce,[],!1,null,null,null).exports;var Ae=function(){var t=this,e=t._self._c;return e("v-list-item",[e("v-list-item-content",{class:!t.useInternalWallet&&"half-opacity",attrs:{transition:"fade-transition"}},[e("v-list-item-title",{staticClass:"text-color"},[e("div",{staticClass:"d-flex align-center"},[e("img",{staticClass:"pr-2 pl-1",attrs:{src:"/wallet-common/images/meeds.svg",alt:"Meeds",width:"16"}}),t._v("\n        "+t._s(t.$t("exoplatform.wallet.settings.meedsWallet"))+"\n      ")])])],1),t._v(" "),e("v-list-item-action",[e("v-btn",{attrs:{disabled:!t.useInternalWallet,small:"",icon:""},on:{click:t.openDetail}},[e("v-icon",{staticClass:"text-sub-title",attrs:{size:"24"}},[t._v("\n        "+t._s(t.$vuetify.rtl?"fa-caret-left":"fa-caret-right")+"\n      ")])],1)],1)],1)};Ae._withStripped=!0;const Te=o({props:{walletSettings:{type:Object,default:null}},data:()=>({useInternalWallet:!1}),watch:{walletSettings:{immediate:!0,handler(){this.useInternalWallet=this.walletSettings&&this.walletSettings.wallet&&(!this.walletSettings.wallet.provider||"INTERNAL_WALLET"===this.walletSettings.wallet.provider)||!1}}},created(){this.$root.$on("wallet-settings-provider-changing",(t=>{this.useInternalWallet=!t||"INTERNAL_WALLET"===t||!1}))},methods:{openDetail(){this.$emit("open-detail",this.$t("exoplatform.wallet.label.settings.internal"),this.$t("exoplatform.wallet.message.settingsDescription.internal"),this.$t("exoplatform.wallet.message.manageDigitalKey.internal"))}}},Ae,[],!1,null,null,null).exports;var Ie=function(){var t=this,e=t._self._c;return e("div",[t.displayManagePasswordDetails?e("wallet-reward-password-management",{staticClass:"d-flex",attrs:{wallet:t.wallet,"is-space":t.isSpace,"button-label":t.$t("exoplatform.wallet.button.resetWalletPassword"),"display-remember-me":""},on:{back:t.closeManagePasswordDetails}}):[!t.isDeleted&&t.walletAddress?e("v-list-item",[e("v-list-item-content",[e("v-list-item-title",{staticClass:"title text-color"},[t._v("\n          "+t._s(t.$t("exoplatform.wallet.label.managePassword"))+"\n        ")]),t._v(" "),e("v-list-item-subtitle",[t._v("\n          "+t._s(t.$t("exoplatform.wallet.message.managePasswordDescription"))+"\n        ")])],1),t._v(" "),e("v-list-item-action",[e("v-btn",{attrs:{small:"",icon:""},on:{click:t.openManagePasswordDetails}},[e("v-icon",{staticClass:"text-sub-title",attrs:{size:"24"}},[t._v("\n            "+t._s(t.$vuetify.rtl?"fa-caret-left":"fa-caret-right")+"\n          ")])],1)],1)],1):t._e(),t._v(" "),!t.isDeleted&&t.walletAddress?e("v-divider"):t._e(),t._v(" "),!t.isDeleted&&t.walletAddress?e("v-list-item",[e("v-list-item-content",[e("v-list-item-title",{staticClass:"title text-color"},[t._v("\n          "+t._s(t.$t("exoplatform.wallet.title.backupWalletModal"))+"\n        ")]),t._v(" "),e("v-list-item-subtitle",[t._v("\n          "+t._s(t.$t("exoplatform.wallet.message.backupWallet"))+"\n        ")])],1),t._v(" "),e("v-list-item-action",[e("v-btn",{attrs:{small:"",icon:""},on:{click:t.openWalletBackUpDrawer}},[e("i",{staticClass:"uiIconEdit uiIconLightBlue pb-2",attrs:{"aria-hidden":"true"}})])],1)],1):t._e(),t._v(" "),!t.isDeleted&&t.walletAddress?e("v-divider"):t._e(),t._v(" "),e("v-list-item",[e("v-list-item-content",[e("v-list-item-title",{staticClass:"title text-color"},[t._v("\n          "+t._s(t.$t("exoplatform.wallet.title.restoreWalletModal"))+"\n        ")]),t._v(" "),e("v-list-item-subtitle",[t._v("\n          "+t._s(t.$t("exoplatform.wallet.message.importNewPrivateKeyMessage"))+"\n        ")])],1),t._v(" "),e("v-list-item-action",[e("v-btn",{attrs:{small:"",icon:""},on:{click:t.openWalletImportKeyDrawer}},[e("i",{staticClass:"uiIconEdit uiIconLightBlue pb-2",attrs:{"aria-hidden":"true"}})])],1)],1),t._v(" "),!t.isDeleted&&t.walletAddress?e("v-divider"):t._e(),t._v(" "),!t.isDeleted&&t.walletAddress?e("v-list-item",{staticClass:"deleteWallet"},[e("v-list-item-content",[e("v-list-item-title",{staticClass:"title deleteText"},[t._v("\n          "+t._s(t.$t("exoplatform.wallet.title.deleteWalletConfirmationModal"))+"\n        ")]),t._v(" "),e("v-list-item-subtitle",[t._v("\n          "+t._s(t.$t("exoplatform.wallet.message.deleteWallet"))+"\n        ")])],1),t._v(" "),e("v-list-item-action",[e("v-btn",{attrs:{small:"",icon:""},on:{click:t.openDeleteConfirmationModal}},[e("i",{staticClass:"uiIconTrash uiIconLightBlue pb-2",attrs:{"aria-hidden":"true"}})])],1)],1):t._e()],t._v(" "),e("wallet-reward-import-key-drawer",{ref:"walletImportKey",attrs:{"is-space":t.isSpace,"wallet-address":t.wallet&&t.wallet.address},on:{configured:function(e){return t.$emit("settings-changed")}}}),t._v(" "),e("wallet-reward-backup-drawer",{ref:"walletBackup",staticClass:"walletBackup",attrs:{"display-complete-message":"","no-button":""}}),t._v(" "),e("wallet-reward-confirm-dialog",{ref:"informationModal",attrs:{loading:t.loading,title:t.$t("exoplatform.wallet.title.deleteWalletConfirmationModal"),"title-class":t.deleteText,message:t.$t("exoplatform.wallet.message.deleteWalletConfirmationModal"),"hide-default-footer":!1,"ok-label":t.$t("exoplatform.wallet.button.deleteteConfirm"),"cancel-label":t.$t("exoplatform.wallet.button.cancel"),width:"400px"},on:{ok:t.deleteWallet}})],2)};Ie._withStripped=!0;const Ee=o({props:{walletSettings:{type:Object,default:null},isSpace:{type:Boolean,default:!1}},data:()=>({displayManagePasswordDetails:!1,alert:!1,type:"",message:"",provider:null}),computed:{wallet(){return this.walletSettings&&this.walletSettings.wallet},walletAddress(){return this.walletSettings&&this.walletSettings.wallet&&this.walletSettings.wallet.address},initializationState(){return this.wallet&&this.wallet.address&&this.wallet.initializationState},isDeleted(){return"DELETED"===this.initializationState}},watch:{walletSettings:{immediate:!0,handler(){this.provider=this.walletSettings&&this.walletSettings.wallet&&this.walletSettings.wallet.provider}}},methods:{openManagePasswordDetails(){this.$emit("close-details"),this.displayManagePasswordDetails=!0},closeManagePasswordDetails(){this.$emit("open-details"),this.displayManagePasswordDetails=!1},openWalletImportKeyDrawer(){this.$refs.walletImportKey.open()},openWalletBackUpDrawer(){this.$refs.walletBackup.open()},openDeleteConfirmationModal(){this.$refs.informationModal.open()},deleteWallet(){return this.walletUtils.deleteWallet(this.walletSettings.wallet.address).then((()=>(this.$root.$emit("wallet-notification-alert",{type:"success",message:this.$t("exoplatform.wallet.message.deleteWalletSuccess")}),"user"===this.wallet.type?window.location.href=`${eXo.env.portal.context}/${eXo.env.portal.portalName}/wallet`:window.location.href=`${eXo.env.portal.context}/g/:spaces:${eXo.env.portal.spaceGroup}/${eXo.env.portal.spaceName}/SpaceWallet`))).catch((t=>{this.$root.$emit("wallet-notification-alert",{type:"error",message:String(t)})}))}}},Ie,[],!1,null,null,null).exports;var De=function(){var t=this,e=t._self._c;return e("div",[e("v-list-item",[e("v-list-item-content",{class:(!t.isMetamaskInstalled||!t.useMetamask)&&"half-opacity",attrs:{transition:"fade-transition"}},[e("v-list-item-title",{staticClass:"text-color"},[e("div",{staticClass:"d-flex align-center"},[e("img",{staticClass:"pr-2 pl-1",attrs:{src:"/wallet-common/images/metamask.svg",alt:"Metamask",width:"18"}}),t._v(" "),e("span"),t._v("\n          "+t._s(t.$t("exoplatform.wallet.settings.useMetamask"))+"\n        ")])])],1),t._v(" "),e("v-list-item-action",[e("v-switch",{staticClass:"pl-n1",attrs:{loading:t.savingMetamaskAddress,disabled:!t.isMetamaskInstalled&&!t.useMetamask||t.savingMetamaskAddress},on:{click:t.switchMetamask},model:{value:t.useMetamask,callback:function(e){t.useMetamask=e},expression:"useMetamask"}})],1)],1),t._v(" "),t.isMetamaskInstalled?t._e():e("v-list-item",{staticClass:"mt-n2"},[e("v-list-item-content",[e("v-list-item-subtitle",{staticClass:"text-sub-title pl-1"},[e("span",{staticClass:"mr-3 text-light-color"},[t._v(t._s(t.$t("exoplatform.wallet.settings.metamaskInstallation")))]),t._v(" "),e("a",{attrs:{href:t.metamaskInstallLink,target:"_blank",rel:"noopener nofollow"}},[t._v(t._s(t.metamaskInstallLink))])])],1)],1),t._v(" "),t.metamaskAddress&&!t.savingMetamaskAddress?e("v-list-item",{staticClass:"mt-n2"},[e("v-list-item-content",[e("v-list-item-subtitle",{staticClass:"text-sub-title pl-5"},[e("v-chip",{staticClass:"grey-background"},[e("span",{staticClass:"mr-3 dark-grey-color walletTitle"},[t._v("\n            "+t._s(t.metamaskAddressPreview)+"\n          ")]),t._v(" "),e("wallet-settings-jdenticon",{attrs:{address:t.metamaskAddress}})],1)],1)],1),t._v(" "),e("v-list-item-action",[e("v-btn",{attrs:{small:"",icon:"",disabled:t.savingMetamaskAddress},on:{click:t.openDetail}},[e("v-icon",{staticClass:"text-sub-title",attrs:{size:"24"}},[t._v("\n          "+t._s(t.$vuetify.rtl?"fa-caret-left":"fa-caret-right")+"\n        ")])],1)],1)],1):t._e()],1)};De._withStripped=!0;const We=o({props:{walletSettings:{type:Object,default:null}},data:()=>({useMetamask:!1,savingMetamaskAddress:!1}),computed:{isMetamaskInstalled:()=>window.ethereum&&window.ethereum.isMetaMask,isMobile(){return this.$vuetify.breakpoint.smAndDown},currentSiteLink:()=>`${window.location.host}${window.location.pathname}`,disableSwitchButton(){return!this.isMetamaskInstalled&&!this.useMetamask||this.savingMetamaskAddress},metamaskInstallLink(){return this.isMobile&&`https://metamask.app.link/dapp/${this.currentSiteLink}`||"https://metamask.io/"},metamaskAddress(){return this.useMetamask&&this.walletSettings&&this.walletSettings.wallet&&this.walletSettings.wallet.address},metamaskAddressPreview(){return this.metamaskAddress&&`${this.metamaskAddress.substring(0,5)}...${this.metamaskAddress.substring(this.metamaskAddress.length-4,this.metamaskAddress.length)}`},generatedToken(){return this.$root.generatedToken},isEmptyPassphrase(){return null===this.walletSettings.wallet.passPhrase},isDeleted(){return"DELETED"===this.walletSettings.wallet.initializationState}},watch:{walletSettings:{immediate:!0,handler(){this.useMetamask=this.walletSettings&&this.walletSettings.wallet&&"METAMASK"===this.walletSettings.wallet.provider,this.metamaskAddress=this.walletSettings&&this.walletSettings.wallet&&this.walletSettings.wallet.address}}},created(){this.$root.$on("wallet-settings-provider-changing",(t=>{this.useMetamask="METAMASK"===t}))},methods:{openDetail(){this.$emit("open-detail",this.$t("exoplatform.wallet.label.settings.metamask"),this.$t("exoplatform.wallet.message.settingsDescription.metamask"),this.$t("exoplatform.wallet.message.manageDigitalKey.metamask"))},switchMetamask(){this.useMetamask?this.connectToMetamask():this.resetMetamask()},resetMetamask(){return this.savingMetamaskAddress=!0,this.$root.$emit("wallet-settings-provider-changing","INTERNAL_WALLET"),_().then((()=>{if(window.walletSettings.wallet.provider="INTERNAL_WALLET",this.$root.$emit("wallet-settings-provider-changed","INTERNAL_WALLET"),this.isEmptyPassphrase||this.isDeleted)return"user"===this.walletSettings.wallet.type?window.location.href=`${eXo.env.portal.context}/${eXo.env.portal.portalName}/wallet`:window.location.href=`${eXo.env.portal.context}/g/:spaces:${eXo.env.portal.spaceGroup}/${eXo.env.portal.spaceName}/SpaceWallet`})).catch((()=>this.$root.$emit("wallet-settings-provider-changing",window.walletSettings.wallet.provider))).finally((()=>{this.savingMetamaskAddress=!1}))},connectToMetamask(){this.$root.$emit("wallet-settings-provider-changing","METAMASK"),this.savingMetamaskAddress=!0;let t=null;return window.ethereum.request({method:"wallet_requestPermissions",params:[{eth_accounts:{}}]}).then((()=>this.retrieveAddress())).then((e=>(t=e,this.signMessage(e)))).then((()=>{window.walletSettings.wallet.address=t,window.walletSettings.wallet.provider="METAMASK",this.$root.$emit("wallet-settings-provider-changed","METAMASK"),this.savingMetamaskAddress=!1})).catch((()=>{this.$root.$emit("wallet-settings-provider-changing",window.walletSettings.wallet.provider),this.savingMetamaskAddress=!1}))},retrieveAddress:()=>window.ethereum.request({method:"eth_requestAccounts"}).then((t=>t[0])),signMessage(t){let e=this.$t("exoplatform.wallet.metamask.welcomeMessage",{0:t,1:this.generatedToken});return e=e.split(/\\n/g).join("\n"),window.ethereum.request({method:"personal_sign",params:[e,t,""]}).then((a=>this.saveProvider("METAMASK",t,e,a)))},saveProvider(t,e,a,s){return y(t,e,a,s).then((()=>{window.walletSettings.wallet.address=e,window.walletSettings.wallet.provider="METAMASK",this.$root.$emit("wallet-notification-alert",{type:"success",message:this.$t("exoplatform.wallet.metamask.message.connectedSuccess")})}))}}},De,[],!1,null,null,null).exports;var Le=function(){var t=this._self._c;return t("v-avatar",{staticClass:"whiteBackground",attrs:{size:"16px"}},[t("svg",{ref:"identicon",attrs:{"data-jdenticon-value":this.address}})])};Le._withStripped=!0;const Me=o({props:{address:{type:String,default:null}},mounted(){window.jdenticon.updateSvg(this.$refs.identicon)}},Le,[],!1,null,null,null).exports;var Ne=function(){var t=this,e=t._self._c;return e("v-app",[t.displayDetails?e("wallet-settings-details",{attrs:{"wallet-settings":t.walletSettings,"is-space":t.isSpace,title:t.detailsTitle,description:t.detailsDescription,"message-digital-key":t.detailsmessageDigitalKey},on:{back:t.closeDetail}}):t.displayed?e("v-card",{staticClass:"border-radius",class:t.walletSettingsClass,attrs:{flat:""}},[e("v-list",[e("v-list-item",[e("v-list-item-content",[e("v-list-item-title",{staticClass:"title text-color"},[t._v("\n            "+t._s(t.$t("exoplatform.wallet.label.settings.internal"))+"\n          ")])],1)],1),t._v(" "),e("wallet-settings-internal",{attrs:{"wallet-settings":t.walletSettings},on:{"open-detail":t.openDetail}}),t._v(" "),t.metamaskFeatureEnabled&&!t.isSpace?e("wallet-settings-metamask",{attrs:{"wallet-settings":t.walletSettings},on:{"open-detail":t.openDetail}}):t._e()],1)],1):t._e(),t._v(" "),e("wallet-notification-alert")],1)};Ne._withStripped=!0;const Be=o({data:()=>({id:`Wallet${parseInt(1e4*Math.random())}`,walletSettings:{},displayed:!0,displayDetails:!1}),computed:{isSpace(){return""!==eXo.env.portal.spaceId||this.wallet&&this.wallet.spaceId&&0!==this.wallet.spaceId},walletSettingsClass:()=>eXo.env.portal.spaceName?"":"my-3",metamaskFeatureEnabled(){return this.walletSettings&&this.walletSettings.metamaskEnabled}},created(){document.addEventListener("hideSettingsApps",(t=>{t&&t.detail&&this.id!==t.detail&&(this.displayed=!1)})),document.addEventListener("showSettingsApps",(()=>{this.displayed=!0,this.isSpace&&this.checkWalletInstalled()})),this.$root.$on("wallet-settings-provider-changed",(t=>{"INTERNAL_WALLET"===t?this.walletUtils.initSettings(this.isSpace).then((()=>this.walletSettings=Object.assign({},window.walletSettings))):this.walletSettings=Object.assign({},window.walletSettings)})),this.isSpace&&this.checkWalletInstalled(),window.walletSettings&&window.walletSettings.wallet?(this.walletSettings=Object.assign({},window.walletSettings),this.walletUtils.initWeb3(this.isSpace,!0),this.$root.$applicationLoaded()):this.walletUtils.initSettings(this.isSpace).then((()=>(this.walletSettings=window.walletSettings&&Object.assign({},window.walletSettings)||{},this.walletUtils.initWeb3(this.isSpace,!0)))).finally((()=>this.$root.$applicationLoaded()))},mounted(){if(window.location.href.includes("walletSetting"))return window.location.hash="#walletSettingsApp",window.location.href},methods:{checkWalletInstalled(){this.displayed=!1,this.$spaceService.getSpaceApplications(eXo.env.portal.spaceId).then((t=>{this.applications=t,this.displayed=this.applications.some((t=>"SpaceWallet"===t.id))}))},openDetail(t,e,a){document.dispatchEvent(new CustomEvent("hideSettingsApps",{detail:this.id})),this.detailsTitle=t,this.detailsDescription=e,this.detailsmessageDigitalKey=a,this.displayDetails=!0},closeDetail(){document.dispatchEvent(new CustomEvent("showSettingsApps")),this.displayDetails=!1,window.history.replaceState("",window.document.title,window.location.href.split("#")[0])}}},Ne,[],!1,null,null,null).exports;var Fe=function(){var t=this,e=t._self._c;return e("v-snackbar",{attrs:{left:!t.$vuetify.rtl,right:t.$vuetify.rtl,color:"transparent",elevation:"0",app:""},model:{value:t.snackbar,callback:function(e){t.snackbar=e},expression:"snackbar"}},[e("exo-notification-alert",{attrs:{alert:t.alert},on:{dismissed:t.clear},scopedSlots:t._u([t.showTransactionLink?{key:"actions",fn:function(){return[e("a",{staticClass:"d-block",attrs:{href:t.transactionHashLink,title:t.$t("exoplatform.wallet.message.transactionExplorerLink"),rel:"external nofollow noreferrer noopener",target:"_blank"}},[t._v("\n        "+t._s(t.transactionLinkLabel)+"\n      ")])]},proxy:!0}:null],null,!0)})],1)};Fe._withStripped=!0;const Oe=o({data:()=>({snackbar:!1,alert:null}),computed:{transactionLinkLabel(){return this.$t("exoplatform.wallet.message.followTransaction",{0:this.walletUtils.getTransactionExplorerName()})},transactionHashLink(){return this.walletUtils.getTransactionEtherscanlink().concat(this.alert.transactionHash)},showTransactionLink(){return this.alert?.transactionHash}},watch:{alert(){this.snackbar=!!this.alert}},created(){this.$root.$on("wallet-notification-alert",(t=>this.alert=t))},methods:{clear(){this.alert=null}}},Fe,[],!1,null,null,null).exports;var Re=function(){var t=this,e=t._self._c;return e("div",{staticClass:"d-flex justify-space-between"},[e("v-icon",{staticClass:"me-2",attrs:{color:"warning",size:"16"}},[t._v("\n    fa-exclamation-triangle\n  ")]),t._v("\n  "+t._s(t.alertMessage)+"\n  "),e("div",{staticClass:"align-self-center align-center"},[t.notInstalled?e("v-btn",{staticClass:"btn primary",attrs:{href:t.metamaskInstallLinlk,name:"installMetamaskLink",target:"_blank",rel:"nofollow noreferrer noopener"}},[e("span",{staticClass:"text-capitalize"},[t._v(t._s(t.buttonLabel))])]):e("v-btn",{staticClass:"btn primary",on:{click:t.operateMetamaskChange}},[e("span",{staticClass:"text-capitalize"},[t._v(t._s(t.buttonLabel))])])],1)],1)};Re._withStripped=!0;const Ue=o({props:{notInstalled:{type:Boolean,default:!1},notConnected:{type:Boolean,default:!1},invalidNetwork:{type:Boolean,default:!1},invalidAccount:{type:Boolean,default:!1}},computed:{alertMessage(){return this.notInstalled?this.$t("exoplatform.wallet.warn.metamaskNotInstalled"):this.notConnected?this.$t("exoplatform.wallet.warn.metamaskDisconnected"):this.invalidNetwork?this.$t("exoplatform.wallet.warn.networkVersion"):this.invalidAccount?this.$t("exoplatform.wallet.warn.selectedAddress"):""},buttonLabel(){return this.notInstalled?this.$t("exoplatform.wallet.warn.installMetamask"):this.notConnected?this.$t("exoplatform.wallet.warn.connectMetamask"):this.invalidNetwork?this.$t("exoplatform.wallet.warn.changeNetwork"):this.invalidAccount?this.$t("exoplatform.wallet.warn.changeAccount"):""},isMobile(){return this.$vuetify.breakpoint.smAndDown},currentSiteLink:()=>`${window.location.host}${window.location.pathname}`,metamaskInstallLinlk(){return this.isMobile&&`https://metamask.app.link/dapp/${this.currentSiteLink}`||"https://metamask.io/"}},methods:{operateMetamaskChange(){this.notConnected?this.walletUtils.connectToMetamask():this.invalidNetwork?this.walletUtils.switchMetamaskNetwork():this.invalidAccount&&this.walletUtils.switchMetamaskAccount()}}},Re,[],!1,null,null,null).exports;var Ke=function(){var t=this,e=t._self._c;return e("v-flex",{staticClass:"mx-4",attrs:{id:"walletWelcomeScreen"}},[e("v-row",{attrs:{"no-gutters":""}},[e("v-col",[e("div",{staticClass:"title px-4 py-4 styleTitle"},[t._v(t._s(t.$t("exoplatform.wallet.label.createWalletInvitation")))]),t._v(" "),e("div",{staticClass:"d-flex flex-column pl-4"},[e("div",{staticClass:"subtitle walletInformation"},[t._v(t._s(t.$t("exoplatform.wallet.label.createWalletInvitation.description")))]),t._v(" "),e("div",{staticClass:"subtitle walletInformation pt-1"},[t._v(t._s(t.$t("exoplatform.wallet.label.createWalletInvitation.spendDescription")))])]),t._v(" "),e("div",[e("div",{staticClass:"subtitle px-4 pt-4 styleTitle"},[t._v(t._s(t.$t("exoplatform.wallet.label.createWalletInvitation.secure")))]),t._v(" "),e("ul",{staticClass:"ml-8 px-4 py-4"},[e("li",{staticClass:"subtitle walletInformation"},[t._v(t._s(t.$t("exoplatform.wallet.label.createWalletInvitation.firstDescription")))]),t._v(" "),e("li",{staticClass:"subtitle walletInformation"},[t._v(t._s(t.$t("exoplatform.wallet.label.createWalletInvitation.lastDescription")))])])])])],1),t._v(" "),e("v-row",{staticClass:"my-12 justify-space-between"},[e("v-col",{staticClass:"text-start"},[e("v-btn",{staticClass:"ignore-vuetify-classes mx-2",attrs:{outlined:"",title:t.$t("exoplatform.wallet.label.meedsBtnTitle")},on:{click:function(e){return t.$emit("create-internal-wallet")}}},[t._v("\n        "+t._s(t.$t("exoplatform.wallet.label.internalWallet"))+"\n        "),e("img",{staticClass:"ml-2",attrs:{src:"/wallet-common/images/meeds.svg",alt:"Meeds",width:"16"}})]),t._v(" "),e("div",{staticClass:"subtitle px-4 py-4 walletInformation"},[t._v(t._s(t.$t("exoplatform.wallet.label.createInternalWallet")))])],1),t._v(" "),e("v-col",{staticClass:"text-start"},[e("v-btn",{staticClass:"ignore-vuetify-classes mx-2",class:t.metamaskBtnClass,attrs:{disaled:!t.isMetamaskInstalled,outlined:"",title:t.metamaskBtnTitle},on:{click:t.connectToMetamask}},[t._v("\n        "+t._s(t.$t("exoplatform.wallet.button.metamask"))+"\n        "),e("img",{staticClass:"ml-2",attrs:{src:"/wallet-common/images/metamask.svg",alt:"Metamask",width:"25"}})]),t._v(" "),e("div",{staticClass:"subtitle px-4 py-4 walletInformation"},[t._v("\n        "+t._s(t.$t("exoplatform.wallet.label.createMetamaskWallet"))+"\n        "),t.isMetamaskInstalled?t._e():e("div",{staticClass:"subtitle walletInformation"},[t._v("\n          "+t._s(t.$t("exoplatform.wallet.label.createMetamaskWalletLearnMore"))+"\n          "),e("a",{attrs:{href:t.metamaskInstallLink,target:"_blank",rel:"noopener nofollow"}},[t._v(t._s(t.metamaskInstallLink))])])])],1)],1)],1)};Ke._withStripped=!0;const je=o({computed:{isMetamaskInstalled:()=>window.ethereum&&window.ethereum.isMetaMask,isMobile(){return this.$vuetify.breakpoint.smAndDown},currentSiteLink:()=>`${window.location.host}${window.location.pathname}`,metamaskInstallLink(){return this.isMobile&&`https://metamask.app.link/dapp/${this.currentSiteLink}`||"https://metamask.io/"},generatedToken(){return this.$root.generatedToken},metamaskBtnClass(){return this.isMetamaskInstalled?" ":"disabledButton"},metamaskBtnTitle(){return this.isMetamaskInstalled&&this.$t("exoplatform.wallet.label.metamask.buttonTitle")||this.$t("exoplatform.wallet.label.metamask.disabledButton")}},methods:{connectToMetamask(){let t=null;return window.ethereum.request({method:"wallet_requestPermissions",params:[{eth_accounts:{}}]}).then((()=>this.retrieveAddress())).then((e=>(t=e,this.signMessage(e)))).then((()=>{window.walletSettings.wallet.address=t,window.walletSettings.wallet.provider="METAMASK"})).catch((()=>{this.savingMetamaskAddress=!1}))},retrieveAddress:()=>window.ethereum.request({method:"eth_requestAccounts"}).then((t=>t[0])),signMessage(t){let e=this.$t("exoplatform.wallet.label.metamask.welcomeMessage",{0:t,1:this.generatedToken});return e=e.split(/\\n/g).join("\n"),window.ethereum.request({method:"personal_sign",params:[e,t,""]}).then((a=>this.saveProvider("METAMASK",t,e,a)))},saveProvider(t,e,a,s){return this.addressRegistry.switchProvider(t,e,a,s).then((()=>{window.walletSettings.wallet.address=e,window.walletSettings.wallet.provider="METAMASK",this.$emit("configured"),this.$root.$emit("wallet-notification-alert",{type:"success",message:this.$t("exoplatform.wallet.metamask.message.connectedSuccess")})}))}}},Ke,[],!1,null,null,null).exports;var qe=function(){var t=this,e=t._self._c;return e("v-app",{class:t.owner?"walletOverviewApplication":"walletOverviewApplicationOther"},[t.isOverviewDisplay?t._e():e("v-toolbar",{staticClass:"border-box-sizing py-3",attrs:{color:"white",height:"48",flat:""}},[e("div",{staticClass:"text-header-title text-sub-title text-no-wrap"},[t._v("\n      "+t._s(t.title||"")+"\n    ")]),t._v(" "),e("v-spacer"),t._v(" "),t.clickable?e("v-btn",{attrs:{icon:"",outlined:"",small:""},on:{click:t.openDrawer}},[e("i",{staticClass:"uiIconInformation clickable primary--text my-auto"})]):t._e()],1),t._v(" "),e("div",{staticClass:"walletOverviewCard white",class:t.clickable?"clickable":"",attrs:{flat:""},on:{click:function(e){t.clickable&&t.openDrawer()}}},[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.loading,expression:"!loading"}],staticClass:"justify-center ma-auto d-flex flex-no-wrap",class:t.isOverviewDisplay?"px-0 py-2":"py-5"},[e("div",{staticClass:"justify-center d-flex flex-no-wrap"},[e("div",{staticClass:"tertiary-color text-start font-weight-bold walletOverviewBalance",class:t.isOverviewDisplay?"pe-2 display-1":"px-2 display-2"},[t._v("\n          "+t._s(t.currencySymbol)+"\n        ")]),t._v(" "),e("div",{staticClass:"text-color font-weight-bold d-flex align-self-center walletOverviewBalance",class:t.typographyClass},[t._v("\n          "+t._s(t.balanceToDisplay)+"\n        ")])])])]),t._v(" "),e("wallet-overview-drawer",{ref:"walletOverviewDrawer",attrs:{symbol:t.currencySymbol}})],1)};qe._withStripped=!0;const ze=o({props:{isOverviewDisplay:{type:Boolean,default:()=>!1}},data:()=>({owner:eXo.env.portal.profileOwner===eXo.env.portal.userName,currentName:eXo.env.portal.profileOwner,title:null,currencyName:null,currencySymbol:null,rewardBalance:null,loading:!0}),computed:{clickable(){return this.owner&&this.rewardBalance>0},balanceToDisplay(){return null!==this.rewardBalance&&Number.isFinite(Number(this.rewardBalance))?Number(this.rewardBalance).toFixed():""},typographyClass(){switch(String(this.balanceToDisplay).length){case 1:case 2:case 3:case 4:case 5:return"text-h4";case 6:return"text-h5";case 7:case 8:return"text-h6";default:return"body-1"}}},created(){this.refresh(),this.refreshSettings(window.walletSettings)},methods:{openDrawer(){this.owner&&this.$refs.walletOverviewDrawer.open(this.title)},refresh(){this.loading=!0;const t=function(t){return fetch(`/portal/rest/wallet/api/reward/countRewards?userId=${t}`,{method:"GET",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error count rewards")})).catch((t=>{console.error(t),this.error=this.$t("exoplatform.wallet.error.errorCountRewards")}))}(eXo.env.portal.profileOwner).then((t=>this.rewardBalance=t.sumRewards)),e=fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/wallet/api/account/detailsById?id=${this.currentName}&type=user`,{credentials:"include"}).then((t=>t&&t.ok&&t.json())).then((()=>{if(!this.currencyName)return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/wallet/api/settings`,{method:"GET",credentials:"include"}).then((t=>t&&t.ok&&t.json())).then(this.refreshSettings)})).then((()=>this.$nextTick())).finally((()=>{this.$root.$emit("application-loaded")}));return Promise.all([t,e]).then((()=>this.$nextTick())).finally((()=>this.loading=!1))},refreshSettings(t){if(!t)return;const e=t&&t.contractDetail;this.currencyName=e&&e.name,this.currencySymbol=e&&e.symbol,this.currencyName&&(this.title=this.$t("exoplatform.wallet.title.rewardedBalance",{0:this.currencyName}))}}},qe,[],!1,null,null,null).exports;var Xe=function(){var t=this,e=t._self._c;return e("exo-drawer",{ref:"rewardsOverviewDrawer",staticClass:"rewardsOverviewDrawer",attrs:{right:!t.$vuetify.rtl}},[e("template",{slot:"title"},[t._v("\n    "+t._s(t.title)+"\n  ")]),t._v(" "),e("template",{slot:"content"},[t.rewardsList?e("v-list",t._l(t.rewardsList,(function(a){return e("wallet-overview-reward-item",{key:a.technicalId,staticClass:"border-color border-radius ma-4",attrs:{"reward-item":a,symbol:t.symbol}})})),1):t._e()],1),t._v(" "),t.hasMore?e("template",{slot:"footer"},[e("v-spacer"),t._v(" "),e("v-btn",{staticClass:"loadMoreButton ma-auto btn",attrs:{loading:t.loading,disabled:t.loading,block:""},on:{click:t.loadNextPage}},[t._v("\n      "+t._s(t.$t("exoplatform.wallet.button.loadMore"))+"\n    ")]),t._v(" "),e("v-spacer")],1):t._e()],2)};Xe._withStripped=!0;const He=o({props:{symbol:{type:String,default:"sent"}},data:()=>({pageSize:20,limit:20,rewardsList:[]}),computed:{hasMore(){return this.rewardsList.length>=this.limit}},methods:{reset(){this.limit=20,this.size=0,this.rewardsList=[]},open(t){this.title=t,this.reset(),this.retrieveList(),this.$refs.rewardsOverviewDrawer.open()},loadMore(){this.limit+=this.pageSize,this.retrieveList()},retrieveList(){return this.$refs.rewardsOverviewDrawer.startLoading(),fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/wallet/api/reward/list?limit=${this.limit}`,{method:"GET",credentials:"include"}).then((t=>t&&t.ok&&t.json())).then((t=>{t&&t.length?this.rewardsList=t.filter((t=>t.transaction&&"success"===t.status)):this.rewardsList=[]})).finally((()=>{this.$refs.rewardsOverviewDrawer.endLoading()}))}}},Xe,[],!1,null,null,null).exports;var Ge=function(){var t=this,e=t._self._c;return t.rewards&&t.rewards.length?e("div",[e("v-list-item",[e("v-list-item-content",{staticClass:"align-end text-start"},[e("v-list-item-title",{attrs:{title:t.period}},[e("i",{staticClass:"fa fa-trophy px-2 tertiary--text"}),t._v("\n        "+t._s(t.periodShort)+"\n      ")]),t._v(" "),e("v-list-item-subtitle",{staticClass:"ps-10"},[t._v("\n        "+t._s(t.$t("exoplatform.wallet.label.sentDate"))+": "+t._s(t.sentDate)+"\n      ")])],1),t._v(" "),e("v-list-item-icon",{staticClass:"my-auto"},[e("span",{staticClass:"primary--text"},[t._v("\n        "+t._s(t.rewardAmount)+"\n      ")])])],1),t._v(" "),t._l(t.rewards,(function(a,s){return e("wallet-overview-reward-plugin-item",{key:s,attrs:{id:`plugin-${a.pluginId}`,"reward-item":t.rewardItem,plugin:a,symbol:t.symbol}})}))],2):t._e()};Ge._withStripped=!0;const Ve=o({props:{rewardItem:{type:Object,default:()=>({})},symbol:{type:String,default:"sent"}},data:()=>({lang:eXo.env.portal.language,dateFormat:{dateStyle:"long"}}),computed:{rewards(){return this.rewardItem&&this.rewardItem.rewards&&this.rewardItem.rewards.length&&this.rewardItem.rewards.filter((t=>t.amount))},rewardEarnedAmount(){return parseInt(100*this.rewardItem.tokensSent)/100},rewardAmount(){return`${this.rewardEarnedAmount} ${this.symbol}`},sentDate(){return new window.Intl.DateTimeFormat(this.lang,this.dateFormat).format(new Date(this.rewardItem.transaction.sentTimestamp))},periodStartDate(){return new window.Intl.DateTimeFormat(this.lang,this.dateFormat).format(new Date(1e3*this.rewardItem.period.startDateInSeconds-60*(new Date).getTimezoneOffset()*1e3))},periodEndDate(){return new window.Intl.DateTimeFormat(this.lang,this.dateFormat).format(new Date(1e3*(this.rewardItem.period.endDateInSeconds-60*(new Date).getTimezoneOffset()*1e3-1)))},periodLabelKey(){return`exoplatform.wallet.label.${this.rewardItem.period.rewardPeriodType.toLowerCase()}ShortPeriod`},periodShort(){const t=new Date(1e3*this.rewardItem.period.startDateInSeconds+864e5),e=t.getFullYear();switch(this.rewardItem.period.rewardPeriodType){case"WEEK":case"week":{const a=this.getWeekNumber(t);return this.$t(this.periodLabelKey,{0:a,1:e})}case"MONTH":case"month":{const a=new window.Intl.DateTimeFormat(this.lang,{month:"long"}).format(t);return this.$t(this.periodLabelKey,{0:a,1:e})}case"QUARTER":case"quarter":{const a=this.getQuarterNumber(t);return this.$t(this.periodLabelKey,{0:a,1:e})}case"SEMESTER":case"semester":{const a=this.getSemesterNumber(t);return this.$t(this.periodLabelKey,{0:a,1:e})}case"YEAR":case"year":return this.$t(this.periodLabelKey,{0:e})}return""},period(){return this.$t("exoplatform.wallet.label.rewardedForPeriod",{0:this.periodStartDate,1:this.periodEndDate})}},methods:{getSemesterNumber:t=>Math.ceil((t.getMonth()+1)/6),getQuarterNumber:t=>Math.ceil((t.getMonth()+1)/3),getWeekNumber(t){const e=new Date(t);e.setHours(0,0,0,0),e.setDate(e.getDate()+3-(e.getDay()+6)%7);const a=new Date(e.getFullYear(),0,4);return 1+Math.round(((e.getTime()-a.getTime())/864e5-3+(a.getDay()+6)%7)/7)}}},Ge,[],!1,null,null,null).exports;var Qe=function(){var t=this,e=t._self._c;return t.pluginEarnedAmount?e("v-list-item",{attrs:{dense:""}},[e("v-list-item-icon",{staticClass:"my-auto"}),t._v(" "),e("v-list-item-content",{staticClass:"align-end text-start"},[e("v-list-item-subtitle",[e("span",{staticClass:"text-sub-title caption uiIcon",class:t.iconClass}),t._v(" "),e("span",{staticClass:"text-sub-title caption"},[t._v(t._s(t.plugin.points)+" "+t._s(t.pluginName))])])],1),t._v(" "),e("v-list-item-icon",{staticClass:"my-auto"},[e("span",{staticClass:"text-sub-title caption"},[t._v("\n      "+t._s(t.pluginAmount)+"\n    ")])])],1):t._e()};Qe._withStripped=!0;const Ye=o({props:{rewardItem:{type:Object,default:()=>({})},plugin:{type:Object,default:()=>({})},symbol:{type:String,default:"sent"}},computed:{pluginName(){return this.plugin.pluginId.charAt(0).toUpperCase()+this.plugin.pluginId.slice(1)},iconClass(){return`uiIconReward${this.pluginName}`},pluginEarnedAmount(){return parseInt(100*this.plugin.amount)/100},pluginAmount(){return`${this.pluginEarnedAmount} ${this.symbol}`}}},Qe,[],!1,null,null,null).exports;var Je=function(){var t=this,e=t._self._c;return e("v-app",{staticClass:"ma-0",attrs:{id:"WalletApp"}},[e("div",{staticClass:"clickable",attrs:{flat:""},on:{click:function(e){return t.$refs.accountDetail.open()}}},[e("div",{staticClass:"pa-0 d-flex justify-center flex-nowrap text-color display-1 font-weight-bold big-number"},[e("span",{staticClass:"my-2 tertiary-color"},[t._v(t._s(t.symbol))]),t._v(" "),e("span",{staticClass:"ma-2 text-color font-weight-bold d-flex align-self-center",class:t.typographyClass},[t._v("\n        "+t._s(t.balanceToDisplay)+"\n      ")])])]),t._v(" "),e("wallet-reward-account-detail",{ref:"accountDetail",attrs:{"fiat-symbol":t.symbol,wallet:t.wallet,"contract-details":t.contractDetails}})],1)};Je._withStripped=!0;const Ze=o({data:()=>({wallet:null,contractDetails:null,isOverviewDisplay:{type:Boolean,default:()=>!1}}),computed:{symbol(){return this.contractDetails?.symbol},balance(){return this.wallet?.tokenBalance},balanceToDisplay(){return Number.isFinite(Number(this.balance))?Math.trunc(this.balance):""},typographyClass(){switch(String(this.balanceToDisplay).length){case 1:case 2:case 3:case 4:case 5:return"text-h4";case 6:return"text-h5";case 7:case 8:return"text-h6";default:return"body-1"}}},created(){this.walletUtils.initSettings(!1,!0,!0).then((()=>{this.wallet=Object.assign({},window.walletSettings.wallet),this.contractDetails=Object.assign({},window.walletSettings.contractDetail)}))}},Je,[],!1,null,null,null).exports;var ta=function(){var t=this,e=t._self._c;return e("div",{staticClass:"ma-0"},[e("div",{staticClass:"clickable",attrs:{flat:""},on:{click:t.openDrawer}},[e("div",{staticClass:"pa-0 d-flex justify-center flex-nowrap text-color display-1 font-weight-bold big-number"},[e("span",{staticClass:"my-2 tertiary-color"},[t._v(t._s(t.symbol))]),t._v(" "),e("span",{staticClass:"ma-2 text-color font-weight-bold d-flex align-self-center",class:t.typographyClass},[t._v("\n        "+t._s(t.weeklyRewardToDisplay)+"\n      ")])])]),t._v(" "),e("wallet-overview-drawer",{ref:"walletOverviewDrawer",attrs:{symbol:t.symbol}})],1)};ta._withStripped=!0;const ea={install:t=>{t.prototype.constants=s,t.prototype.addressRegistry=a,t.prototype.walletUtils=i,t.prototype.tokenUtils=l,t.prototype.transactionUtils=n}},aa={"wallet-reward-account-detail":d,"wallet-reward-address-auto-complete":S,"wallet-reward-confirm-dialog":k,"wallet-reward-information-bubble":P,"wallet-reward-warning-bubble":T,"wallet-reward-profile-chip":E,"wallet-reward-qr-code":W,"wallet-reward-qr-code-modal":M,"wallet-reward-send-tokens-form":ne,"wallet-reward-send-tokens-modal":re,"wallet-reward-transactions-list":de,"wallet-reward-backup-modal":we,"wallet-reward-browser-setup":me,"wallet-reward-import-key-drawer":he,"wallet-reward-password-management":ve,"wallet-reward-request-funds-modal":be,"wallet-reward-address":_e,"wallet-reward-setup":xe,"wallet-reward-backup-drawer":$e,"wallet-settings":Be,"wallet-settings-details":Pe,"wallet-settings-internal":Te,"wallet-settings-internal-details":Ee,"wallet-settings-metamask":We,"wallet-settings-jdenticon":Me,"wallet-welcome-screen":je,"wallet-notification-alert":Oe,"wallet-metamask-warnings":Ue,"wallet-overview":ze,"wallet-overview-drawer":He,"wallet-overview-reward-item":Ve,"wallet-overview-reward-plugin-item":Ye,"wallet-user-balance":Ze,"wallet-reward-weekly-earnings":o({data:()=>({weeklyReward:null,wallet:null,contractDetails:null}),computed:{selectedDate:()=>(new Date).toISOString().substring(0,10),symbol(){return this.contractDetails?.symbol},weeklyRewardToDisplay(){return Number.isFinite(Number(this.weeklyReward))?Math.trunc(this.weeklyReward):""}},created(){this.init(),this.refreshRewards()},methods:{init(){return this.walletUtils.initSettings(!1,!0,!0).then((()=>(window.walletSettings&&(this.wallet=Object.assign({},window.walletSettings.wallet),this.contractDetails=Object.assign({},window.walletSettings.contractDetail)),this.$nextTick())))},refreshRewards(){var t;(t=this.selectedDate,fetch(`/portal/rest/wallet/api/reward/compute/user?date=${t}`,{method:"GET",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error computing rewards")}))).then((t=>{if(t)for(const e of t.rewards)e.wallet.address.toUpperCase()===this.wallet.address.toUpperCase()&&(this.weeklyReward=e.tokensToSend)}))},openDrawer(){this.$refs.walletOverviewDrawer.open(this.$t("exoplatform.wallet.title.rewardedBalance"))}}},ta,[],!1,null,null,null).exports};for(const t in aa)Vue.component(t,aa[t]);return window.WalletCommon=ea,extensionRegistry&&(extensionRegistry.registerComponent("SpaceSettings","space-settings-components",{id:"wallet-space-settings",vueComponent:Vue.options.components["wallet-settings"],rank:10}),extensionRegistry.registerComponent("my-rewards-overview","my-rewards-item",{id:"wallet-rewards-overview",vueComponent:Vue.options.components["wallet-reward-weekly-earnings"],rank:10}),extensionRegistry.registerComponent("my-rewards-wallet-overview","my-rewards-wallet-item",{id:"wallet-balance-overview",vueComponent:Vue.options.components["wallet-user-balance"],rank:20})),e})()));