define((()=>(()=>{"use strict";var e={d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:()=>v});var r=function(){var e=this,t=e._self._c;return t("v-app",{class:e.owner?"walletOverviewApplication":"walletOverviewApplicationOther"},[e.isOverviewDisplay?e._e():t("v-toolbar",{staticClass:"border-box-sizing py-3",attrs:{color:"white",height:"48",flat:""}},[t("div",{staticClass:"text-header-title text-sub-title text-no-wrap"},[e._v("\n      "+e._s(e.title||"")+"\n    ")]),e._v(" "),t("v-spacer"),e._v(" "),e.clickable?t("v-btn",{attrs:{icon:"",outlined:"",small:""},on:{click:e.openDrawer}},[t("i",{staticClass:"uiIconInformation clickable primary--text my-auto"})]):e._e()],1),e._v(" "),t("div",{staticClass:"walletOverviewCard white",class:e.clickable?"clickable":"",attrs:{flat:""},on:{click:function(t){e.clickable&&e.openDrawer()}}},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}],staticClass:"justify-center ma-auto d-flex flex-no-wrap",class:e.isOverviewDisplay?"px-0 py-2":"py-5"},[t("div",{staticClass:"justify-center d-flex flex-no-wrap"},[t("div",{staticClass:"tertiary-color text-start font-weight-bold walletOverviewBalance",class:e.isOverviewDisplay?"pe-2 display-1":"px-2 display-2"},[e._v("\n          "+e._s(e.currencySymbol)+"\n        ")]),e._v(" "),t("div",{staticClass:"text-color font-weight-bold d-flex align-self-center walletOverviewBalance",class:e.typographyClass},[e._v("\n          "+e._s(e.balanceToDisplay)+"\n        ")])])])]),e._v(" "),t("wallet-overview-drawer",{ref:"walletOverviewDrawer",attrs:{symbol:e.currencySymbol}})],1)};function a(e,t,r,a,i,s,n,l){var o,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=r,c._compiled=!0),a&&(c.functional=!0),s&&(c._scopeId="data-v-"+s),n?(o=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(n)},c._ssrRegister=o):i&&(o=l?function(){i.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:i),o)if(c.functional){c._injectStyles=o;var d=c.render;c.render=function(e,t){return o.call(t),d(e,t)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,o):[o]}return{exports:e,options:c}}r._withStripped=!0;const i=a({props:{isOverviewDisplay:{type:Boolean,default:()=>!1}},data:()=>({owner:eXo.env.portal.profileOwner===eXo.env.portal.userName,currentName:eXo.env.portal.profileOwner,title:null,currencyName:null,currencySymbol:null,rewardBalance:null,loading:!0}),computed:{clickable(){return this.owner&&this.rewardBalance>0},balanceToDisplay(){return null!==this.rewardBalance&&Number.isFinite(Number(this.rewardBalance))?Number(this.rewardBalance).toFixed():""},typographyClass(){switch(String(this.balanceToDisplay).length){case 1:case 2:case 3:case 4:case 5:return"text-h4";case 6:return"text-h5";case 7:case 8:return"text-h6";default:return"body-1"}}},created(){this.refresh(),this.refreshSettings(window.walletSettings)},methods:{openDrawer(){this.owner&&this.$refs.walletOverviewDrawer.open(this.title)},refresh(){this.loading=!0;const e=function(e){return fetch(`/portal/rest/wallet/api/reward/countRewards?userId=${e}`,{method:"GET",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Error count rewards")})).catch((e=>{console.error(e),this.error=this.$t("exoplatform.wallet.error.errorCountRewards")}))}(eXo.env.portal.profileOwner).then((e=>this.rewardBalance=e.sumRewards)),t=fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/wallet/api/account/detailsById?id=${this.currentName}&type=user`,{credentials:"include"}).then((e=>e&&e.ok&&e.json())).then((()=>{if(!this.currencyName)return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/wallet/api/settings`,{method:"GET",credentials:"include"}).then((e=>e&&e.ok&&e.json())).then(this.refreshSettings)})).then((()=>this.$nextTick())).finally((()=>{this.$root.$emit("application-loaded")}));return Promise.all([e,t]).then((()=>this.$nextTick())).finally((()=>this.loading=!1))},refreshSettings(e){if(!e)return;const t=e&&e.contractDetail;this.currencyName=t&&t.name,this.currencySymbol=t&&t.symbol,this.currencyName&&(this.title=this.$t("exoplatform.wallet.title.rewardedBalance",{0:this.currencyName}))}}},r,[],!1,null,null,null).exports;var s=function(){var e=this,t=e._self._c;return t("exo-drawer",{ref:"rewardsOverviewDrawer",staticClass:"rewardsOverviewDrawer",attrs:{right:!e.$vuetify.rtl}},[t("template",{slot:"title"},[e._v("\n    "+e._s(e.title)+"\n  ")]),e._v(" "),t("template",{slot:"content"},[e.rewardsList?t("v-list",e._l(e.rewardsList,(function(r){return t("wallet-overview-reward-item",{key:r.technicalId,staticClass:"border-color border-radius ma-4",attrs:{"reward-item":r,symbol:e.symbol}})})),1):e._e()],1),e._v(" "),e.hasMore?t("template",{slot:"footer"},[t("v-spacer"),e._v(" "),t("v-btn",{staticClass:"loadMoreButton ma-auto btn",attrs:{loading:e.loading,disabled:e.loading,block:""},on:{click:e.loadNextPage}},[e._v("\n      "+e._s(e.$t("exoplatform.wallet.button.loadMore"))+"\n    ")]),e._v(" "),t("v-spacer")],1):e._e()],2)};s._withStripped=!0;const n=a({props:{symbol:{type:String,default:"sent"}},data:()=>({pageSize:20,limit:20,rewardsList:[]}),computed:{hasMore(){return this.rewardsList.length>=this.limit}},methods:{reset(){this.limit=20,this.size=0,this.rewardsList=[]},open(e){this.title=e,this.reset(),this.retrieveList(),this.$refs.rewardsOverviewDrawer.open()},loadMore(){this.limit+=this.pageSize,this.retrieveList()},retrieveList(){return this.$refs.rewardsOverviewDrawer.startLoading(),fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/wallet/api/reward/list?limit=${this.limit}`,{method:"GET",credentials:"include"}).then((e=>e&&e.ok&&e.json())).then((e=>{e&&e.length?this.rewardsList=e.filter((e=>e.transaction&&"success"===e.status)):this.rewardsList=[]})).finally((()=>{this.$refs.rewardsOverviewDrawer.endLoading()}))}}},s,[],!1,null,null,null).exports;var l=function(){var e=this,t=e._self._c;return e.rewards&&e.rewards.length?t("div",[t("v-list-item",[t("v-list-item-content",{staticClass:"align-end text-start"},[t("v-list-item-title",{attrs:{title:e.period}},[t("i",{staticClass:"fa fa-trophy px-2 tertiary--text"}),e._v("\n        "+e._s(e.periodShort)+"\n      ")]),e._v(" "),t("v-list-item-subtitle",{staticClass:"ps-10"},[e._v("\n        "+e._s(e.$t("exoplatform.wallet.label.sentDate"))+": "+e._s(e.sentDate)+"\n      ")])],1),e._v(" "),t("v-list-item-icon",{staticClass:"my-auto"},[t("span",{staticClass:"primary--text"},[e._v("\n        "+e._s(e.rewardAmount)+"\n      ")])])],1),e._v(" "),e._l(e.rewards,(function(r,a){return t("wallet-overview-reward-plugin-item",{key:a,attrs:{id:`plugin-${r.pluginId}`,"reward-item":e.rewardItem,plugin:r,symbol:e.symbol}})}))],2):e._e()};l._withStripped=!0;const o=a({props:{rewardItem:{type:Object,default:()=>({})},symbol:{type:String,default:"sent"}},data:()=>({lang:eXo.env.portal.language,dateFormat:{dateStyle:"long"}}),computed:{rewards(){return this.rewardItem&&this.rewardItem.rewards&&this.rewardItem.rewards.length&&this.rewardItem.rewards.filter((e=>e.amount))},rewardEarnedAmount(){return parseInt(100*this.rewardItem.tokensSent)/100},rewardAmount(){return`${this.rewardEarnedAmount} ${this.symbol}`},sentDate(){return new window.Intl.DateTimeFormat(this.lang,this.dateFormat).format(new Date(this.rewardItem.transaction.sentTimestamp))},periodStartDate(){return new window.Intl.DateTimeFormat(this.lang,this.dateFormat).format(new Date(1e3*this.rewardItem.period.startDateInSeconds-60*(new Date).getTimezoneOffset()*1e3))},periodEndDate(){return new window.Intl.DateTimeFormat(this.lang,this.dateFormat).format(new Date(1e3*(this.rewardItem.period.endDateInSeconds-60*(new Date).getTimezoneOffset()*1e3-1)))},periodLabelKey(){return`exoplatform.wallet.label.${this.rewardItem.period.rewardPeriodType.toLowerCase()}ShortPeriod`},periodShort(){const e=new Date(1e3*this.rewardItem.period.startDateInSeconds+864e5),t=e.getFullYear();switch(this.rewardItem.period.rewardPeriodType){case"WEEK":case"week":{const r=this.getWeekNumber(e);return this.$t(this.periodLabelKey,{0:r,1:t})}case"MONTH":case"month":{const r=new window.Intl.DateTimeFormat(this.lang,{month:"long"}).format(e);return this.$t(this.periodLabelKey,{0:r,1:t})}case"QUARTER":case"quarter":{const r=this.getQuarterNumber(e);return this.$t(this.periodLabelKey,{0:r,1:t})}case"SEMESTER":case"semester":{const r=this.getSemesterNumber(e);return this.$t(this.periodLabelKey,{0:r,1:t})}case"YEAR":case"year":return this.$t(this.periodLabelKey,{0:t})}return""},period(){return this.$t("exoplatform.wallet.label.rewardedForPeriod",{0:this.periodStartDate,1:this.periodEndDate})}},methods:{getSemesterNumber:e=>Math.ceil((e.getMonth()+1)/6),getQuarterNumber:e=>Math.ceil((e.getMonth()+1)/3),getWeekNumber(e){const t=new Date(e);t.setHours(0,0,0,0),t.setDate(t.getDate()+3-(t.getDay()+6)%7);const r=new Date(t.getFullYear(),0,4);return 1+Math.round(((t.getTime()-r.getTime())/864e5-3+(r.getDay()+6)%7)/7)}}},l,[],!1,null,null,null).exports;var c=function(){var e=this,t=e._self._c;return e.pluginEarnedAmount?t("v-list-item",{attrs:{dense:""}},[t("v-list-item-icon",{staticClass:"my-auto"}),e._v(" "),t("v-list-item-content",{staticClass:"align-end text-start"},[t("v-list-item-subtitle",[t("span",{staticClass:"text-sub-title caption uiIcon",class:e.iconClass}),e._v(" "),t("span",{staticClass:"text-sub-title caption"},[e._v(e._s(e.plugin.points)+" "+e._s(e.pluginName))])])],1),e._v(" "),t("v-list-item-icon",{staticClass:"my-auto"},[t("span",{staticClass:"text-sub-title caption"},[e._v("\n      "+e._s(e.pluginAmount)+"\n    ")])])],1):e._e()};c._withStripped=!0;const d={"wallet-overview":i,"wallet-overview-drawer":n,"wallet-overview-reward-item":o,"wallet-overview-reward-plugin-item":a({props:{rewardItem:{type:Object,default:()=>({})},plugin:{type:Object,default:()=>({})},symbol:{type:String,default:"sent"}},computed:{pluginName(){return this.plugin.pluginId.charAt(0).toUpperCase()+this.plugin.pluginId.slice(1)},iconClass(){return`uiIconReward${this.pluginName}`},pluginEarnedAmount(){return parseInt(100*this.plugin.amount)/100},pluginAmount(){return`${this.pluginEarnedAmount} ${this.symbol}`}}},c,[],!1,null,null,null).exports};for(const e in d)Vue.component(e,d[e]);if(extensionRegistry){const e=extensionRegistry.loadComponents("WalletOverview");e&&e.length>0&&e.forEach((e=>{Vue.component(e.componentName,e.componentOptions)}))}Vue.use(Vuetify);const u=new Vuetify(eXo.env.portal.vuetifyPreset),p=eXo&&eXo.env&&eXo.env.portal&&eXo.env.portal.language||"en",w=`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.addon.Wallet-${p}.json`,h="WalletOverview",m=`${h}_${eXo.env.portal.profileOwnerIdentityId}`;function v(){exoi18n.loadLanguageAsync(p,w).then((e=>{const t=document.createElement("div");t.id=h,new Vue({template:`<wallet-overview id="${h}" v-cacheable="{cacheId: '${m}'}" />`,i18n:e,vuetify:u}).$mount(t)}))}return t})()));