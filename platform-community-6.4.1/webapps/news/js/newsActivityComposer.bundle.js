/*! For license information please see newsActivityComposer.bundle.js.LICENSE.txt */
define((()=>(()=>{var e={367:function(e,t){var s,i;s=function(e,t){"use strict";var s,i,n="function"==typeof Map?new Map:(s=[],i=[],{has:function(e){return s.indexOf(e)>-1},get:function(e){return i[s.indexOf(e)]},set:function(e,t){-1===s.indexOf(e)&&(s.push(e),i.push(t))},delete:function(e){var t=s.indexOf(e);t>-1&&(s.splice(t,1),i.splice(t,1))}}),a=function(e){return new Event(e,{bubbles:!0})};try{new Event("test")}catch(e){a=function(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!1),t}}function o(e){if(e&&e.nodeName&&"TEXTAREA"===e.nodeName&&!n.has(e)){var t=null,s=null,i=null,o=function(){e.clientWidth!==s&&u()},r=function(t){window.removeEventListener("resize",o,!1),e.removeEventListener("input",u,!1),e.removeEventListener("keyup",u,!1),e.removeEventListener("autosize:destroy",r,!1),e.removeEventListener("autosize:update",u,!1),Object.keys(t).forEach((function(s){e.style[s]=t[s]})),n.delete(e)}.bind(e,{height:e.style.height,resize:e.style.resize,overflowY:e.style.overflowY,overflowX:e.style.overflowX,wordWrap:e.style.wordWrap});e.addEventListener("autosize:destroy",r,!1),"onpropertychange"in e&&"oninput"in e&&e.addEventListener("keyup",u,!1),window.addEventListener("resize",o,!1),e.addEventListener("input",u,!1),e.addEventListener("autosize:update",u,!1),e.style.overflowX="hidden",e.style.wordWrap="break-word",n.set(e,{destroy:r,update:u}),"vertical"===(l=window.getComputedStyle(e,null)).resize?e.style.resize="none":"both"===l.resize&&(e.style.resize="horizontal"),t="content-box"===l.boxSizing?-(parseFloat(l.paddingTop)+parseFloat(l.paddingBottom)):parseFloat(l.borderTopWidth)+parseFloat(l.borderBottomWidth),isNaN(t)&&(t=0),u()}var l;function d(t){var s=e.style.width;e.style.width="0px",e.offsetWidth,e.style.width=s,e.style.overflowY=t}function c(){if(0!==e.scrollHeight){var i=function(e){for(var t=[];e&&e.parentNode&&e.parentNode instanceof Element;)e.parentNode.scrollTop&&t.push({node:e.parentNode,scrollTop:e.parentNode.scrollTop}),e=e.parentNode;return t}(e),n=document.documentElement&&document.documentElement.scrollTop;e.style.height="",e.style.height=e.scrollHeight+t+"px",s=e.clientWidth,i.forEach((function(e){e.node.scrollTop=e.scrollTop})),n&&(document.documentElement.scrollTop=n)}}function u(){c();var t=Math.round(parseFloat(e.style.height)),s=window.getComputedStyle(e,null),n="content-box"===s.boxSizing?Math.round(parseFloat(s.height)):e.offsetHeight;if(n<t?"hidden"===s.overflowY&&(d("scroll"),c(),n="content-box"===s.boxSizing?Math.round(parseFloat(window.getComputedStyle(e,null).height)):e.offsetHeight):"hidden"!==s.overflowY&&(d("hidden"),c(),n="content-box"===s.boxSizing?Math.round(parseFloat(window.getComputedStyle(e,null).height)):e.offsetHeight),i!==n){i=n;var o=a("autosize:resized");try{e.dispatchEvent(o)}catch(e){}}}}function r(e){var t=n.get(e);t&&t.destroy()}function l(e){var t=n.get(e);t&&t.update()}var d=null;"undefined"==typeof window||"function"!=typeof window.getComputedStyle?((d=function(e){return e}).destroy=function(e){return e},d.update=function(e){return e}):((d=function(e,t){return e&&Array.prototype.forEach.call(e.length?e:[e],(function(e){return o(e)})),e}).destroy=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],r),e},d.update=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],l),e}),t.default=d,e.exports=t.default},void 0===(i=s.apply(t,[e,t]))||(e.exports=i)}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,s),a.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{"use strict";s.r(i),s.d(i,{destroy:()=>Y,init:()=>J});var e={};s.r(e),s.d(e,{canPublishNews:()=>X,canScheduleNews:()=>z,canUserCreateNews:()=>V,clickOnEditButton:()=>k,deleteDraft:()=>L,deleteNews:()=>j,escapeHTML:()=>M,fetchFoldersAndFiles:()=>P,findUserSpaces:()=>F,getDrivers:()=>O,getNews:()=>N,getNewsByActivityId:()=>x,getNewsById:()=>C,getNewsSpaces:()=>S,getSpaceById:()=>U,getUserSpaces:()=>R,importFileFromUrl:()=>_,markNewsAsRead:()=>E,saveNews:()=>I,scheduleNews:()=>T,searchSpaces:()=>A,undoDeleteNews:()=>B,updateNews:()=>D});var t=function(){var e=this,t=e._self._c;return t("v-app",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}]},[t("div",{staticClass:"loadingComposer"},[t("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1)]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.canCreateNews&&!e.loading,expression:"canCreateNews && !loading"}],staticClass:"newsComposer",attrs:{id:"newsActivityComposer"}},[t("schedule-news-drawer",{attrs:{"posting-news":e.postingNews,"news-id":e.newsId},on:{"post-article":e.postNews}}),e._v(" "),t("div",{staticClass:"newsComposerToolbar"},[t("div",{staticClass:"d-flex flex-row py-2",attrs:{id:"composerToolbarInformation"}},[t("v-avatar",{staticClass:"mx-3 my-auto",attrs:{height:"40","min-height":"40",width:"40","min-width":"40","max-width":"40",size:"40"}},[t("v-img",{attrs:{src:"/news/images/news.png"}})],1),e._v(" "),t("div",{staticClass:"d-flex flex-grow-1 flex-column my-auto align-left"},[t("div",[t("span",{staticClass:"flex-row text-truncate subtitle-1"},[e._v(e._s(e.newsFormTitle))]),e._v(" "),e.isMobile&&e.editMode&&e.draftSavingStatus?t("span",{staticClass:"caption"},[e._v("("+e._s(e.draftSavingStatus)+")")]):e._e()]),e._v(" "),e.spaceDisplayName?t("span",{staticClass:"flex-row subtitle-2 text-capitalize text-truncate text-light-color spaceName"},[e._v(e._s(e.spaceDisplayName))]):e._e()]),e._v(" "),t("div",{staticClass:"d-flex d-flex flex-grow-0 my-auto"},[e.isMobile?e._e():t("span",{staticClass:"my-auto me-4 flex-shrink-0"},[e._v(e._s(e.draftSavingStatus))]),e._v(" "),e.canUpdateNewVisibilty&&!e.isMobile?t("div",[e.isNewsAuthor?t("v-select",{ref:"selectVisibility",staticClass:"selectMenuClass mr-7",attrs:{items:e.items,"item-value":"value",label:"text","item-text":"text","hide-selected":"",color:"black","item-color":"black",attach:"",solo:"",dense:""},on:{change:function(t){return e.updateDraftVisibility()}},scopedSlots:e._u([{key:"selection",fn:function({item:s}){return[s.value?t("v-icon",{staticClass:"mr-3 mb-1",attrs:{size:"16",color:"black"}},[e._v("\n                  mdi-account-edit\n                ")]):t("v-icon",{staticClass:"mr-3 mb-1",attrs:{size:"16",color:"black"}},[e._v("\n                  mdi-lock\n                ")]),e._v("\n                "+e._s(s.text)+"\n              ")]}},{key:"item",fn:function({item:s}){return[s.value?t("v-icon",{staticClass:"mr-3 mb-1",attrs:{size:"16",color:"black"}},[e._v("\n                  mdi-account-edit\n                ")]):t("v-icon",{staticClass:"mr-3 mb-1",attrs:{size:"16",color:"black"}},[e._v("\n                  mdi-lock\n                ")]),e._v("\n                "+e._s(s.text)+"\n              ")]}}],null,!1,3323605724),model:{value:e.news.draftVisible,callback:function(t){e.$set(e.news,"draftVisible",t)},expression:"news.draftVisible"}}):t("div",{staticClass:"d-flex mr-5 mt-1"},[this.news.draftVisible?t("v-icon",{staticClass:"mr-2",attrs:{size:"16",color:"black"}},[e._v("\n                mdi-account-edit\n              ")]):t("v-icon",{staticClass:"mr-2",attrs:{size:"16",color:"black"}},[e._v("\n                mdi-lock\n              ")]),e._v(" "),t("div",{staticClass:"font-weight-bold pa-0 mt-1",attrs:{id:"newsDraftVisible1",disabled:""},domProps:{textContent:e._s(e.newsLabel)}})],1)],1):e._e(),e._v(" "),e.canUpdateNewVisibilty&&e.isMobile?t("div",{staticClass:"d-flex mr-2 mt-1"},[t("v-btn",{attrs:{primary:"",icon:"",text:"",disabled:!e.isNewsAuthor},on:{click:function(t){return e.$root.$emit("open-draft-visibility",e.news.draftVisible)}}},[this.news.draftVisible?t("v-icon",{staticClass:"mr-1",attrs:{size:"20",color:"black"}},[e._v("\n                mdi-account-edit\n              ")]):t("v-icon",{staticClass:"mr-1",attrs:{size:"20",color:"black"}},[e._v("\n                mdi-lock\n              ")])],1)],1):e._e(),e._v(" "),t("v-btn",{directives:[{name:"show",rawName:"v-show",value:!e.editMode,expression:"!editMode"}],staticClass:"btn btn-primary my-auto me-4",attrs:{id:"newsPost",loading:e.postingNews,disabled:e.postDisabled||e.postingNews,"aria-label":e.$t("news.composer.post"),elevation:"0"},on:{click:e.newsActions}},[e._v("\n            "+e._s(e.$t("news.composer.post"))+"\n          ")]),e._v(" "),!e.isMobile&&e.editMode?t("div",[t("div",{staticClass:"d-flex flex-row me-2"},[t("v-btn",{staticClass:"btn btn-primary",attrs:{id:"newsEdit",disabled:e.updateDisabled},on:{click:function(t){return t.preventDefault(),e.updateNews(!1)}}},[e._v("\n                "+e._s(e.$t("news.edit.update"))+"\n              ")]),e._v(" "),t("v-tooltip",{attrs:{bottom:"",disabled:!e.news.activityPosted},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("span",e._g({},s),[t("v-btn",e._g(e._b({staticClass:"btn ms-2 me-2",class:[e.news.archived?"unauthorizedPublish":""],attrs:{id:"newsUpdateAndPost",disabled:!(!e.news.archived&&!e.news.activityPosted)||e.updateDisabled},on:{click:function(t){return t.preventDefault(),e.updateNews(!0)}}},"v-btn",i,!1),s),[e._v("\n                      "+e._s(e.$t("news.edit.update.post"))+"\n                    ")])],1)]}}],null,!1,3440584234)},[e._v(" "),t("span",[e._v(e._s(e.$t("news.edit.disable.update.postButton")))])]),e._v(" "),t("v-btn",{staticClass:"btn me-2",on:{click:e.goBack}},[e._v("\n                "+e._s(e.$t("news.composer.btn.cancel"))+"\n              ")])],1)]):e.isMobile&&e.editMode?t("div",{staticClass:"d-flex flex-row me-2"},[t("v-btn",{staticClass:"btn btn-primary",attrs:{id:"newsEdit",disabled:e.updateDisabled},on:{click:function(t){return t.preventDefault(),e.updateNews(!1)}}},[e._v("\n              "+e._s(e.$t("news.edit.update"))+"\n            ")])],1):e._e()],1)],1),e._v(" "),t("div",{attrs:{id:"newsTop"}})]),e._v(" "),t("form",{staticClass:"newsForm",attrs:{id:"newsForm",onsubmit:"event.preventDefault(); return false;"}},[t("div",{staticClass:"newsFormInput"},[t("div",{staticClass:"newsFormAttachment",attrs:{id:"newsFormAttachment"}},[t("div",{staticClass:"control-group attachments"},[t("div",{staticClass:"controls"},[t("exo-news-file-drop",{on:{change:e.autoSave},model:{value:e.news.illustration,callback:function(t){e.$set(e.news,"illustration",t)},expression:"news.illustration"}})],1)])]),e._v(" "),t("div",{staticClass:"formInputGroup newsTitle"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.news.title,expression:"news.title"}],attrs:{id:"newsTitle",maxlength:e.titleMaxLength,placeholder:e.newsFormTitlePlaceholder,type:"text"},domProps:{value:e.news.title},on:{input:function(t){t.target.composing||e.$set(e.news,"title",t.target.value)}}})]),e._v(" "),t("div",{staticClass:"formInputGroup"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.news.summary,expression:"news.summary"}],staticClass:"newsFormInput",attrs:{id:"newsSummary",maxlength:e.summaryMaxLength,placeholder:e.newsFormSummaryPlaceholder},domProps:{value:e.news.summary},on:{input:function(t){t.target.composing||e.$set(e.news,"summary",t.target.value)}}})]),e._v(" "),t("div",{staticClass:"formInputGroup"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.news.content,expression:"news.content"}],staticClass:"newsFormInput",attrs:{id:"newsContent",placeholder:e.newsFormContentPlaceholder,name:"newsContent"},domProps:{value:e.news.content},on:{input:function(t){t.target.composing||e.$set(e.news,"content",t.target.value)}}})]),e._v(" "),e.news.draftUpdaterUserName!==e.currentUser&&"draft"===e.news.publicationState&&e.activityId?t("v-alert",{staticClass:"warningAlert",attrs:{dismissible:"",border:"left",elevation:"2","colored-border":""}},[t("i",{staticClass:"fas fa-exclamation-circle exclamationIcon"}),e._v(" "),t("span",{staticClass:"warningText"},[e._v(e._s(e.draftWarningText))])]):e._e()],1)]),e._v(" "),e.isMobile?e._e():t("v-btn",{staticClass:"attachmentsButton",attrs:{fixed:"",bottom:"",right:"",fab:"","x-large":""},on:{click:function(t){return e.openApp()}}},[t("i",{staticClass:"uiIconAttachment"}),e._v(" "),t("v-progress-circular",{class:e.uploading?"uploading":"",attrs:{indeterminate:""}},[e._v("\n        "+e._s(e.news.attachments.length)+"\n      ")])],1),e._v(" "),t("exo-attachments",{ref:"attachmentsComponent",attrs:{"space-id":e.news.spaceId},on:{HideAttachmentsDrawer:e.onHideAttachmentsDrawer,uploadingCountChanged:e.setUploadingCount},model:{value:e.news.attachments,callback:function(t){e.$set(e.news,"attachments",t)},expression:"news.attachments"}}),e._v(" "),t("exo-news-notification-alerts",{attrs:{name:"event-form"}}),e._v(" "),t("exo-news-draft-visibility-mobile",{ref:"selectVisibilityDialog",attrs:{items:e.items}})],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.canCreateNews&&!e.loading||e.unAuthorizedAccess,expression:"(!canCreateNews && !loading) || unAuthorizedAccess"}],staticClass:"newsComposer"},[t("div",{staticClass:"articleNotFound"},[t("i",{staticClass:"iconNotFound"}),e._v(" "),t("h3",{staticClass:"restrictedAction"},[e._v(e._s(e.$t("news.details.restricted")))])])])])};t._withStripped=!0;var n=s(367),a=s.n(n);const o=(new window.Intl.DateTimeFormat).resolvedOptions().timeZone,r={props:{newsId:{type:String,required:!1,default:null},spaceId:{type:String,required:!0},activityId:{type:String,required:!1,default:null}},data(){return{news:{id:"",activityId:"",author:"",title:"",body:"",summary:"",illustration:[],attachments:[],targets:[],spaceId:"",published:!1,archived:!1,draftVisible:!1,audience:null},originalNews:{id:"",activityId:"",title:"",body:"",summary:"",illustration:[],attachments:[],spaceId:"",published:!1},file:{src:""},SMARTPHONE_LANDSCAPE_WIDTH:768,titleMaxLength:150,summaryMaxLength:1e3,autoSaveDelay:1e3,newsFormTitle:"",newsFormTitlePlaceholder:`${this.$t("news.composer.placeholderTitleInput")}*`,newsFormSummaryPlaceholder:this.$t("news.composer.placeholderSummaryInput"),newsFormContentPlaceholder:`${this.$t("news.composer.placeholderContentInput")}*`,newsFormContentHeight:"250",newsFormSummaryHeight:"80",initDone:!1,initIllustrationDone:!1,showDraftNews:!1,postingNews:!1,savingDraft:!1,saveDraft:"",draftSavingStatus:"",illustrationChanged:!1,attachmentsChanged:!1,imagesURLs:new Map,uploading:!1,canCreateNews:!1,loading:!0,currentSpace:{},spaceURL:null,spaceGroupId:null,currentUser:eXo.env.portal.userName,fullDateFormat:{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"},items:[{key:"private",value:!1,text:this.$t("news.composer.private"),align:"center",sortable:!1},{key:"shared",value:!0,text:this.$t("news.composer.shared"),align:"center",sortable:!1}],canScheduleNews:!1,scheduleMode:"",switchView:!1,spaceDisplayName:"",unAuthorizedAccess:!1,endUplodingFileTimeout:50}},computed:{editMode:function(){return this.activityId&&""!==this.activityId},postDisabled:function(){return this.uploading||!this.news.title||!this.news.title.trim()||!this.news.body||!(new DOMParser).parseFromString(this.news.body,"text/html").documentElement.textContent.replace(/&nbsp;/g,"").trim()},updateDisabled:function(){return!(!this.uploading&&this.news.title&&this.news.title.trim()&&this.news.body&&this.news.body.replace(/&nbsp;/g,"").trim()&&(this.illustrationChanged||this.attachmentsChanged||this.news.title!==this.originalNews.title||this.news.summary!==this.originalNews.summary||this.getString(this.news.body)!==this.getString(this.originalNews.body)||this.news.published!==this.originalNews.published||"draft"===this.news.publicationState))},draftWarningText(){return this.$t("news.drafts.warning.youAreEditingDraft").replace("{0}",this.news.draftUpdaterDisplayName).replace("{1}",this.formatDate(this.news.draftUpdateDate.time))},isMobile(){return"xs"===this.$vuetify.breakpoint.name||"sm"===this.$vuetify.breakpoint.name},canUpdateNewVisibilty(){return!this.editMode&&""!==this.news.id&&this.currentSpace&&this.currentSpace.redactorsCount>0},isNewsAuthor(){return this.news.author===this.currentUser},newsLabel(){return this.news.draftVisible?this.$t("news.composer.shared"):this.$t("news.composer.private")}},watch:{"news.title":function(){this.news.title!==this.originalNews.title&&this.autoSave()},"news.draftVisible":function(){this.autoSave()},"news.summary":function(){this.news.summary!==this.originalNews.summary&&this.autoSave()},"news.body":function(){this.getContent(this.news.body)!==this.getContent(this.originalNews.body)&&this.autoSave()},"news.attachments":function(){this.initDone&&this.news.attachments!==this.originalNews.attachments&&(this.attachmentsChanged=!0,this.waitForEndUploding())},"news.illustration":function(){this.initIllustrationDone&&(this.illustrationChanged=!0,this.autoSave())}},mounted(){document.getElementById("newsTop").classList.add("darkComposerEffect"),document.body.style.overflow="hidden",a()(document.querySelector("#newsSummary")),this.$newsServices.getSpaceById(this.spaceId).then((e=>{this.currentSpace=e,this.spaceURL=this.currentSpace.prettyName,this.spaceGroupId=this.currentSpace.groupId,this.displayFormTitle(),this.$newsServices.canUserCreateNews(this.currentSpace.id).then((e=>{this.canCreateNews=e||this.newsId,this.$nextTick((()=>{if(this.canCreateNews)if(this.newsId)this.initNewsComposerData(this.newsId);else{this.initCKEditor(),this.setToolBarEffect(),this.news.draftVisible=!1;const e=localStorage.getItem("exo-activity-composer-message");e&&(this.initCKEditorData(e),localStorage.removeItem("exo-activity-composer-message")),this.initDone=!0}this.loading=!1}))})),this.$newsServices.canScheduleNews(this.currentSpace.id).then((e=>{this.canScheduleNews=e}))})),this.$nextTick((()=>{const e=JSON.parse(localStorage.getItem("exo-activity-composer-attachments"));e&&(this.news.attachments=e,localStorage.removeItem("exo-activity-composer-attachments"))})),$('[rel="tooltip"]').tooltip()},beforeDestroy(){const e=document.querySelector("#activityComposerTextarea"),t=document.querySelector("#ShareButton");e&&t&&(e.style.display="block",t.style.display="block")},created(){document.addEventListener("switch-view-plugins",(()=>{this.changeView()})),document.addEventListener("attach-file-plugins",(()=>{this.openApp()})),this.$root.$on("update-visibility",this.updateVisibility)},methods:{initCKEditor:function(){CKEDITOR.instances.newsContent&&CKEDITOR.instances.newsContent.destroy&&CKEDITOR.instances.newsContent.destroy(!0),CKEDITOR.plugins.addExternal("video","/news/js/ckeditor/plugins/video/","plugin.js"),CKEDITOR.plugins.addExternal("switchView","/news/js/ckeditor/plugins/switchView/","plugin.js"),CKEDITOR.plugins.addExternal("attachFile","/news/js/ckeditor/plugins/attachment/","plugin.js"),CKEDITOR.dtd.$removeEmpty.i=!1;let e="sharedspace,simpleLink,suggester,font,justify,widget,video,switchView,attachFile,googleDocPastePlugin,tagSuggester",t="image,confirmBeforeReload,maximize,resize,embedsemantic";const s=$(window).width();s>$(window).height()&&s<this.SMARTPHONE_LANDSCAPE_WIDTH&&(e="simpleLink"),CKEDITOR.addCss(".cke_editable { font-size: 14pt; font-family: Helvetica, regular, sans-serif; line-height: 1.4 !important;}"),CKEDITOR.addCss("h1 { font-size: 34px;font-weight: 400;}"),CKEDITOR.addCss("h2 { font-size: 28px;font-weight: 400;}"),CKEDITOR.addCss("h3 { font-size: 21.84px;font-weight: 400;}"),CKEDITOR.addCss("p,li { font-size: 18.6667px;}"),CKEDITOR.addCss("blockquote p  { font-size: 17.5px;font-weight: 300;}"),CKEDITOR.basePath="/commons-extension/ckeditor/";const i=this,n=this.isMobile,a=[];this.isMobile?a.push({name:"switchView",items:["switchView"]},{name:"basicstyles",items:["Bold","Italic","Underline","Strike","-","RemoveFormat"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Blockquote"]},{name:"links",items:["Video"]},{name:"attachFile",items:["attachFile"]}):a.push({name:"format",items:["Format"]},{name:"basicstyles",items:["Bold","Italic","Underline","Strike","-","RemoveFormat"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Blockquote"]},{name:"fontsize",items:["FontSize"]},{name:"colors",items:["TextColor"]},{name:"align",items:["JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"links",items:["simpleLink","Video"]});const o=extensionRegistry.loadExtensions("WYSIWYGPlugins","image");if(o&&o.length){const s=o.map((e=>e.extraPlugin)).join(","),i=o.map((e=>e.removePlugin)).join(",");s&&(e=`${e},${s}`),i&&(t=`${e},${i}`),o.forEach((e=>a.find((e=>"links"===e.name)).items.push(e.extraToolbarItem)))}$("textarea#newsContent").ckeditor({customConfig:"/commons-extension/ckeditorCustom/config.js",extraPlugins:e,removePlugins:t,allowedContent:!0,typeOfRelation:"mention_activity_stream",spaceURL:i.spaceURL,spaceGroupId:i.spaceGroupId,imagesDownloadFolder:"news/images",toolbarLocation:"top",extraAllowedContent:"img[style,class,src,referrerpolicy,alt,width,height]; span(*)[*]{*}; span[data-atwho-at-query,data-atwho-at-value,contenteditable]; a[*];i[*]",removeButtons:"Subscript,Superscript,Cut,Copy,Paste,PasteText,PasteFromWord,Undo,Redo,Scayt,Unlink,Anchor,Table,HorizontalRule,SpecialChar,Maximize,Source,Strike,Outdent,Indent,BGColor,About",toolbar:a,format_tags:"p;h1;h2;h3",autoGrow_minHeight:i.newsFormContentHeight,height:i.newsFormContentHeight,bodyClass:"newsContent",dialog_noConfirmCancel:!0,sharedSpaces:{top:"newsTop"},on:{instanceReady:function(e){if(n){const e=document.getElementById("cke_16"),t=document.getElementById("cke_20"),s=document.getElementById("cke_23");e.style.borderRight="none",t.style.display="none",s.style.display="none";const i=document.createElement("span");i.setAttribute("class","badge"),i.setAttribute("id","badge"),i.innerHTML="0",s.appendChild(i)}i.news.body=e.editor.getData(),$(CKEDITOR.instances.newsContent.document.$).find(".atwho-inserted").each((function(){$(this).on("click",".remove",(function(){$(this).closest("[data-atwho-at-query]").remove()}))})),window.setTimeout((()=>i.setFocus()),50)},change:function(e){i.news.body=e.editor.getData(),i.autoSave()},drop:function(e){window.setTimeout((()=>{i.news.body=e.editor.getData(),i.autoSave()}),1e3)}}})},initCKEditorData:function(e){if(e){const t=$("<div class='temp'/>").html(e);t.find('a[href*="/profile"]').each((function(){$(this).replaceWith((function(){return $("<span/>",{class:"atwho-inserted",html:`<span class="exo-mention">${$(this).text()}<a data-cke-survive href="#" class="remove"><i data-cke-survive class="uiIconClose uiIconLightGray"></i></a></span>`}).attr("data-atwho-at-query",`@${$(this).attr("href").substring($(this).attr("href").lastIndexOf("/")+1)}`).attr("data-atwho-at-value",$(this).attr("href").substring($(this).attr("href").lastIndexOf("/")+1)).attr("contenteditable","false")}))})),e=`${t.html()}&nbsp;`}CKEDITOR.instances.newsContent.setData(e)},displayFormTitle:function(){this.$newsServices.getSpaceById(this.spaceId).then((e=>{this.isMobile&&!this.editMode?(this.newsFormTitle=`${this.$t("news.composer.mobile.createNews")}`,this.spaceDisplayName=e.displayName):this.isMobile||this.editMode?(this.newsFormTitle=this.$t("news.edit.editNews"),this.spaceDisplayName=e.displayName):this.newsFormTitle=this.newsFormTitle=this.$t("news.composer.createNews").replace("{0}",e.displayName)}))},initNewsComposerData:function(e){const t=this;this.$newsServices.getNewsById(e,!0).then((s=>{401===s?(this.unAuthorizedAccess=!0,t.initDone=!0):(this.news.id=s.id,this.news.title=s.title,this.news.summary=s.summary,this.news.body=s.body,this.news.published=s.published,this.news.archived=s.archived,this.news.spaceId=s.spaceId,this.news.publicationState=s.publicationState,this.news.activityId=s.activityId,this.news.updater=s.updater,this.news.draftUpdaterDisplayName=s.draftUpdaterDisplayName,this.news.draftUpdaterUserName=s.draftUpdaterUserName,this.news.draftUpdateDate=s.draftUpdateDate,this.news.author=s.author,this.news.draftVisible=s.draftVisible,this.news.activityPosted=s.activityPosted,this.news.audience=s.audience,this.initCKEditor(),this.initCKEditorData(s.body),s.illustrationURL?this.$newsServices.importFileFromUrl(s.illustrationURL).then((e=>e.blob())).then((t=>{const i=new File([t],`illustration${e}`),n={id:null,uploadId:null,name:i.name,size:i.size,src:s.illustrationURL,progress:null,file:i,finished:!0};this.news.illustration.push(n),this.originalNews.illustration.push(n)})).then((()=>this.initIllustrationDone=!0)):this.initIllustrationDone=!0,this.news.attachments=s.attachments,this.originalNews=JSON.parse(JSON.stringify(this.news)),Vue.nextTick((()=>{a().update(document.querySelector("#newsSummary")),t.initDone=!0})))}))},autoSave:function(){this.initDone&&(this.postingNews||(clearTimeout(this.saveDraft),this.saveDraft=setTimeout((()=>{this.savingDraft=!0,this.draftSavingStatus=this.$t("news.composer.draft.savingDraftStatus"),Vue.nextTick((()=>{this.activityId?this.doUpdateNews("draft",!1):this.saveNewsDraft()}))}),this.autoSaveDelay)))},newsActions(){this.canScheduleNews?(this.scheduleMode="postScheduledNews",this.$root.$emit("open-schedule-drawer",this.scheduleMode)):this.postNews()},postNews:function(e,t,s,i,n,a){this.news.activityPosted=i,this.news.published=s,this.news.targets=n,null!==a&&(this.news.audience=a===this.$t("news.composer.stepper.audienceSection.allUsers")?"all":"space"),this.doPostNews(e)},doPostNews:function(e){this.postingNews=!0,this.savingDraft?(this.$on("draftCreated",this.saveNews),this.$on("draftUpdated",this.saveNews)):this.saveNews(e)},saveNews:function(e){clearTimeout(this.saveDraft),this.$off("draftCreated",this.saveNews),this.$off("draftUpdated",this.saveNews),this.news.body=this.replaceImagesURLs(this.news.body);const t=this.replaceImagesURLs(this.getBody()),s={id:this.news.id,title:this.news.title,summary:this.news.summary,body:this.getBody()?t:this.news.body,author:this.currentUser,attachments:this.news.attachments,published:this.news.published,draftVisible:this.news.draftVisible,targets:this.news.targets,spaceId:this.spaceId,publicationState:"published",schedulePostDate:null,timeZoneId:null,activityPosted:this.news.activityPosted,audience:this.news.audience};null!=e&&(s.publicationState="staged",s.schedulePostDate=e,s.timeZoneId=o),this.news.illustration.length>0&&(s.uploadId=this.news.illustration[0].uploadId),"staged"===s.publicationState?this.$newsServices.scheduleNews(s).then((e=>{e&&(window.location.href=e.url)})):this.$newsServices.saveNews(s).then((e=>{let t=null;if(e.activities){const s=e.activities.split(";")[0].split(":");s.length>1&&(t=s[1])}window.location.href=t?`${eXo.env.portal.context}/${eXo.env.portal.portalName}/activity?id=${t}`:`${eXo.env.portal.context}/${eXo.env.portal.portalName}`}))},saveNewsDraft:function(){const e={title:this.news.title,summary:this.news.summary,body:this.replaceImagesURLs(this.news.body),author:this.currentUser,attachments:[],published:!1,draftVisible:this.news.draftVisible,spaceId:this.spaceId,publicationState:""};this.news.illustration.length>0?e.uploadId=this.news.illustration[0].uploadId:e.uploadId="",this.news.attachments.forEach((t=>{(t.id||100===t.uploadProgress)&&e.attachments.push({id:t.id,uploadId:t.uploadId,name:t.name})})),this.news.id?(this.news.title||this.news.summary||this.news.body||this.news.illustration.length>0?(e.id=this.news.id,this.$newsServices.updateNews(e,!1).then((e=>{this.news.body!==e.body&&(this.imagesURLs=this.extractImagesURLsDiffs(this.news.body,e.body))})).then((()=>this.$emit("draftUpdated"))).then((()=>this.draftSavingStatus=this.$t("news.composer.draft.savedDraftStatus")))):(this.$newsServices.deleteDraft(this.news.id).then((()=>this.$emit("draftDeleted"))).then((()=>this.draftSavingStatus=this.$t("news.composer.draft.savedDraftStatus"))),this.news.id=null),this.savingDraft=!1):this.news.title||this.news.summary||this.news.body||this.news.illustration.length>0?(e.publicationState="draft",this.$newsServices.saveNews(e).then((e=>{this.draftSavingStatus=this.$t("news.composer.draft.savedDraftStatus"),this.news.id=e.id,this.newsId||(this.newsId=e.id),this.news.author=e.author,this.savingDraft=!1,this.$emit("draftCreated")}))):this.draftSavingStatus=""},extractImagesURLsDiffs:function(e,t){const s=new Map,i=$(e),n=$(t),a=i.find("img"),o=n.find("img");return a.each((function(e,t){const i=$(t).attr("src"),n=$(o[e]).attr("src");n!==i&&s.set(i,n)})),s},replaceImagesURLs:function(e){let t=e;const s=/[-/\\^$*+?.()|[\]{}]/g;return this.imagesURLs.forEach((function(e,i){const n=i.replace(s,"\\$&"),a=new RegExp(`src="${n}"`);t=t.replace(a,`src="${e}"`)})),t},resetNewsActivity:function(){this.news.id="",this.news.title="",this.news.summary="",this.news.body="",this.news.published=!1,CKEDITOR.instances.newsContent.setData(""),this.news.illustration=[]},updateNews:function(e){this.confirmAndUpdateNews(e).then((()=>{window.location.href=`${eXo.env.portal.context}/${eXo.env.portal.portalName}/activity?id=${this.activityId}`})).catch((function(){window.location.href=`${eXo.env.portal.context}/${eXo.env.portal.portalName}/activity?id=${this.activityId}`}))},confirmAndUpdateNews:function(e){return this.doUpdateNews("published",e)},doUpdateNews:function(e,t){const s=this.replaceImagesURLs(this.getBody()),i={id:this.news.id,title:this.news.title,summary:null!=this.news.summary?this.news.summary:"",body:this.getBody()?s:this.news.body,attachments:this.news.attachments,published:this.news.published,publicationState:e,draftVisible:this.news.draftVisible,activityPosted:this.news.activityPosted,audience:this.news.audience};return null!=this.news.illustration&&this.news.illustration.length>0?i.uploadId=this.news.illustration[0].uploadId:null!==this.originalNews.illustrationURL&&(i.uploadId=""),this.$newsServices.updateNews(i,t).then((e=>{this.news.body!==e.body&&(this.imagesURLs=this.extractImagesURLsDiffs(this.news.body,e.body))})).then((()=>this.$emit("draftUpdated"))).then((()=>this.draftSavingStatus=this.$t("news.composer.draft.savedDraftStatus")))},goBack(){history.length>1?history.back():window.open("/","_self")},openApp(){this.$refs.attachmentsComponent.toggleAttachmentsDrawer()},onHideAttachmentsDrawer:function(){const e=document.getElementById("badge");if(e){const t=this.news&&this.news.attachments&&this.news.attachments.length||0;e.innerHTML=`${t}`}},setUploadingCount:function(e){this.uploading=e>0},getBody:function(){return CKEDITOR.instances.newsContent.getData()||null},formatDate(e){return this.$dateUtil.formatDateObjectToDisplay(new Date(e),this.fullDateFormat,eXo.env.portal.language)},getContent:e=>(new DOMParser).parseFromString(e,"text/html").documentElement.textContent.replace(/&nbsp;/g,"").trim(),setFocus(){CKEDITOR.instances.newsContent&&(CKEDITOR.instances.newsContent.status="ready",window.setTimeout((()=>{this.$nextTick().then((()=>CKEDITOR.instances.newsContent.focus()))}),200))},setToolBarEffect(){const e=CKEDITOR.instances.newsContent,t=document.getElementById("newsTop");e.on("contentDom",(function(){this.document.on("click",(function(){t.classList.add("darkComposerEffect")}))})),e.on("contentDom",(function(){this.document.on("keyup",(function(){t.classList.add("darkComposerEffect")}))})),$("#newsSummary").parent().click((()=>{t.classList.remove("darkComposerEffect"),t.classList.add("greyComposerEffect")})),$("#newsSummary").parent().keyup((()=>{t.classList.remove("darkComposerEffect"),t.classList.add("greyComposerEffect")})),$("#newsTitle").parent().click((()=>{t.classList.remove("darkComposerEffect"),t.classList.add("greyComposerEffect")})),$("#newsTitle").parent().keyup((()=>{t.classList.remove("darkComposerEffect"),t.classList.add("greyComposerEffect")})),$("#composerToolbarInformation").click((()=>{t.classList.remove("darkComposerEffect"),t.classList.add("greyComposerEffect")})),$("#composerToolbarInformation").keyup((()=>{t.classList.remove("darkComposerEffect"),t.classList.add("greyComposerEffect")})),$("#newsFormAttachment").parent().click((()=>{t.classList.remove("darkComposerEffect"),t.classList.add("greyComposerEffect")})),$("#newsFormAttachment").parent().keyup((()=>{t.classList.remove("darkComposerEffect"),t.classList.add("greyComposerEffect")}))},getString:e=>(new DOMParser).parseFromString(e,"text/html").documentElement.textContent.replace(/&nbsp;/g,"").trim(),updateDraftVisibility(){this.$root.$emit("update-draft-visibility",this.news.draftVisible)},updateVisibility(e){e!==this.news.draftVisible&&(this.news.draftVisible=e,this.updateDraftVisibility())},changeView(){const e=document.getElementById("newsTop");e.classList.remove("greyComposerEffect"),e.classList.add("darkComposerEffect");const t=document.getElementById("cke_9"),s=document.getElementById("cke_11"),i=document.getElementById("cke_16"),n=document.getElementById("cke_20"),a=document.getElementById("cke_23");i.style.borderRight="none",n.style.display="none",this.switchView?(t.style.display="initial",s.style.display="initial",i.style.display="initial",a.style.display="none",this.switchView=!1):(t.style.borderRight="none",s.style.display="none",i.style.display="none",n.style.display="initial",n.style.borderRight="none",a.style.display="initial",this.switchView=!0)},waitForEndUploding(){window.setTimeout((()=>{this.uploading?this.waitForEndUploding():this.autoSave()}),this.endUplodingFileTimeout)}}};function l(e,t,s,i,n,a,o,r){var l,d="function"==typeof e?e.options:e;if(t&&(d.render=t,d.staticRenderFns=s,d._compiled=!0),i&&(d.functional=!0),a&&(d._scopeId="data-v-"+a),o?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},d._ssrRegister=l):n&&(l=r?function(){n.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:n),l)if(d.functional){d._injectStyles=l;var c=d.render;d.render=function(e,t){return l.call(t),c(e,t)}}else{var u=d.beforeCreate;d.beforeCreate=u?[].concat(u,l):[l]}return{exports:e,options:d}}const d=l(r,t,[],!1,null,null,null).exports;var c=function(){var e=this,t=e._self._c;return t("div",{staticClass:"fileDrop"},[t("div",{staticClass:"dropZone"},[t("label",{staticClass:"dropMsg",class:e.files.length>0?"imageUploaded":"",attrs:{for:"uploadedFile"}},[t("i",{staticClass:"uiIcon uiIconIllustrationUpload"}),e._v(" "),t("i",{staticClass:"uiIcon uiIconPlusCircled"})]),e._v(" "),t("input",{staticClass:"attachFile",attrs:{id:"uploadedFile",type:"file"},domProps:{value:e.selectedFile}}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.error,expression:"error"}],staticClass:"uploadError alert alert-error v-content"},[e._v("\n      "+e._s(e.error)+"\n    ")]),e._v(" "),t("div",{staticClass:"uploadedFile"},[e.files.length>0?t("div",{staticClass:"abortFile"},[t("div",{staticClass:"removeButton",attrs:{title:e.$t("news.composer.btn.remove"),href:"#",rel:"tooltip","data-placement":"top"},on:{click:function(t){return e.abortUpload(e.files[0].name)}}},[t("i",{staticClass:"uiIconRemove"})])]):e._e(),e._v(" "),e.files.length>0?t("img",{attrs:{src:e.files[0].src}}):e._e()])])])};c._withStripped=!0;const u=eXo.env.portal.context||"",h=(eXo.env.portal.portalName,eXo.env.portal.containerName,eXo.env.portal.rest),p=`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/news`,m=(eXo.env.portal.context,eXo.env.portal.rest,`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/social/spaces`),w=`${eXo.env.portal.context}/${eXo.env.portal.rest}${eXo.env.portal.context}/social/spaces/suggest.json`,f=`${eXo.env.portal.context}/${eXo.env.portal.rest}/space/user/searchSpace/`,v=(eXo.env.portal.spaceId,window.location.host,`${eXo.env.portal.context}/upload`),g=eXo.env.portal.userName,y=l({model:{prop:"files",event:"change"},props:{files:{type:Array,default:()=>[]}},data:()=>({selectedFile:null,error:""}),mounted(){const e=$(this.$el).find(".dropZone"),t=this;let s="";e.filedrop({fallback_id:"uploadedFile",url:function(){const e=Math.round(5e3*Math.random()),t=Date.now();return s=`${e}-${t}`,`${v}?uploadId=${s}&action=upload`},paramname:"userfile",error:function(e){switch(e){case"ErrorBrowserNotSupported":case"BrowserNotSupported":t.setErrorCode("news.composer.error.BrowserNotSupported");break;case"ErrorTooManyFiles":case"TooManyFiles":t.setErrorCode("news.composer.error.TooManyFiles",[1]);break;case"ErrorFileTooLarge":case"FileTooLarge":t.setErrorCode("news.composer.error.FileTooLarge",[10]);break;case"ErrorFileTypeNotAllowed":case"FileTypeNotAllowed":t.setErrorCode("news.composer.error.FileTypeNotAllowed")}},allowedfiletypes:["image/jpeg","image/png","image/gif"],allowedfileextensions:[".jpg",".jpeg",".png",".gif"],maxfiles:1,maxfilesize:10,rename:t.getFileName,uploadStarted:function(e,i){0===e&&(t.error=null);const n={id:null,uploadId:s,name:i.name,size:i.size,src:null,progress:0,file:i,finished:!1},a=new FileReader;a.onload=e=>{const s=e.target.result;t.$set(n,"src",s),t.$set(n,"data",s),t.$forceUpdate()},a.readAsDataURL(i),t.files.push(n)},uploadFinished:function(){t.$emit("change",t.files)},beforeEach:function(){if(t.files.length>=1)return t.setErrorCode("news.composer.error.TooManyFiles",[1]),!1},afterAll:function(){t.selectedFile=null}})},methods:{abortUpload(e){this.deleteFile(e)},deleteFile(e){const t=this.files.findIndex((t=>t.name===e)),s=this.files[t];this.files.splice(t,1),this.$emit("change",this.files),s.uploadId&&fetch(`${v}?uploadId=${s.uploadId}&action=delete`,{method:"post",credentials:"include"})},setErrorCode(e,t){this.error=this.$t(e,t),setTimeout((()=>{this.error=""}),5e3)}}},c,[],!1,null,null,null).exports;var b=function(){var e=this,t=e._self._c;return t("v-dialog",{ref:"dialog",staticClass:"pa-2",attrs:{"content-class":"uiPopup"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[t("v-card",{staticClass:"elevation-12"},[t("div",{staticClass:"ClearFix"},[t("span",{staticClass:"subtitle-1 pa-3 font-weight-bold PopupTitle popupTitle text-truncate"},[e._v(" "+e._s(e.$t("news.composer.visibility.mobile.title")))])]),e._v(" "),t("v-radio-group",{staticClass:"mt-2",model:{value:e.visibility,callback:function(t){e.visibility=t},expression:"visibility"}},e._l(e.items,(function(e){return t("v-radio",{key:e.key,staticClass:"pa-1",attrs:{label:e.text,value:e.value}})})),1)],1)],1)};function C(e,t){return fetch(`${p}/${e}?editMode=${t||""}`,{credentials:"include",method:"GET"}).then((e=>e&&e.ok?e.json():401===e.status?e.status:void 0)).then((e=>e)).catch((e=>e))}function x(e){return fetch(`${p}/byActivity/${e}`,{credentials:"include",method:"GET"}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Response code indicates a server error",e)}))}function S(e){return fetch(`${p}/${e}?fields=spaces`,{credentials:"include",method:"GET"}).then((e=>e.json())).then((e=>e))}function E(e){return fetch(`${p}/markAsRead/${e}`,{credentials:"include",method:"POST"}).then((e=>{if(e&&e.ok)return e.text();throw new Error("Error while marking news as read")}))}function N(e,t,s,i,n,a){let o=`${p}?author=${g}&publicationState=published&filter=${e}`;return s&&(o+=`&text=${s}`),t&&(o+=`&spaces=${t}`),isNaN(i)||(o+=`&offset=${i}`),isNaN(n)||(o+=`&limit=${n}`),a&&(o+=`&returnSize=${a}`),fetch(o,{headers:{"Content-Type":"application/json"},method:"GET"}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Error getting news list")}))}function I(e){return fetch(`${p}`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify(e)}).then((e=>e.json()))}function T(e){return fetch(`${p}/schedule`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"PATCH",body:JSON.stringify(e)}).then((e=>e.json()))}function _(e){return fetch(e,{headers:{"Content-Type":"blob"},credentials:"include",method:"GET"})}function D(e,t){return fetch(`${p}/${e.id}?post=${t}`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"PUT",body:JSON.stringify(e)}).then((e=>e.json()))}function k(e){return fetch(`${p}/${e}/click`,{credentials:"include",method:"POST",body:"edit"})}function F(e){return fetch(`${w}?conditionToSearch=${e}&currentUser=${g}&typeOfRelation=confirmed`,{headers:{"Content-Type":"application/json"},method:"GET"}).then((e=>e.json())).then((e=>e.options))}function L(e){return fetch(`${p}/${e}`,{credentials:"include",method:"DELETE"})}function U(e){return fetch(`${m}/${e}`,{credentials:"include",method:"GET"}).then((t=>{if(t&&t.ok)return t.json();throw new Error(`Error getting space with id ${e}`)}))}function R(e,t,s){return fetch(`${m}?offset=${e}&limit=${t}&returnSize=true&filterType=${s}`,{credentials:"include",method:"GET"}).then((e=>e.json())).then((e=>e))}function A(e){return fetch(`${f}?fields=id,url,displayName,avatarUrl&keyword=${e}`,{headers:{"Content-Type":"application/json"},method:"GET"}).then((e=>e.json()))}function P(e,t,s){return fetch(`/portal/rest/managedocument/getFoldersAndFiles/?driveName=${e}&workspaceName=${t}&currentFolder=${s}`,{}).then((e=>e.text())).then((e=>(new window.DOMParser).parseFromString(e,"text/xml"))).then((e=>e))}function O(){return fetch("/portal/rest/wcmDriver/getDrivers",{}).then((e=>e.text())).then((e=>(new window.DOMParser).parseFromString(e,"text/xml"))).then((e=>e))}function M(e){const t=document.createElement("div");return t.innerText=e,t.innerHTML}function V(e){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/news/canCreateNews/${eXo.env.portal.spaceId||e}`,{headers:{"Content-Type":"application/json"},method:"GET"}).then((e=>e&&e.ok&&e.json()))}function z(e){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/news/canScheduleNews/${eXo.env.portal.spaceId||e}`,{headers:{"Content-Type":"application/json"},method:"GET"}).then((e=>e&&e.ok&&e.json()))}function j(e,t,s){return s>0&&localStorage.setItem("deletedNews",e),fetch(`${p}/${e}?isDraft=${t||""}&delay=${s||0}`,{credentials:"include",method:"DELETE"}).then((e=>{if(e&&!e.ok)throw new Error("Error when deleting news")}))}function B(e){return fetch(`${p}/${e}/undoDelete`,{method:"POST",credentials:"include"}).then((e=>{if(!e||!e.ok)throw new Error("Error when undoing deleting news");localStorage.removeItem("deletedNews")}))}function X(){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/news/canPublishNews?spaceId=${eXo.env.portal.spaceId}`,{headers:{"Content-Type":"application/json"},method:"GET"}).then((e=>e.json())).then((e=>e))}b._withStripped=!0;const K={"exo-news-activity-composer":d,"exo-news-file-drop":y,"exo-news-draft-visibility-mobile":l({props:{items:{type:Array,default:function(){return null}}},data:()=>({dialog:!1,visibility:!1}),watch:{dialog(){this.dialog?(this.$emit("dialog-opened"),document.dispatchEvent(new CustomEvent("modalOpened"))):(this.$emit("dialog-closed"),document.dispatchEvent(new CustomEvent("modalClosed")))},visibility(){this.$root.$emit("update-visibility",this.visibility),this.dialog=!1,this.$nextTick((()=>this.dialog=!1))}},created(){this.$root.$on("open-draft-visibility",this.openVisibilityDialog)},methods:{openVisibilityDialog(e){this.dialog=!0,this.visibility=e,this.$emit("opened"),this.$nextTick((()=>this.dialog=!0))}}},b,[],!1,null,null,null).exports};for(const e in K)Vue.component(e,K[e]);Vue.prototype.$newsServices||window.Object.defineProperty(Vue.prototype,"$newsServices",{value:e}),Vue.use(Vuetify);const H=new Vuetify(eXo.env.portal.vuetifyPreset),G="undefined"!=typeof eXo?eXo.env.portal.language:"en",W=[`${u}/${h}/i18n/bundle/locale.portlet.news.News-${G}.json`,`${u}/${h}/i18n/bundle/locale.attachmentsSelector.attachments-${G}.json`];if(extensionRegistry){const e=extensionRegistry.loadComponents("NewsActivityComposer");e&&e.length>0&&e.forEach((e=>{Vue.component(e.componentName,e.componentOptions)}))}let q;function J(e,t){exoi18n.loadLanguageAsync(G,W).then((s=>{q=new Vue({el:"#NewsComposerApp",data:function(){return{newsId:Z("newsId"),spaceId:Z("spaceId"),activityId:Z("activityId"),maxToUpload:e,maxFileSize:t}},template:'<exo-news-activity-composer :news-id="newsId" :space-id="spaceId" :activity-id="activityId" :max-to-upload="maxToUpload" :max-file-size="maxFileSize"></exo-news-activity-composer>',i18n:s,vuetify:H})}))}function Y(){q&&q.$destroy()}function Z(e){const t=new URLSearchParams(window.location.search);if(t.has(e))return t.get(e)}})(),i})()));