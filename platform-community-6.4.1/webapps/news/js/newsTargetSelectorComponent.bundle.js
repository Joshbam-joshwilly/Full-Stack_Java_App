define((()=>(()=>{"use strict";var e={d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t);var s={};e.r(s),e.d(s,{createTarget:()=>p,deleteTargetByName:()=>l,getAllTargets:()=>a,getAllowedTargets:()=>c,undoDeleteTarget:()=>d,updateTarget:()=>u});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"targetsSelector"},[t("div",{staticClass:"d-flex flex-row selectTarget ms-2 mr-3",on:{click:function(e){e.stopPropagation()}}},[t("v-select",{ref:"chooseTargets",attrs:{id:"chooseTargets",items:e.targets,"menu-props":{bottom:!0,offsetY:!0},placeholder:e.$t("news.composer.stepper.chooseTarget.option"),"item-text":"label","item-value":"name",chips:"","hide-no-data":"",multiple:"",dense:"",outlined:""},on:{change:function(t){return e.addTarget()}},scopedSlots:e._u([{key:"prepend-item",fn:function(){return[t("v-list-item",{attrs:{ripple:""},on:{click:function(t){return t.stopPropagation(),e.toggleTargetsSelection.apply(null,arguments)}}},[t("v-list-item-action",[t("v-icon",{attrs:{color:e.selectedTargets.length>0?"primary":""}},[e._v("\n              "+e._s(e.selectionIcon)+"\n            ")])],1),e._v(" "),t("v-list-item-content",[t("v-list-item-title",[e._v("\n              "+e._s(e.selectTargetLabel)+"\n            ")])],1)],1)]},proxy:!0},{key:"selection",fn:function({item:s,index:r}){return[t("v-tooltip",{attrs:{disabled:!s.description,bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:n,attrs:o}){return[0===r?t("v-chip",e._g(e._b({attrs:{close:""},on:{"click:close":function(t){return e.removeTarget(s)}}},"v-chip",o,!1),n),[t("span",[e._v(e._s(s.label))])]):e._e()]}}],null,!0)},[e._v(" "),t("span",[e._v(e._s(s.description))])]),e._v(" "),1===r?t("span",{staticClass:"grey--text text-caption"},[e._v("\n          (+"+e._s(e.selectedTargets.length-1)+" "+e._s(e.$t("news.composer.stepper.chooseTarget.others"))+")\n        ")]):e._e()]}}]),model:{value:e.selectedTargets,callback:function(t){e.selectedTargets=t},expression:"selectedTargets"}})],1),e._v(" "),e.showTargetInformation?t("span",{staticClass:"d-flex flex-row error--text ms-2"},[e._v("\n    "+e._s(e.$t("news.composer.stepper.chooseTarget.mandatory"))+"\n  ")]):e._e(),e._v(" "),t("div",{staticClass:"ms-2"},[t("span",{staticClass:"text-subtitle-2 font-weight-bold"},[e._v(" "+e._s(e.$t("news.composer.stepper.audienceSection.title"))+" ")]),e._v(" "),t("p",[e._v(e._s(e.$t("news.composer.stepper.audienceSection.description")))]),e._v(" "),t("div",{staticClass:"mr-3",on:{click:function(e){e.stopPropagation()}}},[t("v-select",{ref:"chooseAudience",staticClass:"text-subtitle-2 py-0",attrs:{id:"chooseAudience",items:e.audiences,dense:"",outlined:""},on:{change:function(t){return e.addAudience()}},model:{value:e.selectedAudience,callback:function(t){e.selectedAudience=t},expression:"selectedAudience"}})],1),e._v(" "),t("div",{staticClass:"d-flex flex-row grey--text ms-2"},[t("i",{staticClass:"fas fa-exclamation-triangle mx-2 mt-1"}),e._v("\n      "+e._s(e.selectedAudienceDescription)+"\n    ")])])])};r._withStripped=!0;var n=function(e,t,s,r,n,o,i,a){var c,l="function"==typeof e?e.options:e;if(t&&(l.render=t,l.staticRenderFns=[],l._compiled=!0),c)if(l.functional){l._injectStyles=c;var d=l.render;l.render=function(e,t){return c.call(t),d(e,t)}}else{var p=l.beforeCreate;l.beforeCreate=p?[].concat(p,c):[c]}return{exports:e,options:l}}({props:{publish:{type:Boolean,default:!1},news:{type:Object,required:!1,default:null},targets:{type:Object,default:null},audience:{type:String,default:null}},data:()=>({selectedAudience:null,selectedTargets:[]}),computed:{selectedAudienceDescription(){return this.selectedAudience===this.$t("news.composer.stepper.audienceSection.allUsers")?this.$t("news.composer.stepper.audienceSection.allUsers.description"):this.$t("news.composer.stepper.audienceSection.onlySpaceMembers.description")},audiences(){return[this.$t("news.composer.stepper.audienceSection.allUsers"),this.$t("news.composer.stepper.audienceSection.onlySpaceMembers")]},disableTargetOption(){return this.selectedTargets&&0===this.selectedTargets.length&&this.publish},showTargetInformation(){return this.disableTargetOption&&this.publish},selectAllTargets(){return this.selectedTargets.length===this.targets.length},selectSomeTarget(){return this.selectedTargets.length>0&&!this.selectAllTargets},selectionIcon(){return this.selectAllTargets?"mdi-close-box":this.selectSomeTarget?"mdi-minus-box":"mdi-checkbox-blank-outline"},selectTargetLabel(){return this.selectAllTargets?this.$t("news.composer.stepper.chooseTarget.deselectAllTargets"):this.$t("news.composer.stepper.chooseTarget.selectAllTargets")}},created(){this.selectedAudience=this.audience&&"all"!==this.audience?this.$t("news.composer.stepper.audienceSection.onlySpaceMembers"):this.$t("news.composer.stepper.audienceSection.allUsers"),$(document).click((()=>{this.$refs.chooseTargets&&this.$refs.chooseTargets.isMenuActive&&this.$refs.chooseTargets.blur(),this.$refs.chooseAudience&&this.$refs.chooseAudience.isMenuActive&&this.$refs.chooseAudience.blur()})),this.selectedTargets=this.news.targets},methods:{removeTarget(e){this.selectedTargets.splice(this.selectedTargets.indexOf(e),1),this.selectedTargets=[...this.selectedTargets],this.$emit("selected-targets",this.selectedTargets)},toggleTargetsSelection(){this.$nextTick((()=>{if(this.selectAllTargets)this.selectedTargets=[];else{const e=[];for(const t in this.targets)e.push(this.targets[t].name);this.selectedTargets=e}this.$emit("selected-targets",this.selectedTargets)}))},addTarget(){this.$emit("selected-targets",this.selectedTargets)},addAudience(){this.$emit("selected-audience",this.selectedAudience)}}},r);const o=n.exports,i=(eXo.env.portal.context,eXo.env.portal.portalName,eXo.env.portal.containerName,eXo.env.portal.rest,`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/news`);function a(){return fetch(`${i}/targeting`,{credentials:"include",method:"GET"}).then((e=>{if(e&&e.ok)return e.json()}))}function c(){return fetch(`${i}/targeting/allowed`,{credentials:"include",method:"GET"}).then((e=>{if(e&&e.ok)return e.json()}))}function l(e,t){return t>0&&localStorage.setItem("deletedNewsTarget",e),fetch(`${i}/targeting/${e}?delay=${t||0}`,{credentials:"include",method:"DELETE"}).then((e=>{if(e&&!e.ok)throw new Error("Error when deleting news target")}))}function d(e){return fetch(`${i}/targeting/${e}/undoDelete`,{method:"POST",credentials:"include"}).then((e=>{if(!e||!e.ok)throw new Error("Error when undoing deleting news target");localStorage.removeItem("deletedNewsTarget")}))}function p(e){return fetch(`${i}/targeting`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{if(e&&e.ok)return e.status;if(409===e.status)return e.status;throw new Error("Error when creating news target")}))}function u(e,t){return fetch(`${i}/targeting/${t}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{if(e&&e.ok)return e.status;throw new Error("Error when updating news target")}))}eXo.env.portal.context,eXo.env.portal.rest,eXo.env.portal.context,eXo.env.portal.rest,eXo.env.portal.context,eXo.env.portal.rest,eXo.env.portal.context,eXo.env.portal.context,eXo.env.portal.rest,eXo.env.portal.spaceId,window.location.host,eXo.env.portal.context,eXo.env.portal.userName,Vue.prototype.$newsTargetingService||window.Object.defineProperty(Vue.prototype,"$newsTargetingService",{value:s});const g={"exo-news-targets-selector":o};for(const e in g)Vue.component(e,g[e]);return t})()));