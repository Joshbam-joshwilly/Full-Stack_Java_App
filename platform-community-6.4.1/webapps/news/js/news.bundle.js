define((()=>(()=>{"use strict";var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:()=>ie});var s={};e.r(s),e.d(s,{canPublishNews:()=>Y,canScheduleNews:()=>W,canUserCreateNews:()=>H,clickOnEditButton:()=>j,deleteDraft:()=>q,deleteNews:()=>K,escapeHTML:()=>Q,fetchFoldersAndFiles:()=>G,findUserSpaces:()=>O,getDrivers:()=>V,getNews:()=>E,getNewsByActivityId:()=>k,getNewsById:()=>A,getNewsSpaces:()=>F,getSpaceById:()=>B,getUserSpaces:()=>z,importFileFromUrl:()=>U,markNewsAsRead:()=>L,saveNews:()=>P,scheduleNews:()=>X,searchSpaces:()=>R,undoDeleteNews:()=>J,updateNews:()=>M});var i=function(){var e=this,t=e._self._c;return t("v-app",{staticClass:"newsApp",attrs:{role:"main"}},[t("v-toolbar",{attrs:{color:"white",flat:"",dense:""}},[t("div",{staticClass:"flex d-flex flex-row"},[t("v-spacer"),e._v(" "),t("div",{staticClass:"d-flex flex-row justify-end my-auto flex-nowrap"},[t("div",{class:e.searchInputDisplayed?"":"newsAppHideSearchInput"},[t("div",{staticClass:"inputNewsSearchWrapper"},[t("v-scale-transition",[t("v-text-field",{staticClass:"pa-0 my-auto",attrs:{placeholder:e.$t("news.app.searchPlaceholder"),"prepend-inner-icon":"fa-filter"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}})],1)],1)])]),e._v(" "),t("div",{staticClass:"d-flex flex-row justify-end my-auto flex-nowrap"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.newsFilter,expression:"newsFilter"}],staticClass:"width-auto my-auto ms-4 subtitle-1 ignore-vuetify-classes",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.newsFilter=t.target.multiple?s:s[0]}}},[t("option",{attrs:{value:"all"}},[e._v(e._s(e.$t("news.app.filter.all")))]),e._v(" "),t("option",{attrs:{value:"pinned"}},[e._v(e._s(e.$t("news.app.filter.pinned")))]),e._v(" "),t("option",{attrs:{value:"myPosted"}},[e._v(e._s(e.$t("news.app.filter.myPosted")))]),e._v(" "),t("option",{attrs:{value:"archived"}},[e._v(e._s(e.$t("news.app.filter.archived")))]),e._v(" "),t("option",{attrs:{value:"drafts"}},[e._v(e._s(e.$t("news.app.filter.drafts")))]),e._v(" "),t("option",{attrs:{value:"scheduled"}},[e._v(e._s(e.$t("news.app.filter.scheduled")))])]),e._v(" "),t("v-btn",{staticClass:"d-flex flex-row justify-end my-auto flex-nowrap primary--text ms-2",attrs:{icon:""},on:{click:function(t){return e.$root.$emit("news-space-selector-drawer-open")}}},[e.spacesFilter&&e.spacesFilter.length&&!e.spacesFilter.includes("-1")?[t("i",{staticClass:"uiIcon uiIcon24x24 settingsIcon primary--text mb-1"}),e._v("\n            ("+e._s(e.spacesFilter.length)+")\n          ")]:[t("i",{staticClass:"uiIcon uiIcon24x24 settingsIcon text-color"})]],2)],1)],1)]),e._v(" "),t("div",{staticClass:"newsAppFilterOptions"},[t("news-filter-space-drawer",{model:{value:e.spacesFilter,callback:function(t){e.spacesFilter=t},expression:"spacesFilter"}})],1),e._v(" "),t("v-app",{staticClass:"VuetifyApp"},[e.loadingNews&&0===e.newsList.length?t("v-progress-circular",{staticClass:"loadingRing",attrs:{size:40,width:4,indeterminate:""}}):e._e()],1),e._v(" "),e.newsList.length?t("div",{staticClass:"newsListItems",attrs:{id:"newsListItems"}},e._l(e.newsList,(function(s){return t("news-app-item",{key:s.newsId,staticClass:"newsItem",attrs:{news:s,"news-filter":e.newsFilter},on:{"update-news-list":e.updateNewsList,"delete-news":e.deleteNews}})})),1):e._e(),e._v(" "),0!==e.newsList.length||e.loadingNews?e._e():t("div",{staticClass:"articleNotFound"},[t("span",{staticClass:"iconNotFound"}),e._v(" "),t("h3",[e._v(e._s(e.notFoundMessage))])]),e._v(" "),e.showLoadMoreButton?t("div",{staticClass:"newsListPagination"},[t("div",{staticClass:"btn btn-block",on:{click:e.loadMore}},[e._v(e._s(e.$t("news.app.loadMore")))])]):e._e(),e._v(" "),t("exo-news-notification-alerts"),e._v(" "),t("news-activity-sharing-spaces-drawer"),e._v(" "),t("activity-share-drawer")],1)};function a(e,t,s,i,a,n,r,l){var o,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=s,c._compiled=!0),i&&(c.functional=!0),n&&(c._scopeId="data-v-"+n),r?(o=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),a&&a.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(r)},c._ssrRegister=o):a&&(o=l?function(){a.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:a),o)if(c.functional){c._injectStyles=o;var d=c.render;c.render=function(e,t){return o.call(t),d(e,t)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,o):[o]}return{exports:e,options:c}}i._withStripped=!0;const n=a({name:"NewsApp",data(){return{newsList:[],newsPerPage:10,showLoadMoreButton:!1,errors:[],showDropDown:!1,NEWS_TEXT_MAX_LENGTH:300,searchText:"",searchNews:"",searchDelay:300,searchInputDisplayed:!1,newsFilter:"",spacesFilter:[],newsStatusLabel:this.$t("news.app.filter.all"),showArchiveButton:!0,showShareButton:!0,loadingNews:!0,initialized:!1,dateTimeFormat:{hour:"2-digit",minute:"2-digit"},dateFormat:{year:"numeric",month:"long",day:"numeric"}}},computed:{notFoundMessage(){return this.searchText.trim().length?this.$t("news.app.searchNotFound").replace("{0}",this.searchText):this.$t("news.app.noNews")},isDraftsFilter(){return"drafts"===this.newsFilter}},watch:{searchText(){this.searchText&&this.searchText.trim().length?(clearTimeout(this.searchNews),this.searchNews=setTimeout((()=>{this.fetchNews(!1)}),this.searchDelay)):this.fetchNews(!1)},newsFilter(){window.history.pushState("","News",this.setQueryParam("filter",this.newsFilter)),this.newsStatusLabel=this.$t(`news.app.filter.${this.newsFilter}`),this.fetchNews(!1)},loadingNews(){this.loadingNews?document.dispatchEvent(new CustomEvent("displayTopBarLoading")):document.dispatchEvent(new CustomEvent("hideTopBarLoading"))},initialized(){this.initialized&&this.$root.$emit("application-loaded")},spacesFilter:{handler:function(){this.fetchNews(!1),!1===this.spacesFilter&&(this.spacesFilter=["-1"]),this.spacesFilter.length>0?window.history.pushState("","News",this.setQueryParam("spaces",this.spacesFilter.toString().replace(/,/g,"_"))):window.history.pushState("","News",this.removeQueryParam("spaces"))},deep:!0}},created(){const e=this.getQueryParam("filter"),t=this.getQueryParam("search");this.removeQueryParam("spaces"),e||t?(e&&(this.newsFilter=e),t&&(this.searchText=t)):null===e?this.newsFilter="all":this.fetchNews(),this.$root.$on("activity-shared",(()=>{this.fetchNews(!1)}))},methods:{getNewsText(e,t){let s=e;s||(s=t),s=s.length>this.NEWS_TEXT_MAX_LENGTH?`${s.substring(0,this.NEWS_TEXT_MAX_LENGTH)}...`:s;const i=document.createElement("div");return i.innerHTML=s,s=i.textContent||i.innerText||"",s},updateNewsList(e,t=!0){const s=[];e.forEach((e=>{const t=null!=e.publicationDate?new Date(e.publicationDate.time):null,i=new Date(e.updateDate.time),a=e.activities?e.activities.split(";")[0].split(":")[1]:"";s.push({newsId:e.id,newsText:this.getNewsText(e.summary,e.body),illustrationURL:e.illustrationURL,title:e.title,updatedDate:this.isDraftsFilter?t:i,spaceDisplayName:e.spaceDisplayName,spaceUrl:e.spaceUrl,url:this.isDraftsFilter?`${eXo.env.portal.context}/${eXo.env.portal.portalName}/news/editor?spaceId=${e.spaceId}&newsId=${e.id}&activityId=${a}`:e.url,authorFullName:e.authorDisplayName,authorProfileURL:`${eXo.env.portal.context}/${eXo.env.portal.portalName}/profile/${e.author}`,viewsCount:null==e.viewsCount?0:e.viewsCount,activityId:a,canEdit:e.canEdit,canDelete:e.canDelete,archived:e.archived,draft:"draft"===e.publicationState,scheduled:"staged"===e.publicationState,schedulePostDate:e.schedulePostDate,canArchive:e.canArchive,published:e.published,activities:e.activities,authorAvatarUrl:e.authorAvatarUrl,spaceAvatarUrl:e.spaceAvatarUrl,hiddenSpace:e.hiddenSpace,spaceId:e.spaceId,target:"drafts"===this.newsFilter?"_blank":"_self"})})),this.newsList=t?this.newsList.concat(s):s},fetchNews(e=!0){this.loadingNews=!0;const t=this.searchText.trim().toLowerCase(),s=e?this.newsList.length:0;return this.$newsServices.getNews(this.newsFilter,this.spacesFilter,t,s,this.newsPerPage+1,!1).then((s=>(s.news&&s.news.length?s.news.length>this.newsPerPage?(this.showLoadMoreButton=!0,s.news.pop(),this.updateNewsList(s.news,e)):(this.showLoadMoreButton=!1,this.updateNewsList(s.news,e)):e||(this.showLoadMoreButton=!1,this.newsList=[]),t?window.history.pushState("","News",this.setQueryParam("search",this.searchText)):window.history.pushState("","News",this.removeQueryParam("search")),this.$nextTick()))).catch((()=>this.loadingNews=!1)).finally((()=>{this.loadingNews=!1,this.initialized=!0}))},deleteNews(e){this.$newsServices.deleteNews(e.newsId,"drafts"===this.newsFilter,6).then((()=>{this.$root.$emit("confirm-news-deletion",e,this.isDraftsFilter)})),setTimeout((()=>{null!=localStorage.getItem("deletedNews")&&this.fetchNews(!1)}),8100)},loadMore:function(){this.fetchNews()},getQueryParam(e){const t=window.location.search.substring(1);return new URLSearchParams(t).get(e)},setQueryParam(e,t){const s=new URL(window.location);return s.searchParams.set(e,t),s.href},removeQueryParam(e){const t=new URL(window.location);return t.searchParams.delete(e),t.href}}},i,[],!1,null,null,null).exports;var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"sharedIn"},[t("span",{staticClass:"newsSpaceLabel"},[e._v(e._s(e.$t("news.app.sharedIn")))]),e._v(" "),t("div",{staticClass:"sharedInSpaces"},[e._l(e.sharedActivities.slice(0,2),(function(s,i){return t("a",{key:i,staticClass:"space",attrs:{target:"_blank"},on:{click:function(t){return e.openSharedInSpacesDrawer()}}},[t("img",{attrs:{src:s.spaceAvatar,title:s.spaceDisplayName,rel:"tooltip","data-placement":"top"}})])})),e._v(" "),e.activitiesList.length>2?t("a",{staticClass:"plusSpaces",attrs:{target:"_blank"},on:{click:function(t){return e.openSharedInSpacesDrawer()}}},[e._v("\n      +"+e._s(e.activitiesList.length-2)+"\n    ")]):e._e()],2)])};r._withStripped=!0;const l=a({props:{newsId:{type:String,default:""},activities:{type:String,default:""}},data(){return{sharedActivities:[],sharedInSpacesUpdated:!1,open:!1,maxDisplayedSpaces:2,activitiesList:this.activities.split(";").filter(((e,t)=>t>0&&e))}},watch:{activities(){this.activitiesList=this.activities.split(";").filter(((e,t)=>t>0&&e)),this.updateSharedInSpaces()}},created(){let e=this.activitiesList.slice();this.activitiesList.length>this.maxDisplayedSpaces&&(e=e.slice(0,this.maxDisplayedSpaces)),e.forEach((e=>{const t=e.split(":")[0];t&&this.$newsServices.getSpaceById(t).then((s=>{s.avatarUrl=s.avatarUrl?s.avatarUrl:"/eXoSkin/skin/images/system/SpaceAvtDefault.png",this.sharedActivities.push({spaceId:t,spaceAvatar:s.avatarUrl,spaceDisplayName:s.displayName,activityUrl:`${eXo.env.portal.context}/${eXo.env.portal.portalName}/activity?id=${e.split(":")[1]}`}),this.sharedActivities.sort(((e,t)=>e.spaceDisplayName.toLowerCase().localeCompare(t.spaceDisplayName.toLowerCase())))}))}))},methods:{openSharedInSpacesDrawer(){this.sharedInSpacesUpdated||this.updateSharedInSpaces(),this.$root.$emit("news-spaces-drawer-open",this.sharedActivities),this.open=!0},closeSharedInSpacesDrawer(){this.open=!1,document.body.style.overflow="auto"},updateSharedInSpaces(){this.sharedActivities=[],this.$newsServices.getNewsSpaces(this.newsId).then((e=>{this.activitiesList.forEach((t=>{const s=t.split(":")[0];s&&e.sharedInSpacesList.includes(s)&&this.$newsServices.getSpaceById(s).then((e=>{e&&(e.avatarUrl=e.avatarUrl?e.avatarUrl:"/eXoSkin/skin/images/system/SpaceAvtDefault.png",this.sharedActivities.push({spaceId:s,spaceAvatar:e.avatarUrl,spaceDisplayName:e.displayName,activityUrl:`${eXo.env.portal.context}/${eXo.env.portal.portalName}/activity?id=${t.split(":")[1]}`}),this.sharedActivities.sort(((e,t)=>e.spaceDisplayName.toLowerCase().localeCompare(t.spaceDisplayName.toLowerCase()))))}))})),this.sharedInSpacesUpdated=!0}))}}},r,[],!1,null,null,null).exports;var o=function(){var e=this,t=e._self._c;return t("v-app",{staticClass:"newsSpacesSharedInDrawer"},[t("exo-drawer",{ref:"newsSpacesSharedInDrawer",attrs:{"body-classes":"hide-scroll decrease-z-index-more",right:""}},[t("template",{slot:"title"},[e._v("\n      "+e._s(e.$t("news.app.sharedInSpaces"))+"\n    ")]),e._v(" "),t("template",{slot:"content"},[t("v-list",e._l(e.sharedActivities,(function(s){return t("v-list-item",{key:s,staticClass:"spaceSharedIn"},[t("v-list-item-avatar",[t("v-avatar",{staticClass:"rounded",attrs:{size:"28"}},[t("v-img",{attrs:{src:s.spaceAvatar,alt:s.spaceAvatar}})],1)],1),e._v(" "),t("v-list-item-content",{staticClass:"text-truncate"},[e._v("\n            "+e._s(s.spaceDisplayName)+"\n          ")]),e._v(" "),t("v-list-item-action",[t("v-btn",{staticClass:"btn text-capitalize",attrs:{href:s.activityUrl}},[e._v("\n              "+e._s(e.$t("news.app.viewArticle"))+"\n            ")])],1)],1)})),1)],1)],2)],1)};o._withStripped=!0;const c=a({data:()=>({sharedActivities:[]}),created(){this.$root.$on("news-spaces-drawer-open",(e=>{this.sharedActivities=e,this.open()}))},methods:{open(){this.$refs.newsSpacesSharedInDrawer&&this.$refs.newsSpacesSharedInDrawer.open()}}},o,[],!1,null,null,null).exports;var d=function(){var e=this,t=e._self._c;return t("exo-drawer",{ref:"newsSpacesFilters",attrs:{id:"newsSpacesFilters",right:""},on:{opened:function(t){e.drawer=!0},closed:function(t){e.drawer=!1}}},[t("template",{slot:"title"},[e._v("\n    "+e._s(e.$t("news.app.filter.label"))+"\n  ")]),e._v(" "),t("template",{slot:"content"},[t("news-filter-space-list",{ref:"filterSpaceList",staticClass:"me-4",model:{value:e.selectedOwnerIds,callback:function(t){e.selectedOwnerIds=t},expression:"selectedOwnerIds"}})],1)],2)};d._withStripped=!0;const h=a({props:{value:{type:Array,default:()=>[]}},data:()=>({drawer:!1,selectedOwnerIds:[]}),watch:{selectedOwnerIds(){this.applyFilters()}},created(){this.$root.$on("news-space-selector-drawer-open",this.open)},methods:{applyFilters(){this.value=this.selectedOwnerIds,this.$emit("input",this.value)},close(){this.$refs.newsSpacesFilters.close()},open(){this.$refs.newsSpacesFilters.open(),this.$nextTick().then((()=>{this.$refs.filterSpaceList.reset()}))}}},d,[],!1,null,null,null).exports;var p=function(){var e=this,t=e._self._c;return t("v-list-item",{staticClass:"px-0"},[t("v-list-item-content",{staticClass:"flex-grow-1 pa-0",attrs:{title:e.spaceDisplayName}},[t("v-checkbox",{staticClass:"newsCheckbox ms-4",attrs:{label:e.spaceDisplayName},on:{click:e.changeSelection},model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}})],1)],1)};p._withStripped=!0;const u=a({props:{space:{type:Object,default:null},spaceIds:{type:Array,default:()=>[]},selectedIds:{type:Array,default:()=>[]}},data:()=>({saving:!1,checked:!1}),computed:{selected(){return!1!==this.selectedIds&&(!this.selectedIds.length||this.selectedIds.find((e=>Number(e)===this.spaceId)))},spaceDisplayName(){return this.space.displayName},spaceId(){return Number(this.space.id)}},watch:{selected(){this.checked=this.selected}},mounted(){this.checked=this.selected},methods:{changeSelection(){if(this.selectedIds)if(this.selected){this.selectedIds&&!this.selectedIds.length&&(this.selectedIds=this.spaceIds.slice());const e=this.selectedIds.findIndex((e=>Number(e)===this.spaceId));e>=0&&(this.selectedIds.splice(e,1),this.selectedIds.length||(this.selectedIds=!1))}else this.selectedIds.push(this.space.id);else this.selected||(this.selectedIds=[this.space.id]);this.$emit("changeSelection",this.selectedIds)}}},p,[],!1,null,null,null).exports;var w=function(){var e=this,t=e._self._c;return t("v-list",[t("v-list-item",{staticClass:"px-0"},[t("v-list-item-action",{staticClass:"me-2 ms-4"},[t("v-checkbox",{staticClass:"ma-auto newsCheckbox",attrs:{indeterminate:e.partiallySelected,color:"primary"},on:{click:e.changeAllSelection},model:{value:e.selectAll,callback:function(t){e.selectAll=t},expression:"selectAll"}})],1),e._v(" "),t("v-list-item-content",[t("news-filter-space-search",{ref:"queryInput",staticClass:"mb-0 mt-1",model:{value:e.query,callback:function(t){e.query=t},expression:"query"}})],1),e._v(" "),t("v-list-item-action",{staticClass:"ms-2"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectionType,expression:"selectionType"}],staticClass:"width-auto my-auto subtitle-1 ignore-vuetify-classes",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.selectionType=t.target.multiple?s:s[0]}}},[t("option",{attrs:{value:"all"}},[e._v(e._s(e.$t("news.app.filter.drawer.all")))]),e._v(" "),t("option",{attrs:{value:"selected"}},[e._v(e._s(e.$t("news.app.filter.drawer.selected")))]),e._v(" "),t("option",{attrs:{value:"nonSelected"}},[e._v(e._s(e.$t("news.app.filter.drawer.nonSelected")))])])])],1),e._v(" "),e._l(e.filteredSpaces,(function(s){return t("news-filter-space-item",{key:s.id,attrs:{space:s,"space-ids":e.spaceIds,"selected-ids":e.value},on:{changeSelection:e.changeSelection}})})),e._v(" "),e.hasMore?t("v-flex",{staticClass:"d-flex my-4 border-box-sizing"},[t("v-btn",{staticClass:"btn mx-auto",attrs:{loading:e.loading,disabled:e.loading},on:{click:e.loadMore}},[e._v("\n      "+e._s(e.$t("news.app.filter.drawer.showMoreSpaces"))+"\n    ")])],1):e._e()],2)};w._withStripped=!0;const v=a({props:{value:{type:Array,default:()=>[]}},data:()=>({spaces:[],selectionType:"all",selectAll:!0,loading:!1,query:null,limit:20,pageSize:20,totalSize:0}),computed:{filteredSpaces(){return"selected"===this.selectionType?this.selectedSpaces:"nonSelected"===this.selectionType?this.unselectedSpaces:this.spaces},partiallySelected(){return this.value&&this.value.length&&(this.hasMore||this.spaceIds.length!==this.value.length)},hasMore(){return this.limit<this.totalSize},spaceIds(){return this.spaces&&this.spaces.filter((e=>e.id)).map((e=>Number(e.id)))||[]},selectedSpaces(){return!1===this.value?[]:!this.selectAll&&this.value&&this.value.length?this.spaces&&this.spaces.filter((e=>this.value.indexOf(Number(e.id))>=0))||[]:this.spaces},unselectedSpaces(){return this.spaces&&this.spaces.filter((e=>!this.selectedSpaces||!this.selectedSpaces.find((t=>t.id===e.id))))||[]}},watch:{limit(){this.retrieveSpaces()},query(){this.retrieveSpaces()},loading(){this.loading?this.$emit("start-loading"):this.$emit("end-loading")}},created(){this.retrieveSpaces()},methods:{reset(){this.spaces&&this.spaces.length||this.retrieveSpaces(),this.selectAll=!this.value||!this.value.length,window.setTimeout((()=>this.$refs.queryInput.$el.querySelector("input").focus()),200)},loadMore(){this.hasMore&&(this.limit+=this.pageSize)},changeAllSelection(){this.selectAll?this.checkAll():this.uncheckAll()},changeSelection(e){this.value&&1===this.value.length&&!e.length?this.uncheckAll():this.query||e.length!==this.spaceIds.length?(this.value=e,this.selectAll=!1,this.$emit("input",this.value)):this.checkAll()},checkAll(){this.query?(this.value=this.spaceIds.slice(),this.selectAll=!1):(this.value=[],this.selectAll=!0),this.$emit("input",this.value)},uncheckAll(){this.value=!1,this.selectAll=!1,this.$emit("input",this.value)},retrieveSpaces(){this.loading=!0,this.$spaceService.getSpaces(this.query,0,this.limit,"member","identity").then((e=>(this.spaces=e.spaces,this.totalSize=e.size||this.totalSize,this.$nextTick()))).then((e=>{e&&e.spaces?this.spaces=e.spaces:this.spaces=[],!1===this.value?this.uncheckAll():this.value&&this.value.length||(this.selectedSpaces=this.spaces.slice())})).then((e=>{e&&e.spaces&&(this.query?this.selectedSpaces=e.spaces.filter((e=>e.displayName.indexOf(this.query)>=0)):this.selectedSpaces=e.spaces)})).finally((()=>this.loading=!1))}}},w,[],!1,null,null,null).exports;var m=function(){var e=this,t=e._self._c;return t("v-scale-transition",[t("v-text-field",{staticClass:"pa-0 my-auto",attrs:{placeholder:e.$t("news.app.filter.bySpaces"),"append-icon":e.appendIcon,"prepend-inner-icon":"fa-filter"},on:{"click:append":function(t){e.query=null}},model:{value:e.query,callback:function(t){e.query=t},expression:"query"}})],1)};m._withStripped=!0;const f=a({props:{value:{type:Array,default:()=>[]}},data:()=>({startSearchAfterInMilliseconds:600,endTypingKeywordTimeout:50,startTypingKeywordTimeout:0,query:null,loading:!1}),computed:{appendIcon(){return this.query?"mdi-close primary--text":null}},watch:{query(){if(!this.query)return this.loading=!1,void this.$emit("input","");this.startTypingKeywordTimeout=Date.now(),this.loading||(this.loading=!0,this.waitForEndTyping())}},methods:{waitForEndTyping(){window.setTimeout((()=>{Date.now()-this.startTypingKeywordTimeout>this.startSearchAfterInMilliseconds?(this.loading=!1,this.$emit("input",this.query)):this.waitForEndTyping()}),this.endTypingKeywordTimeout)}}},m,[],!1,null,null,null).exports;var y=function(){var e=this,t=e._self._c;return t("v-menu",{staticClass:"px-0 mx-2",attrs:{attach:"",eager:"",bottom:"",left:"","offset-y":"","min-width":"108px"},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-btn",e._g(e._b({staticClass:"newsDetailsActionMenu pull-right",attrs:{icon:""}},"v-btn",i,!1),s),[t("v-icon",[e._v("mdi-dots-vertical")])],1)]}}]),model:{value:e.actionMenu,callback:function(t){e.actionMenu=t},expression:"actionMenu"}},[e._v(" "),t("v-list",[e.showEditButton?t("v-list-item",{on:{click:function(t){return e.$emit("edit")}}},[t("v-list-item-title",[e._v("\n        "+e._s(e.$t("news.details.header.menu.edit"))+"\n      ")])],1):e._e(),e._v(" "),e.showShareButton&&e.news.activityId?t("v-list-item",{on:{click:function(t){return e.$root.$emit("activity-share-drawer-open",e.news.activityId,"newsApp")}}},[t("v-list-item-title",[e._v("\n        "+e._s(e.$t("news.details.header.menu.share"))+"\n      ")])],1):e._e(),e._v(" "),e.showResumeButton?t("v-list-item",{on:{click:function(t){return e.$emit("edit")}}},[t("v-list-item-title",[e._v("\n        "+e._s(e.$t("news.details.header.menu.resume"))+"\n      ")])],1):e._e(),e._v(" "),e.showDeleteButton?t("v-list-item",{on:{click:function(t){return e.$emit("delete")}}},[t("v-list-item-title",[e._v("\n        "+e._s(e.$t("news.details.header.menu.delete"))+"\n      ")])],1):e._e()],1)],1)};y._withStripped=!0;const g=a({props:{news:{type:Object,required:!1,default:null},showShareButton:{type:Boolean,required:!1,default:!1},showEditButton:{type:Boolean,required:!1,default:!1},showResumeButton:{type:Boolean,required:!1,default:!1},showDeleteButton:{type:Boolean,required:!1,default:!1}},data:()=>({actionMenu:null}),created(){$(document).mousedown((()=>{this.actionMenu&&window.setTimeout((()=>{this.actionMenu=!1}),200)}))}},y,[],!1,null,null,null).exports;var _=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"newsAppItem"}},[t("a",{staticClass:"newsSmallIllustration",style:{"background-image":"url("+e.illustrationUrl+")"},attrs:{href:e.news.url,target:e.news.target}}),e._v(" "),t("div",{staticClass:"newsItemContent"},[t("div",{staticClass:"newsItemContentHeader"},[t("h3",[t("a",{attrs:{href:e.news.url,target:e.news.target}},[e._v(e._s(e.news.title)+" ")])]),e._v(" "),e.news.activities&&e.news.activities.split(";")[1]?t("news-spaces-shared-in",{attrs:{"news-id":e.news.newsId,activities:e.news.activities}}):e._e(),e._v(" "),e.news.schedulePostDate?e._e():t("exo-news-details-action-menu-app",{attrs:{news:e.news,"show-edit-button":e.news.canEdit&&!e.isDraftsFilter,"show-delete-button":e.news.canDelete,"show-share-button":e.showShareButton&&!e.isDraftsFilter,"show-resume-button":e.news.draft&&e.isDraftsFilter},on:{delete:e.deleteConfirmDialog,edit:function(t){return e.editLink(e.news)}}}),e._v(" "),t("exo-confirm-dialog",{ref:"deleteConfirmDialog",attrs:{message:e.confirmDeleteNewsDialogMessage,title:e.confirmDeleteNewsDialogTitle,"ok-label":e.$t("news.button.ok"),"cancel-label":e.$t("news.button.cancel")},on:{ok:function(t){return e.$emit("delete-news",e.news)}}})],1),e._v(" "),t("div",{staticClass:"newsInfo d-flex pb-1"},[t("div",{staticClass:"newsOwner d-flex align-center pe-4"},[t("exo-user-avatar",{staticClass:"align-center width-full my-auto text-truncate flex-grow-0 flex",attrs:{"profile-id":e.newsAuthor,size:25,"small-font-size":"",popover:""}}),e._v(" "),e.news.hiddenSpace?e._e():t("i",{staticClass:"uiIconArrowNext pt-1"}),e._v(" "),e.news.hiddenSpace?e._e():t("exo-space-avatar",{staticClass:"width-full text-truncate",attrs:{"space-id":e.spaceId,size:25,"extra-class":"ps-1","small-font-size":"",popover:""}})],1),e._v(" "),e.news.activityId?t("div",{staticClass:"newsDate pe-4"},[e.displayClock?t("i",{staticClass:"uiIconClock"}):e._e(),e._v(" "),e.news&&e.news.schedulePostDate?t("span",[t("date-format",{staticClass:"newsTime caption",attrs:{value:e.news.schedulePostDate,format:e.dateFormat}}),e._v("\n          -\n          "),t("date-format",{staticClass:"newsTime caption",attrs:{value:e.news.schedulePostDate,format:e.dateTimeFormat}})],1):t("span",[t("date-format",{staticClass:"newsTime caption",attrs:{value:e.news.updatedDate,format:e.dateFormat}})],1)]):e._e(),e._v(" "),!e.news.scheduled&&e.news.activityId?t("div",{staticClass:"newsViews"},[t("i",{staticClass:"uiIconWatch"}),e._v(" "),t("span",{staticClass:"viewsCount"},[e._v(e._s(e.news.viewsCount)+"  "+e._s(e.$t("news.app.views")))])]):e._e()]),e._v(" "),t("div",{staticClass:"newsItemContentDetails"},[t("a",{attrs:{href:e.news.url,target:e.news.target}},[t("p",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:e.news.newsText,expression:"news.newsText"}],staticClass:"newsSummary"})]),e._v(" "),e.news.draft?e._e():t("div",{staticClass:"newsActions"},[e.news.canArchive?t("exo-news-archive",{attrs:{"news-id":e.news.newsId,"news-archived":e.news.archived,"news-title":e.news.title,published:e.news.published},on:{"refresh-news-list":function(t){return e.$emit("update-news-list",!1)}}}):e._e()],1)])])])};_._withStripped=!0;const S=a({props:{news:{type:Object,required:!1,default:null},newsFilter:{type:String,required:!1,default:null},newsList:{type:Array,required:!1,default:null}},data:()=>({showShareButton:!0,dateTimeFormat:{hour:"2-digit",minute:"2-digit"},dateFormat:{year:"numeric",month:"long",day:"numeric"}}),computed:{isDraftsFilter(){return"drafts"===this.newsFilter},confirmDeleteNewsDialogMessage(){return this.isDraftsFilter?this.$t("news.message.confirmDeleteDraftNews"):this.$t("news.message.confirmDeleteNews")},confirmDeleteNewsDialogTitle(){return this.isDraftsFilter?this.$t("news.title.confirmDeleteDraftNews"):this.$t("news.title.confirmDeleteNews")},displayClock(){return this.news&&(this.news.schedulePostDate||this.news.updatedDate)},draftNews(){return this.news&&this.news.draft},spaceId(){return this.news&&this.news.spaceId},newsAuthor(){return this.news&&this.news.authorProfileURL&&this.news.authorProfileURL.split("/").pop()},illustrationUrl(){return this.news?.illustrationURL?this.news.illustrationURL.concat("&size=150x150").toString():"/news/images/news.png"}},methods:{editLink(e){const t=`${eXo.env.portal.context}/${eXo.env.portal.portalName}/news/editor?spaceId=${e.spaceId}&newsId=${e.newsId}&activityId=${e.activityId}`;window.open(t,"_blank")},deleteConfirmDialog(){this.$refs.deleteConfirmDialog.open()}}},_,[],!1,null,null,null).exports,x=eXo.env.portal.context||"",N=(eXo.env.portal.portalName,eXo.env.portal.containerName,eXo.env.portal.rest),I=`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/news`,C=(eXo.env.portal.context,eXo.env.portal.rest,`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/social/spaces`),T=`${eXo.env.portal.context}/${eXo.env.portal.rest}${eXo.env.portal.context}/social/spaces/suggest.json`,b=`${eXo.env.portal.context}/${eXo.env.portal.rest}/space/user/searchSpace/`,D=(eXo.env.portal.spaceId,window.location.host,eXo.env.portal.context,eXo.env.portal.userName);function A(e,t){return fetch(`${I}/${e}?editMode=${t||""}`,{credentials:"include",method:"GET"}).then((e=>e&&e.ok?e.json():401===e.status?e.status:void 0)).then((e=>e)).catch((e=>e))}function k(e){return fetch(`${I}/byActivity/${e}`,{credentials:"include",method:"GET"}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Response code indicates a server error",e)}))}function F(e){return fetch(`${I}/${e}?fields=spaces`,{credentials:"include",method:"GET"}).then((e=>e.json())).then((e=>e))}function L(e){return fetch(`${I}/markAsRead/${e}`,{credentials:"include",method:"POST"}).then((e=>{if(e&&e.ok)return e.text();throw new Error("Error while marking news as read")}))}function E(e,t,s,i,a,n){let r=`${I}?author=${D}&publicationState=published&filter=${e}`;return s&&(r+=`&text=${s}`),t&&(r+=`&spaces=${t}`),isNaN(i)||(r+=`&offset=${i}`),isNaN(a)||(r+=`&limit=${a}`),n&&(r+=`&returnSize=${n}`),fetch(r,{headers:{"Content-Type":"application/json"},method:"GET"}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Error getting news list")}))}function P(e){return fetch(`${I}`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify(e)}).then((e=>e.json()))}function X(e){return fetch(`${I}/schedule`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"PATCH",body:JSON.stringify(e)}).then((e=>e.json()))}function U(e){return fetch(e,{headers:{"Content-Type":"blob"},credentials:"include",method:"GET"})}function M(e,t){return fetch(`${I}/${e.id}?post=${t}`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"PUT",body:JSON.stringify(e)}).then((e=>e.json()))}function j(e){return fetch(`${I}/${e}/click`,{credentials:"include",method:"POST",body:"edit"})}function O(e){return fetch(`${T}?conditionToSearch=${e}&currentUser=${D}&typeOfRelation=confirmed`,{headers:{"Content-Type":"application/json"},method:"GET"}).then((e=>e.json())).then((e=>e.options))}function q(e){return fetch(`${I}/${e}`,{credentials:"include",method:"DELETE"})}function B(e){return fetch(`${C}/${e}`,{credentials:"include",method:"GET"}).then((t=>{if(t&&t.ok)return t.json();throw new Error(`Error getting space with id ${e}`)}))}function z(e,t,s){return fetch(`${C}?offset=${e}&limit=${t}&returnSize=true&filterType=${s}`,{credentials:"include",method:"GET"}).then((e=>e.json())).then((e=>e))}function R(e){return fetch(`${b}?fields=id,url,displayName,avatarUrl&keyword=${e}`,{headers:{"Content-Type":"application/json"},method:"GET"}).then((e=>e.json()))}function G(e,t,s){return fetch(`/portal/rest/managedocument/getFoldersAndFiles/?driveName=${e}&workspaceName=${t}&currentFolder=${s}`,{}).then((e=>e.text())).then((e=>(new window.DOMParser).parseFromString(e,"text/xml"))).then((e=>e))}function V(){return fetch("/portal/rest/wcmDriver/getDrivers",{}).then((e=>e.text())).then((e=>(new window.DOMParser).parseFromString(e,"text/xml"))).then((e=>e))}function Q(e){const t=document.createElement("div");return t.innerText=e,t.innerHTML}function H(e){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/news/canCreateNews/${eXo.env.portal.spaceId||e}`,{headers:{"Content-Type":"application/json"},method:"GET"}).then((e=>e&&e.ok&&e.json()))}function W(e){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/news/canScheduleNews/${eXo.env.portal.spaceId||e}`,{headers:{"Content-Type":"application/json"},method:"GET"}).then((e=>e&&e.ok&&e.json()))}function K(e,t,s){return s>0&&localStorage.setItem("deletedNews",e),fetch(`${I}/${e}?isDraft=${t||""}&delay=${s||0}`,{credentials:"include",method:"DELETE"}).then((e=>{if(e&&!e.ok)throw new Error("Error when deleting news")}))}function J(e){return fetch(`${I}/${e}/undoDelete`,{method:"POST",credentials:"include"}).then((e=>{if(!e||!e.ok)throw new Error("Error when undoing deleting news");localStorage.removeItem("deletedNews")}))}function Y(){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/news/canPublishNews?spaceId=${eXo.env.portal.spaceId}`,{headers:{"Content-Type":"application/json"},method:"GET"}).then((e=>e.json())).then((e=>e))}const Z={"news-app":n,"news-spaces-shared-in":l,"news-activity-sharing-spaces-drawer":c,"news-filter-space-drawer":h,"news-filter-space-item":u,"news-filter-space-list":v,"news-filter-space-search":f,"exo-news-details-action-menu-app":g,"news-app-item":S};for(const e in Z)Vue.component(e,Z[e]);Vue.prototype.$newsServices||window.Object.defineProperty(Vue.prototype,"$newsServices",{value:s}),Vue.use(Vuetify);const ee=new Vuetify(eXo.env.portal.vuetifyPreset);if(extensionRegistry){const e=extensionRegistry.loadComponents("News");e&&e.length>0&&e.forEach((e=>{Vue.component(e.componentName,e.componentOptions)}))}const te="undefined"!=typeof eXo?eXo.env.portal.language:"en",se=[`${x}/${N}/i18n/bundle/locale.portlet.news.News-${te}.json`,`${x}/${N}/i18n/bundle/locale.social.Webui-${te}.json`];function ie(){exoi18n.loadLanguageAsync(te,se).then((e=>{new Vue({template:'<news-app id="NewsApp"/>',i18n:e,vuetify:ee}).$mount("#NewsApp")}))}return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),t})()));