define((()=>(()=>{"use strict";var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:()=>_});var s={};e.r(s),e.d(s,{createTarget:()=>u,deleteTargetByName:()=>c,getAllTargets:()=>d,getAllowedTargets:()=>p,undoDeleteTarget:()=>h,updateTarget:()=>v});var i=function(){var e=this,t=e._self._c;return t("v-app",{staticClass:"newsTargetsAdminSettings"},[t("v-main",{staticClass:"white rounded-lg ma-5 px-7 pb-2"},[t("div",{staticClass:"white"},[t("div",{staticClass:"d-flex flex-row"},[t("h4",{staticClass:"py-5 font-weight-bold"},[e._v("\n          "+e._s(e.$t("newsTargets.settings.title"))+"\n        ")])]),e._v(" "),t("div",{staticClass:"d-flex flex-row pb-5"},[t("v-btn",{staticClass:"btn btn-primary",on:{click:e.openAddTargetDrawer}},[t("v-icon",{attrs:{dark:""}},[e._v("\n            mdi-plus\n          ")]),e._v(" "),t("span",{staticClass:"ms-2 d-none d-lg-inline"},[e._v("\n            "+e._s(e.$t("newsTargets.settings.button.addTarget"))+"\n          ")])],1)],1),e._v(" "),t("v-divider",{staticClass:"mt-5"}),e._v(" "),t("v-data-table",{attrs:{loading:e.loading,headers:e.headers,items:e.newsTargets,"items-per-page":e.itemsPerPage,"hide-default-footer":e.hideFooter,"footer-props":{itemsPerPageText:`${e.$t("newsTargets.settings.itemsPerPage")}:`},"loading-text":e.$t("newsTargets.settings.loadingResults"),"no-results-text":e.$t("newsTargets.settings.noResultsFound"),"no-data-text":e.$t("newsTargets.settings.noTargets"),"disable-sort":""},scopedSlots:e._u([{key:"item",fn:function(s){return[t("tr",[t("td",[t("div",{staticClass:"align-center text-truncate",attrs:{title:s.item.label}},[e._v("\n                "+e._s(e.$t(s.item.label))+"\n              ")])]),e._v(" "),t("td",[t("div",{staticClass:"align-center text-truncate",attrs:{title:s.item.description}},[e._v("\n                "+e._s(e.$t(s.item.description))+"\n              ")])]),e._v(" "),t("td",[s.item.permissions.length>0?t("div",{staticClass:"align-center text-truncate d-flex flex-column"},[t("div",{staticClass:"d-flex flex-row"},[t("div",{staticClass:"identitySuggester no-border mx-4"},[t("news-publish-targets-management-permissions",{attrs:{permission:s.item.permissions[0],close:!1}})],1),e._v(" "),s.item.permissions.length>1?t("span",{staticClass:"permissionsIcon font-weight-bold mt-5"},[e._v("\n                    +"+e._s(e.$t(s.item.permissions.length-1)))]):e._e()])]):e._e()]),e._v(" "),t("td",[t("div",{staticClass:"align-center"},[t("v-btn",{attrs:{icon:"",text:""},on:{click:function(t){return e.openDrawer(s.item.name,s.item.description,s.item.permissions)}}},[t("v-icon",{attrs:{dark:"",color:"primary",size:"16"}},[e._v("\n                    fas fa-pen\n                  ")])],1),e._v(" "),t("v-btn",{attrs:{icon:"",text:""},on:{click:function(t){return e.deleteConfirmDialog(s.item.name)}}},[t("v-icon",{attrs:{dark:"",color:"primary",size:"16"}},[e._v("\n                    fas fa-trash\n                  ")])],1)],1)])])]}}])})],1),e._v(" "),t("exo-confirm-dialog",{ref:"deleteConfirmDialog",attrs:{message:e.$t("news.newsTarget.message.confirmDeleteNews"),title:e.$t("news.newsTarget.title.confirmDeleteNews"),"ok-label":e.$t("news.button.ok"),"cancel-label":e.$t("news.button.cancel")},on:{ok:function(t){return e.deleteNewsTarget(e.selectedTargetName)}}}),e._v(" "),t("news-publish-targets-management-drawer",{ref:"newsPublishTargetsManagementDrawer",on:{"news-target-saved":e.init}}),e._v(" "),t("exo-news-notification-alerts")],1)],1)};function r(e,t,s,i,r,a,n,o){var l,g="function"==typeof e?e.options:e;if(t&&(g.render=t,g.staticRenderFns=s,g._compiled=!0),i&&(g.functional=!0),a&&(g._scopeId="data-v-"+a),n?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(n)},g._ssrRegister=l):r&&(l=o?function(){r.call(this,(g.functional?this.parent:this).$root.$options.shadowRoot)}:r),l)if(g.functional){g._injectStyles=l;var m=g.render;g.render=function(e,t){return l.call(t),m(e,t)}}else{var d=g.beforeCreate;g.beforeCreate=d?[].concat(d,l):[l]}return{exports:e,options:g}}i._withStripped=!0;const a=r({data:()=>({targetPermissions:[],headers:[],newsTargets:[],permissions:[],itemsPerPage:10,initialized:!1,loading:!0,selectedTargetName:""}),computed:{hideFooter(){return this.newsTargets&&this.newsTargets.length<=this.itemsPerPage}},mounted(){document.dispatchEvent(new CustomEvent("hideTopBarLoading"))},created(){this.headers=[{text:this.$t("newsTargets.settings.name"),align:"center"},{text:this.$t("newsTargets.settings.description"),align:"center"},{text:this.$t("news.publishTargets.managementDrawer.permissions"),align:"center"},{text:this.$t("newsTargets.settings.actions"),align:"center"}],this.init()},methods:{init(){this.initialized||(this.loading=!0,this.$newsTargetingService.getAllTargets().then((e=>{this.newsTargets=e.map((e=>({name:e.name,label:e.properties.label,description:e.properties.description,permissions:e.permissions||[]}))),this.initialized=!0})).finally((()=>{this.initialized||this.$root.$applicationLoaded(),this.loading=!1,this.initialized=!1})))},deleteNewsTarget(e){this.$newsTargetingService.deleteTargetByName(e,6).then((()=>{this.$root.$emit("confirm-newsTarget-deletion",e)})),setTimeout((()=>{null!=localStorage.getItem("deletedNewsTarget")&&this.init()}),8100)},deleteConfirmDialog(e){this.selectedTargetName=e,this.$refs.deleteConfirmDialog.open()},openDrawer(e,t,s){let i=null;i={targetName:e&&e.trim(),targetDescription:t&&t.trim(),targetPermissions:s},this.$root.$emit("selected-target",i),this.$refs.newsPublishTargetsManagementDrawer.open()},openAddTargetDrawer(){this.$refs.newsPublishTargetsManagementDrawer.open()}}},i,[],!1,null,null,null).exports;var n=function(){var e=this,t=e._self._c;return t("exo-drawer",{ref:"newsPublishTargetsManagementDrawer",attrs:{id:"newsPublishTargetsManagementDrawer","body-classes":"hide-scroll decrease-z-index-more",right:""},on:{closed:e.reset}},["creationMode"===e.saveMode?t("template",{slot:"title"},[e._v("\n    "+e._s(e.$t("news.publishTargets.management.addTarget"))+"\n  ")]):t("template",{slot:"title"},[e._v("\n    "+e._s(e.$t("news.publishTargets.management.editTarget"))+"\n  ")]),e._v(" "),t("template",{slot:"content"},[t("v-form",{ref:"activityShareFrom",staticClass:"flex mx-4",attrs:{flat:""}},[t("div",{staticClass:"d-flex flex-column flex-grow-1"},[t("div",{staticClass:"d-flex flex-row mt-6 mb-1"},[t("label",{staticClass:"text-subtitle-1 font-weight-bold"},[e._v("\n            "+e._s(e.$t("news.publishTargets.managementDrawer.name"))+"*\n          ")])]),e._v(" "),t("div",{staticClass:"d-flex flex-row"},[t("v-text-field",{ref:"targetName",staticClass:"targetName input-block-level ignore-vuetify-classes",attrs:{id:"targetName",type:"string",name:"newsHeader",placeholder:e.$t("news.publishTargets.managementDrawer.placeholder.name"),"error-messages":e.checkAlphanumeric,maxlength:"100",counter:"",required:"",outlined:"",dense:""},model:{value:e.targetName,callback:function(t){e.targetName=t},expression:"targetName"}})],1),e._v(" "),t("div",{staticClass:"d-flex flex-row mt-6"},[t("label",{staticClass:"text-subtitle-1 font-weight-bold"},[e._v("\n            "+e._s(e.$t("news.publishTargets.managementDrawer.description"))+"\n          ")])]),e._v(" "),t("div",{staticClass:"d-flex flex-row"},[t("extended-textarea",{ref:"targetDescription",staticClass:"targetDescription pt-0",attrs:{id:"targetDescription",placeholder:e.$t("news.publishTargets.managementDrawer.placeholder.description"),"max-length":e.targetDescriptionTextLength},model:{value:e.targetDescription,callback:function(t){e.targetDescription=t},expression:"targetDescription"}})],1),e._v(" "),e.sameTargetError?t("div",{staticClass:"d-flex flex-row mt-4"},[t("v-icon",{staticClass:"warning--text"},[e._v("warning")]),e._v(" "),t("span",{staticClass:"ms-2 grey--text"},[e._v("\n            "+e._s(e.$t("news.publishTargets.managementDrawer.sameNewsTargetWarning"))+"\n          ")])],1):e._e(),e._v(" "),t("div",{staticClass:"d-flex flex-row mt-6"},[t("label",{staticClass:"text-subtitle-1 font-weight-bold"},[e._v("\n            "+e._s(e.$t("news.publishTargets.managementDrawer.permissions"))+"*\n            "),e.isMobile?e._e():t("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:i}){return[t("v-icon",e._g(e._b({staticClass:"px-2 iconStyle",attrs:{color:"grey darken-2",dark:"",size:"16"}},"v-icon",i,!1),s),[e._v("\n                  fa-info-circle\n                ")])]}}],null,!1,4037312523)},[e._v(" "),t("span",[e._v("\n                "+e._s(e.$t("news.publishTargets.managementDrawer.permissions.tooltip"))+"\n              ")])])],1)]),e._v(" "),t("div",{staticClass:"d-flex flex-row"},[t("span",{staticClass:"text-subtitle-6 font-weight-regular"},[e._v("\n            "+e._s(e.$t("news.publishTargets.managementDrawer.permissions.description"))+"\n          ")])]),e._v(" "),t("div",{staticClass:"d-flex flex-row"},[t("exo-identity-suggester",{ref:"targetPermissions",attrs:{labels:e.suggesterLabels,name:"permissions",height:"40","ignore-items":e.ignoredItems,"group-member":e.userGroup,"group-type":e.groupType,"all-groups-for-admin":e.allGroupsForAdmin,"include-spaces":"","include-groups":"",required:""},model:{value:e.targetPermissions,callback:function(t){e.targetPermissions=t},expression:"targetPermissions"}})],1)])]),e._v(" "),e.permissions.length>0?t("div",{staticClass:"identitySuggester no-border mx-4"},e._l(e.permissions,(function(s){return t("news-publish-targets-management-permissions",{key:s,attrs:{permission:s,close:!0},on:{"remove-permission":e.removePermission}})})),1):e._e()],1),e._v(" "),t("template",{slot:"footer"},[t("div",{staticClass:"d-flex justify-end"},[t("v-btn",{staticClass:"btn ms-2",on:{click:e.closeDrawer}},[e._v("\n        "+e._s(e.$t("news.publishTargets.managementDrawer.btn.cancel"))+"\n      ")]),e._v(" "),t("v-btn",{staticClass:"btn btn-primary ms-2",attrs:{disabled:e.saving||e.disabled,loading:e.saving},on:{click:e.saveTarget}},[e._v("\n        "+e._s(e.saveButtonLabel)+"\n      ")])],1)])],2)};n._withStripped=!0;const o=r({data:()=>({targetPermissions:[],allGroupsForAdmin:!0,userGroup:"/platform/users",groupType:"GROUP",drawer:!1,saving:!1,targetDescriptionTextLength:1e3,targetDescription:"",targetName:"",sameTargetError:!1,selectedTarget:"",originalTargetName:"",saveMode:"creationMode",permissions:[],permissionsUpdated:!1}),computed:{ignoredItems(){return this.permissions.map((e=>`${e.providerId}:${e.remoteId}`))},suggesterLabels(){return{placeholder:this.$t("news.publishTargets.managementDrawer.placeholder.permissions"),noDataLabel:this.$t("news.publishTargets.managementDrawer.permissions.noData")}},checkAlphanumeric(){return this.targetName&&!this.targetName.trim().match(/^[a-zA-Z\u00C0-\u00FF ]*$/)&&this.targetName.length>0?this.$t("news.list.settings.name.errorMessage"):""},disabled(){return this.selectedTarget.targetName===this.targetName&&this.selectedTarget.targetDescription===this.targetDescription&&!this.permissionsUpdated||""!==this.checkAlphanumeric||0===this.targetName.length||0===this.permissions.length||this.sameTargetError||void 0!==this.targetDescription&&this.targetDescription.length>this.targetDescriptionTextLength},saveButtonLabel(){return"edit"===this.saveMode?this.$t("news.publishTargets.managementDrawer.btn.update"):this.$t("news.publishTargets.managementDrawer.btn.confirm")},isMobile(){return"xs"===this.$vuetify.breakpoint.name||"sm"===this.$vuetify.breakpoint.name}},watch:{targetPermissions(){this.targetPermissions?(this.permissions.find((e=>e.remoteId===this.targetPermissions.remoteId&&e.providerId===this.targetPermissions.providerId))||(this.permissions.push(this.mapPermission(this.targetPermissions)),this.permissionsUpdated=!0),this.targetPermissions=null):this.$nextTick(this.$refs.targetPermissions.$refs.selectAutoComplete.deleteCurrentItem)},saving(){this.saving?this.$refs.newsPublishTargetsManagementDrawer.startLoading():this.$refs.newsPublishTargetsManagementDrawer.endLoading()},targetName(e,t){this.sameTargetError=e&&e.length>0&&t.length>0&&e===t}},created(){this.$root.$on("selected-target",(e=>{this.selectedTarget=e,this.originalTargetName=e.targetName,this.targetName=e.targetName,this.targetDescription=e.targetDescription,this.permissions=JSON.parse(JSON.stringify(e.targetPermissions)),this.targetName===e.targetName&&this.targetDescription===e.targetDescription&&(this.sameTargetError=!0),this.saveMode="edit"}))},methods:{removePermission(e){const t=this.permissions.findIndex((t=>e.remoteId===t.remoteId&&e.providerId===t.providerId));t>=0&&(this.permissions.splice(t,1),this.permissionsUpdated=!0)},mapPermission(e){const t=e.profile&&e.profile.fullName&&e.profile.fullName.substring(0,e.profile.fullName.lastIndexOf(" ("));return{id:"space"===e.providerId?`space:${e.spaceId}`:e.spaceId,profile:{fullName:t},name:e.displayName||t,remoteId:e.remoteId,providerId:e.providerId,avatar:e.profile.avatarUrl}},open(){this.$refs.newsPublishTargetsManagementDrawer.open()},closeDrawer(){this.$refs.newsPublishTargetsManagementDrawer.close(),this.reset()},saveTarget(){"edit"===this.saveMode?this.updateNewsTarget():this.createTarget()},createTarget(){this.saving=!0;const e={name:"",properties:""};let t="";this.permissions.length>0&&this.permissions.forEach((e=>{t=`${t+e.id},`})),e.name=this.targetName,e.properties={description:this.targetDescription,label:this.targetName,permissions:t},this.sameTargetError=!1,this.$newsTargetingService.createTarget(e).then((e=>{e&&200===e?(this.$emit("news-target-saved"),this.reset(),this.closeDrawer()):e&&409===e&&(this.sameTargetError=!0,this.disabled=!0,this.saving=!1)})).finally((()=>this.saving=!1))},updateNewsTarget(){this.saving=!0;const e={name:"",type:"",properties:""};let t="";this.permissions.length>0&&this.permissions.forEach((e=>{t=`${t+e.id},`})),e.name=this.targetName,e.properties={description:this.targetDescription,label:this.targetName,permissions:t},this.$newsTargetingService.updateTarget(e,this.originalTargetName).then((e=>{e&&200===e&&(this.$emit("news-target-saved"),this.reset(),this.closeDrawer())})).finally((()=>this.saving=!1))},reset(){this.targetDescription="",this.targetName="",this.saveMode="creationMode",this.permissions=[],this.permissionsUpdated=!1}}},n,[],!1,null,null,null).exports;var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-flex"},[t("v-chip",{staticClass:"identitySuggesterItem mt-2",attrs:{close:e.close},on:{"click:close":function(t){return e.$emit("remove-permission",e.permission)}}},["group"===e.permission.providerId?t("v-icon",{staticClass:"fas fa-users",attrs:{size:"19",color:"white"}}):t("v-avatar",{staticClass:"ma-0",attrs:{size:"32"}},[t("img",{staticClass:"object-fit-cover ma-auto",attrs:{src:e.avatarUrl,alt:e.displayName,loading:"lazy",role:"presentation"}})]),e._v(" "),e.displayName||e.$slots.subTitle?t("div",{staticClass:"ms-2 overflow-hidden"},[e.displayName?t("p",{staticClass:"text-truncate subtitle-2 text-left mb-0 font-weight-bold"},[e._v("\n        "+e._s(e.displayName)+"\n      ")]):e._e()]):e._e()],1)],1)};l._withStripped=!0;const g={"news-publish-targets-management":a,"news-publish-targets-management-drawer":o,"news-publish-targets-management-permissions":r({props:{permission:{type:Object,default:()=>({})},close:{type:Boolean,default:!1}},computed:{avatarUrl(){const e=this.permission&&(this.permission.profile||this.permission.space);return e&&(e.avatarUrl||e.avatar)||this.permission&&this.permission.avatar},displayName(){const e=this.permission&&(this.permission.profile||this.permission.space);return e&&(e.displayName||e.fullName&&e.fullName.substring(0,e.fullName.lastIndexOf(" (")))||this.permission&&(this.permission.name||this.permission.displayName)}}},l,[],!1,null,null,null).exports};for(const e in g)Vue.component(e,g[e]);eXo.env.portal.context,eXo.env.portal.portalName,eXo.env.portal.containerName,eXo.env.portal.rest;const m=`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/news`;function d(){return fetch(`${m}/targeting`,{credentials:"include",method:"GET"}).then((e=>{if(e&&e.ok)return e.json()}))}function p(){return fetch(`${m}/targeting/allowed`,{credentials:"include",method:"GET"}).then((e=>{if(e&&e.ok)return e.json()}))}function c(e,t){return t>0&&localStorage.setItem("deletedNewsTarget",e),fetch(`${m}/targeting/${e}?delay=${t||0}`,{credentials:"include",method:"DELETE"}).then((e=>{if(e&&!e.ok)throw new Error("Error when deleting news target")}))}function h(e){return fetch(`${m}/targeting/${e}/undoDelete`,{method:"POST",credentials:"include"}).then((e=>{if(!e||!e.ok)throw new Error("Error when undoing deleting news target");localStorage.removeItem("deletedNewsTarget")}))}function u(e){return fetch(`${m}/targeting`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{if(e&&e.ok)return e.status;if(409===e.status)return e.status;throw new Error("Error when creating news target")}))}function v(e,t){return fetch(`${m}/targeting/${t}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{if(e&&e.ok)return e.status;throw new Error("Error when updating news target")}))}if(eXo.env.portal.context,eXo.env.portal.rest,eXo.env.portal.context,eXo.env.portal.rest,eXo.env.portal.context,eXo.env.portal.rest,eXo.env.portal.context,eXo.env.portal.context,eXo.env.portal.rest,eXo.env.portal.spaceId,window.location.host,eXo.env.portal.context,eXo.env.portal.userName,Vue.prototype.$newsTargetingService||window.Object.defineProperty(Vue.prototype,"$newsTargetingService",{value:s}),extensionRegistry){const e=extensionRegistry.loadComponents("newsPublishTargetsManagement");e&&e.length>0&&e.forEach((e=>{Vue.component(e.componentName,e.componentOptions)}))}Vue.use(Vuetify);const f=new Vuetify(eXo.env.portal.vuetifyPreset);document.dispatchEvent(new CustomEvent("displayTopBarLoading"));const w="newsPublishTargetsManagement",b=eXo&&eXo.env&&eXo.env.portal.language||"en",T=`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.portlet.news.News-${b}.json`;function _(){exoi18n.loadLanguageAsync(b,T).then((e=>{new Vue({template:`<news-publish-targets-management id="${w}" />`,vuetify:f,i18n:e}).$mount(`#${w}`)}))}return t})()));