define((()=>(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:()=>H});var n={};e.r(n),e.d(n,{canPublishNews:()=>L,canScheduleNews:()=>V,canUserCreateNews:()=>B,clickOnEditButton:()=>X,deleteDraft:()=>j,deleteNews:()=>P,escapeHTML:()=>U,fetchFoldersAndFiles:()=>F,findUserSpaces:()=>I,getDrivers:()=>R,getNews:()=>_,getNewsByActivityId:()=>T,getNewsById:()=>$,getNewsSpaces:()=>x,getSpaceById:()=>k,getUserSpaces:()=>A,importFileFromUrl:()=>N,markNewsAsRead:()=>S,saveNews:()=>C,scheduleNews:()=>b,searchSpaces:()=>O,undoDeleteNews:()=>D,updateNews:()=>E});var o=function(){var e=this,t=e._self._c;return e.loading?t("v-progress-circular",{attrs:{size:"24",color:"primary",indeterminate:""}}):e.content?t("div",[t("a",{attrs:{href:e.contentUrl}},[e._v(e._s(e.contentTitle))])]):t("div",{staticClass:"d-flex"},[t("i",{staticClass:"uiIconColorError my-auto",attrs:{title:e.$t("analytics.errorRetrievingDataForValue",{0:e.value})}}),e._v(" "),t("span",{staticClass:"text-no-wrap text-sub-title my-auto ml-1"},[e._v("\n    "+e._s(e.$t("analytics.deletedContent"))+"\n  ")])])};function i(e,t,n,o,i,s,r,a){var l,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=n,c._compiled=!0),o&&(c.functional=!0),s&&(c._scopeId="data-v-"+s),r?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(r)},c._ssrRegister=l):i&&(l=a?function(){i.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:i),l)if(c.functional){c._injectStyles=l;var p=c.render;c.render=function(e,t){return l.call(t),p(e,t)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,l):[l]}return{exports:e,options:c}}o._withStripped=!0;const s=i({props:{value:{type:Object,default:function(){return null}}},data:()=>({loading:!0,content:null}),computed:{contentTitle(){return this.content&&this.content.title},contentUrl(){return this.content&&this.content.url}},created(){this.value&&(this.loading=!0,this.$newsServices.getNewsById(this.value).then((e=>{this.content=e,this.$forceUpdate()})).finally((()=>this.loading=!1)))}},o,[],!1,null,null,null).exports;var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"text--secondary"},[e.contentTitle?t("a",{staticClass:"text-truncate",attrs:{title:e.contentTitle,href:e.contentUrl,rel:"nofollow",target:"_blank"}},[e._v("\n  "+e._s(e.contentTitle)+"\n  ")]):e._e(),e._v(" "),t("p",[e._v("\n  ("+e._s(e.attrValue)+")\n  ")])])};r._withStripped=!0;const a=i({props:{attrValue:{type:String,default:""}},data:()=>({content:null}),computed:{contentTitle(){return this.content&&this.content.title},contentUrl(){return this.content&&this.content.url}},created(){this.attrValue&&(this.loading=!0,this.$newsServices.getNewsById(this.attrValue).then((e=>{this.content=e,this.$forceUpdate()})).finally((()=>this.loading=!1)))}},r,[],!1,null,null,null).exports;var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"action"},[e.displayButton?t("v-btn",{staticClass:"ps-0",attrs:{href:e.link,color:"primary",target:"_blank",link:"",text:""},on:{click:e.switchToNews}},[t("v-icon",{attrs:{size:"12"}},[e._v("fas fa-pencil-alt fa-sm")]),e._v(" "),t("span",{staticClass:"ms-1 font-weight-bold text-decoration-underline text-capitalize-first-letter"},[e._v("\n      "+e._s(e.$t("news.composer.switch.article"))+"\n    ")])],1):e._e()],1)};l._withStripped=!0;const c=i({props:{activityId:{type:String,default:null},message:{type:String,default:null},maxMessageLength:{type:Number,default:0},templateParams:{type:Object,default:null},files:{type:Array,default:null},activityType:{type:Array,default:null}},computed:{link(){const e=`${eXo.env.portal.context}/${eXo.env.portal.portalName}/news/editor`;return eXo.env.portal.spaceId?`${e}?spaceId=${eXo.env.portal.spaceId}`:e},displayButton(){return this.message&&this.message.length>this.maxMessageLength&&this.activityType&&0===this.activityType.length}},methods:{switchToNews(){localStorage.setItem("exo-activity-composer-message",this.message||""),localStorage.setItem("exo-activity-composer-attachments",JSON.stringify(this.files||[]))}}},l,[],!1,null,null,null).exports;var p=function(){var e=this,t=e._self._c;return t("div",{staticClass:"actionItem",attrs:{title:e.disableComposerButtonTooltip},on:{click:e.switchToNews}},[e._m(0),e._v(" "),t("div",{staticClass:"actionItemDescription"},[t("div",{staticClass:"actionLabel"},[e._v(e._s(e.$t("news.composer.write")))]),e._v(" "),t("div",{staticClass:"actionDescription"},[t("p",[e._v(e._s(e.$t("news.composer.write.description")))])])])])};p._withStripped=!0;const d={props:{activityId:{type:String,default:null},message:{type:String,default:null},maxMessageLength:{type:Number,default:0},templateParams:{type:Object,default:null},files:{type:Array,default:null},activityType:{type:Array,default:null}},computed:{disableComposerButton(){return this.activityType&&0!==this.activityType.length},disableComposerButtonTooltip(){return this.disableComposerButton?this.$t("news.composer.write.disable"):""}},watch:{disableComposerButton(e){e?document.getElementsByClassName("actionItem")[1].setAttribute("style","opacity: 0.5"):document.getElementsByClassName("actionItem")[1].removeAttribute("style")}},methods:{switchToNews(){if(!this.disableComposerButton){let e=`${eXo.env.portal.context}/${eXo.env.portal.portalName}/news/editor`;eXo.env.portal.spaceId&&(e+=`?spaceId=${eXo.env.portal.spaceId}`),localStorage.setItem("exo-activity-composer-message",this.message||""),localStorage.setItem("exo-activity-composer-attachments",JSON.stringify(this.files||[])),window.open(e,"_blank")}}}},u=i(d,p,[function(){var e=this._self._c;return e("div",{staticClass:"actionItemIcon"},[e("div",{staticClass:"newsComposerIcon"})])}],!1,null,null,null).exports;var h=function(){var e=this,t=e._self._c;return t("v-list-item",{staticClass:"clickable",attrs:{href:e.url}},[t("v-list-item-icon",{staticClass:"me-3 my-auto"},[t("v-avatar",{attrs:{tile:"",size:"25"}},[e.news.illustrationURL?t("img",{attrs:{alt:e.activityTitle,src:`${e.news.illustrationURL}&size=25x25`}}):t("img",{attrs:{alt:e.activityTitle,src:"/news/images/news.png"}})])],1),e._v(" "),t("v-list-item-content",[t("v-list-item-title",{staticClass:"text-color body-2"},[e._v(e._s(e.activityTitle))])],1),e._v(" "),t("v-list-item-action",[t("favorite-button",{attrs:{id:e.id,favorite:e.isFavorite,top:e.top,right:e.right,type:"news","type-label":"News"},on:{removed:e.removed,"remove-error":e.removeError}})],1)],1)};h._withStripped=!0;const v={"analytics-table-cell-content-value":s,"analytics-sample-item-content":a,"activity-switch-to-news":c,"activity-write-news":u,"news-favorite-item":i({props:{id:{type:String,default:()=>null}},data:()=>({activityTitle:"",url:"",isFavorite:!0}),created(){this.$newsServices.getNewsById(this.id,!1).then((e=>{this.activityTitle=e.title,this.url=e.url,this.news=e}))},methods:{removed(){this.isFavorite=!this.isFavorite,this.displayAlert(this.$t("Favorite.tooltip.SuccessfullyDeletedFavorite",{0:this.$t("news.label")})),this.$emit("removed"),this.$root.$emit("refresh-favorite-list")},removeError(){this.displayAlert(this.$t("Favorite.tooltip.ErrorDeletingFavorite",{0:this.$t("news.label")}),"error")},displayAlert(e,t){this.$root.$emit("news-notification-alert",{activityId:this.id,message:e,type:t||"success"})}}},h,[],!1,null,null,null).exports};for(const e in v)Vue.component(e,v[e]);eXo.env.portal.context,eXo.env.portal.portalName,eXo.env.portal.containerName,eXo.env.portal.rest;const m=`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/news`,y=(eXo.env.portal.context,eXo.env.portal.rest,`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/social/spaces`),f=`${eXo.env.portal.context}/${eXo.env.portal.rest}${eXo.env.portal.context}/social/spaces/suggest.json`,w=`${eXo.env.portal.context}/${eXo.env.portal.rest}/space/user/searchSpace/`,g=(eXo.env.portal.spaceId,window.location.host,eXo.env.portal.context,eXo.env.portal.userName);function $(e,t){return fetch(`${m}/${e}?editMode=${t||""}`,{credentials:"include",method:"GET"}).then((e=>e&&e.ok?e.json():401===e.status?e.status:void 0)).then((e=>e)).catch((e=>e))}function T(e){return fetch(`${m}/byActivity/${e}`,{credentials:"include",method:"GET"}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Response code indicates a server error",e)}))}function x(e){return fetch(`${m}/${e}?fields=spaces`,{credentials:"include",method:"GET"}).then((e=>e.json())).then((e=>e))}function S(e){return fetch(`${m}/markAsRead/${e}`,{credentials:"include",method:"POST"}).then((e=>{if(e&&e.ok)return e.text();throw new Error("Error while marking news as read")}))}function _(e,t,n,o,i,s){let r=`${m}?author=${g}&publicationState=published&filter=${e}`;return n&&(r+=`&text=${n}`),t&&(r+=`&spaces=${t}`),isNaN(o)||(r+=`&offset=${o}`),isNaN(i)||(r+=`&limit=${i}`),s&&(r+=`&returnSize=${s}`),fetch(r,{headers:{"Content-Type":"application/json"},method:"GET"}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Error getting news list")}))}function C(e){return fetch(`${m}`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify(e)}).then((e=>e.json()))}function b(e){return fetch(`${m}/schedule`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"PATCH",body:JSON.stringify(e)}).then((e=>e.json()))}function N(e){return fetch(e,{headers:{"Content-Type":"blob"},credentials:"include",method:"GET"})}function E(e,t){return fetch(`${m}/${e.id}?post=${t}`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"PUT",body:JSON.stringify(e)}).then((e=>e.json()))}function X(e){return fetch(`${m}/${e}/click`,{credentials:"include",method:"POST",body:"edit"})}function I(e){return fetch(`${f}?conditionToSearch=${e}&currentUser=${g}&typeOfRelation=confirmed`,{headers:{"Content-Type":"application/json"},method:"GET"}).then((e=>e.json())).then((e=>e.options))}function j(e){return fetch(`${m}/${e}`,{credentials:"include",method:"DELETE"})}function k(e){return fetch(`${y}/${e}`,{credentials:"include",method:"GET"}).then((t=>{if(t&&t.ok)return t.json();throw new Error(`Error getting space with id ${e}`)}))}function A(e,t,n){return fetch(`${y}?offset=${e}&limit=${t}&returnSize=true&filterType=${n}`,{credentials:"include",method:"GET"}).then((e=>e.json())).then((e=>e))}function O(e){return fetch(`${w}?fields=id,url,displayName,avatarUrl&keyword=${e}`,{headers:{"Content-Type":"application/json"},method:"GET"}).then((e=>e.json()))}function F(e,t,n){return fetch(`/portal/rest/managedocument/getFoldersAndFiles/?driveName=${e}&workspaceName=${t}&currentFolder=${n}`,{}).then((e=>e.text())).then((e=>(new window.DOMParser).parseFromString(e,"text/xml"))).then((e=>e))}function R(){return fetch("/portal/rest/wcmDriver/getDrivers",{}).then((e=>e.text())).then((e=>(new window.DOMParser).parseFromString(e,"text/xml"))).then((e=>e))}function U(e){const t=document.createElement("div");return t.innerText=e,t.innerHTML}function B(e){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/news/canCreateNews/${eXo.env.portal.spaceId||e}`,{headers:{"Content-Type":"application/json"},method:"GET"}).then((e=>e&&e.ok&&e.json()))}function V(e){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/news/canScheduleNews/${eXo.env.portal.spaceId||e}`,{headers:{"Content-Type":"application/json"},method:"GET"}).then((e=>e&&e.ok&&e.json()))}function P(e,t,n){return n>0&&localStorage.setItem("deletedNews",e),fetch(`${m}/${e}?isDraft=${t||""}&delay=${n||0}`,{credentials:"include",method:"DELETE"}).then((e=>{if(e&&!e.ok)throw new Error("Error when deleting news")}))}function D(e){return fetch(`${m}/${e}/undoDelete`,{method:"POST",credentials:"include"}).then((e=>{if(!e||!e.ok)throw new Error("Error when undoing deleting news");localStorage.removeItem("deletedNews")}))}function L(){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/news/canPublishNews?spaceId=${eXo.env.portal.spaceId}`,{headers:{"Content-Type":"application/json"},method:"GET"}).then((e=>e.json())).then((e=>e))}const G={name:"News",getExtendedComponent:(e,t)=>{if(e&&t)return{component:Vue.options.components["exo-news-details-activity"],overrideHeader:!0,overrideFooter:!1}},extendSharedActivity:(e,t)=>t,showSharedInformationFooter:(e,t)=>t,init:(e,t)=>{let n=e.id;if(e.parentActivity&&(n=e.parentActivity.id),!e.news||t)return Vue.prototype.$newsServices.getNewsByActivityId(n).then((t=>e.news=t))},canEdit:()=>!1,canShare:()=>!0,hideOnDelete:!0,supportsThumbnail:!0,windowTitlePrefixKey:"news.window.title",getThumbnail:e=>e&&e.news&&e.news.illustrationURL&&`${e.news.illustrationURL}&size=305x285`||"/news/images/news.png",getThumbnailProperties:e=>!(e&&e.news&&e.news.illustrationURL)&&{height:"90px",width:"90px",noBorder:!0}||null,isUseSameViewForMobile:e=>!e||!e.news||!e.news.illustrationURL,getTitle:e=>{const t=e&&e.news;return t&&t.title?t.title:""},getSourceLink:e=>`${eXo.env.portal.context}/${eXo.env.portal.portalName}/activity?id=${e.parentActivity?e.parentActivity.id:e.id}`,getSummary:e=>{const t=e&&e.news;return t&&t.summary?t.summary:t&&t.body?Vue.prototype.$utils.htmlToText(t.body):""},getTooltip:(e,t)=>!t&&e&&"news.activity.clickToShowDetail"},M=eXo.env.portal.language||"en",z=`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.portlet.news.News-${M}.json`,J=exoi18n.loadLanguageAsync(M,z).then((e=>new Vue({i18n:e})));function H(){eXo.env.portal.spaceId&&""!==eXo.env.portal.spaceId&&B(eXo.env.portal.spaceId).then((e=>{if(e)return J.then((()=>{extensionRegistry.registerComponent("ActivityComposerAction","activity-composer-action",{id:"switchNewsButton",vueComponent:Vue.options.components["activity-switch-to-news"],rank:10}),extensionRegistry.registerComponent("ActivityComposerFooterAction","activity-composer-footer-action",{id:"writeNewsButton",vueComponent:Vue.options.components["activity-write-news"],rank:30})}))})),extensionRegistry.registerExtension("activity","type",{type:"news",options:G}),extensionRegistry.registerExtension("AnalyticsTable","CellValue",{type:"news",options:{rank:60,vueComponent:Vue.options.components["analytics-table-cell-content-value"],match:(e,t)=>"contentId.keyword"===e&&"TERMS"===t}}),extensionRegistry.registerExtension("AnalyticsSamples","SampleItem",{type:"news",options:{rank:30,vueComponent:Vue.options.components["analytics-sample-item-content"],match:e=>"contentId"===e}}),extensionRegistry.registerComponent("favorite-news","favorite-drawer-item",{id:"news",vueComponent:Vue.options.components["news-favorite-item"]})}return Vue.prototype.$newsServices||window.Object.defineProperty(Vue.prototype,"$newsServices",{value:n}),t})()));