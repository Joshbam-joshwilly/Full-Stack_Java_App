((ea,fa)=>{"object"===typeof exports?module.exports=fa():"function"===typeof define&&define.amd?define([],fa):(ea.org=ea.org||{},ea.org.cometd=fa())})(this,()=>{function ea(){let t=0;const m={};this.register=q=>{const d=++t;m[d]=q;return d};this.unregister=q=>{const d=m[q];delete m[q];return d};this.setTimeout=(q,d)=>window.setTimeout(q,d);this.clearTimeout=q=>{window.clearTimeout(q)}}function fa(){const t={};self.onmessage=m=>{const q=m.data;m=t[q.id];switch(q.type){case "setTimeout":t[q.id]=self.setTimeout(()=>
{delete t[q.id];self.postMessage({id:q.id})},q.delay);break;case "clearTimeout":delete t[q.id];m&&self.clearTimeout(m);break;default:throw"Unknown command "+q.type;}}}function Oa(){let t=[],m={};this.getTransportTypes=()=>t.slice(0);this.findTransportTypes=(q,d,h)=>{const u=[];for(let n=0;n<t.length;++n){const x=t[n];!0===m[x].accept(q,d,h)&&u.push(x)}return u};this.negotiateTransport=(q,d,h,u)=>{for(let n=0;n<t.length;++n){const x=t[n];for(let v=0;v<q.length;++v)if(x===q[v]){const E=m[x];if(!0===
E.accept(d,h,u))return E}}return null};this.add=(q,d,h)=>{let u=!1;for(let n=0;n<t.length;++n)if(t[n]===q){u=!0;break}u||("number"!==typeof h?t.push(q):t.splice(h,0,q),m[q]=d);return!u};this.find=q=>{for(let d=0;d<t.length;++d)if(t[d]===q)return m[q];return null};this.remove=q=>{for(var d=0;d<t.length;++d)if(t[d]===q)return t.splice(d,1),d=m[q],delete m[q],d;return null};this.clear=()=>{t=[];m={}};this.reset=q=>{for(let d=0;d<t.length;++d)m[t[d]].reset(q)}}function W(){let t,m,q;this.registered=(d,
h)=>{t=d;m=h};this.unregistered=()=>{m=t=null};this._notifyTransportTimeout=function(d){const h=m._getTransportListeners("timeout");if(h)for(let u=0;u<h.length;++u){const n=h[u];try{const x=n.call(this,d);if("number"===typeof x&&0<x)return x}catch(x){this._info("Exception during execution of transport listener",n,x)}}return 0};this._debug=function(){m._debug.apply(m,arguments)};this._info=function(){m._info.apply(m,arguments)};this._mixin=function(){return m._mixin.apply(m,arguments)};this.getConfiguration=
()=>m.getConfiguration();this.getAdvice=()=>m.getAdvice();this.setTimeout=(d,h)=>m.setTimeout(d,h);this.clearTimeout=d=>{m.clearTimeout(d)};this.convertToJSON=function(d){const h=this.getConfiguration().maxSendBayeuxMessageSize;let u="[";for(let n=0;n<d.length;++n){0<n&&(u+=",");const x=JSON.stringify(d[n]);if(x.length>h)throw"maxSendBayeuxMessageSize "+h+" exceeded";u+=x}return u+"]"};this.convertToMessages=function(d){if(T.isString(d))try{return JSON.parse(d)}catch(h){throw this._debug("Could not convert to JSON the following string",
'"'+d+'"'),h;}if(Array.isArray(d))return d;if(void 0===d||null===d)return[];if(d instanceof Object)return[d];throw"Conversion Error "+d+", typeof "+typeof d;};this.accept=(d,h,u)=>{throw"Abstract";};this.getType=()=>t;this.getURL=()=>q;this.setURL=d=>{q=d};this.send=(d,h)=>{throw"Abstract";};this.reset=function(d){this._debug("Transport",t,"reset",d?"initial":"retry")};this.abort=function(){this._debug("Transport",t,"aborted")};this.toString=function(){return this.getType()}}function qa(){function t(l){for(;0<
C.length;){var p=C[0];const z=p[0];p=p[1];if(z.url===l.url&&z.sync===l.sync)C.shift(),l.messages=l.messages.concat(z.messages),this._debug("Coalesced",z.messages.length,"messages from request",p.id);else break}}function m(l,p,z){const F=this._notifyTransportTimeout(l.messages);if(0<F)this._debug("Transport",this.getType(),"extended waiting for message replies of request",p.id,":",F,"ms"),p.timeout=this.setTimeout(()=>{m.call(this,l,p,z+F)},F);else{p.expired=!0;const G="Transport "+this.getType()+
" expired waiting for message replies of request "+p.id+": "+z+" ms",O={reason:G},f=p.xhr;O.httpCode=this.xhrStatus(f);this.abortXHR(f);this._debug(G);this.complete(p,!1,p.metaConnect);l.onFailure(f,l.messages,O)}}function q(l,p){if(this.transportSend(l,p)&&(p.expired=!1,!l.sync)){let z=this.getConfiguration().maxNetworkDelay;!0===p.metaConnect&&(z+=this.getAdvice().timeout);this._debug("Transport",this.getType(),"started waiting for message replies of request",p.id,":",z,"ms");p.timeout=this.setTimeout(()=>
{m.call(this,l,p,z)},z)}}function d(l){const p=++x,z={id:p,metaConnect:!1,envelope:l};E.length<this.getConfiguration().maxConnections-1?(E.push(z),q.call(this,l,z)):(this._debug("Transport",this.getType(),"queueing request",p,"envelope",l),C.push([l,z]))}function h(l,p){var z=E.indexOf(l);0<=z&&E.splice(z,1);if(0<C.length){z=C.shift();const F=z[0],G=z[1];this._debug("Transport dequeued request",G.id);p?(this.getConfiguration().autoBatch&&t.call(this,F),d.call(this,F),this._debug("Transport completed request",
l.id,F)):this.setTimeout(()=>{this.complete(G,!1,G.metaConnect);const O={reason:"Previous request failed"},f=G.xhr;O.httpCode=this.xhrStatus(f);F.onFailure(f,F.messages,O)},0)}}const u=new W,n=W.derive(u);let x=0,v=null,E=[],C=[];n.complete=function(l,p,z){if(z){l=l.id;this._debug("Transport",this.getType(),"/meta/connect complete, request",l);if(null!==v&&v.id!==l)throw"/meta/connect request mismatch, completing request "+l;v=null}else h.call(this,l,p)};n.transportSend=(l,p)=>{throw"Abstract";};
n.transportSuccess=function(l,p,z){if(!p.expired)if(this.clearTimeout(p.timeout),this._debug("Transport",this.getType(),"cancelled waiting for message replies"),this.complete(p,!0,p.metaConnect),z&&0<z.length)l.onSuccess(z);else l.onFailure(p.xhr,l.messages,{httpCode:204})};n.transportFailure=function(l,p,z){p.expired||(this.clearTimeout(p.timeout),this._debug("Transport",this.getType(),"cancelled waiting for failed message replies"),this.complete(p,!1,p.metaConnect),l.onFailure(p.xhr,l.messages,
z))};n.send=function(l,p){if(p){if(null!==v)throw"Concurrent /meta/connect requests not allowed, request id="+v.id+" not yet completed";p=++x;this._debug("Transport",this.getType(),"/meta/connect send, request",p,"envelope",l);p={id:p,metaConnect:!0,envelope:l};q.call(this,l,p);v=p}else d.call(this,l)};n.abort=function(){u.abort();for(var l=0;l<E.length;++l){const p=E[l];p&&(this._debug("Aborting request",p),this.abortXHR(p.xhr)||this.transportFailure(p.envelope,p,{reason:"abort"}))}if(l=v)this._debug("Aborting /meta/connect request",
l),this.abortXHR(l.xhr)||this.transportFailure(l.envelope,l,{reason:"abort"});this.reset(!0)};n.reset=l=>{u.reset(l);v=null;E=[];C=[]};n.abortXHR=function(l){if(l)try{const p=l.readyState;l.abort();return p!==window.XMLHttpRequest.UNSENT}catch(p){this._debug(p)}return!1};n.xhrStatus=function(l){if(l)try{return l.status}catch(p){this._debug(p)}return-1};return n}function ya(){const t=new qa,m=W.derive(t);let q=!0;m.accept=(d,h,u)=>q||!h;m.newXMLHttpRequest=()=>new window.XMLHttpRequest;m.xhrSend=d=>
{const h=m.newXMLHttpRequest();try{h.context=m.context}catch(n){m._debug("Could not copy transport context into XHR",n)}h.withCredentials=!0;h.open("POST",d.url,!0!==d.sync);const u=d.headers;if(u)for(let n in u)u.hasOwnProperty(n)&&h.setRequestHeader(n,u[n]);h.setRequestHeader("Content-Type","application/json;charset=UTF-8");h.onload=()=>{if(200===h.status)d.onSuccess(h.responseText);else d.onError(h.statusText)};h.onabort=h.onerror=()=>{d.onError(h.statusText)};h.send(d.body);return h};m.transportSend=
function(d,h){this._debug("Transport",this.getType(),"sending request",h.id,"envelope",d);try{let u=!0;h.xhr=this.xhrSend({transport:this,url:d.url,sync:d.sync,headers:this.getConfiguration().requestHeaders,body:this.convertToJSON(d.messages),onSuccess:n=>{this._debug("Transport",this.getType(),"received response",n);let x=!1;try{const v=this.convertToMessages(n);0===v.length?(q=!1,this.transportFailure(d,h,{httpCode:204})):(x=!0,this.transportSuccess(d,h,v))}catch(v){this._debug(v),x||(q=!1,n={exception:v},
n.httpCode=this.xhrStatus(h.xhr),this.transportFailure(d,h,n))}},onError:(n,x)=>{this._debug("Transport",this.getType(),"received error",n,x);q=!1;const v={reason:n,exception:x};v.httpCode=this.xhrStatus(h.xhr);u?this.setTimeout(()=>{this.transportFailure(d,h,v)},0):this.transportFailure(d,h,v)}});u=!1;return!0}catch(u){return this._debug("Transport",this.getType(),"exception:",u),q=!1,this.setTimeout(()=>{this.transportFailure(d,h,{exception:u})},0),!1}};m.reset=d=>{t.reset(d);q=!0};return m}function za(){function t(d,
h,u){return()=>{this.transportFailure(d,h,"error",u)}}var m=new qa;m=W.derive(m);let q=0;m.accept=(d,h,u)=>!0;m.jsonpSend=d=>{const h=document.getElementsByTagName("head")[0],u=document.createElement("script"),n="_cometd_jsonp_"+q++;window[n]=v=>{h.removeChild(u);delete window[n];d.onSuccess(v)};let x=d.url;x+=0>x.indexOf("?")?"?":"&";x=x+("jsonp="+n)+("&message="+encodeURIComponent(d.body));u.src=x;u.async=!0!==d.sync;u.type="application/javascript";u.onerror=v=>{d.onError("jsonp "+v.type)};h.appendChild(u)};
m.transportSend=function(d,h){for(var u=0,n=d.messages.length,x=[];0<n;){var v=JSON.stringify(d.messages.slice(u,u+n));v=d.url.length+encodeURI(v).length;var E=this.getConfiguration().maxURILength;if(v>E){if(1===n){x="Bayeux message too big ("+v+" bytes, max is "+E+") for transport "+this.getType();this.setTimeout(t.call(this,d,h,x),0);return}--n}else x.push(n),u+=n,n=d.messages.length-u}let C=d;if(1<x.length)for(u=0,n=x[0],this._debug("Transport",this.getType(),"split",d.messages.length,"messages into",
x.join(" + ")),C=this._mixin(!1,{},d),C.messages=d.messages.slice(u,n),C.onSuccess=d.onSuccess,C.onFailure=d.onFailure,v=1;v<x.length;++v)E=this._mixin(!1,{},d),u=n,n+=x[v],E.messages=d.messages.slice(u,n),E.onSuccess=d.onSuccess,E.onFailure=d.onFailure,this.send(E,h.metaConnect);this._debug("Transport",this.getType(),"sending request",h.id,"envelope",C);try{let l=!0;this.jsonpSend({transport:this,url:C.url,sync:C.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(C.messages),
onSuccess:p=>{let z=!1;try{const F=this.convertToMessages(p);0===F.length?this.transportFailure(C,h,{httpCode:204}):(z=!0,this.transportSuccess(C,h,F))}catch(F){this._debug(F),z||this.transportFailure(C,h,{exception:F})}},onError:(p,z)=>{const F={reason:p,exception:z};l?this.setTimeout(()=>{this.transportFailure(C,h,F)},0):this.transportFailure(C,h,F)}});l=!1;return!0}catch(l){return this.setTimeout(()=>{this.transportFailure(C,h,{exception:l})},0),!1}};return m}function Aa(){function t(f,r){f&&(this.webSocketClose(f,
r.code,r.reason),this.onClose(f,r))}function m(f,r,y){const A=[];for(let B=0;B<r.messages.length;++B){const H=r.messages[B];H.id&&A.push(H.id)}f.envelopes[A.join(",")]=[r,y];this._debug("Transport",this.getType(),"stored envelope, envelopes",f.envelopes)}function q(f,r){let y=!1;f=f.envelopes;for(let H=0;H<r.length;++H){var A=r[H];for(let M in f)if(f.hasOwnProperty(M)){const Y=M.split(",");var B=Y.indexOf(A);if(0<=B){y=!0;Y.splice(B,1);A=f[M][0];B=f[M][1];delete f[M];0<Y.length&&(f[Y.join(",")]=[A,
B]);break}}}y&&this._debug("Transport",this.getType(),"removed envelope, envelopes",f)}function d(f){if(!F){var r=E.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",r);try{const B=E.getConfiguration().protocol;f.webSocket=B?new window.WebSocket(r,B):new window.WebSocket(r);F=f}catch(B){throw C=!1,this._debug("Exception while creating WebSocket object",B),B;}p=!1!==E.getConfiguration().stickyReconnect;var y=E.getConfiguration().connectTimeout;0<y&&(f.connectTimer=
this.setTimeout(()=>{E._debug("Transport",this.getType(),"timed out while connecting to URL",r,":",y,"ms");t.call(this,f,{code:1E3,reason:"Connect Timeout"})},y));var A=B=>{B=B||{code:1E3};E._debug("WebSocket onclose",f,B,"connecting",F,"current",z);f.connectTimer&&this.clearTimeout(f.connectTimer);this.onClose(f,B)};f.webSocket.onopen=()=>{E._debug("WebSocket onopen",f);f.connectTimer&&this.clearTimeout(f.connectTimer);f===F||f===z?(F=null,z=f,l=!0,this.onOpen(f)):(E._warn("Closing extra WebSocket connection",
this,"active connection",z),t.call(this,f,{code:1E3,reason:"Extra Connection"}))};f.webSocket.onclose=A;f.webSocket.onerror=()=>{A({code:1E3,reason:"Error"})};f.webSocket.onmessage=B=>{E._debug("WebSocket onmessage",B,f);this.onMessage(f,B)};this._debug("Transport",this.getType(),"configured callbacks on",f)}}function h(f,r,y){const A=this._notifyTransportTimeout([r]);0<A?(this._debug("Transport",this.getType(),"extended waiting for message replies:",A,"ms"),f.timeouts[r.id]=this.setTimeout(()=>{h.call(this,
f,r,y+A)},A)):(this._debug("Transport",this.getType(),"expired waiting for message reply",r.id,":",y,"ms"),t.call(this,f,{code:1E3,reason:"Message Timeout"}))}function u(f,r,y){try{var A=this.convertToJSON(r.messages)}catch(H){this._debug("Transport",this.getType(),"exception:",H);y=[];for(A=0;A<r.messages.length;++A)y.push(r.messages[A].id);q.call(this,f,y);this.setTimeout(()=>{this._notifyFailure(r.onFailure,f,r.messages,{exception:H})},0);return}f.webSocket.send(A);this._debug("Transport",this.getType(),
"sent",r,"/meta/connect =",y);let B=this.getConfiguration().maxNetworkDelay;y&&(B+=this.getAdvice().timeout,G=!0);y=[];for(A=0;A<r.messages.length;++A){const H=r.messages[A];H.id&&(y.push(H.id),f.timeouts[H.id]=this.setTimeout(()=>{h.call(this,f,H,B)},B))}this._debug("Transport",this.getType(),"started waiting for message replies",B,"ms, messageIds:",y,", timeouts:",f.timeouts)}function n(f,r,y){try{null===f?(f=F||{envelopes:{},timeouts:{}},m.call(this,f,r,y),d.call(this,f)):(m.call(this,f,r,y),u.call(this,
f,r,y))}catch(A){this.setTimeout(()=>{t.call(this,f,{code:1E3,reason:"Exception",exception:A})},0)}}const x=new W,v=W.derive(x);let E,C=!0,l=!1,p=!0,z=null,F=null,G=!1,O=null;v.reset=f=>{x.reset(f);C=!0;f&&(l=!1);p=!0;f&&(z=null);F=null;G=!1};v._notifySuccess=function(f,r){f.call(this,r)};v._notifyFailure=function(f,r,y,A){f.call(this,r,y,A)};v.onOpen=function(f){const r=f.envelopes;this._debug("Transport",this.getType(),"opened",f,"pending messages",r);for(let A in r)if(r.hasOwnProperty(A)){var y=
r[A];const B=y[0];y=y[1];O=B.onSuccess;u.call(this,f,B,y)}};v.onMessage=function(f,r){this._debug("Transport",this.getType(),"received websocket message",r,f);let y=!1;r=this.convertToMessages(r.data);const A=[];for(let B=0;B<r.length;++B){const H=r[B];if((/^\/meta\//.test(H.channel)||void 0===H.data)&&H.id){A.push(H.id);const M=f.timeouts[H.id];M&&(this.clearTimeout(M),delete f.timeouts[H.id],this._debug("Transport",this.getType(),"removed timeout for message",H.id,", timeouts",f.timeouts))}"/meta/connect"===
H.channel&&(G=!1);"/meta/disconnect"!==H.channel||G||(y=!0)}q.call(this,f,A);this._notifySuccess(O,r);y&&this.webSocketClose(f,1E3,"Disconnect")};v.onClose=function(f,r){this._debug("Transport",this.getType(),"closed",f,r);if(f===F||f===z)C=p&&l,z=F=null;var y=f.timeouts;f.timeouts={};for(var A in y)y.hasOwnProperty(A)&&this.clearTimeout(y[A]);y=f.envelopes;f.envelopes={};for(let B in y)if(y.hasOwnProperty(B)){A=y[B][0];y[B][1]&&(G=!1);const H={websocketCode:r.code,reason:r.reason};r.exception&&(H.exception=
r.exception);this._notifyFailure(A.onFailure,f,A.messages,H)}};v.registered=(f,r)=>{x.registered(f,r);E=r};v.accept=function(f,r,y){this._debug("Transport",this.getType(),"accept, supported:",C);return C&&!!window.WebSocket&&!1!==E.websocketEnabled};v.send=function(f,r){this._debug("Transport",this.getType(),"sending",f,"/meta/connect =",r);n.call(this,z,f,r)};v.webSocketClose=function(f,r,y){try{f.webSocket&&f.webSocket.close(r,y)}catch(A){this._debug(A)}};v.abort=function(){x.abort();t.call(this,
z,{code:1E3,reason:"Abort"});this.reset(!0)};return v}const T={isString:t=>void 0===t||null===t?!1:"string"===typeof t||t instanceof String};W.derive=t=>{function m(){}m.prototype=t;return new m};const ra="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ.-:+=^!/*?&<>()[]{}@%$#".split(""),Pa=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,
16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0];return{CometD:function(t){function m(a,b){try{return a[b]}catch(c){}}function q(a){if(!T.isString(a)||2>a.length||"/"!==a.charAt(0))return!1;for(let c=1;c<a.length;++c){const e=a.charAt(c);var b="A"<=e&&"Z">=e?!0:"a"<=e&&"z">=e;if(!(b=b||"0"<=e&&"9">=e))a:switch(e){case " ":case "!":case "#":case "$":case "(":case ")":case "*":case "+":case "-":case ".":case "/":case "@":case "_":case "{":case "~":case "}":b=!0;break a;default:b=
!1}if(!b)return!1}return!0}function d(a){return void 0===a||null===a?!1:"function"===typeof a}function h(a,b){let c="";for(;0<--b&&!(a>=Math.pow(10,b));)c+="0";return c+a}function u(a,b){if(window.console&&(a=window.console[a],d(a))){const c=new Date;[].splice.call(b,0,0,h(c.getHours(),2)+":"+h(c.getMinutes(),2)+":"+h(c.getSeconds(),2)+"."+h(c.getMilliseconds(),3));a.apply(window.console,b)}}function n(a){return RegExp("(^https?://)?(((\\[[^\\]]+])|([^:/?#]+))(:(\\d+))?)?([^?#]*)(.*)?").exec(a)}function x(a){k._debug("Configuring cometd object with",
a);T.isString(a)&&(a={url:a});a||={};J=k._mixin(!1,J,a);a=k.getURL();if(!a)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var b=n(a);a=b[8];var c=b[9];la=k._isCrossDomain(b[2]);J.appendMessageTypeToURL&&(void 0!==c&&0<c.length?(k._info("Appending message type to URI "+a+c+" is not supported, disabling 'appendMessageTypeToURL' configuration"),J.appendMessageTypeToURL=!1):(b=a.split("/"),c=b.length-1,a.match(/\/$/)&&--c,0<=b[c].indexOf(".")&&(k._info("Appending message type to URI "+
a+" is not supported, disabling 'appendMessageTypeToURL' configuration"),J.appendMessageTypeToURL=!1)));if(window.Worker&&window.Blob&&window.URL&&J.useWorkerScheduler){a=fa.toString();a=a.substring(a.indexOf("{")+1,a.lastIndexOf("}"));a=new window.Blob([a],{type:"application/json"});a=window.URL.createObjectURL(a);const e=new window.Worker(a);Z.setTimeout=(g,w)=>{g=Z.register(g);e.postMessage({id:g,type:"setTimeout",delay:w});return g};Z.clearTimeout=g=>{Z.unregister(g);e.postMessage({id:g,type:"clearTimeout"})};
e.onmessage=g=>{(g=Z.unregister(g.data.id))&&g()}}}function v(a){if(a){const b=R[a.channel];b&&b[a.id]&&(delete b[a.id],k._debug("Removed",a.listener?"listener":"subscription",a))}}function E(){for(let b in R)if(R.hasOwnProperty(b)){const c=R[b];if(c)for(let e in c)if(c.hasOwnProperty(e)){var a=c[e];a&&!a.listener&&v(a)}}}function C(a){X!==a&&(k._debug("Status",X,"->",a),X=a)}function l(){return"disconnecting"===X||"disconnected"===X}function p(a,b,c,e,g){try{return b.call(a,e)}catch(w){a=k.onExtensionException;
if(d(a)){k._debug("Invoking extension exception handler",c,w);try{a.call(k,w,c,g,e)}catch(D){k._info("Exception during execution of extension exception handler",c,D)}}else k._info("Exception during execution of extension",c,w);return e}}function z(a){for(let c=N.length-1;0<=c&&void 0!==a&&null!==a;--c){var b=N[c];const e=b.extension.outgoing;d(e)&&(b=p(b.extension,e,b.name,a,!0),a=void 0===b?a:b)}return a}function F(a,b){if(a=R[a])for(let c in a)if(a.hasOwnProperty(c)){const e=a[c];if(e)try{e.callback.call(e.scope,
b)}catch(g){const w=k.onListenerException;if(d(w)){k._debug("Invoking listener exception handler",e,g);try{w.call(k,g,e,e.listener,b)}catch(D){k._info("Exception during execution of listener exception handler",e,D)}}else k._info("Exception during execution of listener",e,b,g)}}}function G(a,b){F(a,b);a=a.split("/");const c=a.length-1;for(let e=c;0<e;--e){let g=a.slice(0,e).join("/")+"/*";e===c&&F(g,b);g+="*";F(g,b)}}function O(a,b){null!==aa&&k.clearTimeout(aa);aa=null;b=L.interval+b;k._debug("Function scheduled in",
b,"ms, interval =",L.interval,"backoff =",P,a);aa=k.setTimeout(a,b)}function f(a,b,c){for(var e=0;e<a.length;++e){let g=a[e];const w=g.id;ba&&(g.clientId=ba);g=z(g);void 0!==g&&null!==g?(g.id=w,a[e]=g):(delete ma[w],a.splice(e--,1))}0!==a.length&&(b&&(ha=a[0]),e=k.getURL(),J.appendMessageTypeToURL&&(e.match(/\/$/)||(e+="/"),c&&(e+=c)),a={url:e,sync:!1,messages:a,onSuccess:g=>{try{Ba.call(k,g)}catch(w){k._info("Exception during handling of messages",w)}},onFailure:(g,w,D)=>{try{const K=k.getTransport();
D.connectionType=K?K.getType():"unknown";sa.call(k,g,w,D)}catch(K){k._info("Exception during handling of failure",K)}}},k._debug("Send",a),I.send(a,b))}function r(a){0<U||!0===ia?ca.push(a):f([a],!1)}function y(){const a=ca;ca=[];0<a.length&&f(a,!1)}function A(a){C("connecting");O(()=>{if(!l()){const b={id:""+ ++V,channel:"/meta/connect",connectionType:I.getType()};na||(b.advice={timeout:0});C("connecting");k._debug("Connect sent",b);f([b],!0,"connect");C("connected")}},a)}function B(a){a&&(L=k._mixin(!1,
{},J.advice,a),k._debug("New advice",L))}function H(a){null!==aa&&k.clearTimeout(aa);aa=null;a&&I&&I.abort();la=!1;I=null;C("disconnected");ba=null;P=U=0;na=ta=!1;ja=0;ha=null;0<ca.length&&(a=ca,ca=[],sa.call(k,void 0,a,{reason:"Disconnected"}))}function M(a,b,c){const e=k.onTransportException;if(d(e)){k._debug("Invoking transport exception handler",a,b,c);try{e.call(k,c,a,b)}catch(g){k._info("Exception during execution of transport exception handler",g)}}}function Y(a,b){d(a)&&(b=a,a=void 0);ba=
null;E();l()&&Q.reset(!0);B({});U=0;ia=!0;ua=a;Ca=b;a=k.getURL();const c=Q.findTransportTypes("1.0",la,a);var e={id:""+ ++V,version:"1.0",minimumVersion:"1.0",channel:"/meta/handshake",supportedConnectionTypes:c,advice:{timeout:L.timeout,interval:L.interval}};e=k._mixin(!1,{},ua,e);k._putCallback(e.id,b);if(!I&&(I=Q.negotiateTransport(c,"1.0",la,a),!I))throw b="Could not find initial transport among: "+Q.getTransportTypes(),k._warn(b),b;k._debug("Initial transport is",I.getType());C("handshaking");
k._debug("Handshake sent",e);f([e],!1,"handshake")}function Qa(a){C("handshaking");ia=!0;O(()=>{Y(ua,Ca)},a)}function oa(a,b){try{a.call(k,b)}catch(c){if(a=k.onCallbackException,d(a)){k._debug("Invoking callback exception handler",c);try{a.call(k,c,b)}catch(e){k._info("Exception during execution of callback exception handler",e)}}else k._info("Exception during execution of message callback",c)}}function S(a){const b=k._getCallback([a.id]);d(b)&&(delete ma[a.id],oa(b,a))}function Da(a){var b=va[a.id];
delete va[a.id];if(b){k._debug("Handling remote call response for",a,"with context",b);const c=b.timeout;c&&k.clearTimeout(c);b=b.callback;if(d(b))return oa(b,a),!0}return!1}function Ea(a){k._debug("Transport failure handling",a);a.transport&&(I=a.transport);a.url&&I.setURL(a.url);const b=a.action;a=a.delay||0;switch(b){case "handshake":Qa(a);break;case "retry":A(a);break;case "none":H(!0);break;default:throw"Unknown action "+b;}}function wa(a,b){S(a);G("/meta/handshake",a);G("/meta/unsuccessful",
a);l()&&(b.action="none");k.onTransportFailure.call(k,a,b,Ea)}function Fa(a){return"disconnected"===X?!0:ha&&ha.id===a.id?(ha=null,!0):!1}function Ga(a,b){G("/meta/connect",a);G("/meta/unsuccessful",a);l()&&(b.action="none");k.onTransportFailure.call(k,a,b,Ea)}function Ha(a){H(!0);S(a);G("/meta/disconnect",a);G("/meta/unsuccessful",a)}function Ia(a){const b=R[a.subscription];if(b)for(let c in b)if(b.hasOwnProperty(c)){const e=b[c];e&&!e.listener&&(delete b[c],k._debug("Removed failed subscription",
e))}S(a);G("/meta/subscribe",a);G("/meta/unsuccessful",a)}function Ja(a){S(a);G("/meta/unsubscribe",a);G("/meta/unsuccessful",a)}function xa(a){Da(a)||(S(a),G("/meta/publish",a),G("/meta/unsuccessful",a))}function Ka(a){ja=0;for(var b=0;b<N.length&&void 0!==a&&null!==a;++b){var c=N[b];const e=c.extension.incoming;d(e)&&(c=p(c.extension,e,c.name,a,!1),a=void 0===c?a:c)}if(void 0!==a&&null!==a)switch(B(a.advice),a.channel){case "/meta/handshake":b=k.getURL();if(a.successful)if(c=k._isCrossDomain(n(b)[2]),
b=Q.negotiateTransport(a.supportedConnectionTypes,a.version,c,b),null===b)a.successful=!1,wa(a,{cause:"negotiation",action:"none",transport:null});else switch(I!==b&&(k._debug("Transport",I.getType(),"->",b.getType()),I=b),ba=a.clientId,ia=!1,y(),a.reestablish=ta,ta=!0,S(a),G("/meta/handshake",a),da=a["x-messages"]||0,a=l()?"none":L.reconnect||"retry",a){case "retry":P=0;0===da?A(0):k._debug("Processing",da,"handshake-delivered messages");break;case "none":H(!0);break;default:throw"Unrecognized advice action "+
a;}else wa(a,{cause:"unsuccessful",action:L.reconnect||"handshake",transport:I});break;case "/meta/connect":if(Fa(a))if(na=a.successful)switch(G("/meta/connect",a),a=l()?"none":L.reconnect||"retry",a){case "retry":P=0;A(P);break;case "none":H(!1);break;default:throw"Unrecognized advice action "+a;}else Ga(a,{cause:"unsuccessful",action:L.reconnect||"retry",transport:I});else k._debug("Mismatched /meta/connect reply",a);break;case "/meta/disconnect":a.successful?(H(!1),S(a),G("/meta/disconnect",a)):
Ha(a);break;case "/meta/subscribe":a.successful?(S(a),G("/meta/subscribe",a)):Ia(a);break;case "/meta/unsubscribe":a.successful?(S(a),G("/meta/unsubscribe",a)):Ja(a);break;default:void 0!==a.data?Da(a)||(G(a.channel,a),0<da&&(--da,0===da&&(k._debug("Processed last handshake-delivered message"),A(0)))):void 0===a.successful?k._warn("Unknown Bayeux Message",a):a.successful?(S(a),G("/meta/publish",a)):xa(a)}}function La(a){if(a=R[a])for(let b in a)if(a.hasOwnProperty(b)&&a[b])return!0;return!1}function Ma(a,
b){const c={scope:a,method:b};if(d(a))c.scope=void 0,c.method=a;else if(T.isString(b)){if(!a)throw"Invalid scope "+a;c.method=a[b];if(!d(c.method))throw"Invalid callback "+b+" for scope "+a;}else if(!d(b))throw"Invalid callback "+b;return c}function Na(a,b,c,e){c=Ma(b,c);k._debug("Adding",e?"listener":"subscription","on",a,"with scope",c.scope,"and callback",c.method);b=++Ra;c={id:b,channel:a,scope:c.scope,callback:c.method,listener:e};let g=R[a];g||(g={},R[a]=g);g[b]=c;k._debug("Added",e?"listener":
"subscription",c);return c}const Z=new ea,k=this,Sa=t||"default";let la=!1;const Q=new Oa;let I,X="disconnected",V=0,ba=null,U=0,ca=[],ia=!1,Ra=0,R={};const pa={};let P=0,aa=null;const N=[];let L={},ua,Ca;const ma={},va={};let ta=!1,na=!1,ja=0,da=0,ha=null,J={useWorkerScheduler:!0,protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1E3,maxBackoff:6E4,logLevel:"info",maxNetworkDelay:1E4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,urls:{},maxURILength:2E3,
maxSendBayeuxMessageSize:8192,advice:{timeout:6E4,interval:0,reconnect:void 0,maxInterval:0}};this._mixin=function(a,b,c){const e=b||{};for(let g=2;g<arguments.length;++g){const w=arguments[g];if(void 0!==w&&null!==w)for(let D in w)if(w.hasOwnProperty(D)){const K=m(w,D),ka=m(e,D);K!==b&&void 0!==K&&(e[D]=a&&"object"===typeof K&&null!==K?K instanceof Array?this._mixin(a,ka instanceof Array?ka:[],K):this._mixin(a,"object"!==typeof ka||ka instanceof Array?{}:ka,K):K)}}return e};this._warn=function(){u("warn",
arguments)};this._info=function(){"warn"!==J.logLevel&&u("info",arguments)};this._debug=function(){"debug"===J.logLevel&&u("debug",arguments)};this._isCrossDomain=a=>window.location&&window.location.host&&a?a!==window.location.host:!1;let Ba,sa;this.send=r;this._getCallback=a=>ma[a];this._putCallback=function(a,b){const c=this._getCallback(a);d(b)&&(ma[a]=b);return c};this.onTransportFailure=function(a,b,c){this._debug("Transport failure",b,"for",a);var e=this.getTransportRegistry();const g=this.getURL(),
w=this._isCrossDomain(n(g)[2]);var D=e.findTransportTypes("1.0",w,g);if("none"===b.action)"/meta/handshake"!==a.channel||b.transport||(a="Could not negotiate transport, client=["+D+"], server=["+a.supportedConnectionTypes+"]",this._warn(a),M(I.getType(),null,{reason:a,connectionType:I.getType(),transport:I}));else if(b.delay=this.getBackoffPeriod(),"/meta/handshake"===a.channel){if(!b.transport){var K=I?I.getType():null;(e=e.negotiateTransport(D,"1.0",w,g))?(D=e.getType(),this._debug("Transport",
K,"->",D),M(K,D,a.failure),b.action="handshake",b.transport=e):(this._warn("Could not negotiate transport, client=["+D+"]"),M(K,null,a.failure),b.action="none")}"none"!==b.action&&this.increaseBackoffPeriod()}else a=(new Date).getTime(),0===ja&&(ja=a),"retry"===b.action&&(b.delay=this.increaseBackoffPeriod(),K=L.maxInterval,0<K&&a-ja+P>L.timeout+L.interval+K&&(b.action="handshake")),"handshake"===b.action&&(b.delay=0,e.reset(!1),this.resetBackoffPeriod());c.call(k,b)};this.receive=Ka;Ba=a=>{k._debug("Received",
a);for(let b=0;b<a.length;++b)Ka(a[b])};sa=(a,b,c)=>{k._debug("handleFailure",a,b,c);c.transport=a;for(a=0;a<b.length;++a){var e=b[a];const g={id:e.id,successful:!1,channel:e.channel,failure:c};c.message=e;switch(e.channel){case "/meta/handshake":wa(g,{cause:"failure",action:"handshake",transport:null});break;case "/meta/connect":e=g;Fa(e)?(na=!1,Ga(e,{cause:"failure",action:"retry",transport:null})):k._debug("Mismatched /meta/connect failure",e);break;case "/meta/disconnect":Ha(g);break;case "/meta/subscribe":g.subscription=
e.subscription;Ia(g);break;case "/meta/unsubscribe":g.subscription=e.subscription;Ja(g);break;default:xa(g)}}};this.registerTransport=function(a,b,c){if(c=Q.add(a,b,c))this._debug("Registered transport",a),d(b.registered)&&b.registered(a,this);return c};this.unregisterTransport=function(a){const b=Q.remove(a);null!==b&&(this._debug("Unregistered transport",a),d(b.unregistered)&&b.unregistered());return b};this.unregisterTransports=()=>{Q.clear()};this.getTransportTypes=()=>Q.getTransportTypes();this.findTransport=
a=>Q.find(a);this.getTransportRegistry=()=>Q;this.configure=function(a){x.call(this,a)};this.init=function(a,b){this.configure(a);this.handshake(b)};this.handshake=(a,b)=>{if("disconnected"!==X)throw"Illegal state: handshaken";Y(a,b)};this.disconnect=function(a,b){if(!l()){d(a)&&(b=a,a=void 0);var c={id:""+ ++V,channel:"/meta/disconnect"};a=this._mixin(!1,{},a,c);k._putCallback(a.id,b);C("disconnecting");f([a],!1,"disconnect")}};this.startBatch=()=>{++U;k._debug("Starting batch, depth",U)};this.endBatch=
()=>{--U;k._debug("Ending batch, depth",U);if(0>U)throw"Calls to startBatch() and endBatch() are not paired";0!==U||l()||ia||y()};this.batch=function(a,b){a=Ma(a,b);this.startBatch();try{a.method.call(a.scope),this.endBatch()}catch(c){throw this._info("Exception during execution of batch",c),this.endBatch(),c;}};this.addTransportListener=(a,b)=>{if("timeout"!==a)throw"Unsupported event "+a;let c=pa[a];c||(pa[a]=c=[]);c.push(b)};this.removeTransportListener=(a,b)=>{if(a=pa[a])if(b=a.indexOf(b),0<=
b)return a.splice(b,1),!0;return!1};this._getTransportListeners=a=>pa[a];this.addListener=function(a,b,c){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!T.isString(a))throw"Illegal argument type: channel must be a string";return Na(a,b,c,!0)};this.removeListener=a=>{if(!(a&&a.channel&&"id"in a))throw"Invalid argument: expected subscription, not "+a;v(a)};this.clearListeners=()=>{R={}};this.subscribe=function(a,b,c,e,g){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+
arguments.length;if(!q(a))throw"Illegal argument: invalid channel "+a;if(l())throw"Illegal state: disconnected";d(b)&&(g=e,e=c,c=b,b=void 0);d(e)&&(g=e,e=void 0);var w=!La(a);const D=Na(a,b,c,!1);w?(w={id:""+ ++V,channel:"/meta/subscribe",subscription:a},w=this._mixin(!1,{},e,w),k._putCallback(w.id,g),r(w)):d(g)&&k.setTimeout(()=>{oa(g,{id:""+ ++V,successful:!0,channel:"/meta/subscribe",subscription:a})},0);return D};this.unsubscribe=function(a,b,c){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+
arguments.length;if(l())throw"Illegal state: disconnected";d(b)&&(c=b,b=void 0);this.removeListener(a);const e=a.channel;if(La(e))d(c)&&k.setTimeout(()=>{oa(c,{id:""+ ++V,successful:!0,channel:"/meta/unsubscribe",subscription:e})},0);else{var g={id:""+ ++V,channel:"/meta/unsubscribe",subscription:e};g=this._mixin(!1,{},b,g);k._putCallback(g.id,c);r(g)}};this.resubscribe=function(a,b){a&&!a.listener&&v(a);if(a)return this.subscribe(a.channel,a.scope,a.callback,b)};this.clearSubscriptions=()=>{E()};
this.publish=function(a,b,c,e){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+arguments.length;if(!q(a))throw"Illegal argument: invalid channel "+a;if(/^\/meta\//.test(a))throw"Illegal argument: cannot publish to meta channels";if(l())throw"Illegal state: disconnected";d(b)?(e=b,b={},c=void 0):d(c)&&(e=c,c=void 0);var g={id:""+ ++V,channel:a,data:b};g=this._mixin(!1,{},c,g);k._putCallback(g.id,e);r(g)};this.publishBinary=function(a,b,c,e,g,w){d(b)?(w=b,b=new ArrayBuffer(0),
c=!0,g=e=void 0):d(c)?(w=c,c=!0,g=e=void 0):d(e)?(w=e,g=e=void 0):d(g)&&(w=g,g=void 0);b={meta:e,data:b,last:c};g=this._mixin(!1,g,{ext:{binary:{}}});this.publish(a,b,g,w)};this.remoteCall=function(a,b,c,e,g){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+arguments.length;if(!T.isString(a))throw"Illegal argument type: target must be a string";if(l())throw"Illegal state: disconnected";d(b)?(g=b,b={},c=J.maxNetworkDelay,e=void 0):d(c)?(g=c,c=J.maxNetworkDelay,e=void 0):d(e)&&
(g=e,e=void 0);if("number"!==typeof c)throw"Illegal argument type: timeout must be a number";a.match(/^\//)||(a="/"+a);var w="/service"+a;if(!q(w))throw"Illegal argument: invalid target "+a;w={id:""+ ++V,channel:w,data:b};const D=this._mixin(!1,{},e,w);w={callback:g};0<c&&(w.timeout=k.setTimeout(()=>{k._debug("Timing out remote call",D,"after",c,"ms");xa({id:D.id,error:"406::timeout",successful:!1,failure:{message:D,reason:"Remote Call Timeout"}})},c),k._debug("Scheduled remote call timeout",D,"in",
c,"ms"));va[D.id]=w;r(D)};this.remoteCallBinary=function(a,b,c,e,g,w,D){d(b)?(D=b,b=new ArrayBuffer(0),c=!0,e=void 0,g=J.maxNetworkDelay,w=void 0):d(c)?(D=c,c=!0,e=void 0,g=J.maxNetworkDelay,w=void 0):d(e)?(D=e,e=void 0,g=J.maxNetworkDelay,w=void 0):d(g)?(D=g,g=J.maxNetworkDelay,w=void 0):d(w)&&(D=w,w=void 0);b={meta:e,data:b,last:c};w=this._mixin(!1,w,{ext:{binary:{}}});this.remoteCall(a,b,g,w,D)};this.getStatus=()=>X;this.isDisconnected=l;this.setBackoffIncrement=a=>{J.backoffIncrement=a};this.getBackoffIncrement=
()=>J.backoffIncrement;this.getBackoffPeriod=()=>P;this.increaseBackoffPeriod=()=>{P<J.maxBackoff&&(P+=J.backoffIncrement);return P};this.resetBackoffPeriod=()=>{P=0};this.setLogLevel=a=>{J.logLevel=a};this.registerExtension=function(a,b){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!T.isString(a))throw"Illegal argument type: extension name must be a string";let c=!1;for(let e=0;e<N.length;++e)if(N[e].name===a){c=!0;break}if(c)return this._info("Could not register extension with name",
a,"since another extension with the same name already exists"),!1;N.push({name:a,extension:b});this._debug("Registered extension",a);d(b.registered)&&b.registered(a,this);return!0};this.unregisterExtension=function(a){if(!T.isString(a))throw"Illegal argument type: extension name must be a string";let b=!1;for(let c=0;c<N.length;++c){const e=N[c];if(e.name===a){N.splice(c,1);b=!0;this._debug("Unregistered extension",a);a=e.extension;d(a.unregistered)&&a.unregistered();break}}return b};this.getExtension=
a=>{for(let b=0;b<N.length;++b){const c=N[b];if(c.name===a)return c.extension}return null};this.getName=()=>Sa;this.getClientId=()=>ba;this.getURL=()=>{if(I){let a=I.getURL();if(a||(a=J.urls[I.getType()]))return a}return J.url};this.getTransport=()=>I;this.getConfiguration=function(){return this._mixin(!0,{},J)};this.getAdvice=function(){return this._mixin(!0,{},L)};this.setTimeout=(a,b)=>Z.setTimeout(()=>{try{k._debug("Invoking timed function",a),a()}catch(c){k._debug("Exception invoking timed function",
a,c)}},b);this.clearTimeout=a=>{Z.clearTimeout(a)};window.WebSocket&&this.registerTransport("websocket",new Aa);this.registerTransport("long-polling",new ya);this.registerTransport("callback-polling",new za)},Transport:W,RequestTransport:qa,LongPollingTransport:ya,CallbackPollingTransport:za,WebSocketTransport:Aa,Utils:T,Z85:{encode:t=>{var m=null;t instanceof ArrayBuffer?m=t:t.buffer instanceof ArrayBuffer?m=t.buffer:Array.isArray(t)&&(m=(new Uint8Array(t)).buffer);if(null==m)throw"Cannot Z85 encode "+
t;t=m.byteLength;var q=t%4;q=4-(0===q?4:q);m=new DataView(m);let d="",h=0;for(let u=0;u<t+q;++u){const n=u>=t;h=256*h+(n?0:m.getUint8(u));if(0===(u+1)%4){let x=52200625;for(let v=5;0<v;--v){if(!n||v>q)d+=ra[Math.floor(h/x)%85];x/=85}h=0}}return d},decode:t=>{var m=t.length%5,q=5-(0===m?5:m);for(m=0;m<q;++m)t+=ra[ra.length-1];m=t.length;q=new ArrayBuffer(4*m/5-q);const d=new DataView(q);let h=0,u=0,n=0;for(let v=0;v<m;++v){var x=t.charCodeAt(u++)-32;h=85*h+Pa[x];if(0===u%5){for(x=16777216;1<=x;)n<
d.byteLength&&d.setUint8(n++,Math.floor(h/x)%256),x/=256;h=0}}return q}}}});
