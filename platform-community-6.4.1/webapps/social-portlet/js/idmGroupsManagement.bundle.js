define((()=>(()=>{"use strict";var e={d:(t,r)=>{for(var s in r)e.o(r,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:r[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:()=>G});var r=function(){var e=this,t=e._self._c;return t("v-app",{staticClass:"white"},[e.error?t("v-card-text",{staticClass:"errorMessage"},[t("v-alert",{attrs:{type:"error"}},[e._v("\n      "+e._s(e.error)+"\n    ")])],1):e._e(),e._v(" "),t("v-card",{staticClass:"d-flex flex py-2",attrs:{flat:""}},[t("v-flex",{staticClass:"sm12 md4",attrs:{flat:""}},[t("groups-management-tree-toolbar"),e._v(" "),t("groups-management-tree")],1),e._v(" "),t("v-divider",{attrs:{vertical:""}}),e._v(" "),t("v-flex",{staticClass:"sm12 md8",attrs:{flat:""}},[t("groups-management-membership-toolbar"),e._v(" "),t("groups-management-membership-list")],1)],1),e._v(" "),t("groups-management-form-drawer"),e._v(" "),t("groups-management-membership-form-drawer")],1)};function s(e,t,r,s,i,n,o,a){var l,p="function"==typeof e?e.options:e;if(t&&(p.render=t,p.staticRenderFns=r,p._compiled=!0),s&&(p.functional=!0),n&&(p._scopeId="data-v-"+n),o?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},p._ssrRegister=l):i&&(l=a?function(){i.call(this,(p.functional?this.parent:this).$root.$options.shadowRoot)}:i),l)if(p.functional){p._injectStyles=l;var u=p.render;p.render=function(e,t){return l.call(t),u(e,t)}}else{var h=p.beforeCreate;p.beforeCreate=h?[].concat(h,l):[l]}return{exports:e,options:p}}r._withStripped=!0;const i=s({data:()=>({error:null}),mounted(){this.$root.$on("error",(e=>this.error=e))}},r,[],!1,null,null,null).exports;var n=function(){var e=this,t=e._self._c;return t("v-list-item-group",{attrs:{color:"primary"},model:{value:e.selectedIndex,callback:function(t){e.selectedIndex=t},expression:"selectedIndex"}},e._l(e.groups,(function(r){return t("groups-management-tree-item",{key:r.id,staticClass:"ms-3",attrs:{group:r,"page-size":e.pageSize,loading:e.loading,"open-all":!!e.keyword}})})),1)};n._withStripped=!0;const o=s({data:()=>({startSearchAfterInMilliseconds:600,endTypingKeywordTimeout:50,startTypingKeywordTimeout:0,keyword:null,groups:[],searching:0,loading:0,pageSize:50,selectedIndex:-1}),watch:{selectedIndex(){(0!==this.selectedIndex&&!this.selectedIndex||this.selectedIndex<0)&&this.$root.$emit("selectGroup")},searching(){this.$root.$emit("searchingGroup",this.searching)},keyword(){if(this.selectedIndex=-1,!this.keyword)return this.retrieveGroupTree();this.startTypingKeywordTimeout=Date.now(),this.loading||(this.searching++,this.waitForEndTyping())}},created(){this.$root.$on("refreshGroup",this.updateGroupTree),this.$root.$on("removeGroup",this.removeGroup),this.$root.$on("retrieveGroupChildren",this.retrieveGroupTree),this.$root.$on("searchGroup",(e=>this.keyword=e)),this.retrieveGroupTree().finally((()=>this.$root.$applicationLoaded()))},methods:{updateGroupItem(e,t){this.loading=!0;try{t||(t=this.groups);const r=t.findIndex((t=>t.id===e.id));if(r>-1)return t.splice(r,1,e),void this.$forceUpdate();for(const r in t){const s=t[r];if(e.parentId&&s.children&&s.children.length&&0===e.parentId.indexOf(s.id))return this.$forceUpdate(),this.updateGroupItem(e,s.children)}}finally{this.$nextTick().then((()=>this.loading=!1))}},updateGroupTree(e,t,r){this.loading=!0;try{r||(r=this.groups);const s=t&&t.id||e.parentId;e.id||(e.id=e.parentId?`${e.parentId}/${e.groupName}`:e.groupName);for(const i in r){const n=r[i];if(e.id===n.id)return Object.assign(n,e),!0;if(s&&0===s.indexOf(n.id)){let r=!1;if(n.children&&n.children.length&&(r=this.updateGroupTree(e,t,n.children)),r)return;if(s===n.id)return void(n.childrenRetrieved&&(n.children&&n.children.length?(n.children.push(e),n.children=n.children.slice()):n.children=[e],this.updateGroupItem(n)))}}s||this.groups.push(e)}finally{this.$nextTick().then((()=>this.loading=!1))}},removeGroup(e,t,r){this.loading=!0;try{r||(r=this.groups);const s=r.findIndex((t=>t.id===e.id));if(s>-1)return r.splice(s,1),t&&(r.length||delete t.children,this.updateGroupItem(t)),void this.$forceUpdate();for(const t in r){const s=r[t];if(e.parentId&&s.children&&s.children.length&&0===e.parentId.indexOf(s.id))return this.removeGroup(e,s,s.children)}}finally{this.$nextTick().then((()=>this.loading=!1))}},searchGroup(e,t){t||(t=this.groups);const r=t.find((t=>t.id===e));if(r)return r;for(const r in t){const s=t[r];if(s.children&&s.children.length&&0===e.indexOf(s.id)){const t=this.searchGroup(e,s.children);if(t)return t}}},retrieveGroupTree(e,t){const r=e&&e.id||"";return e&&(e.loading=!0),this.loading++,fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/groups/tree?parentId=${r}&q=${this.keyword||""}&&offset=${t||0}&limit=${this.pageSize}&returnSize=true`,{method:"GET",credentials:"include"}).then((e=>{if(e&&e.ok)return e.json();throw new Error(this.$t("IDMManagement.error.UnknownServerError"))})).then((t=>{const r=t&&t.entities||[];return e?(e.childrenSize=t&&t.size||[],r.length&&(e.children=r)):this.groups=r,this.$nextTick()})).finally((()=>{e&&(e.childrenRetrieved=!0,e.loading=!1),this.loading--}))},searchGroups(){return this.loading++,fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/groups?q=${this.keyword||""}&offset=0&limit=${this.pageSize}&tree=true&returnSize=true`,{method:"GET",credentials:"include"}).then((e=>{if(e&&e.ok)return e.json();throw new Error(this.$t("IDMManagement.error.UnknownServerError"))})).then((e=>{this.groups=e&&e.entities||[]})).finally((()=>{this.loading--,this.searching--}))},waitForEndTyping(){window.setTimeout((()=>{Date.now()-this.startTypingKeywordTimeout>this.startSearchAfterInMilliseconds?this.searchGroups():this.waitForEndTyping()}),this.endTypingKeywordTimeout)}}},n,[],!1,null,null,null).exports;var a=function(){var e=this,t=e._self._c;return t("div",[t("v-list-item",{class:e.selectedClass,attrs:{selectable:"",dense:""},on:{click:function(t){return e.$root.$emit("selectGroup",e.group)}}},[t("v-list-item-action",{staticClass:"me-4"},[e.displayIcon?t("v-btn",{attrs:{icon:""},on:{click:e.toogleOpenTree}},[e.loadingChildren?t("v-progress-circular",{attrs:{indeterminate:"",size:"32"}}):t("v-icon",{attrs:{size:"32"}},[e._v(e._s(e.icon))])],1):t("div",{staticClass:"ms-5 me-4"})],1),e._v(" "),t("v-list-item-content",[t("v-list-item-title",{staticClass:"font-weight-bold text-truncate",attrs:{title:e.group.label}},[e._v("\n        "+e._s(e.group.label)+"\n      ")]),e._v(" "),t("v-list-item-subtitle",{staticClass:"caption text-truncate",attrs:{title:e.group.id}},[e._v("\n        "+e._s(e.group.id)+"\n      ")])],1),e._v(" "),t("v-list-item-action",[t("groups-management-tree-group-menu",{attrs:{group:e.group}})],1)],1),e._v(" "),e.displayChildren?t("div",[t("div",{staticClass:"ms-3 d-flex flex-nowrap"},[e.pagesCount>1?t("v-pagination",{attrs:{length:e.pagesCount,"total-visible":5},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}}):e._e()],1),e._v(" "),e._l(e.children,(function(r){return t("groups-management-tree-item",{key:r.id,staticClass:"ms-3",attrs:{group:r,"page-size":e.pageSize,loading:e.loading,"open-all":e.openAll}})}))],2):e._e()],1)};a._withStripped=!0;const l=s({props:{group:{type:Object,default:null},selectedGroups:{type:Array,default:null},pageSize:{type:Number,default:10},loading:{type:Boolean,default:!1},openAll:{type:Boolean,default:!1}},data:()=>({selected:!1,open:!1,page:1}),computed:{selectedClass(){return this.loading>=0&&this.selected?"mdi-menu-right":"mdi-menu-down"},pagesCount(){return parseInt((this.childrenSize+this.pageSize-1)/this.pageSize)},icon(){return this.loading>=0&&this.open?"mdi-menu-down":"mdi-menu-right"},loadingChildren(){return this.loading&&this.group.loading},displayChildren(){return this.loading>=0&&this.group.children&&this.group.children.length&&(this.open||this.openAll)},childrenSize(){return this.loading>=0&&this.group.childrenSize},children(){return this.loading>=0&&this.group.children},displayIcon(){return this.loading>=0&&!this.openAll&&(!this.group.childrenRetrieved||this.group.children)}},watch:{open(){if(this.open&&!this.group.childrenRetrieved){const e=(this.page-1)*this.pageSize;this.$root.$emit("retrieveGroupChildren",this.group,e)}},page(){const e=(this.page-1)*this.pageSize;this.$root.$emit("retrieveGroupChildren",this.group,e)}},created(){this.$root.$on("selectGroup",(e=>{this.selected=e&&this.group.id===e.id}))},methods:{toogleOpenTree(e){e&&(e.preventDefault(),e.stopPropagation()),this.open=!this.open}}},a,[],!1,null,null,null).exports;var p=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:e.groupMenuParentId}},[t("exo-confirm-dialog",{ref:"deleteConfirmDialog",attrs:{message:e.deleteConfirmMessage,title:e.$t("GroupsManagement.title.confirmDelete"),"ok-label":e.$t("GroupsManagement.button.ok"),"cancel-label":e.$t("GroupsManagement.button.cancel")},on:{ok:function(t){return e.deleteConfirm()}}}),e._v(" "),t("v-btn",{staticClass:"groupMenuIcon",attrs:{icon:"",text:""},on:{click:e.openMenu}},[t("v-icon",{attrs:{size:"21"}},[e._v("mdi-dots-vertical")])],1),e._v(" "),t("v-menu",{ref:"actionMenu",attrs:{attach:`#${e.groupMenuParentId}`,transition:"slide-x-reverse-transition","content-class":"groupActionMenu",right:"","offset-x":"","offset-y":""},model:{value:e.displayActionMenu,callback:function(t){e.displayActionMenu=t},expression:"displayActionMenu"}},[t("v-list",{staticClass:"pa-0",attrs:{dense:""}},[t("v-list-item",{on:{click:function(t){return e.emitEvent(t,"editGroup")}}},[t("v-list-item-title",{staticClass:"subtitle-2"},[t("i",{staticClass:"uiIcon uiIconEdit"}),e._v("\n          "+e._s(e.$t("GroupsManagement.edit"))+"\n        ")])],1),e._v(" "),t("v-list-item",{on:{click:function(t){return e.emitEvent(t,"addNewGroup")}}},[t("v-list-item-title",{staticClass:"subtitle-2"},[t("i",{staticClass:"uiIcon uiIconGroup"}),e._v("\n          "+e._s(e.$t("GroupsManagement.addSubGroup"))+"\n        ")])],1),e._v(" "),t("v-list-item",{on:{click:function(t){return e.emitEvent(t,"addNewMembership")}}},[t("v-list-item-title",{staticClass:"subtitle-2"},[t("i",{staticClass:"uiIcon uiIconSocConnectUser"}),e._v("\n          "+e._s(e.$t("GroupsManagement.addMember"))+"\n        ")])],1),e._v(" "),t("v-list-item",{on:{click:e.deleteGroup}},[t("v-list-item-title",{staticClass:"subtitle-2"},[t("i",{staticClass:"uiIcon uiIconTrash"}),e._v("\n          "+e._s(e.$t("GroupsManagement.delete"))+"\n        ")])],1)],1)],1)],1)};p._withStripped=!0;const u=s({props:{group:{type:Object,default:null}},data:()=>({displayActionMenu:!1}),computed:{deleteConfirmMessage(){return this.$t("GroupsManagement.message.confirmDelete",{0:this.group.label})},groupMenuParentId:()=>`SpaceApplications${parseInt(1e4*Math.random()).toString().toString()}`},created(){$(document).on("mousedown",(()=>{this.displayActionMenu&&window.setTimeout((()=>{this.displayActionMenu=!1,this.displaySecondButton=!1}),this.waitTimeUntilCloseMenu)}))},methods:{openMenu(e){e&&(e.preventDefault(),e.stopPropagation()),this.displayActionMenu=!0},emitEvent(e,t){e&&(e.preventDefault(),e.stopPropagation()),this.$root.$emit(t,this.group)},deleteGroup(e){e&&(e.preventDefault(),e.stopPropagation()),this.$refs.deleteConfirmDialog.open()},deleteConfirm(){return this.loading=!0,fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/groups?groupId=${this.group.id}`,{method:"DELETE",credentials:"include"}).then((e=>{if(!e||!e.ok){if(e&&400===e.status)return e.text().then((e=>{throw new Error(e)}));throw new Error(this.$t("IDMManagement.error.UnknownServerError"))}return this.$root.$emit("removeGroup",this.group)})).catch((e=>{const t=`GroupsManagement.error.${e=e.message||String(e)}`,r=this.$t(t,{0:this.group.label});r!==t&&(e=r),this.$root.$emit("error",e),window.setTimeout((()=>{this.$root.$emit("error",null)}),5e3)})).finally((()=>this.loading=!1))}}},p,[],!1,null,null,null).exports;var h=function(){var e=this,t=e._self._c;return t("v-flex",{staticClass:"d-flex flex-row",attrs:{id:"groupsManagementToolbar"}},[t("v-flex",{staticClass:"mx-3 d-flex flex-grow-0 groupsManagementToolbarButton"},[t("v-btn",{staticClass:"btn btn-primary my-auto addNewGroupButton",on:{click:function(t){return e.$root.$emit("addNewGroup")}}},[t("i",{staticClass:"uiIconGroup uiIconWhite me-md-3"}),e._v(" "),t("span",{staticClass:"d-none d-sm-inline"},[e._v("\n        "+e._s(e.$t("GroupsManagement.addGroup"))+"\n      ")])])],1),e._v(" "),t("v-flex",{staticClass:"mx-3 d-flex flex-column flex-grow-1 groupsManagementToolbarFilter"},[t("v-text-field",{staticClass:"inputMembershipTypeFilter pa-0 my-auto",attrs:{placeholder:e.$t("GroupsManagement.filterByGroup"),"prepend-inner-icon":"fa-filter"},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),e._v(" "),e.searching?t("v-progress-linear",{staticClass:"groupSearchingProgressBar",attrs:{color:"primary",indeterminate:"",size:"32"}}):e._e()],1)],1)};h._withStripped=!0;const d=s({data:()=>({keyword:null,searching:!1}),watch:{keyword(){this.$root.$emit("searchGroup",this.keyword)}},created(){this.$root.$on("searchingGroup",(e=>this.searching=e))}},h,[],!1,null,null,null).exports;var m=function(){var e=this,t=e._self._c;return t("v-toolbar",{attrs:{id:"groupsManagementToolbar",flat:""}},[t("v-toolbar-title",[t("v-btn",{staticClass:"btn addNewMembershipButton",attrs:{disabled:!e.group},on:{click:function(t){return e.$root.$emit("addNewMembership",e.group)}}},[t("i",{staticClass:"uiIconSocConnectUser me-md-3"}),e._v(" "),t("span",{staticClass:"d-none d-sm-inline"},[e._v("\n        "+e._s(e.$t("GroupsManagement.addMemberInGroup"))+"\n      ")])])],1),e._v(" "),t("v-spacer"),e._v(" "),t("v-scale-transition",[t("v-text-field",{staticClass:"inputMembershipTypeFilter pa-0 me-3 my-auto",attrs:{placeholder:e.$t("GroupsManagement.filterBy"),disabled:!e.group,"prepend-inner-icon":"fa-filter"},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1)],1)};m._withStripped=!0;const c=s({data:()=>({group:null,keyword:null}),watch:{keyword(){this.$root.$emit("searchGroupMemberships",this.keyword)}},created(){this.$root.$on("selectGroup",(e=>this.group=e))}},m,[],!1,null,null,null).exports;var g=function(){var e=this,t=e._self._c;return t("exo-drawer",{ref:"groupFormDrawer",attrs:{id:"groupFormDrawer",right:""},on:{closed:function(t){e.drawer=!1}}},[t("template",{slot:"title"},[e._v("\n    "+e._s(e.title)+"\n  ")]),e._v(" "),t("template",{slot:"content"},[t("v-form",{ref:"groupForm",staticClass:"form-horizontal pt-0 pb-4",attrs:{flat:""},on:{submit:e.saveGroup}},[e.error?t("v-card-text",{staticClass:"errorMessage"},[t("v-alert",{attrs:{type:"error"}},[e._v("\n          "+e._s(e.error)+"\n        ")])],1):e._e(),e._v(" "),t("v-card-text",{staticClass:"d-flex groupNameLabel flex-grow-1 text-no-wrap text-left font-weight-bold pb-2"},[e._v("\n        "+e._s(e.$t("GroupsManagement.name"))),e.newGroup?[e._v("*")]:e._e()],2),e._v(" "),t("v-card-text",{staticClass:"d-flex groupNameField py-0"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.group.groupName,expression:"group.groupName"}],ref:"nameInput",staticClass:"ignore-vuetify-classes flex-grow-1",attrs:{disabled:e.saving||!e.newGroup,autofocus:e.drawer,placeholder:e.$t("GroupsManagement.namePlaceholder"),type:"text",maxlength:"2000",required:""},domProps:{value:e.group.groupName},on:{input:function(t){t.target.composing||e.$set(e.group,"groupName",t.target.value)}}})]),e._v(" "),t("v-card-text",{staticClass:"d-flex groupNameLabel flex-grow-1 text-no-wrap text-left font-weight-bold pb-2"},[e._v("\n        "+e._s(e.$t("GroupsManagement.label"))+"*\n      ")]),e._v(" "),t("v-card-text",{staticClass:"d-flex groupNameField py-0"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.group.label,expression:"group.label"}],ref:"labelInput",staticClass:"ignore-vuetify-classes flex-grow-1",attrs:{disabled:e.saving,placeholder:e.$t("GroupsManagement.labelPlaceholder"),type:"text",maxlength:"2000",required:""},domProps:{value:e.group.label},on:{input:function(t){t.target.composing||e.$set(e.group,"label",t.target.value)}}})]),e._v(" "),t("v-card-text",{staticClass:"d-flex descriptionLabel flex-grow-1 text-no-wrap text-left font-weight-bold pb-2"},[e._v("\n        "+e._s(e.$t("GroupsManagement.description"))+"\n      ")]),e._v(" "),t("v-card-text",{staticClass:"d-flex descriptionField py-0"},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.group.description,expression:"group.description"}],ref:"descriptionInput",staticClass:"ignore-vuetify-classes flex-grow-1 textarea-no-resize",attrs:{disabled:e.saving,placeholder:e.$t("GroupsManagement.descriptionPlaceholder"),type:"text",maxlength:"2000"},domProps:{value:e.group.description},on:{input:function(t){t.target.composing||e.$set(e.group,"description",t.target.value)}}})])],1)],1),e._v(" "),t("template",{slot:"footer"},[t("div",{staticClass:"d-flex"},[t("v-spacer"),e._v(" "),t("v-btn",{staticClass:"btn me-2",attrs:{disabled:e.saving},on:{click:e.cancel}},[e._v("\n        "+e._s(e.$t("GroupsManagement.button.cancel"))+"\n      ")]),e._v(" "),t("v-btn",{staticClass:"btn btn-primary",attrs:{disabled:e.saving,loading:e.saving},on:{click:e.saveGroup}},[e._v("\n        "+e._s(e.$t("GroupsManagement.button.save"))+"\n      ")])],1)])],2)};g._withStripped=!0;const f=s({data:()=>({error:null,fieldError:!1,drawer:!1,newGroup:!1,saving:!1,confirmNewPassword:null,group:{},parentGroup:null}),computed:{title(){return this.newGroup?this.$t("GroupsManagement.addGroup"):this.$t("GroupsManagement.editGroup")}},watch:{confirmNewPassword(){this.resetCustomValidity()},saving(){this.saving?this.$refs.groupFormDrawer.startLoading():this.$refs.groupFormDrawer.endLoading()},drawer(){this.drawer?(this.$refs.groupFormDrawer.open(),window.setTimeout((()=>{this.newGroup?this.$refs.nameInput.focus():this.$refs.labelInput.focus()}),200)):this.$refs.groupFormDrawer.close()}},created(){this.$root.$on("addNewGroup",this.addNewGroup),this.$root.$on("editGroup",this.editGroup)},methods:{resetCustomValidity(){this.$refs.nameInput.setCustomValidity("")},addNewGroup(e){this.parentGroup=e,this.group={parentId:this.parentGroup&&this.parentGroup.id||null},this.newGroup=!0,this.drawer=!0},editGroup(e){this.group={id:e.id,parentId:e.parentId,groupName:e.groupName,label:e.label,description:e.description},this.newGroup=!1,this.drawer=!0},saveGroup(e){const t=/(?!^\d)^[a-zA-Z0-9-_]+$/.test(this.group.groupName);if(this.group.groupName&&(t?this.group.groupName.length<3||this.group.groupName.length>30?this.$refs.nameInput.setCustomValidity(this.$t("GroupsManagement.message.invalidFieldLength",{0:this.$t("GroupsManagement.name"),1:3,2:50})):this.$refs.nameInput.setCustomValidity(""):this.$refs.nameInput.setCustomValidity(this.$t("GroupsManagement.error.invalidField",{0:this.$t("GroupsManagement.name")}))),this.group.label&&(this.group.label.length<3||this.group.label.length>50?this.$refs.labelInput.setCustomValidity(this.$t("GroupsManagement.message.invalidFieldLength",{0:this.$t("GroupsManagement.label"),1:3,2:50})):this.$refs.labelInput.setCustomValidity("")),this.group.description&&(this.group.description.length<3||this.group.description.length>255?this.$refs.descriptionInput.setCustomValidity(this.$t("GroupsManagement.message.invalidFieldLength",{0:this.$t("GroupsManagement.description"),1:0,2:255})):this.$refs.descriptionInput.setCustomValidity("")),e&&(e.preventDefault(),e.stopPropagation()),this.error=null,this.fieldError=!1,this.$refs.groupForm.validate()&&this.$refs.groupForm.$el.reportValidity())return this.saving=!0,fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/groups`,{method:this.newGroup?"POST":"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.group)}).then((e=>{if(!e||!e.ok){if(400===e.status)return e.text().then((e=>{throw this.fieldError=e,new Error(e)}));throw new Error(this.$t("IDMManagement.error.UnknownServerError"))}})).then((()=>this.$root.$emit("refreshGroup",this.group,this.parentGroup))).then((()=>this.$refs.groupFormDrawer.close())).catch(this.handleError).finally((()=>this.saving=!1))},cancel(){this.drawer=!1},handleError(e){this.resetCustomValidity(),e?(this.fieldError&&"NAME:ALREADY_EXISTS"===this.fieldError?this.$refs.nameInput.setCustomValidity(this.$t("GroupsManagement.message.sameNameAlreadyExists")):(this.error=String(e),window.setTimeout((()=>{this.error=null}),5e3)),window.setTimeout((()=>{this.$refs.groupForm.validate()&&this.$refs.groupForm.$el.reportValidity()}),200)):this.error=null}}},g,[],!1,null,null,null).exports;var v=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ms-4 me-7"},[t("exo-confirm-dialog",{ref:"deleteConfirmDialog",attrs:{message:e.deleteConfirmMessage,title:e.$t("GroupsManagement.title.confirmDeleteMembership"),"ok-label":e.$t("GroupsManagement.button.ok"),"cancel-label":e.$t("GroupsManagement.button.cancel")},on:{ok:function(t){return e.deleteConfirm()}}}),e._v(" "),t("v-data-table",{staticClass:"data-table-light-border",attrs:{headers:e.headers,items:e.filteredMemberships,loading:e.loading,options:e.options,"footer-props":{itemsPerPageOptions:e.itemsPerPageOptions},"hide-default-footer":!e.hasPages,"server-items-length":e.totalSize,"loading-text":e.$t("UsersManagement.loadingResults"),"no-results-text":e.$t("UsersManagement.noResultsFound"),"no-data-text":e.$t("UsersManagement.noData")},on:{"update:options":function(t){e.options=t}},scopedSlots:e._u([{key:"item.actions",fn:function({item:r}){return[t("div",{staticClass:"d-flex flex-no-wrap"},[t("v-btn",{attrs:{title:e.$t("GroupsManagement.editMembership"),primary:"",icon:"",text:""},on:{click:function(t){return e.$root.$emit("editMembership",r,e.group)}}},[t("i",{staticClass:"uiIconEdit"})]),e._v(" "),t("v-btn",{attrs:{title:e.$t("GroupsManagement.button.delete"),primary:"",icon:"",text:""},on:{click:function(t){return e.deleteMembership(r)}}},[t("i",{staticClass:"uiIconTrash"})])],1)]}}])})],1)};v._withStripped=!0;const b=s({data:()=>({startSearchAfterInMilliseconds:600,endTypingKeywordTimeout:50,startTypingKeywordTimeout:0,itemsPerPageOptions:[20,50,100],memberships:[],selectedMembership:null,deleteConfirmMessage:null,keyword:null,dateTimeFormat:{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"},group:null,totalSize:0,options:{page:1,itemsPerPage:20},loading:!1}),computed:{hasPages(){return this.totalSize>this.options.itemsPerPage},filteredMemberships(){return this.keyword?this.memberships.slice().filter((e=>e&&e.fullName&&e.fullName.toLowerCase().indexOf(this.keyword.toLowerCase())>=0||e.email&&e.email.toLowerCase().indexOf(this.keyword.toLowerCase())>=0)):this.memberships.slice()},headers(){return[{text:this.$t&&this.$t("UsersManagement.userName"),value:"userName",align:"center",class:"text-no-wrap",sortable:!1},{text:this.$t&&this.$t("UsersManagement.lastName"),value:"lastName",align:"center",class:"text-no-wrap",sortable:!1},{text:this.$t&&this.$t("UsersManagement.firstName"),value:"firstName",align:"center",class:"text-no-wrap",sortable:!1},{text:this.$t&&this.$t("UsersManagement.email"),value:"email",align:"center",class:"text-no-wrap",sortable:!1},{text:this.$t&&this.$t("UsersManagement.membershipType"),value:"membershipType",align:"center",class:"text-no-wrap",sortable:!1},{text:this.$t&&this.$t("UsersManagement.actions"),value:"actions",align:"center",class:"text-no-wrap",sortable:!1}]}},watch:{options(){this.searchMemberships()},keyword(){if(this.options.page=1,!this.keyword)return this.searchMemberships();this.startTypingKeywordTimeout=Date.now(),this.loading||(this.loading=!0,this.waitForEndTyping())},group(){return this.options.page=1,this.searchMemberships()}},created(){this.$root.$on("searchGroupMemberships",this.updateSearchTerms),this.$root.$on("selectGroup",(e=>this.group=e)),this.$root.$on("refreshGroupMemberships",(()=>this.searchMemberships()))},methods:{updateSearchTerms(e){this.keyword=e},deleteMembership(e){this.selectedMembership=e,this.deleteConfirmMessage=this.$t("GroupsManagement.message.confirmDeleteMembership",{0:this.selectedMembership.fullName,1:this.selectedMembership.membershipType}),this.$refs.deleteConfirmDialog.open()},deleteConfirm(){return this.loading=!0,fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/groups/memberships?membershipId=${this.selectedMembership.id}`,{method:"DELETE",credentials:"include"}).then((e=>{if(!e||!e.ok)throw new Error(this.$t("IDMManagement.error.UnknownServerError"));return this.searchMemberships()})).finally((()=>this.loading=!1))},searchMemberships(e){if(!this.group)return this.memberships=[],void(this.totalSize=0);const t=((this.options&&this.options.page)-1)*(e=e||this.options.itemsPerPage);return this.loading=!0,fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/groups/memberships?groupId=${this.group.id}&offset=${t}&limit=${e}&returnSize=true`,{method:"GET",credentials:"include"}).then((e=>{if(e&&e.ok)return e.json();throw new Error(this.$t("IDMManagement.error.UnknownServerError"))})).then((t=>{if(this.memberships=t&&t.entities||[],this.totalSize=t&&t.size||0,this.keyword)return this.$nextTick().then((()=>{const t=this.totalSize;if(this.totalSize=this.filteredMemberships.length,e<t&&this.filteredMemberships.length<this.options.itemsPerPage){const r=Math.min(2*e,t);return this.searchMemberships(r)}}))})).finally((()=>this.loading=!1))},waitForEndTyping(){window.setTimeout((()=>{Date.now()-this.startTypingKeywordTimeout>this.startSearchAfterInMilliseconds?this.searchMemberships():this.waitForEndTyping()}),this.endTypingKeywordTimeout)}}},v,[],!1,null,null,null).exports;var w=function(){var e=this,t=e._self._c;return t("exo-drawer",{ref:"membershipFormDrawer",attrs:{id:"membershipFormDrawer",right:""},on:{closed:function(t){e.drawer=!1}}},[t("template",{slot:"title"},[e._v("\n    "+e._s(e.title)+"\n  ")]),e._v(" "),t("template",{slot:"content"},[t("v-form",{ref:"membershipForm",staticClass:"form-horizontal pt-0 pb-4",attrs:{flat:""},on:{submit:e.saveMembership}},[e.error?t("v-card-text",{staticClass:"errorMessage"},[t("v-alert",{attrs:{type:"error"}},[e._v("\n          "+e._s(e.error)+"\n        ")])],1):e._e(),e._v(" "),t("v-card-text",{staticClass:"d-flex membershipNameLabel flex-grow-1 text-no-wrap text-left font-weight-bold pb-2"},[e._v("\n        "+e._s(e.$t("UsersManagement.membershipType"))+" *\n      ")]),e._v(" "),t("v-card-text",{staticClass:"d-flex membershipNameField py-0"},[e.newMembership?[t("select",{directives:[{name:"model",rawName:"v-model",value:e.membershipType,expression:"membershipType"}],ref:"membershipTypeInput",staticClass:"input-block-level ignore-vuetify-classes",attrs:{disabled:e.saving,required:""},on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.membershipType=t.target.multiple?r:r[0]}}},e._l(e.membershipTypes,(function(r){return t("option",{key:r.name,domProps:{value:r.name}},[e._v("\n              "+e._s(r.name)+"\n            ")])})),0)]:[t("select",{directives:[{name:"model",rawName:"v-model",value:e.membership.membershipType,expression:"membership.membershipType"}],ref:"membershipTypeInput",staticClass:"input-block-level ignore-vuetify-classes",attrs:{disabled:e.saving,required:""},on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.membership,"membershipType",t.target.multiple?r:r[0])}}},e._l(e.membershipTypes,(function(r){return t("option",{key:r.name,domProps:{value:r.name}},[e._v("\n              "+e._s(r.name)+"\n            ")])})),0)]],2),e._v(" "),t("v-card-text",{staticClass:"d-flex membershipUser flex-grow-1 text-no-wrap text-left font-weight-bold pb-2"},[e._v("\n        "+e._s(e.$t("GroupsManagement.user"))+" *\n      ")]),e._v(" "),t("v-card-text",{staticClass:"d-flex membershipUserField py-0"},[e.newMembership?[t("v-autocomplete",{ref:"userNameInput",staticClass:"identitySuggester",attrs:{id:"userNameInput",disabled:e.saving||!e.newMembership,loading:e.loadingSuggestions>0,items:e.users,"search-input":e.searchTerm,placeholder:e.$t("GroupsManagement.addMemberInGroup"),required:!e.selectedUsers.length,"return-object":!1,name:"membershipUser",height:"100","append-icon":"","menu-props":"closeOnClick, maxHeight = 100","content-class":"identitySuggesterContent",width:"100%","max-width":"100%","item-text":"fullName","item-value":"userName","persistent-hint":"","hide-selected":"",chips:"","cache-items":"",dense:"",flat:"",multiple:""},on:{"update:searchInput":function(t){e.searchTerm=t},"update:search-input":[function(t){e.searchTerm=t},function(t){e.searchTerm=t}],change:e.clearSearch},scopedSlots:e._u([{key:"selection",fn:function({item:r,selected:s}){return[t("v-chip",{staticClass:"identitySuggesterItem",attrs:{"input-value":s,close:e.newMembership},on:{"click:close":function(t){return e.removeMemberShip(r)}}},[t("span",{staticClass:"text-truncate"},[e._v("\n                  "+e._s(r.fullName)+"\n                ")])])]}},{key:"item",fn:function({item:r}){return[t("v-list-item-title",{staticClass:"text-truncate identitySuggestionMenuItemText",domProps:{textContent:e._s(r.fullName)}})]}}],null,!1,2839965527),model:{value:e.selectedUsers,callback:function(t){e.selectedUsers=t},expression:"selectedUsers"}},[t("template",{slot:"no-data"},[t("v-list-item",{staticClass:"pa-0"},[t("v-list-item-title",{staticClass:"px-2"},[e._v("\n                  "+e._s(e.$t("GroupsManagement.label.addMembers"))+"\n                ")])],1)],1)],2)]:[t("v-autocomplete",{ref:"userNameInput",staticClass:"identitySuggester",attrs:{id:"userNameInput",disabled:e.saving||!e.newMembership,loading:e.loadingSuggestions>0,items:e.users,"search-input":e.searchTerm,placeholder:e.$t("GroupsManagement.addMemberInGroup"),required:!e.membership.userName,"return-object":!1,name:"membershipUser",height:"100","append-icon":"","menu-props":"closeOnClick, maxHeight = 100","content-class":"identitySuggesterContent",width:"100%","max-width":"100%","item-text":"fullName","item-value":"userName","persistent-hint":"","hide-selected":"",chips:"","cache-items":"",dense:"",flat:"","single-line":""},on:{"update:searchInput":function(t){e.searchTerm=t},"update:search-input":[function(t){e.searchTerm=t},function(t){e.searchTerm=t}]},scopedSlots:e._u([{key:"selection",fn:function({item:r,selected:s}){return[t("v-chip",{staticClass:"identitySuggesterItem",attrs:{"input-value":s,close:e.newMembership},on:{"click:close":function(t){e.membership.userName=null}}},[t("span",{staticClass:"text-truncate"},[e._v("\n                  "+e._s(r.fullName)+"\n                ")])])]}},{key:"item",fn:function({item:r}){return[t("v-list-item-title",{staticClass:"text-truncate identitySuggestionMenuItemText",domProps:{textContent:e._s(r.fullName)}})]}}]),model:{value:e.membership.userName,callback:function(t){e.$set(e.membership,"userName",t)},expression:"membership.userName"}},[t("template",{slot:"no-data"},[t("v-list-item",{staticClass:"pa-0"},[t("v-list-item-title",{staticClass:"px-2"},[e._v("\n                  "+e._s(e.$t("GroupsManagement.label.addMembers"))+"\n                ")])],1)],1)],2)]],2)],1)],1),e._v(" "),t("template",{slot:"footer"},[t("div",{staticClass:"d-flex"},[t("v-spacer"),e._v(" "),t("v-btn",{staticClass:"btn me-2",attrs:{disabled:e.saving},on:{click:e.cancel}},[e._v("\n        "+e._s(e.$t("GroupsManagement.button.cancel"))+"\n      ")]),e._v(" "),t("v-btn",{staticClass:"btn btn-primary",attrs:{disabled:e.saving,loading:e.saving},on:{click:e.saveMembership}},[e._v("\n        "+e._s(e.$t("GroupsManagement.button.save"))+"\n      ")])],1)])],2)};w._withStripped=!0;const y={data:()=>({error:null,fieldError:!1,drawer:!1,newMembership:!1,saving:!1,confirmNewPassword:null,previousSearchTerm:null,searchTerm:null,loadingSuggestions:0,membershipTypes:[],users:[],memberships:[],selectedUsers:[],group:{},membership:{},membershipType:null}),computed:{title(){return this.newMembership?this.$t("GroupsManagement.addMemberInGroup"):this.$t("GroupsManagement.editMembership")}},watch:{searchTerm(e){e&&e.length?window.setTimeout((()=>{this.previousSearchTerm===this.searchTerm&&(this.users=[],this.loadingSuggestions++,this.$userService.getUsersByStatus(e,0,20,"ENABLED").then((e=>{this.users=e&&e.entities||[]})).finally((()=>this.loadingSuggestions--))),this.previousSearchTerm=this.searchTerm}),400):this.users=[]},saving(){this.saving?this.$refs.membershipFormDrawer.startLoading():this.$refs.membershipFormDrawer.endLoading()},drawer(){this.drawer?(this.$refs.membershipFormDrawer.open(),window.setTimeout((()=>{this.$refs.membershipTypeInput.focus(),$("#membershipFormDrawer #userNameInput").on("blur",(()=>{this.$refs.userNameInput.isFocused=!1}))}),200)):this.$refs.membershipFormDrawer.close()},selectedUsers(){this.selectedUsers.forEach((e=>{this.memberships.some((t=>t.userName===e))||this.memberships.push({groupId:this.group.id,membershipType:this.membershipType,userName:e})}))}},created(){return this.$root.$on("addNewMembership",this.addNewMembership),this.$root.$on("editMembership",this.editMembership),fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/membershipTypes`,{method:"GET",credentials:"include"}).then((e=>{if(e&&e.ok)return e.json();throw new Error(this.$t("IDMManagement.error.UnknownServerError"))})).then((e=>{this.membershipTypes=e||[]}))},methods:{resetCustomValidity(){this.$refs.membershipTypeInput.setCustomValidity("")},addNewMembership(e){this.membershipType="member",this.selectedUsers=[],this.membership={},this.group=e,this.newMembership=!0,this.drawer=!0},editMembership(e,t){this.membershipType=null,this.selectedUsers=[],this.membership=Object.assign({},e),this.group=t,this.newMembership=!1,this.refreshUserSelection(this.membership.userName),this.drawer=!0},saveMembership(e){if(e&&(e.preventDefault(),e.stopPropagation()),this.error=null,this.fieldError=!1,this.resetCustomValidity(),!this.$refs.membershipForm.validate()||!this.$refs.membershipForm.$el.reportValidity())return;this.saving=!0,this.membership.groupId=this.group.id,this.memberships.forEach((e=>e.membershipType=this.membershipType));const t=`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/groups/${this.newMembership?"memberships/bulk":"memberships"}?membershipId=${this.membership.id||""}`,r={method:this.newMembership?"POST":"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.newMembership?this.memberships:this.membership)};return fetch(t,r).then((e=>{if(!e||!e.ok){if(400===e.status)return e.text().then((e=>{throw this.fieldError=e,new Error(e)}));throw new Error(this.$t("IDMManagement.error.UnknownServerError"))}})).then((()=>this.$root.$emit("refreshGroupMemberships"))).then((()=>this.$refs.membershipFormDrawer.close())).catch(this.handleError).finally((()=>{this.memberships=[],this.saving=!1}))},cancel(){this.drawer=!1},handleError(e){this.resetCustomValidity(),e?(this.fieldError&&"MEMBERSHIP:ALREADY_EXISTS"===this.fieldError?this.$refs.membershipTypeInput.setCustomValidity(this.$t("GroupsManagement.message.sameMembershipAlreadyExists")):(this.error=String(e),window.setTimeout((()=>{this.error=null}),5e3)),window.setTimeout((()=>{this.$refs.membershipForm.validate()&&this.$refs.membershipForm.$el.reportValidity()}),200)):this.error=null},refreshUserSelection(e){e&&(this.loadingSuggestions++,this.$userService.getUsersByStatus(e,0,20,"ANY").then((e=>this.users=e&&e.entities||[])).finally((()=>this.loadingSuggestions--)))},removeMemberShip(e){this.memberships.splice(this.memberships.findIndex((t=>t.userName===e.userName)),1),this.selectedUsers.splice(this.selectedUsers.findIndex((t=>t===e.userName)),1)},clearSearch(){this.searchTerm=null}}},M={"groups-management":i,"groups-management-tree":o,"groups-management-tree-item":l,"groups-management-tree-group-menu":u,"groups-management-tree-toolbar":d,"groups-management-form-drawer":f,"groups-management-membership-toolbar":c,"groups-management-membership-list":b,"groups-management-membership-form-drawer":s(y,w,[],!1,null,null,null).exports};for(const e in M)Vue.component(e,M[e]);if(extensionRegistry){const e=extensionRegistry.loadComponents("GroupsManagement");e&&e.length>0&&e.forEach((e=>{Vue.component(e.componentName,e.componentOptions)}))}const x="undefined"!=typeof eXo?eXo.env.portal.language:"en";document.dispatchEvent(new CustomEvent("displayTopBarLoading"));const _="GroupsManagement",C=`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.portlet.Portlets-${x}.json`;function G(){exoi18n.loadLanguageAsync(x,C).then((e=>{Vue.createApp({mounted(){document.dispatchEvent(new CustomEvent("hideTopBarLoading"))},template:`<groups-management id="${_}" />`,vuetify:Vue.prototype.vuetifyOptions,i18n:e},`#${_}`,"Group Management")}))}return t})()));