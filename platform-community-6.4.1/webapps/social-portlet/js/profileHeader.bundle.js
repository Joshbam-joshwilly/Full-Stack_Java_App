define((()=>(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:()=>b});var n=function(){var e=this,t=e._self._c;return t("v-app",{class:e.owner?"profileHeaderOwner":"profileHeaderOther"},[t("v-hover",{scopedSlots:e._u([{key:"default",fn:function({hover:n}){return t("div",{staticClass:"white"},[t("v-card",{staticClass:"d-flex position-relative overflow-hidden",attrs:{height:"13vw","max-height":"175",tile:"",flat:""}},[t("img",{staticClass:"profileBannerImg absolute-vertical-center",attrs:{src:e.user&&e.user.banner,alt:"",width:"100%",height:"auto",lazy:""}}),e._v(" "),e.owner?t("profile-header-banner-button",{staticClass:"justify-end full-width position-absolute t-0 r-3 pt-3",attrs:{user:e.user,hover:n},on:{edit:e.editBanner,refresh:e.refresh}}):e._e()],1),e._v(" "),t("v-card",{staticClass:"d-flex flex-column flex-md-row border-color px-4",attrs:{color:"white",flat:"",tile:""}},[t("v-card",{staticClass:"flex-shrink-0 position-relative me-2",attrs:{width:e.imageSize,"max-width":165,"max-height":"70",height:"11vw",flat:"",tile:""}},[t("v-card",{staticClass:"position-absolute z-index-two b-0 mb-2 mb-md-2",attrs:{color:"transparent",flat:"",tile:""}},[t("profile-header-avatar",{attrs:{user:e.user,owner:e.owner,hover:n,size:e.imageSize},on:{edit:e.editAvatar}})],1)],1),e._v(" "),t("v-card",{staticClass:"d-flex flex-column flex-sm-row flex-grow-1",attrs:{"min-height":"70",flat:"",tile:""}},[t("profile-header-text",{staticClass:"d-flex flex-grow-0 text-truncate",attrs:{user:e.user}}),e._v(" "),e.owner?e._e():t("profile-header-actions",{staticClass:"profileHeader flex-grow-1 flex-shrink-0 d-flex flex-row justify-start justify-sm-end my-auto",attrs:{user:e.user,hover:n},on:{refresh:e.refresh}})],1)],1)],1)}}])}),e._v(" "),e.owner?t("image-crop-drawer",{ref:"imageCropDrawer",attrs:{src:e.imageCropperSrc,circle:e.imageCropperCircle,"crop-options":e.imageCropperOptions,"drawer-title":e.imageCropperDrawerTitle,"max-file-size":e.maxUploadSizeInBytes,"max-image-width":e.maxImageWidth},on:{input:e.uploadImage}}):e._e()],1)};function i(e,t,n,i,r,s,a,o){var l,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=n,c._compiled=!0),i&&(c.functional=!0),s&&(c._scopeId="data-v-"+s),a?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},c._ssrRegister=l):r&&(l=o?function(){r.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:r),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(e,t){return l.call(t),d(e,t)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,l):[l]}return{exports:e,options:c}}n._withStripped=!0;const r=i({props:{maxUploadSize:{type:Number,default:()=>2}},data:()=>({user:null,owner:eXo.env.portal.profileOwner===eXo.env.portal.userName,errorMessage:null,imageType:null}),computed:{small(){return this.$vuetify.breakpoint.mdAndDown},large(){return this.$vuetify.breakpoint.lgAndUp},xlarge(){return this.$vuetify.breakpoint.xlAndUp},imageSize:()=>"15vw",maxImageViewHeight(){return this.large?"175px":"calc(16.6vw - 40px)"},maxUploadSizeInBytes(){return 1024*this.maxUploadSize*1024},imageCropperDrawerTitle(){return"avatar"===this.imageType&&this.$t("UIChangeAvatarContainer.label.ChangeAvatar")||this.$t("UIPopupBannerUploader.title.ChangeBanner")},imageCropperSrc(){return this.user&&("avatar"===this.imageType&&`${this.user.avatar}&size=0`||`${this.user.banner}&size=0`)},imageCropperCircle(){return"avatar"===this.imageType},imageCropperOptions(){return"avatar"===this.imageType&&{aspectRatio:1,viewMode:1}||{aspectRatio:1280/175,viewMode:1}},maxImageWidth(){return"avatar"===this.imageType?350:1280}},watch:{errorMessage(){this.errorMessage&&this.$root.$emit("alert-message",this.errorMessage,"error")}},mounted(){this.refresh(),document.addEventListener("userModified",(e=>{e&&e.detail&&e.detail!==this.user&&(this.user=Object.assign({},this.user,e.detail),this.$nextTick().then((()=>this.$root.$emit("application-loaded"))))}))},methods:{editAvatar(){this.imageType="avatar",this.$nextTick().then((()=>this.$refs.imageCropDrawer.open()))},editBanner(){this.imageType="banner",this.$nextTick().then((()=>this.$refs.imageCropDrawer.open()))},uploadImage(e){"avatar"===this.imageType?this.uploadAvatar(e):"banner"===this.imageType&&this.uploadBanner(e)},uploadAvatar(e){if(e)return this.$userService.updateProfileField(eXo.env.portal.userName,"avatar",e).then((()=>this.avatarUpdated())).catch(this.handleError).finally((()=>this.imageType=null))},uploadBanner(e){if(e)return this.$userService.updateProfileField(eXo.env.portal.userName,"banner",e).then((()=>this.bannerUpdated())).catch(this.handleError).finally((()=>this.imageType=null))},avatarUpdated(){return this.refresh().then((()=>{document.dispatchEvent(new CustomEvent("userModified",{detail:this.user})),this.$root.$emit("alert-message",this.$t("UIChangeAvatarContainer.label.AvatarUpdated"),"success")}))},bannerUpdated(){return this.refresh().then((()=>{document.dispatchEvent(new CustomEvent("userModified",{detail:this.user})),this.$root.$emit("alert-message",this.$t("UIPopupBannerUploader.title.BannerUpdated"),"success")}))},refresh(){return this.$userService.getUser(eXo.env.portal.profileOwner,"relationshipStatus").then((e=>(this.user=e,this.$nextTick()))).catch((e=>{console.warn("Error while retrieving user details",e)})).finally((()=>this.$nextTick().then((()=>this.$root.$applicationLoaded()))))},handleError(e){e&&(String(e).indexOf(this.$uploadService.avatarExcceedsLimitError)>=0?this.errorMessage=this.$t("profileHeader.label.avatarExcceededAllowedSize",{0:this.maxUploadSize}):String(e).indexOf(this.$uploadService.bannerExcceedsLimitError)>=0?this.errorMessage=this.$t("profileHeader.label.bannerExcceededAllowedSize",{0:this.maxUploadSize}):this.errorMessage=String(e))}}},n,[],!1,null,null,null).exports;var s=function(){var e=this,t=e._self._c;return t("v-card",{staticClass:"d-flex",attrs:{id:"profileHeaderText",color:"transparent","min-height":"70",flat:"",tile:""}},[t("div",{staticClass:"d-flex flex-column my-auto"},[t("div",{staticClass:"title text-break text-wrap",attrs:{id:"profileHeaderUserFullname"}},[e._v("\n      "+e._s(e.userFullname)+"\n    ")]),e._v(" "),e.userPosition?t("div",{staticClass:"subtitle text-sub-title text-break text-wrap",attrs:{id:"profileHeaderUserPosition"}},[e._v("\n      "+e._s(e.userPosition||"")+"\n    ")]):e._e()])])};s._withStripped=!0;const a=i({props:{user:{type:Object,default:()=>null}},computed:{userFullname(){return this.user?.fullname&&`${this.user.fullname}${this.external}${this.disabled}`},userPosition(){return this.user?.position},external(){return this.user&&"true"===this.user.external?` (${this.$t("profileHeader.label.external")}) `:""},disabled(){return this.user&&!this.user.enabled?` (${this.$t("profileHeader.label.disabled")}) `:""}}},s,[],!1,null,null,null).exports;var o=function(){var e=this,t=e._self._c;return t("v-card",{staticClass:"profileHeaderOtherActions d-flex",attrs:{id:"profileHeaderActions","max-height":"70",flat:"",tile:""}},[t("div",{staticClass:"d-flex justify-end flex-wrap my-auto"},[e._l(e.enabledProfileActionExtensions,(function(n,i){return t("v-btn",{key:i,staticClass:"btn ma-2 mb-0",on:{click:function(t){return n.click(e.user)}}},[t("i",{staticClass:"uiIcon",class:n.icon?n.icon:"hidden"}),e._v(" "),t("span",{staticClass:"buttonText"},[e._v("\n        "+e._s(n.title)+"\n      ")])])})),e._v(" "),e.invited?t("div",{staticClass:"invitationButtons d-inline"},[t("v-dialog",{attrs:{"content-class":"border-box-sizing width-auto",width:"auto"},model:{value:e.mobileAcceptRefuseConnectionDialog,callback:function(t){e.mobileAcceptRefuseConnectionDialog=t},expression:"mobileAcceptRefuseConnectionDialog"}},[t("v-card",{staticClass:"d-flex flex-column pa-0",attrs:{color:"white"}},[t("v-btn",{staticClass:"white no-border-radius success--text",attrs:{disabled:e.loading,loading:e.loading,block:""},on:{click:e.acceptToConnect}},[e._v("\n            "+e._s(e.$t("profileHeader.button.acceptToConnect"))+"\n          ")]),e._v(" "),t("v-btn",{staticClass:"white no-border-radius error--text",attrs:{disabled:e.loading,loading:e.loading,block:"",outlined:""},on:{click:e.refuseToConnect}},[e._v("\n            "+e._s(e.$t("profileHeader.button.refuseToConnect"))+"\n          ")])],1)],1),e._v(" "),t("div",{staticClass:"acceptToConnectButtonParent"},[t("v-btn",{staticClass:"btn btn-primary mx-auto acceptToConnectButton",attrs:{loading:e.sendingAction,disabled:e.sendingAction},on:{click:e.acceptToConnect}},[t("i",{staticClass:"uiIconSocConnectUser"}),e._v(" "),t("span",{staticClass:"buttonText"},[e._v("\n            "+e._s(e.$t("profileHeader.button.acceptToConnect"))+"\n          ")])]),e._v(" "),t("v-btn",{staticClass:"btn btn-primary peopleButtonMenu dropdownButton",on:{click:e.openSecondButton}},[t("v-icon",[e._v("mdi-menu-down")])],1),e._v(" "),t("v-btn",{staticClass:"btn btn-primary peopleButtonMenu dialogButton",on:{click:function(t){return e.openSecondButton(!0)}}},[t("v-icon",[e._v("mdi-close")])],1)],1),e._v(" "),t("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.displaySecondButton,expression:"displaySecondButton"}],staticClass:"btn mx-auto refuseToConnectButton",attrs:{loading:e.sendingSecondAction,disabled:e.sendingSecondAction},on:{click:e.refuseToConnect}},[t("i",{staticClass:"uiIconSocCancelConnectUser"}),e._v(" "),t("span",{staticClass:"buttonText"},[e._v("\n          "+e._s(e.$t("profileHeader.button.refuseToConnect"))+"\n        ")])])],1):e.requested?t("v-btn",{staticClass:"btn btn-primary mx-auto cancelRequestButton",attrs:{loading:e.sendingAction,disabled:e.sendingAction},on:{click:e.cancelRequest}},[t("i",{staticClass:"uiIconSocCancelConnectUser"}),e._v(" "),t("span",{staticClass:"buttonText"},[e._v("\n        "+e._s(e.$t("profileHeader.button.cancelRequest"))+"\n      ")])]):e.disconnected?t("v-btn",{staticClass:"btn ma-1 mb-0 btn-primary connectUserButton",attrs:{loading:e.sendingAction,disabled:e.sendingAction},on:{click:e.connect}},[t("i",{staticClass:"uiIconSocConnectUser"}),e._v(" "),t("span",{staticClass:"buttonText"},[e._v("\n        "+e._s(e.$t("profileHeader.button.connect"))+"\n      ")])]):e._e(),e._v(" "),t("div",{staticClass:"profileHeaderActionComponents order-first mb-0"},e._l(e.enabledProfileHeaderActionComponents,(function(n){return t("div",{key:n.key,ref:n.key,refInFor:!0,class:`${n.appClass} ${n.typeClass}`},[n.component?t("div",[t(n.component.name,e._b({directives:[{name:"dynamic-events",rawName:"v-dynamic-events",value:n.component.events,expression:"action.component.events"}],tag:"component"},"component",n.component.props?n.component.props:{},!1))],1):n.element?t("div",{domProps:{innerHTML:e._s(n.element.outerHTML)}}):n.html?t("div",{domProps:{innerHTML:e._s(n.html)}}):e._e(),e._v("\n        "+e._s(e.initTitleActionComponent(n))+"\n      ")])})),0)],2)])};o._withStripped=!0;const l=("action-component",extensionRegistry.loadExtensions("profile-header","action-component"));const c=i({props:{user:{type:Object,default:()=>null},hover:{type:Boolean,default:()=>!1}},data:()=>({profileActionExtensions:[],mobileAcceptRefuseConnectionDialog:!1,sendingAction:!1,sendingSecondAction:!1,displaySecondButton:!1,waitTimeUntilCloseMenu:200,profileHeaderActionComponents:l,isMounted:null,resolveMounting:null}),computed:{isMobile(){return this.$vuetify&&this.$vuetify.breakpoint&&"xs"===this.$vuetify.breakpoint.name},enabledProfileHeaderActionComponents(){return this.profileHeaderActionComponents&&this.profileHeaderActionComponents.filter((e=>e.enabled))||[]},relationshipStatus(){return this.user&&this.user.relationshipStatus},connected(){return"CONFIRMED"===this.relationshipStatus},disconnected(){return!this.relationshipStatus||"IGNORED"===this.relationshipStatus},invited(){return"INCOMING"===this.relationshipStatus},requested(){return"OUTGOING"===this.relationshipStatus},enabledProfileActionExtensions(){return this.profileActionExtensions&&this.user?this.profileActionExtensions.slice().filter((e=>e.enabled(this.user))):[]}},created(){document.addEventListener("profile-extension-updated",this.refreshExtensions),document.dispatchEvent(new CustomEvent("profile-extension-init")),this.refreshExtensions(),$(document).on("mousedown",(()=>{this.displaySecondButton&&window.setTimeout((()=>{this.displaySecondButton=!1}),this.waitTimeUntilCloseMenu)}));const e=this;this.isMounted=new Promise((function(t){e.resolveMounting=t}))},mounted(){this.resolveMounting()},methods:{refreshExtensions(){this.profileActionExtensions=extensionRegistry.loadExtensions("profile-extension","action")||[]},openSecondButton(e){e?this.mobileAcceptRefuseConnectionDialog=!0:this.displaySecondButton=!this.displaySecondButton},connect(){this.sendingAction=!0,this.$userService.connect(this.user.username).then((()=>this.$emit("refresh"))).catch((e=>{console.error("Error processing action",e)})).finally((()=>{this.sendingAction=!1}))},acceptToConnect(){this.sendingAction=!0,this.$userService.confirm(this.user.username).then((()=>this.$emit("refresh"))).catch((e=>{console.error("Error processing action",e)})).finally((()=>{this.sendingAction=!1}))},refuseToConnect(){this.sendingSecondAction=!0,this.$userService.deleteRelationship(this.user.username).then((()=>this.$emit("refresh"))).catch((e=>{console.error("Error processing action",e)})).finally((()=>{this.sendingSecondAction=!1}))},cancelRequest(){this.sendingAction=!0,this.$userService.deleteRelationship(this.user.username).then((()=>this.$emit("refresh"))).catch((e=>{console.error("Error processing action",e)})).finally((()=>{this.sendingAction=!1}))},initTitleActionComponent(e){const t=this;e.init&&!e.isStartedInit&&e.enabled&&this.user&&(e.isStartedInit=!0,this.isMounted.then((()=>{let n=this.$refs[e.key];n&&n.length>0?(n=n[0],e.init(n,t.user.username)):console.error(`Error initialization of the ${e.key} action component: empty container`)})))}}},o,[],!1,null,null,null).exports;var d=function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-flex"},[t("v-avatar",{staticClass:"align-start flex-grow-0 border-color profileHeaderAvatar",class:e.owner&&e.hover&&"profileHeaderAvatarHoverEdit",attrs:{size:e.size,id:"profileAvatar","min-width":"44","min-height":"44","max-width":"165","max-height":"165"}},[t("v-img",{attrs:{"lazy-src":e.avatarData||e.user&&`${e.user.avatar}&size=165x165`||"",src:e.avatarData||e.user&&`${e.user.avatar}&size=165x165`||"",id:"profileAvatarImg",transition:"none","min-width":"44","min-height":"44","max-width":"165","max-height":"165",eager:"",role:"presentation"}}),e._v(" "),e.owner?t("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.hover,expression:"hover"}],ref:"avatarInput",staticClass:"changeAvatarButton",attrs:{title:e.$t("UIChangeAvatarContainer.label.ChangeAvatar"),id:"profileAvatarEditButton",icon:"",outlined:"",dark:""},on:{click:function(t){return e.$emit("edit")}}},[t("v-icon",{attrs:{size:"18"}},[e._v("fas fa-camera")])],1):e._e()],1),e._v(" "),e._t("default")],2)};d._withStripped=!0;const u=i({props:{user:{type:Object,default:()=>null},avatarData:{type:Array,default:null},owner:{type:Boolean,default:()=>!0},hover:{type:Boolean,default:()=>!1},size:{type:Number,default:()=>165}}},d,[],!1,null,null,null).exports;var p=function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-flex flex-row changeBannerButton"},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isDefaultBanner&&e.hover,expression:"!isDefaultBanner && hover"}],staticClass:"changeBannerButtonIcon me-2"},[t("v-btn",{staticClass:"border-color",attrs:{title:e.$t("UIPopupBannerUploader.title.deleteBanner"),id:"profileBannerDeleteButton",outlined:"",icon:"",dark:""},on:{click:e.removeBanner}},[t("v-icon",{attrs:{size:"18"}},[e._v("mdi-delete")])],1)],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.hover,expression:"hover"}],staticClass:"changeBannerButtonIcon"},[t("v-btn",{staticClass:"border-color",attrs:{title:e.$t("UIPopupBannerUploader.title.ChangeBanner"),id:"profileBannerEditButton",outlined:"",icon:"",dark:""},on:{click:function(t){return e.$emit("edit")}}},[t("v-icon",{attrs:{size:"18"}},[e._v("fas fa-file-image")])],1)],1)])};p._withStripped=!0;const h={"profile-header":r,"profile-header-avatar":u,"profile-header-banner-button":i({props:{hover:{type:Boolean,default:()=>!1},user:{type:Object,default:()=>null}},computed:{isDefaultBanner(){return this.user&&this.user.banner&&this.user.banner.startsWith("/portal/rest/v1/social/users/default-image/")}},methods:{removeBanner(){return this.$userService.updateProfileField(eXo.env.portal.userName,"banner",null).then((()=>{this.isDefaultBanner=!0,this.$root.$emit("alert-message",this.$t("UIPopupBannerUploader.title.BannerDeleted"),"success"),this.$emit("refresh")})).catch((e=>this.$emit("error",e)))}}},p,[],!1,null,null,null).exports,"profile-header-actions":c,"profile-header-text":a};for(const e in h)Vue.component(e,h[e]);if(extensionRegistry){const e=extensionRegistry.loadComponents("ProfileHeader");e&&e.length>0&&e.forEach((e=>{Vue.component(e.componentName,e.componentOptions)}))}document.dispatchEvent(new CustomEvent("displayTopBarLoading"));const v=eXo&&eXo.env.portal.language||"en",f=[`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.portlet.social.ProfileHeader-${v}.json`,`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.portlet.Portlets-${v}.json`],m="ProfileHeader",g=`${m}_${eXo.env.portal.profileOwnerIdentityId}`;function b(e){exoi18n.loadLanguageAsync(v,f).then((t=>{const n=document.createElement("div");n.id=m,Vue.createApp({mounted(){document.dispatchEvent(new CustomEvent("hideTopBarLoading"))},template:`<profile-header v-cacheable="{cacheId: '${g}'}" id="${m}" max-upload-size="${e}" />`,i18n:t,vuetify:Vue.prototype.vuetifyOptions},n,"Profile Header")}))}return t})()));