define((()=>(()=>{"use strict";var t={d:(e,i)=>{for(var n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{init:()=>b});var i=function(){var t=this,e=t._self._c;return t.displayed?e("v-app",[t.displayDetails?e("user-setting-notifications-window",{attrs:{settings:t.notificationSettings},on:{back:t.closeDetail}}):e("v-card",{staticClass:"my-3 border-radius",attrs:{flat:""}},[e("v-list",{on:{click:t.openNotificationSettingDetail}},[e("v-list-item",[e("v-list-item-content",[e("v-list-item-title",{staticClass:"title text-color"},[t._v("\n            "+t._s(t.$t("UserSettings.notifications"))+"\n          ")])],1)],1),t._v(" "),t.notificationSettings&&t.notificationSettings.channels?t._l(t.notificationSettings.channels,(function(i){return e("user-setting-notification-channel",{key:i,attrs:{channel:i,active:t.notificationSettings.channelStatus[i],settings:t.notificationSettings}})})):t._e(),t._v(" "),e("v-list-item",[e("v-list-item-content",[e("v-list-item-title",{staticClass:"title text-color"},[t._v("\n            "+t._s(t.$t("UserSettings.manageNotifications"))+"\n          ")])],1),t._v(" "),e("v-list-item-action",[e("v-btn",{attrs:{small:"",icon:""},on:{click:t.openDetail}},[e("v-icon",{staticClass:"text-sub-title",attrs:{size:"24"}},[t._v("\n              "+t._s(t.$vuetify.rtl?"fa-caret-left":"fa-caret-right")+"\n            ")])],1)],1)],1)],2)],1)],1):t._e()};function n(t,e,i,n,s,a,l,o){var r,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=i,c._compiled=!0),n&&(c.functional=!0),a&&(c._scopeId="data-v-"+a),l?(r=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(l)},c._ssrRegister=r):s&&(r=o?function(){s.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:s),r)if(c.functional){c._injectStyles=r;var d=c.render;c.render=function(t,e){return r.call(e),d(t,e)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,r):[r]}return{exports:t,options:c}}i._withStripped=!0;const s=n({data:()=>({id:`Notifications${parseInt(1e4*Math.random()).toString().toString()}`,notificationSettings:null,displayDetails:!1,displayed:!0}),created(){document.addEventListener("hideSettingsApps",(t=>{t&&t.detail&&this.id!==t.detail&&(this.displayed=!1)})),document.addEventListener("showSettingsApps",(()=>this.displayed=!0)),this.$root.$on("refresh",this.refresh),this.refresh()},methods:{refresh(){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/notifications/settings/${eXo.env.portal.userName}`).then((t=>t&&t.ok&&t.json())).then((t=>(this.notificationSettings=t,this.$nextTick()))).finally((()=>{this.$nextTick().then((()=>this.$root.$applicationLoaded()))}))},openDetail(){document.dispatchEvent(new CustomEvent("hideSettingsApps",{detail:this.id})),this.displayDetails=!0},closeDetail(){document.dispatchEvent(new CustomEvent("showSettingsApps")),this.displayDetails=!1}}},i,[],!1,null,null,null).exports;var a=function(){var t=this,e=t._self._c;return t.settings?e("v-card",{attrs:{flat:""}},[e("v-toolbar",{staticClass:"border-box-sizing",attrs:{flat:""}},[e("v-btn",{staticClass:"mx-1",attrs:{icon:"",height:"36",width:"36"},on:{click:function(e){return t.$emit("back")}}},[e("v-icon",{attrs:{size:"20"}},[t._v("\n        "+t._s(t.$vuetify.rtl?"mdi-arrow-right":"mdi-arrow-left")+"\n      ")])],1),t._v(" "),e("v-toolbar-title",{staticClass:"ps-0"},[t._v("\n      "+t._s(t.$t("UserSettings.manageNotifications"))+"\n    ")]),t._v(" "),e("v-spacer")],1),t._v(" "),e("v-flex",{staticClass:"ma-3 white"},t._l(t.settings.groups,(function(i){return e("user-setting-notification-group",{key:i.groupId,attrs:{settings:t.settings,group:i,"digest-mail-notification-enabled":t.digestMailNotificationEnabled},on:{edit:t.openDrawer}})})),1),t._v(" "),e("user-setting-notification-drawer",{ref:"drawer",attrs:{settings:t.settings,"digest-mail-notification-enabled":t.digestMailNotificationEnabled}})],1):t._e()};a._withStripped=!0;const l=n({props:{settings:{type:Object,default:null}},data:()=>({digestMailNotificationEnabled:!1}),created(){this.$featureService.isFeatureEnabled("digestMailNotification").then((t=>this.digestMailNotificationEnabled=t))},methods:{openDrawer(t,e){this.$nextTick((()=>this.$refs.drawer.open(t,e)))}}},a,[],!1,null,null,null).exports;var o=function(){var t=this,e=t._self._c;return e("div",[e("v-list-item",{attrs:{"two-line":""}},[e("v-list-item-content",[e("v-list-item-title",{staticClass:"text-color"},[t._v("\n        "+t._s(t.label)+"\n      ")]),t._v(" "),t.description?e("v-list-item-subtitle",{staticClass:"text-sub-title font-italic"},[t._v("\n        "+t._s(t.description)+"\n      ")]):t._e()],1),t._v(" "),e("v-list-item-action",[e("v-switch",{attrs:{loading:t.saving},on:{change:t.save},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}})],1)],1),t._v(" "),e("v-divider",{staticClass:"mx-4"})],1)};o._withStripped=!0;const r=n({props:{channel:{type:String,default:null},active:{type:Boolean,default:null},settings:{type:Object,default:null}},data:()=>({saving:!1}),computed:{label(){return this.settings&&this.settings.channelLabels&&this.settings.channelLabels[this.channel]},description(){return this.settings&&this.settings.channelDescriptions&&this.settings.channelDescriptions[this.channel]}},methods:{save(){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/notifications/settings/${eXo.env.portal.userName}/channel/${this.channel}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`enable=${this.active}`}).then((t=>{t&&t.ok&&this.$root.$emit("refresh")})).finally((()=>{this.saving=!1}))}}},o,[],!1,null,null,null).exports;var c=function(){var t=this,e=t._self._c;return t.manageNotification?e("div",{staticClass:"border-radius border-color ma-4"},[e("v-list-item",{attrs:{dense:""}},[e("v-list-item-content",[e("v-list-item-title",{staticClass:"text-color font-weight-bold subtitle-1"},[t._v("\n        "+t._s(t.label)+"\n      ")])],1)],1),t._v(" "),t._l(t.group.pluginInfos,(function(i){return e("user-setting-notification-plugin",{key:i.type,attrs:{plugin:i,settings:t.settings,"digest-mail-notification-enabled":t.digestMailNotificationEnabled},on:{edit:function(e){return t.$emit("edit",i,t.group)}}})}))],2):t._e()};c._withStripped=!0;const d=n({props:{group:{type:Object,default:null},settings:{type:Object,default:null},digestMailNotificationEnabled:{type:Boolean,default:!1}},computed:{label(){return this.settings&&this.settings.groupsLabels&&this.settings.groupsLabels[this.group.groupId]},manageNotification(){return this.group&&this.group.pluginInfos&&this.group.pluginInfos.length}}},c,[],!1,null,null,null).exports;var h=function(){var t=this,e=t._self._c;return e("div",[e("v-divider"),t._v(" "),e("v-list-item",{attrs:{dense:""}},[e("v-list-item-content",{staticClass:"px-0 pb-0 pt-2 mt-auto mb-2"},[e("v-list-item-title",{staticClass:"text-color text-wrap"},[t._v("\n        "+t._s(t.label)+"\n      ")])],1),t._v(" "),e("v-list-item-action",{staticClass:"ma-auto"},[e("v-btn",{attrs:{icon:""},on:{click:function(e){return t.$emit("edit")}}},[e("i",{staticClass:"uiIconEdit uiIconLightBlue pb-2"})])],1)],1),t._v(" "),t.hasNotificationSettings?e("v-flex",{staticClass:"d-flex flex-wrap"},[t.enabledDigestLabel?[e("v-chip",{staticClass:"ma-2",attrs:{color:"primary"}},[e("span",{staticClass:"text-truncate"},[t._v("\n          "+t._s(t.enabledDigestLabel)+"\n        ")])])]:t._e(),t._v(" "),t.enabledNotificationLabels&&t.enabledNotificationLabels.length?t._l(t.enabledNotificationLabels,(function(i){return e("v-chip",{key:i,staticClass:"ma-2",attrs:{color:"primary"}},[e("span",{staticClass:"text-truncate"},[t._v("\n          "+t._s(i)+"\n        ")])])})):t._e()],2):e("v-list-item",{attrs:{dense:""}},[e("v-list-item-content",{staticClass:"pa-0"},[e("v-list-item-subtitle",{staticClass:"text-sub-title font-italic"},[t._v("\n        "+t._s(t.$t("UINotification.label.NoNotifications"))+"\n      ")])],1)],1)],1)};h._withStripped=!0;const u=n({props:{plugin:{type:Object,default:null},settings:{type:Object,default:null},digestMailNotificationEnabled:{type:Boolean,default:!1}},computed:{label(){return this.settings&&this.settings.pluginLabels&&this.settings.pluginLabels[this.plugin.type]},hasInstantNotificationSettings(){return this.enabledNotificationLabels&&this.enabledNotificationLabels.length||this.enabledDigest},hasNotificationSettings(){return this.hasInstantNotificationSettings||this.enabledDigest},enabledDigest(){return this.digestMailNotificationEnabled?this.settings&&this.settings.emailDigestChoices&&this.settings.emailDigestChoices.find((t=>t&&t.channelActive&&t.channelId===this.settings.emailChannel&&t.pluginId===this.plugin.type)):[]},enabledDigestLabel(){return this.enabledDigest&&this.settings.digestDescriptions&&this.enabledDigest.value&&"Never"!==this.enabledDigest.value&&this.settings.digestDescriptions[this.enabledDigest.value]},enabledNotifications(){return this.settings&&this.settings.channelCheckBoxList&&this.settings.channelCheckBoxList.filter((t=>t.active&&t.channelActive&&t.pluginId===this.plugin.type))},enabledNotificationLabels(){return this.enabledNotifications&&this.enabledNotifications.map((t=>this.settings.channelLabels[t.channelId]))}}},h,[],!1,null,null,null).exports;var p=function(){var t=this,e=t._self._c;return e("exo-drawer",{ref:"drawer",staticClass:"userNotificationDrawer",attrs:{"body-classes":"hide-scroll decrease-z-index-more",right:""},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[e("template",{slot:"title"},[e("span",{staticClass:"text-wrap"},[t._v("\n      "+t._s(t.pluginLabel)+"\n    ")])]),t._v(" "),e("template",{slot:"content"},t._l(t.listChannelOptions,(function(i){return e("div",{key:i.channelId},[i.allowed?e("v-row",{staticClass:"ma-0 d-flex"},[e("v-col",{staticClass:"flex-grow-1"},[e("label",{staticClass:"my-auto",attrs:{for:i.channelId}},[t._v(t._s(t.channelLabels[i.channelId]))])]),t._v(" "),e("v-col",{staticClass:"text-right flex-grow-0"},[e("v-switch",{staticClass:"mt-0",attrs:{name:i.channelId,disabled:!i.channelActive,"hide-details":"",dense:""},model:{value:t.channels[i.channelId],callback:function(e){t.$set(t.channels,i.channelId,e)},expression:"channels[pluginOption.channelId]"}})],1)],1):t._e(),t._v(" "),i.channelId===t.emailChannel&&t.digestMailNotificationEnabled?[e("v-row",{staticClass:"ma-0"},[e("v-col",[e("label",{staticClass:"align-start",attrs:{for:"EMAIL_DIGEST"}},[t._v(t._s(t.$t("UINotification.label.selectBox-mail")))])]),t._v(" "),e("v-col",{staticClass:"text-right"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.digest,expression:"digest"}],staticClass:"col-auto me-2 my-auto px-3 py-0 subtitle-1 ignore-vuetify-classes",attrs:{disabled:!i.channelActive,name:"EMAIL_DIGEST"},on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.digest=e.target.multiple?i:i[0]}}},t._l(t.digestOptions,(function(i){return e("option",{key:i.value,domProps:{value:i.value}},[t._v("\n                "+t._s(i.text)+"\n              ")])})),0)])],1)]:t._e()],2)})),0),t._v(" "),e("template",{slot:"footer"},[e("div",{staticClass:"d-flex"},[e("v-spacer"),t._v(" "),e("v-btn",{staticClass:"btn me-2",on:{click:t.cancel}},[t._v("\n        "+t._s(t.$t("UserSettings.button.cancel"))+"\n      ")]),t._v(" "),e("v-btn",{staticClass:"btn btn-primary",on:{click:t.save}},[t._v("\n        "+t._s(t.$t("UserSettings.button.apply"))+"\n      ")])],1)])],2)};p._withStripped=!0;const g={"user-setting-notifications":s,"user-setting-notifications-window":l,"user-setting-notification-channel":r,"user-setting-notification-group":d,"user-setting-notification-plugin":u,"user-setting-notification-drawer":n({props:{settings:{type:Object,default:null},digestMailNotificationEnabled:{type:Boolean,default:!1}},data:()=>({drawer:!1,channels:{},digest:null,emailChannel:null,listChannelOptions:[],plugin:null,group:null}),computed:{digestOptions(){return this.settings&&Object.keys(this.settings.digestLabels).map((t=>({value:t,text:this.settings.digestLabels[t]})))},channelLabels(){return this.settings&&this.settings.channelLabels},groupLabel(){return this.settings&&this.group&&this.settings.groupsLabels[this.group.groupId]},pluginLabel(){return this.settings&&this.plugin&&this.settings.pluginLabels[this.plugin.type]}},methods:{open(t,e){this.plugin=t,this.group=e,this.emailChannel=this.settings&&this.settings.emailChannel,this.listChannelOptions=this.settings?.channelCheckBoxList?.filter((t=>t.allowed&&t.pluginId===this.plugin.type)).map((t=>JSON.parse(JSON.stringify(t))))||[];const i=this.settings&&this.settings.emailDigestChoices&&this.settings.emailDigestChoices.find((t=>t&&t.channelActive&&t.channelId===this.emailChannel&&t.pluginId===this.plugin.type));this.digest=i&&i.value,this.channels={},this.listChannelOptions.forEach((t=>{this.channels[t.channelId]=t.allowed&&t.active&&t.channelActive})),this.listChannelOptions.sort(((t,e)=>t.channelId.localeCompare(e.channelId))),this.$refs.drawer.open()},save(){this.$refs.drawer.startLoading();const t=Object.keys(this.channels).map((t=>`${t}=${this.channels[t]}`)).join(",");return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/notifications/settings/${eXo.env.portal.userName}/plugin/${this.plugin.type}`,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`digest=${this.digest}&channels=${t}`}).then((t=>{t&&t.ok&&(this.$root.$emit("refresh"),this.$refs.drawer.close())})).finally((()=>{this.$refs.drawer.endLoading()}))},cancel(){this.$refs.drawer.close()}}},p,[],!1,null,null,null).exports};for(const t in g)Vue.component(t,g[t]);if(extensionRegistry){const t=extensionRegistry.loadComponents("UserSettingNotifications");t&&t.length>0&&t.forEach((t=>{Vue.component(t.componentName,t.componentOptions)}))}document.dispatchEvent(new CustomEvent("displayTopBarLoading"));const v=eXo&&eXo.env.portal.language||"en",f=[`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.portlet.notification.UserNotificationPortlet-${v}.json`,`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.portlet.social.UserSettings-${v}.json`],m="UserSettingNotifications";function b(t){exoi18n.loadLanguageAsync(v,f).then((e=>{const i=document.createElement("div");i.id=m,Vue.createApp({data:{settings:t},mounted(){document.dispatchEvent(new CustomEvent("hideTopBarLoading"))},template:`<user-setting-notifications v-cacheable id="${m}" :languages="settings && settings.languages" :timezones="settings && settings.timezones" />`,i18n:e,vuetify:Vue.prototype.vuetifyOptions},i,"User Settings Notifications")}))}return e})()));