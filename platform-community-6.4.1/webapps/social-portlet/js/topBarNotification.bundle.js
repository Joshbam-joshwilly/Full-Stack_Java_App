define((()=>(()=>{"use strict";var t={d:(e,i)=>{for(var o in i)t.o(i,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:i[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{init:()=>d,updateBadge:()=>l});var i={};t.r(i),t.d(i,{getNotifications:()=>r,initCometd:()=>c,updateNotification:()=>s});var o=function(){var t=this,e=t._self._c;return e("v-app",{attrs:{id:"NotificationPopoverPortlet"}},[e("v-flex",[e("v-layout",[e("v-btn",{staticClass:"text-xs-center",attrs:{icon:"",title:t.notificationIconTooltip},on:{click:function(e){return t.openDrawer()}}},[e("v-badge",{attrs:{value:t.badge>0,content:t.badge,flat:"",color:"var(--allPagesBadgePrimaryColor, #d32a2a)",overlap:""}},[e("v-icon",{staticClass:"icon-default-color",attrs:{size:"22"}},[t._v("fa-bell")])],1)],1),t._v(" "),e("exo-drawer",{ref:"drawerNotificationDrawer",staticClass:"notifDrawer",attrs:{"body-classes":"hide-scroll",right:""}},[e("template",{slot:"title"},[t._v("\n          "+t._s(t.$t("UIIntranetNotificationsPortlet.title.notifications"))+"\n        ")]),t._v(" "),e("template",{slot:"titleIcons"},[e("v-btn",{attrs:{title:t.$t("UIIntranetNotificationsPortlet.title.NotificationsSetting"),href:t.settingsLink,icon:""}},[e("v-icon",{staticClass:"uiSettingsIcon notifDrawerSettings"})],1)],1),t._v(" "),t.notificationsSize?e("template",{slot:"content"},[e("div",{staticClass:"notifDrawerItems"},t._l(t.notifications,(function(i,o){return e("a",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:i.notification,expression:"notif.notification"}],key:o,staticClass:"notifDrawerItem",attrs:{id:"notifItem-"+o},on:{mouseenter:function(e){return t.applyActions("notifItem-"+o)}}})})),0)]):t.loading?t._e():e("template",{slot:"content"},[e("div",{staticClass:"noNoticationWrapper"},[e("div",{staticClass:"noNotificationsContent"},[e("i",{staticClass:"uiNoNotifIcon"}),t._v(" "),e("p",[t._v(t._s(t.$t("UIIntranetNotificationsPortlet.label.NoNotifications")))])])])]),t._v(" "),t.notificationsSize?e("template",{slot:"footer"},[e("v-row",{staticClass:"notifFooterActions mx-0"},[e("v-card",{staticClass:"d-flex flex justify-end mx-2",attrs:{flat:"",tile:""}},[e("v-btn",{staticClass:"text-uppercase caption markAllAsRead",attrs:{text:"",small:"",color:"primary"},on:{click:function(e){return t.markAllAsRead()}}},[t._v("\n                "+t._s(t.$t("UIIntranetNotificationsPortlet.label.MarkAllAsRead"))+"\n              ")]),t._v(" "),e("v-btn",{staticClass:"text-uppercase caption primary--text seeAllNotif",attrs:{href:t.allNotificationsLink,outlined:"",small:""}},[t._v("\n                "+t._s(t.$t("UIIntranetNotificationsPortlet.label.seeAll"))+"\n              ")])],1)],1)],1):t._e()],2)],1)],1)],1)};o._withStripped=!0;var n=function(t,e,i,o,n,a,r,s){var c,l="function"==typeof t?t.options:t;if(e&&(l.render=e,l.staticRenderFns=[],l._compiled=!0),c)if(l.functional){l._injectStyles=c;var d=l.render;l.render=function(t,e){return c.call(e),d(t,e)}}else{var f=l.beforeCreate;l.beforeCreate=f?[].concat(f,c):[c]}return{exports:t,options:l}}({data(){return{loading:!1,drawerNotification:!1,notifications:[],badge:0,notificationsSize:0,settingsLink:`${eXo.env.portal.context}/${eXo.env.portal.portalName}/settings`,allNotificationsLink:`${eXo.env.portal.context}/${eXo.env.portal.portalName}/allNotifications`,notificationIconTooltip:this.$t("UIIntranetNotificationsPortlet.label.tooltip")}},watch:{badge(){return this.badge},loading(){!this.loading&&this.$refs.drawerNotificationDrawer&&this.$refs.drawerNotificationDrawer.endLoading()}},created(){document.addEventListener("cometdNotifEvent",this.notificationUpdated),this.getNotifications()},mounted(){this.$refs.drawerNotificationDrawer&&(this.loading?this.$refs.drawerNotificationDrawer.startLoading():this.$refs.drawerNotificationDrawer.endLoading()),this.openDrawer(),this.$root.$applicationLoaded()},methods:{getNotifications(){return this.loading=!0,this.$notificationService.getNotifications().then((t=>(this.notifications=t.notifications,this.badge=t.badge,this.notificationsSize=this.notifications.length,this.$nextTick()))).finally((()=>this.loading=!1))},markAllAsRead(){return this.$notificationService.updateNotification(null,"markAllAsRead").then((()=>{$(".notifDrawerItems").find("li").each((function(){$(this).hasClass("unread")&&$(this).removeClass("unread").addClass("read")}))})).finally((()=>this.$root.$emit("application-loaded")))},openDrawer(){return this.$refs.drawerNotificationDrawer.open(),this.$notificationService.updateNotification(null,"resetNew").then((()=>this.badge=0))},closeDrawer(){this.$refs.drawerNotificationDrawer.close(),this.$nextTick().then((()=>this.$root.$emit("application-loaded")))},navigateTo(t){location.href=`${eXo.env.portal.context}/${eXo.env.portal.portalName}/${t}`},applyActions(t){$(`#${t}`).find("li").each((function(){let t=$(this).find(".contentSmall:first").data("link");void 0===t&&(t=$(this).find(".media").children("a").attr("href")),t.includes("/portal/g/")||t.includes("/portal/rest/")?t.replace(/\/portal\//,`${eXo.env.portal.context}/`):t.replace(/\/portal\/([a-zA-Z0-9_-]+)\//,`${eXo.env.portal.context}/${eXo.env.portal.portalName}/`);const e=t.split(`${eXo.env.portal.context}/`),i=$(this).data("id").toString(),o=$(this).data("details")&&$(this).data("details").toString()?$(this).data("details").toString():null;if(null!=e&&e.length>1)if(e[0].includes("/view_full_activity/")){const t=e[0].split("/view_full_activity/")[1];$(this).parent().attr("href",`${eXo.env.portal.context}/${eXo.env.portal.portalName}/activity?id=${t}`)}else $(this).parent().attr("href",`${eXo.env.portal.context}/${e[1]}`);else"notification-details-drawer"!==o&&$(this).parent().attr("href",t.replace(/^\/rest\//,`${eXo.env.portal.context}/rest/`));$(this).find(".open-details-drawer").off("click").on("click",(function(t){t.preventDefault(),t.stopPropagation();const e=$(this).data("notification-details");document.dispatchEvent(new CustomEvent("open-notification-details-drawer",{detail:e})),$(this).closest("[data-details]").hasClass("unread")&&$(this).closest("[data-details]").removeClass("unread").addClass("read"),Vue.prototype.$notificationService.updateNotification(i,"markAsRead")})),$(this).on("click",(function(){$(this).hasClass("unread")&&$(this).removeClass("unread").addClass("read"),Vue.prototype.$notificationService.updateNotification(i,"markAsRead")})),$(this).find(".remove-item").off("click").on("click",(function(t){t.preventDefault(),t.stopPropagation(),Vue.prototype.$notificationService.updateNotification(i,"hide"),$(this).parents("li:first").slideUp(300)})),$(this).find(".action-item").off("click").on("click",(function(t){t.stopPropagation();let e=$(this).data("rest");e.indexOf("?")>=0?e+="&":e+="?",e+=`portal:csrf=${eXo.env.portal.csrfToken}`,e&&e.length>0&&$.ajax(e).done((function(){$(document).trigger("exo-invitation-updated")})),Vue.prototype.$notificationService.updateNotification(i,"hide"),$(this).parents("li:first").slideUp(600)})),$(this).find(".cancel-item").off("click").on("click",(function(t){t.stopPropagation();let e=$(this).data("rest");e.indexOf("?")>=0?e+="&":e+="?",e+=`portal:csrf=${eXo.env.portal.csrfToken}`,e&&e.length>0&&$.ajax(e).done((function(){$(document).trigger("exo-invitation-updated")})),Vue.prototype.$notificationService.updateNotification(i,"hide"),$(this).parents("li:first").slideUp(600)}))}))},notificationUpdated(t){t&&t.detail&&(this.badge=t.detail.data.numberOnBadge,this.getNotifications())}}},o);const a={"exo-top-bar-notification":n.exports};for(const t in a)Vue.component(t,a[t]);function r(){return fetch("/portal/rest/notifications/webNotifications",{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting notification list")}))}function s(t,e){return fetch(`/portal/rest/notifications/webNotifications/${t}`,{headers:{"Content-Type":"text/plain",credentials:"include"},method:"PATCH",body:e})}function c(){const t=window.location;cCometd.configure({url:`${t.protocol}//${t.hostname}${t.port?":":""}${t.port||""}/cometd/cometd`,exoId:eXo.env.portal.userName,exoToken:eXo.env.portal.cometdToken}),cCometd.subscribe("/eXo/Application/web/NotificationMessage",null,(t=>{const e=JSON.parse(t.data);document.dispatchEvent(new CustomEvent("cometdNotifEvent",{detail:{data:e}}))}))}if(extensionRegistry){const t=extensionRegistry.loadComponents("TopBarNotification");t&&t.length>0&&t.forEach((t=>{Vue.component(t.componentName,t.componentOptions)}))}function l(t){if(t&&t.detail){const e=t.detail.data.numberOnBadge,i=document.querySelector("#NotificationPopoverPortlet .v-badge__wrapper");0===e?i.classList.add("hidden"):i.classList.remove("hidden"),i.querySelector("span").innerText=e}}function d(){document.removeEventListener("cometdNotifEvent",l);const t="NotificationPopoverPortlet",e=eXo.env.portal.language,i=`${Vue.prototype.$spacesConstants.PORTAL}/${Vue.prototype.$spacesConstants.PORTAL_REST}/i18n/bundle/locale.portlet.Portlets-${e}.json`;exoi18n.loadLanguageAsync(e,i).then((()=>{Vue.createApp({template:`<exo-top-bar-notification id="${t}"></exo-top-bar-notification>`,vuetify:Vue.prototype.vuetifyOptions,i18n:exoi18n.i18n},`#${t}`,"Topbar Notifications")}))}return window.Object.defineProperty(Vue.prototype,"$notificationService",{value:i}),c(),document.addEventListener("cometdNotifEvent",l),e})()));