define((()=>(()=>{"use strict";var t={900:(t,e,s)=>{function a(t,e,s,a,i,r,o,n){var l,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=s,c._compiled=!0),a&&(c.functional=!0),r&&(c._scopeId="data-v-"+r),o?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=l):i&&(l=n?function(){i.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:i),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(t,e){return l.call(e),d(t,e)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,l):[l]}return{exports:t,options:c}}s.d(e,{Z:()=>a})}},e={};function s(a){var i=e[a];if(void 0!==i)return i.exports;var r=e[a]={exports:{}};return t[a](r,r.exports,s),r.exports}s.d=(t,e)=>{for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};return(()=>{s.r(a);var t={};s.r(t),s.d(t,{filterTasksList:()=>B,getLabelsByProjectId:()=>U,getLabelsByTaskId:()=>R,getMyTasksList:()=>N,getStatusesByProjectId:()=>G,getTaskById:()=>X,getTasksByProjectId:()=>V,updateCompleted:()=>z});var e={};s.r(e),s.d(e,{addProject:()=>K,cloneProject:()=>W,deleteProjectInfo:()=>Z,getFilterSettings:()=>tt,getProject:()=>H,getProjectStats:()=>J,getProjectsList:()=>F,saveFilterSettings:()=>Q,updateProjectColor:()=>Y,updateProjectInfo:()=>q});var i={};s.r(i),s.d(i,{createStatus:()=>et,deleteStatus:()=>it,moveStatus:()=>at,updateStatus:()=>st});var r={};s.r(r),s.d(r,{addLabel:()=>pt,addTask:()=>nt,addTaskComments:()=>Tt,addTaskSubComment:()=>Dt,addTaskToLabel:()=>ut,cloneTask:()=>St,editLabel:()=>kt,findUsersToMention:()=>bt,getAllUsers:()=>$t,getDefaultStatusByProjectId:()=>gt,getMyAllLabels:()=>lt,getProjectLabels:()=>ct,getProjects:()=>ft,getStatusesByProjectId:()=>vt,getSuggestedUsers:()=>Et,getTaskComments:()=>yt,getTaskLabels:()=>dt,getTaskLogs:()=>wt,getUser:()=>jt,getUserInformations:()=>rt,removeLabel:()=>mt,removeTaskComment:()=>Ct,removeTaskFromLabel:()=>ht,updateTask:()=>ot,urlVerify:()=>_t});var o=function(){var t=this,e=t._self._c;return e("div",[e("exo-confirm-dialog",{ref:"deleteConfirmDialog",attrs:{message:t.deleteConfirmMessage,title:t.$t("popup.deleteTask"),"ok-label":t.$t("label.ok"),"cancel-label":t.$t("popup.cancel")},on:{ok:function(e){return t.deleteConfirm()}}}),t._v(" "),e("exo-drawer",{ref:"addTaskDrawer",staticClass:"taskDrawer",attrs:{id:"task-Drawer",temporary:t.confirmDrawerClose,"body-classes":"hide-scroll decrease-z-index-more",right:""},on:{closed:t.onCloseDrawer}},[t.task&&t.task.id?e("template",{slot:"title"},[e("div",{staticClass:"drawerTitleAndProject d-flex"},[t.addBackArrow?e("i",{staticClass:"uiIcon uiArrowBAckIcon",on:{click:t.closeTaskDrawer}}):t._e(),t._v(" "),e("span",[t._v(t._s(t.$t("label.drawer.header")))]),t._v(" "),e("div",{staticClass:"taskProjectName"},[e("task-projects",{attrs:{task:t.task},on:{projectsListOpened:function(e){t.closePriority(),t.closeStatus(),t.closeLabelsList(),t.closeTaskDates(),t.closeAssignements()}}})],1)]),t._v(" "),t.menuActions.length?e("div",{attrs:{id:"taskActionMenu"}},[e("i",{staticClass:"uiIcon uiThreeDotsIcon",on:{click:function(e){t.displayActionMenu=!0}}}),t._v(" "),e("v-menu",{attrs:{attach:"#taskActionMenu",transition:"slide-x-reverse-transition","content-class":"taskActionMenu","offset-y":""},model:{value:t.displayActionMenu,callback:function(e){t.displayActionMenu=e},expression:"displayActionMenu"}},[e("v-list",{staticClass:"pa-0",attrs:{dense:""}},t._l(t.menuActions,(function(s){return e("v-list-item",{key:s.title},[e("v-list-item-title",{staticClass:"subtitle-2",on:{click:s.action}},[e("i",{class:`uiIcon ${s.uiIcon} pe-2`}),t._v(" "),e("span",[t._v(t._s(s.title))])])],1)})),1)],1)],1):t._e()]):e("template",{slot:"title"},[e("div",{staticClass:"drawerTitleAndProject d-flex"},[t.addBackArrow?e("i",{staticClass:"uiIcon uiArrowBAckIcon",on:{click:t.closeTaskDrawer}}):t._e(),t._v(" "),e("span",[t._v(t._s(t.$t("label.drawer.header.add")))]),t._v(" "),e("div",{staticClass:"taskProjectName"},[e("task-projects",{attrs:{task:t.task},on:{projectsListOpened:function(e){t.closePriority(),t.closeStatus(),t.closeLabelsList(),t.closeTaskDates(),t.closeAssignements()}}})],1)])]),t._v(" "),e("template",{slot:"content"},[e("div",{staticClass:"taskDrawerDetails pa-4"},[e("div",{staticClass:"taskTitleAndMark d-flex"},[e("v-btn",{staticClass:"ms-n2",attrs:{id:"check_btn",icon:"",dark:""},on:{click:t.updateCompleted}},[t.task&&t.task.completed?e("v-icon",{staticClass:"markAsCompletedBtn"},[t._v("mdi-checkbox-marked-circle")]):e("v-icon",{staticClass:"markAsCompletedBtn"},[t._v("mdi-checkbox-blank-circle-outline")])],1),t._v(" "),e("v-textarea",{ref:"autoFocusInput4",staticClass:"ps-0 pt-0 task-name",class:{taskCompleted:t.task&&t.task.completed},attrs:{placeholder:t.$t("label.tapTask.name"),autofocus:!t.task||!t.task.id,type:"text","auto-grow":"",rows:"1","row-height":"13",required:""},on:{change:t.updateTaskTitle},model:{value:t.taskTitle,callback:function(e){t.taskTitle=e},expression:"taskTitle"}})],1),t._v(" "),t.task&&t.task.id?e("div",{staticClass:"lastUpdatedTask pb-3",attrs:{title:t.$t("tooltip.viewAllChanges")},on:{click:function(e){return t.$root.$emit("displayTaskChanges")}}},[e("span",{staticClass:"pe-2"},[t._v(t._s(t.$t("label.task.lastUpdate"))+"\n            "+t._s(t.displayedDate(t.lastTaskChangesLog))+"\n            "+t._s(t.$t("label.task.lastUpdateBy"))+"\n            "+t._s(t.lastTaskChangesLogAuthor))])]):t._e(),t._v(" "),e("div",{staticClass:"taskAssignement ms-8 pb-3"},[e("task-assignment",{attrs:{task:t.task},on:{updateTaskAssignment:function(e){return t.updateTaskAssignee(e)},updateTaskCoworker:function(e){return t.updateTaskCoworker(e)},assignmentsOpened:function(e){t.closePriority(),t.closeStatus(),t.closeProjectsList(),t.closeTaskDates(),t.closeLabelsList()}}})],1),t._v(" "),e("v-divider",{staticClass:"my-0"}),t._v(" "),e("div",{staticClass:"d-flex pt-4 pb-2"},[e("div",{staticClass:"taskDates"},[e("task-form-date-pickers",{attrs:{task:t.task,"date-picker-top":t.datePickerTop},on:{startDateChanged:function(e){return t.updateTaskStartDate(e)},dueDateChanged:function(e){return t.updateTaskDueDate(e)}}})],1),t._v(" "),e("div",{staticClass:"taskStatusAndPriority"},[e("task-priority",{attrs:{task:t.task},on:{updateTaskPriority:function(e){return t.updateTaskPriority(e)},PriorityListOpened:function(e){t.closeStatus(),t.closeProjectsList(),t.closeLabelsList(),t.closeTaskDates(),t.closeAssignements()}}}),t._v(" "),e("task-status",{attrs:{task:t.task},on:{statusListOpened:function(e){t.closePriority(),t.closeProjectsList(),t.closeLabelsList(),t.closeTaskDates(),t.closeAssignements()},updateTaskStatus:function(e){return t.updateTaskStatus(e)}}})],1)]),t._v(" "),e("v-divider",{staticClass:"my-0"}),t._v(" "),e("div",{staticClass:"taskDescription py-4"},[e("task-description-editor",{attrs:{task:t.task,placeholder:t.$t("editinline.taskDescription.empty")},on:{addTaskDescription:function(e){return t.addTaskDescription(e)}},model:{value:t.taskDescription,callback:function(e){t.taskDescription=e},expression:"taskDescription"}})],1),t._v(" "),e("div",{staticClass:"taskLabelsName mt-3 mb-3"},[t.task&&t.task.status&&t.task.status.project?e("task-labels",{attrs:{task:t.task},on:{labelsListOpened:function(e){t.closePriority(),t.closeStatus(),t.closeProjectsList(),t.closeTaskDates(),t.closeAssignements()}}}):t._e()],1),t._v(" "),e("extension-registry-components",{staticClass:"d-flex",attrs:{params:{taskId:t.task&&t.task.id,spaceId:t.taskSpaceId},name:"TaskDrawer",type:"task-drawer-action",element:"div","element-class":"overflow-hidden"}}),t._v(" "),e("v-divider",{staticClass:"my-0"}),t._v(" "),t.task&&t.task.id?e("v-flex",{staticClass:"pt-2 taskCommentsAndChanges",attrs:{xs12:""}},[e("task-view-all-comments",{attrs:{task:t.task,comments:t.comments}})],1):t._e()],1)]),t._v(" "),t.task&&!t.task.id?e("template",{slot:"footer"},[e("div",{staticClass:"d-flex"},[e("v-spacer"),t._v(" "),e("v-btn",{staticClass:"btn me-2",on:{click:t.cancel}},[t._v("\n          "+t._s(t.$t("popup.cancel"))+"\n        ")]),t._v(" "),e("v-btn",{staticClass:"btn btn-primary",attrs:{disabled:t.disableSaveButton},on:{click:t.addTask}},[t._v("\n          "+t._s(t.$t("label.save"))+"\n        ")])],1)]):t._e()],2),t._v(" "),e("task-comments-drawer",{ref:"taskCommentDrawer",attrs:{task:t.task,comments:t.comments},on:{confirmDialogOpened:function(e){t.isDrawerClose=!1},confirmDialogClosed:function(e){t.isDrawerClose=!0}}}),t._v(" "),e("task-changes-drawer",{ref:"taskChangesDrawer",attrs:{task:t.task,logs:t.logs}})],1)};o._withStripped=!0;const n={props:{task:{type:Object,default:()=>({})}},data(){return{displayActionMenu:!1,menuActions:[],reset:!1,dates:[],commentPlaceholder:this.$t("comment.message.addYourComment"),descriptionPlaceholder:this.$t("editinline.taskDescription.empty"),chips:[],autoSaveDelay:1e3,saveDescription:"",logs:[],comments:[],subEditorIsOpen:!1,taskPriority:"NONE",labelsToAdd:[],assignee:null,taskCoworkers:[],taskDueDate:null,taskStartDate:null,saving:!1,deleteConfirmMessage:null,datePickerTop:!0,enableDelete:!1,enableClone:!1,currentUserName:eXo.env.portal.userName,MESSAGE_MAX_LENGTH:2e3,dateTimeFormat:{year:"numeric",month:"long",day:"numeric"},lang:eXo.env.portal.language,commentId:"",isDrawerClose:!0,oldTask:{},showBackArrow:!1,taskSpace:{},taskTitle:null,taskDescription:null}},computed:{confirmDrawerClose(){return this.isDrawerClose},taskLink(){return null==this.task||null==this.task.id?"":`${eXo.env.portal.context}/${eXo.env.portal.portalName}/tasks/taskDetail/${this.task.id}`},taskTitleValid(){return this.taskTitle?.trim().length>=3&&this.taskTitle.length<1024},taskDescriptionValid(){const t=this.$utils.htmlToText(this.taskDescription);return!t||t.length<=2e3},disableSaveButton(){return this.saving||!this.taskTitleValid||!this.taskDescriptionValid},lastTaskChangesLog(){return this.logs&&this.logs.length&&this.logs[0].createdTime||""},lastTaskChangesLogAuthor(){return this.logs&&this.logs.length&&(this.logs[0].external?`${this.logs[0].authorFullName} (${this.$t("label.external")})`||"":this.logs[0].authorFullName||"")},taskId(){return this.task&&this.task.id},addBackArrow(){return this.showBackArrow},taskStatus(){return this.task&&this.task.status},taskProject(){return this.taskStatus&&this.taskStatus.project},taskProjectId(){return this.taskProject&&this.taskProject.id},taskSpaceId(){return this.taskSpace&&this.taskSpace.id}},watch:{taskId(){this.task&&null!==this.task.id&&void 0!==this.task.id&&this.displayDrawerMenuAction(this.task)}},created(){$(document).on("mousedown",(()=>{this.displayActionMenu&&window.setTimeout((()=>{this.displayActionMenu=!1}),200)})),document.addEventListener("labelListChanged",(t=>{if(t&&t.detail){const e=t.detail;this.labelsToAdd.push(e)}})),document.addEventListener("taskAssigneeChanged",(t=>{t&&t.detail&&(this.assignee=t.detail)})),document.addEventListener("taskCoworkerChanged",(t=>{t&&t.detail&&(this.taskCoworkers=t.detail)})),this.$root.$on("display-back-arrow",(()=>{this.showBackArrow=!0}))},destroyed:function(){document.removeEventListener("keyup",this.escapeKeyListener)},methods:{closePriority(){document.dispatchEvent(new CustomEvent("closePriority"))},closeStatus(){document.dispatchEvent(new CustomEvent("closeStatus"))},closeProjectsList(){document.dispatchEvent(new CustomEvent("closeProjectList"))},closeLabelsList(){document.dispatchEvent(new CustomEvent("closeLabelsList"))},closeTaskDates(){document.dispatchEvent(new CustomEvent("closeDates"))},closeAssignements(){document.dispatchEvent(new CustomEvent("closeAssignments"))},updateTaskTitle(){if(this.task.id&&this.oldTask.title!==this.taskTitle)if(this.taskTitle&&this.taskTitle.length)if(this.taskTitleValid){const t=JSON.parse(JSON.stringify(this.task));t.title=this.taskTitle,this.$taskDrawerApi.updateTask(this.task.id,t).then((()=>{this.task.title=this.oldTask.title=this.taskTitle,this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.title")}),this.$root.$emit("task-updated",JSON.parse(JSON.stringify(this.task)))})).catch((t=>{console.error("Error when updating task's title",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))}else this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error.title.length")});else this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error.title.mandatory")});else this.task.id||(this.task.title=this.oldTask.title=this.taskTitle)},updateCompleted(){const t={id:this.task.id,isCompleted:!this.task.completed};if(t.id)return this.$tasksService.updateCompleted(t).then((t=>{t.completed?this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.completed")}):this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.unCompleted")}),this.$root.$emit("update-task-completed",t)})).then((()=>this.task.completed=t.isCompleted)).then((()=>{this.$root.$emit("update-completed-task",this.task.completed,this.task.id)})).catch((t=>{console.error("Error updating project",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")}),this.postProject=!1}))},updateTaskPriority(t){t.priority&&this.oldTask.priority!==t.priority&&(null!=this.task.id?(this.task.priority=t.priority,this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.oldTask.priority=this.task.priority,this.$root.$emit("task-updated",this.task),this.$root.$emit("task-priority-updated",this.task),this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.priority")})})).catch((t=>{console.error("Error when updating task's priority",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))):this.taskPriority=t.priority)},updateTaskStatus(t){t&&this.oldTask?.status?.id!==t?.id&&null!=this.task.id&&(this.task.status=t,this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.oldTask.status=this.task.status,this.$root.$emit("task-status-updated",this.task),this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.status")})})).catch((t=>{console.error("Error when updating task's status",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})})))},updateTaskStartDate(t){"none"!==t&&1===t.date&&0===t.month&&t.timezoneOffset<0&&(t.year+=1),!t||"none"===t||this.oldTask.startDate&&this.datesEquals(this.oldTask.startDate,t)?"none"===t&&this.oldTask.startDate&&(this.task.startDate=null,this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.startDate")}),this.$root.$emit("task-start-date-updated",this.task)})).catch((t=>{console.error("Error has occurred while removing the start date ",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))):null!=this.task.id?(this.task.startDate=t,this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.oldTask.startDate=this.task.startDate,this.$root.$emit("task-updated",this.task),this.$root.$emit("task-start-date-updated",this.task),this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.startDate")})})).catch((t=>{console.error("Error when updating task's start date",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))):this.taskStartDate=t},updateTaskDueDate(t){"none"!==t&&1===t.date&&0===t.month&&t.timezoneOffset<0&&(t.year+=1),!t||"none"===t||this.oldTask.dueDate&&this.datesEquals(this.oldTask.dueDate,t)?"none"===t&&this.oldTask.dueDate&&(this.task.dueDate=null,this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.oldTask.dueDate=this.task.dueDate,this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.duetDate")})})).catch((t=>{this.logError(t)})).finally((()=>this.$root.$emit("task-due-date-updated",this.task)))):null!==this.task.id?(this.task.dueDate=t,this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.oldTask.dueDate=this.task.dueDate,this.$root.$emit("task-updated",this.task),this.$root.$emit("task-due-date-updated",this.task),this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.duetDate")}),this.$root.$emit("update-task-widget-list",this.task)})).catch((t=>{this.logError(t)})).finally((()=>this.$root.$emit("task-due-date-updated",this.task)))):this.taskDueDate=t},addTask(){document.dispatchEvent(new CustomEvent("onAddTask")),this.task.description=this.taskDescription,this.task.coworker=this.taskCoworkers,this.task.assignee=this.assignee,this.task.startDate=this.taskStartDate,this.task.dueDate=this.taskDueDate,this.task.priority=this.taskPriority,this.$taskDrawerApi.addTask(this.task).then((t=>{this.labelsToAdd.forEach((e=>{this.$taskDrawerApi.addTaskToLabel(t.id,e)})),this.$root.$emit("task-added",t),this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.created")}),this.showEditor=!1,this.$refs.addTaskDrawer.close(),this.labelsToAdd=[]})).catch((t=>{console.error("Error when adding task title",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))},updateTaskAssignee(t){null!==this.task.id&&this.oldTask.assignee!==t?(this.task.assignee=t||null,this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.oldTask.assignee=this.task.assignee,this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.assignee")})})).then((()=>{this.$root.$emit("update-task-assignee",t,this.task.id)})).catch((t=>{console.error("Error when updating task's assignee",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))):this.assignee=t||null},updateTaskCoworker(t){null!==this.task.id?(t&&t.length?this.task.coworker=t:this.task.coworker=[],this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.coworker")})})).then((()=>{this.$root.$emit("update-task-coworker",t,this.task.id)})).catch((t=>{console.error("Error when updating task's coworkers",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))):t&&t.length?this.taskCoworkers=t:this.taskCoworkers=[]},addTaskDescription(t){this.task.description=t},retrieveTaskLogs(){return this.$taskDrawerApi.getTaskLogs(this.task.id).then((t=>{this.logs=t})),this.logs},getTaskComments(){return this.$taskDrawerApi.getTaskComments(this.task.id).then((t=>{this.comments=t})),this.comments},getTaskSpace(){this.taskProjectId?this.$projectService.getProject(this.taskProjectId).then((t=>{this.taskSpace=t.spaceDetails})):this.taskSpace={}},navigateTo(t){window.open(`${eXo.env.portal.context}/${eXo.env.portal.portalName}/${t}`,"_blank")},open(t){this.oldTask=t,this.task=JSON.parse(JSON.stringify(t)),this.taskTitle=this.task.title,this.taskDescription=this.task.description,this.taskCoworkers=null,this.assignee=null,this.taskStartDate=null,this.taskDueDate=null,this.taskPriority="NONE",window.setTimeout((()=>{document.dispatchEvent(new CustomEvent("loadTaskPriority",{detail:t})),document.dispatchEvent(new CustomEvent("loadProjectStatus",{detail:t})),document.dispatchEvent(new CustomEvent("loadProjectName",{detail:t})),document.dispatchEvent(new CustomEvent("loadPlanDates",{detail:t})),document.dispatchEvent(new CustomEvent("loadProjectLabels",{detail:t})),document.dispatchEvent(new CustomEvent("loadTaskLabels",{detail:t})),document.dispatchEvent(new CustomEvent("loadAssignee",{detail:t}))}),200),null!=t.id&&(this.retrieveTaskLogs(),this.getTaskComments(),this.getTaskSpace(),this.$root.$emit("set-url",{type:"task",id:t.id})),this.$refs.addTaskDrawer.open()},cancel(){this.$emit("updateTaskList"),this.showEditor=!1,this.$refs.addTaskDrawer.close()},onCloseDrawer(){this.$root.$emit("task-drawer-closed",this.task),this.showEditor=!1,this.task={},this.comments={},this.$root.$emit("drawerClosed"),document.dispatchEvent(new CustomEvent("loadTaskLabels",{detail:{}})),this.$root.$emit("hideTaskComment"),this.$root.$emit("hideTaskChanges")},deleteTask(){this.deleteConfirmMessage=`${this.$t("popup.msg.deleteTask")} : <strong>${this.task.title}</strong>? `,this.$refs.deleteConfirmDialog.open()},cloneTask(){this.$taskDrawerApi.cloneTask(this.task.id).then((t=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.cloned")}),this.$root.$emit("task-added",t),this.$root.$emit("open-task-drawer",t)})).catch((t=>{console.error("Error when cloning task",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))},deleteConfirm(){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/tasks/${this.task.id}`,{method:"DELETE",credentials:"include"}).then((()=>{this.$root.$emit("deleteTask",{detail:this.task.id}),this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.deleted")}),document.dispatchEvent(new CustomEvent("deleteTask",{detail:this.task.id}))})).catch((t=>{console.error("Error when deleting task",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))},addMenuAction(t,e,s,a){this.menuActions.push({title:t,uiIcon:e,enabled:s,action:this[a]})},displayDrawerMenuAction(t){this.menuActions=[],t&&t.status&&t.status.project&&t.status.project.id?this.$projectService.getProject(t.status.project.id,!0).then((t=>{this.enableDelete=t.managerIdentities.some((t=>t.username===eXo.env.portal.userName)),this.enableClone=this.enableDelete||t.participatorIdentities.some((t=>t.username===eXo.env.portal.userName)),this.addMenuAction(this.$t("label.delete"),"uiIconTrash",this.enableDelete,"deleteTask"),this.addMenuAction(this.$t("label.clone"),"uiIconCloneNode",this.enableClone,"cloneTask"),this.menuActions=this.menuActions.filter((t=>t.enabled))})):t&&t.id&&(this.enableDelete=t.createdBy===eXo.env.portal.userName,this.enableClone=t.assignee===eXo.env.portal.userName||this.task.coworker.includes(eXo.env.portal.userName),this.addMenuAction(this.$t("label.delete"),"uiIconTrash",this.enableDelete,"deleteTask"),this.addMenuAction(this.$t("label.clone"),"uiIconCloneNode",this.enableClone,"cloneTask"),this.menuActions=this.menuActions.filter((t=>t.enabled)))},displayedDate(t){return t&&this.$dateUtil.formatDateObjectToDisplay(new Date(t),this.dateTimeFormat,this.lang)||""},openCommentDrawer(){this.$root.$emit("displayTaskComment",this.comments[this.comments.length-1].comment.id,!0)},datesEquals:(t,e)=>t.month===e.month&&t.year===e.year&&t.date===e.date,closeTaskDrawer(){this.$refs.addTaskDrawer.close(),this.$root.$emit("displayUnscheduledDrawer",""),this.showBackArrow=!1},logError(t){console.error("Error when updating task's due date",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}}};var l=s(900);const c=(0,l.Z)(n,o,[],!1,null,null,null).exports;var d=function(){var t=this,e=t._self._c;return e("div",{on:{click:function(t){t.stopPropagation()}}},[e("v-combobox",{ref:"selectLabel",staticClass:"pt-0 inputTaskLabel",attrs:{id:"labelInput",filter:t.filter,"hide-no-data":!t.search,items:t.items,"search-input":t.search,label:t.$t("label.tapLabel.name"),attach:"","hide-selected":"",multiple:"","small-chips":"","prepend-icon":"",solo:""},on:{"update:searchInput":function(e){t.search=e},"update:search-input":function(e){t.search=e},click:function(e){return t.openLabelsList()},change:function(e){t.search=""}},scopedSlots:t._u([{key:"prepend",fn:function(){return[e("i",{staticClass:"uiIconTag uiIconBlue"})]},proxy:!0},{key:"no-data",fn:function(){return[e("v-list-item",[e("span",{staticClass:"subheading"},[t._v(t._s(t.$t("label.createLabel")))]),t._v(" "),e("v-chip",{attrs:{label:"",small:""}},[t._v("\n          "+t._s(t.search)+"\n        ")])],1)]},proxy:!0},{key:"selection",fn:function({attrs:s,item:a,parent:i,selected:r}){return[a===Object(a)?e("v-chip",t._b({staticClass:"pe-1 font-weight-bold",attrs:{color:`${a.color} lighten-3`,"input-value":r,label:"",outlined:!a.color,small:""}},"v-chip",s,!1),[e("span",{staticClass:"pe-2"},[t._v("\n          "+t._s(a.text)+"\n        ")]),t._v(" "),a.canEdit?e("v-icon",{staticClass:"pe-0",attrs:{"x-small":""},on:{click:function(e){i.selectItem(a),t.removeTaskFromLabel(a)}}},[t._v("\n          close\n        ")]):t._e()],1):t._e()]}},{key:"item",fn:function({item:s}){return[e("v-list-item",{on:{click:function(e){return t.addTaskToLabel(s)}}},[e("v-chip",{attrs:{color:`${s.color} lighten-3`,outlined:!s.color,label:"",small:""}},[t._v("\n          "+t._s(s.text)+"\n        ")])],1)]}}]),model:{value:t.model,callback:function(e){t.model=e},expression:"model"}})],1)};d._withStripped=!0;const u={props:{task:{type:Object,default:()=>({})}},data:()=>({index:-1,items:[],nonce:1,model:[],x:0,search:null,y:0,currentUserName:eXo.env.portal.userName}),watch:{model(t,e){t.length!==e.length?this.model=t.map((t=>("string"==typeof t&&(t={text:t,name:t,canEdit:this.task.createdBy===this.currentUserName||this.task.status.project.canManage},this.items.push(t),this.nonce++,this.addTaskToLabel(t)),t))):this.search=null}},created(){$(document).on("mousedown",(()=>{this.$refs.selectLabel&&this.$refs.selectLabel.isMenuActive&&window.setTimeout((()=>{this.$refs.selectLabel.isMenuActive=!1}),200)})),document.addEventListener("closeLabelsList",(()=>{setTimeout((()=>{void 0!==this.$refs.selectLabel&&(this.$refs.selectLabel.isMenuActive=!1)}),100)})),document.addEventListener("loadProjectLabels",(t=>{if(t&&t.detail){const e=t.detail;this.model=[],null!=e.status.project&&this.getProjectLabels(e.status.project.id)}})),document.addEventListener("loadTaskLabels",(t=>{if(t&&t.detail){const e=t.detail;this.model=[],null!=e.id&&(this.getTaskLabels(),this.$taskDrawerApi.getTaskLabels(e.id).then((t=>{this.model=t.map((function(t){const e=Object.assign({},t);return e.text=e.name,e}))})))}}))},methods:{filter(t,e,s){if(t.header)return!1;const a=function(t){return null!=t?t:""},i=a(s),r=a(e);return i.toString().toLowerCase().indexOf(r.toString().toLowerCase())>-1},getMyAllLabels(){this.$taskDrawerApi.getMyAllLabels().then((t=>{this.items=t.map((function(t){const e=Object.assign({},t);return e.text=e.name,e}))}))},getProjectLabels(t){this.$taskDrawerApi.getProjectLabels(t).then((t=>{this.items=t.map((function(t){const e=Object.assign({},t);return e.text=e.name,e}))}))},getTaskLabels(){this.$taskDrawerApi.getTaskLabels(this.task.id).then((t=>{this.model=t.map((function(t){const e=Object.assign({},t);return e.text=e.name,e}))}))},addTaskToLabel(t){null!=this.task.id?this.$taskDrawerApi.addTaskToLabel(this.task.id,t).then((()=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.label")}),this.getTaskLabels()})).then((()=>{this.$root.$emit("update-task-labels",t,this.task.id)})).catch((t=>{console.error("Error when updating task's labels",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})})):document.dispatchEvent(new CustomEvent("labelListChanged",{detail:t})),this.model.push(t),document.getElementById("labelInput").focus()},removeTaskFromLabel(t){this.$taskDrawerApi.removeTaskFromLabel(this.task.id,t.id).then((()=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.label")})})).then((()=>{this.$root.$emit("update-remove-task-labels",t.id,this.task.id)})).catch((t=>{console.error("Error when updating task's labels",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))},openLabelsList(){this.$emit("labelsListOpened")}}},h=(0,l.Z)(u,d,[],!1,null,null,null).exports;var p=function(){var t=this,e=t._self._c;return e("div",[e("v-container",{attrs:{"pa-0":"",fluid:"","d-flex":""}},[e("i",{staticClass:"uiIcon icon-ArrowRight uiIconLightGray me-1"}),t._v(" "),e("v-combobox",{ref:"select",staticClass:"pt-0 mb-0 inputTaskProjectName taskInputArea",attrs:{filter:t.filterProjects,items:t.projects,label:t.projectLabel,attach:"",solo:"","prepend-icon":""},on:{click:function(e){return t.$emit("projectsListOpened")},change:function(e){return t.deleteProject()}},scopedSlots:t._u([{key:"selection",fn:function({attrs:s,item:a,parent:i,selected:r}){return[a===Object(a)?e("v-chip",t._b({staticClass:"projectName",attrs:{color:`${a.color} lighten-3`,"input-value":r,title:t.$t("tooltip.clickToEdit"),small:"",close:"","text-color":"white"},on:{click:function(e){return t.$emit("projectsListOpened")},"click:close":t.deleteProject}},"v-chip",s,!1),[e("span",{staticClass:"body-2 text-truncate",on:{click:function(t){return i.selectItem(a)}}},[t._v("\n            "+t._s(a.name)+"\n          ")])]):t._e()]}},{key:"item",fn:function({item:s}){return[e("v-list-item",{on:{click:function(e){return t.updateTaskProject(s)}}},[e("v-chip",{attrs:{color:`${s.color} lighten-3`,dark:"",close:"","text-color":"white",small:""}},[e("span",{staticClass:"text-truncate"},[t._v("\n              "+t._s(s.name)+"\n            ")])])],1)]}}]),model:{value:t.projectModel,callback:function(e){t.projectModel=e},expression:"projectModel"}})],1)],1)};p._withStripped=!0;const k={props:{task:{type:Object,default:()=>({})}},data:()=>({projects:[],projectModel:null,search:null,projectLabel:"",menuId:`ProjectMenu${parseInt(1e4*Math.random()).toString().toString()}`}),watch:{projectModel(){this.$refs.select&&this.$refs.select.isMenuActive&&setTimeout((()=>{this.$refs.select.isMenuActive=!1}),50)},task(){this.task&&this.task.status&&this.task.status.project&&!this.task.status.name&&this.$taskDrawerApi.getDefaultStatusByProjectId(this.task.status.project.id).then((t=>{this.task.status=t}))}},created(){this.getProjects(),$(document).on("mousedown",(()=>{this.$refs.select.isMenuActive&&window.setTimeout((()=>{this.$refs.select.isMenuActive=!1}),200)})),document.addEventListener("closeProjectList",(()=>{setTimeout((()=>{void 0!==this.$refs.select&&(this.$refs.select.isMenuActive=!1)}),100)})),document.addEventListener("loadProjectName",(t=>{if(t&&t.detail){const e=t.detail;null!=e.id&&e.status&&e.status.project||null==e.id&&e.status&&e.status.project?(this.projectModel=this.task.status.project,this.projectLabel=this.$t("label.tapProject.name")):(this.projectModel=null,this.projectLabel=this.$t("label.noProject"))}}))},methods:{getProjects(){this.$taskDrawerApi.getProjects().then((t=>{this.projects=t.projects}))},filterProjects:(t,e)=>t.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1||t.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1,updateTask(){this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.$root.$emit("update-task-widget-list",this.task),this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.project")})})).catch((t=>{console.error("Error when updating task's title",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))},updateTaskProject(t){this.$taskDrawerApi.getDefaultStatusByProjectId(t.id).then((e=>{this.task.status=e,this.updateTask(),this.projectModel=t})).then((()=>{this.$root.$emit("update-task-project",this.task)}))},deleteProject(t){this.task.status=null,this.projectModel=null,this.projectLabel=this.$t("label.noProject"),this.updateTask(),t.preventDefault(),t.stopPropagation()}}},m=(0,l.Z)(k,p,[],!1,null,null,null).exports;var f=function(){var t=this,e=t._self._c;return e("div",{staticClass:"assigneeParent"},[e("v-menu",{staticClass:"taskAssignMenu",attrs:{id:"assigneeMenu","content-class":t.menuId,"close-on-content-click":!1,"nudge-left":0,"max-width":300,attach:"",transition:"scale-transition","offset-y":"","allow-overflow":"",eager:"",bottom:""},scopedSlots:t._u([{key:"activator",fn:function({on:s}){return[e("div",t._g({staticClass:"d-flex align-center taskAssignItem"},s),[t.taskAssigneeObj&&t.taskAssigneeObj.profile&&t.taskAssigneeObj.profile.fullName?e("div",{staticClass:"assigneeName overflow-hidden"},[e("exo-user-avatar",{attrs:{"profile-id":t.taskAssigneeObj.remoteId,url:null,size:24,"extra-class":"pe-2 overflow-hidden",popover:""}})],1):t._e(),t._v(" "),t.taskCoworkers.length>0?e("span",{staticClass:"user-name coworkerNumber pe-2 caption font-italic lighten-2"},[t._v(" +"+t._s(t.taskCoworkers.length)+" "+t._s(t.$t("label.coworker"))+"\n        ")]):t._e(),t._v(" "),e("a",{staticClass:"taskAssignBtn mt-n1"},[e("i",{staticClass:"uiIcon uiAddAssignIcon"}),t._v(" "),e("span",{staticClass:"text-decoration-underline"},[t._v(t._s(t.$t("label.assign")))])])])]}}]),model:{value:t.globalMenu,callback:function(e){t.globalMenu=e},expression:"globalMenu"}},[t._v(" "),e("v-card",{staticClass:"pb-4"},[e("v-card-text",{staticClass:"assignTaskMenu pb-0 d-flex justify-space-between"},[e("span",[t._v(t._s(t.$t("label.assignTo"))+" :")]),t._v(" "),e("a",{staticClass:"ms-4",on:{click:function(e){return t.assignToMe()}}},[e("i",{staticClass:"uiIcon uiAssignToMeIcon"}),t._v(" "),e("span",[t._v(t._s(t.$t("label.addMe")))])])]),t._v(" "),e("exo-identity-suggester",{ref:"autoFocusInput3",attrs:{labels:t.suggesterLabels,value:t.taskAssigneeObj,"search-options":t.searchOptions,name:"taskAssignee","type-of-relations":"''",height:"40","include-users":""},on:{input:function(e){return t.assigneeValueChanged(e)},removeValue:function(e){return t.removeAssignee()}}}),t._v(" "),e("v-divider",{staticClass:"mt-4 mb-4"}),t._v(" "),e("v-card-text",{staticClass:"assignTaskMenu pt-0 pb-0 d-flex justify-space-between"},[e("span",[t._v(t._s(t.$t("label.coworkers"))+" :")]),t._v(" "),e("a",{staticClass:"ms-4",on:{click:function(e){return t.setMeAsCoworker()}}},[e("i",{staticClass:"uiIcon uiAddMeCoworkerIcon"}),t._v(" "),e("span",[t._v(t._s(t.$t("label.addMe")))])])]),t._v(" "),e("exo-identity-suggester",{ref:"autoFocusInput3",attrs:{labels:t.suggesterLabels,value:t.taskCoworkerObj,"search-options":t.searchOptions,name:"taskCoworkers","type-of-relations":"''",height:"40","include-users":"",multiple:""},on:{input:function(e){return t.coworkerValueChanged(e)},removeValue:function(e){return t.removeCoworker(e)}}})],1)],1)],1)};f._withStripped=!0;const g={props:{task:{type:Object,default:()=>({})},globalMenu:{type:Boolean,default:!1}},data:()=>({suggestedAssignee:[],suggestedCoworkers:[],taskAssignee:{},taskAssigneeObj:{},taskCoworkerObj:[],taskCoworkers:[],currentUser:eXo.env.portal.userName,menu:!1,menuId:`AssigneeMenu${parseInt(1e4*Math.random()).toString().toString()}`}),computed:{suggesterLabels(){return{placeholder:this.$t("label.assignee"),noDataLabel:this.$t("label.noResultLabel")}},searchOptions(){return{searchUrl:this.task&&this.task.status&&this.task.status.project?`${eXo.env.portal.context}/${eXo.env.portal.rest}/projects/projectParticipants/`.concat(this.task.status.project.id).concat("/"):`${eXo.env.portal.context}/${eXo.env.portal.rest}/tasks/usersToMention/`}}},mounted(){$(document).on("click",(t=>{!t.target||$(t.target).parents(`.${this.menuId}`).length||$(t.target).parents(".v-autocomplete__content").length||(this.globalMenu=!1)}))},created(){document.addEventListener("closeAssignments",(()=>{this.globalMenu&&window.setTimeout((()=>{this.globalMenu=!1}),100)})),document.addEventListener("loadAssignee",(t=>{if(this.taskAssigneeObj={},this.taskCoworkers=[],this.taskCoworkerObj=[],t&&t.detail){const e=t.detail;if(this.task=e,null!=e.id||e.status.project){if(e.coworker&&e.coworker.length)for(let t=0;t<e.coworker.length;t++)this.$identityService.getIdentityByProviderIdAndRemoteId("organization",e.coworker[t]).then((t=>{this.taskCoworkers.push(t.remoteId);const e={id:`organization:${t.remoteId}`,remoteId:t.remoteId,providerId:"organization",profile:{fullName:t.profile.fullname,avatarUrl:t.profile.avatar,external:"true"===t.profile.dataEntity.external}};this.taskCoworkerObj.push(e)}))}else this.$identityService.getIdentityByProviderIdAndRemoteId("organization",this.currentUser).then((t=>{this.taskAssigneeObj={id:`organization:${t.remoteId}`,remoteId:t.remoteId,providerId:"organization",profile:{fullName:t.profile.fullname,avatarUrl:t.profile.avatar,external:"true"===t.profile.dataEntity.external}}}));e.assignee&&this.$identityService.getIdentityByProviderIdAndRemoteId("organization",e.assignee).then((t=>{this.taskAssigneeObj={id:`organization:${t.remoteId}`,remoteId:t.remoteId,providerId:"organization",profile:{fullName:t.profile.fullname,avatarUrl:t.profile.avatar,external:"true"===t.profile.dataEntity.external}}}))}}))},methods:{assignToMe(){this.task.assignee!==this.currentUser&&(this.$identityService.getIdentityByProviderIdAndRemoteId("organization",this.currentUser).then((t=>{this.taskAssigneeObj={id:`organization:${t.remoteId}`,remoteId:t.remoteId,providerId:"organization",profile:{fullName:t.profile.fullname,avatarUrl:t.profile.avatar,external:"true"===t.profile.dataEntity.external}}})),this.$emit("updateTaskAssignment",this.currentUser))},setMeAsCoworker(){null===this.task.id?this.$identityService.getIdentityByProviderIdAndRemoteId("organization",this.currentUser).then((t=>{this.taskCoworkers.push(this.currentUser);const e={id:`organization:${t.remoteId}`,remoteId:t.remoteId,providerId:"organization",profile:{fullName:t.profile.fullname,avatarUrl:t.profile.avatar,external:"true"===t.profile.dataEntity.external}};this.taskCoworkerObj.push(e)})).then((()=>{document.dispatchEvent(new CustomEvent("taskCoworkerChanged",{detail:this.taskCoworkers})),this.isNewTask=!1})):this.taskCoworkers.includes(this.currentUser)||this.$identityService.getIdentityByProviderIdAndRemoteId("organization",this.currentUser).then((t=>{this.taskCoworkers.push(this.currentUser);const e={id:`organization:${t.remoteId}`,remoteId:t.remoteId,providerId:"organization",profile:{fullName:t.profile.fullname,avatarUrl:t.profile.avatar,external:"true"===t.profile.dataEntity.external}};this.taskCoworkerObj.push(e)})).then((()=>{this.$emit("updateTaskCoworker",this.taskCoworkers)}))},assigneeValueChanged(t){t&&t.id&&(t.remoteId!==this.currentUser&&this.task.assignee!==t.remoteId?(this.taskAssigneeObj=t,this.$emit("updateTaskAssignment",t.remoteId)):null===this.task.id&&this.$emit("updateTaskAssignment",this.taskAssigneeObj.remoteId))},coworkerValueChanged(t){void 0!==t&&t&&t.length&&!this.taskCoworkers.includes(t[t.length-1].remoteId)&&(this.taskCoworkers.push(t[t.length-1].remoteId),this.$emit("updateTaskCoworker",this.taskCoworkers),this.taskCoworkerObj.push(t[t.length-1]))},removeCoworker(t){this.taskCoworkers.splice(this.taskCoworkers.findIndex((e=>e===t.remoteId)),1),this.$emit("updateTaskCoworker",this.taskCoworkers)},removeAssignee(){this.taskAssigneeObj={},this.$emit("updateTaskAssignment",null)}}},v=(0,l.Z)(g,f,[],!1,null,null,null).exports;var w=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"taskDescription",class:t.editorReady&&"active",attrs:{id:"taskDescriptionId"}},[e("div",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:t.value,expression:"value"}],staticClass:"py-1 px-2 taskDescriptionToShow",attrs:{"data-text":t.placeholder,title:t.$t("tooltip.clickToEdit"),contentEditable:"true"},on:{click:function(e){return t.showDescriptionEditor(e)}}},[t._v("\n      "+t._s(t.placeholder)+"\n    ")]),t._v(" "),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.value,expression:"value"}],ref:"editor",staticClass:"d-none",attrs:{id:"descriptionContent",cols:"30",rows:"10"},domProps:{value:t.value},on:{input:function(e){e.target.composing||(t.value=e.target.value)}}}),t._v(" "),t.displayEditor&&t.editorReady?e("div",{staticClass:"activityCharsCount",class:t.charsCount>t.MESSAGE_MAX_LENGTH?"tooManyChars":""},[t._v("\n      "+t._s(t.charsCount)+"/"+t._s(t.MESSAGE_MAX_LENGTH)+"\n      "),e("i",{staticClass:"uiIconMessageLength"})]):t._e()]),t._v(" "),t.task.id&&t.displayEditor&&t.editorReady?e("v-btn",{staticClass:"btn mt-2 ml-auto d-flex px-2 btn-primary v-btn v-btn--contained theme--light v-size--default",attrs:{id:"saveDescriptionButton",loading:t.savingDescription,disabled:t.saveDescriptionButtonDisabled,depressed:"",outlined:""},on:{click:t.saveDescription}},[t._v("\n    "+t._s(t.$t("label.apply"))+"\n  ")]):t._e()],1)};w._withStripped=!0;const y={props:{value:{type:String,default:""},placeholder:{type:String,default:""},task:{type:Object,default:function(){return{}}}},data:()=>({MESSAGE_MAX_LENGTH:2e3,inputVal:"",editorReady:!1,showEditor:!1,savingDescription:!1}),computed:{charsCount(){return this.$utils.htmlToText(this.value).length},saveDescriptionButtonDisabled(){return this.savingDescription||this.charsCount>this.MESSAGE_MAX_LENGTH},taskDescription(){return this.task?.description||""},displayEditor(){return this.showEditor}},watch:{inputVal(t){const e=CKEDITOR.instances.descriptionContent&&CKEDITOR.instances.descriptionContent.getData();null!=e&&t!==e&&(""===t?(CKEDITOR.instances.descriptionContent.setData(""),this.initCKEditor()):CKEDITOR.instances.descriptionContent.setData(t)),this.editorReady&&this.$emit("input",t)},editorReady(t){const e=document.querySelectorAll("[id=cke_descriptionContent]");if(!0===t){if(this.initCKEditor(),e)for(let t=0;t<e.length;t++)e[t].classList.remove("hiddenEditor");document.getElementById("taskDescriptionId").classList.remove("taskDescription"),CKEDITOR.instances.descriptionContent&&CKEDITOR.instances.descriptionContent.focus(!0)}else for(let t=0;t<e.length;t++)e[t].classList.add("hiddenEditor"),document.getElementById("taskDescriptionId").classList.add("taskDescription")},reset(){this.hideDescriptionEditor()}},created(){this.$root.$off("drawerClosed"),this.$root.$on("drawerClosed",(()=>{this.hideDescriptionEditor()})),document.addEventListener("onAddTask",(()=>{this.$emit("addTaskDescription",this.inputVal),this.hideDescriptionEditor()})),this.inputVal=this.value||""},methods:{saveDescription(){const t=this.inputVal?.replace("&nbsp;"," ");if(this.task.id&&!isNaN(this.task.id)){this.savingDescription=!0;const e=JSON.parse(JSON.stringify(this.task));e.description=t,this.$taskDrawerApi.updateTask(this.task.id,e).then((()=>{this.task.description=t,this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.description")}),this.$root.$emit("task-description-updated",this.task),this.hideDescriptionEditor()})).catch((()=>{this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})})).finally((()=>this.savingDescription=!1))}},initCKEditor:function(){CKEDITOR.plugins.addExternal("embedsemantic","/commons-extension/eXoPlugins/embedsemantic/","plugin.js");let t="simpleLink,widget,embedsemantic";const e=$(window).width();e>$(window).height()&&e<768&&(t="simpleLink,selectImage,embedsemantic"),CKEDITOR.basePath="/commons-extension/ckeditor/";const s=this;$(this.$refs.editor).ckeditor({customConfig:"/commons-extension/ckeditorCustom/config.js",extraPlugins:t,removePlugins:"confirmBeforeReload,maximize,resize",toolbarLocation:"bottom",startupFocus:""===s.inputVal||"end",autoGrow_onStartup:!0,on:{blur:function(){$(document.body).trigger("click"),s.hideDescriptionEditor()},change:function(t){const e=t.editor.getData();s.inputVal=e},destroy:function(){s.editorReady=!1,s.showEditor=!1,s.inputVal=""}}})},hideDescriptionEditor(){CKEDITOR.instances.descriptionContent&&CKEDITOR.instances.descriptionContent.destroy(!0),this.editorReady=!1,this.showEditor=!1},showDescriptionEditor:function(t){this.showEditor||"A"===t?.target?.nodeName?"A"===t?.target?.nodeName&&window.open(t.target.href,"_blank"):(this.inputVal=this.value,this.editorReady=!0,this.showEditor=!0)},urlVerify(t){return this.$taskDrawerApi.urlVerify(t)}}},T=(0,l.Z)(y,w,[],!1,null,null,null).exports;var D=function(){var t=this,e=t._self._c;return e("div",{staticClass:"taskPriority"},[e("v-select",{ref:"selectPriority",staticClass:"pt-0 selectFont",attrs:{items:t.priorities,"item-value":"key","item-text":"value",attach:"",solo:"",dense:""},on:{change:function(e){return t.updateTaskPriority()},click:function(e){return t.$emit("PriorityListOpened")}},scopedSlots:t._u([{key:"append",fn:function(){return[e("v-icon",{class:t.priorityDefaultColor,attrs:{size:"20"}},[t._v("mdi-flag-variant")])]},proxy:!0},{key:"item",fn:function(s){return[e("v-list-avatar",{staticClass:"me-2"},[e("v-icon",{class:t.getTaskPriorityColor(s.item.key),attrs:{size:"20"}},[t._v("mdi-flag-variant")])],1),t._v(" "),e("v-list-tile-content",[e("v-list-tile-title",{staticClass:"body-2"},[t._v("\n          "+t._s(s.item.value)+"\n        ")])],1)]}}]),model:{value:t.priority,callback:function(e){t.priority=e},expression:"priority"}})],1)};D._withStripped=!0;const C={props:{task:{type:Object,default:()=>({})}},data(){return{priority:"",priorityDefaultColor:"highPriorityColor",priorities:[{key:"HIGH",value:this.$t("label.priority.high")},{key:"NORMAL",value:this.$t("label.priority.normal")},{key:"LOW",value:this.$t("label.priority.low")},{key:"NONE",value:this.$t("label.priority.none")}]}},watch:{priority(){this.task.priority!==this.priority&&this.updateTaskPriority()}},created(){$(document).on("mousedown",(()=>{this.$refs.selectPriority&&this.$refs.selectPriority.isMenuActive&&window.setTimeout((()=>{this.$refs.selectPriority.isMenuActive=!1}),200)})),document.addEventListener("loadTaskPriority",(t=>{if(t&&t.detail){const e=t.detail;null!=e.id?(this.priority=e.priority,this.priorityDefaultColor=this.getTaskPriorityColor(e.priority)):(this.priority="NONE",this.priorityDefaultColor=this.getTaskPriorityColor("NONE"))}})),document.addEventListener("closePriority",(()=>{this.$refs.selectPriority&&this.$refs.selectPriority.isMenuActive&&window.setTimeout((()=>{this.$refs.selectPriority.isMenuActive=!1}),100)}))},methods:{getTaskPriorityColor(t){switch(t){case"HIGH":return"highPriorityColor";case"NORMAL":return"normalPriorityColor";case"LOW":return"lowPriorityColor";case"NONE":return"nonePriorityColor"}},updateTaskPriority(){this.priorityDefaultColor=this.getTaskPriorityColor(this.priority);const t={priority:this.priority,taskId:this.task.id};this.$emit("updateTaskPriority",t)}}},b=(0,l.Z)(C,D,[],!1,null,null,null).exports;var E=function(){var t=this,e=t._self._c;return e("div",{staticClass:"taskStatus"},[t.task.status&&t.task.status.project?e("div",[e("v-select",{ref:"selectStatus",staticClass:"pt-0 selectFont",attrs:{id:"selectStatus",items:t.projectStatuses,"item-value":"key","item-text":"value",attach:"",dense:"",solo:""},on:{change:function(e){return t.updateTaskStatus()},click:function(e){return t.$emit("statusListOpened")}},model:{value:t.taskStatus,callback:function(e){t.taskStatus=e},expression:"taskStatus"}})],1):t._e()])};E._withStripped=!0;const j={props:{task:{type:Object,default:()=>({})}},data:()=>({taskStatus:"ToDo",projectStatuses:[]}),created(){$(document).on("mousedown",(()=>{this.$refs.selectStatus&&this.$refs.selectStatus.isMenuActive&&window.setTimeout((()=>{this.$refs.selectStatus.isMenuActive=!1}),200)})),document.addEventListener("closeStatus",(()=>{this.$refs.selectStatus&&this.$refs.selectStatus.isMenuActive&&window.setTimeout((()=>{this.$refs.selectStatus.isMenuActive=!1}),100)})),document.addEventListener("loadProjectStatus",this.loadProjectStatus)},destroyed(){document.removeEventListener("loadProjectStatus",this.loadProjectStatus)},methods:{getI18nStatus(t){return this.$te(`tasks.status.${t}`)?this.$t(`tasks.status.${t}`):this.$te(`tasks.status.${t.toLowerCase()}`)&&this.$t(`tasks.status.${t.toLowerCase()}`)||t},updateTaskStatus(){null!=this.taskStatus&&this.$taskDrawerApi.getStatusesByProjectId(this.task.status.project.id).then((t=>{const e=t.find((t=>t.name===this.taskStatus));this.$emit("updateTaskStatus",e)}))},getStatusesByProjectId(t){this.$taskDrawerApi.getStatusesByProjectId(t.status.project.id).then((t=>{this.projectStatuses=t;for(let e=0;e<t.length;e++)this.projectStatuses[e]={key:t[e].name,value:this.getI18nStatus(t[e].name)}}))},loadProjectStatus(t){if(t&&t.detail){const e=t.detail;null!=e.status&&e.status.project?(this.getStatusesByProjectId(e),e.status.name&&(this.taskStatus=e.status.name)):(this.projectStatuses.push({key:"ToDo",value:this.$t("exo.tasks.status.todo")}),this.projectStatuses.push({key:"InProgress",value:this.$t("exo.tasks.status.inprogress")}),this.projectStatuses.push({key:"WaitingOn",value:this.$t("exo.tasks.status.waitingon")}),this.projectStatuses.push({key:"Done",value:this.$t("exo.tasks.status.done")}),this.taskStatus="ToDo")}}}},_=(0,l.Z)(j,E,[],!1,null,null,null).exports;var S=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"taskPlanDateCalender d-flex align-center"},[e("i",{staticClass:"uiIconStartDate uiIconBlue"}),t._v(" "),e("date-picker",{ref:"taskStartDate",staticClass:"flex-grow-1 my-auto",attrs:{"default-value":!1,placeholder:t.$t("label.startDate"),"max-value":t.maximumStartDate,width:"100%"},on:{input:function(e){return t.emitStartDate(t.startDate)}},model:{value:t.startDate,callback:function(e){t.startDate=e},expression:"startDate"}},[e("template",{slot:"footer"},[e("div",{staticClass:"dateFooter"},[e("v-btn-toggle",{staticClass:"d-flex flex-wrap justify-space-between",attrs:{tile:"",color:"primary","background-color":"primary",group:""}},[e("v-btn",{staticClass:"my-0",attrs:{value:"left",small:""},on:{click:function(e){return t.addBtnStartDate()}}},[t._v("\n              "+t._s(t.$t("label.today"))+"\n            ")]),t._v(" "),e("v-btn",{staticClass:"my-0",attrs:{value:"center",small:""},on:{click:function(e){return t.addBtnStartDate(1)}}},[t._v("\n              "+t._s(t.$t("label.tomorrow"))+"\n            ")]),t._v(" "),e("v-btn",{staticClass:"my-0",attrs:{value:"right",small:""},on:{click:function(e){return t.addBtnStartDate(7)}}},[t._v("\n              "+t._s(t.$t("label.nextweek"))+"\n            ")]),t._v(" "),e("v-btn",{staticClass:"my-0",attrs:{value:"right",small:""},on:{click:function(e){return t.resetStartDate()}}},[t._v("\n              "+t._s(t.$t("label.none"))+"\n            ")])],1)],1)])],2)],1),t._v(" "),e("div",{staticClass:"taskDueDateCalender d-flex align-center"},[e("i",{staticClass:"uiIconDueDate uiIconBlue"}),t._v(" "),e("date-picker",{ref:"taskDueDate",staticClass:"flex-grow-1 my-auto",attrs:{"default-value":!1,placeholder:t.$t("label.dueDate"),"min-value":t.minimumEndDate,width:"100%"},on:{input:function(e){return t.emitDueDate(t.dueDate)}},model:{value:t.dueDate,callback:function(e){t.dueDate=e},expression:"dueDate"}},[e("template",{slot:"footer"},[e("div",{staticClass:"dateFooter"},[e("v-btn-toggle",{staticClass:"d-flex flex-wrap justify-space-between",attrs:{tile:"",color:"primary","background-color":"primary",group:""}},[e("v-btn",{staticClass:"my-0",attrs:{value:"left",small:"",disabled:t.startDate>t.checkDate()},on:{click:function(e){return t.addBtnDate()}}},[t._v("\n              "+t._s(t.$t("label.today"))+"\n            ")]),t._v(" "),e("v-btn",{staticClass:"my-0",attrs:{value:"center",small:"",disabled:t.startDate>t.checkDate(1)},on:{click:function(e){return t.addBtnDate(1)}}},[t._v("\n              "+t._s(t.$t("label.tomorrow"))+"\n            ")]),t._v(" "),e("v-btn",{staticClass:"my-0",attrs:{value:"right",small:"",disabled:t.startDate>t.checkDate(7)},on:{click:function(e){return t.addBtnDate(7)}}},[t._v("\n              "+t._s(t.$t("label.nextweek"))+"\n            ")]),t._v(" "),e("v-btn",{staticClass:"my-0",attrs:{value:"right",small:""},on:{click:function(e){return t.resetDueDate()}}},[t._v("\n              "+t._s(t.$t("label.none"))+"\n            ")])],1)],1)])],2)],1)])};S._withStripped=!0;const A={props:{task:{type:Object,default:()=>({})},taskDueDate:{type:String,default:()=>"endDate"},datePickerTop:{type:Boolean,default:!1}},data(){return{startDate:null,dueDate:null,actualDueDate:{},actualTask:{},dateShortCutItems:[{key:"today",value:this.$t("label.today")},{key:"tomorrow",value:this.$t("label.tomorrow")},{key:"nextweek",value:this.$t("label.nextweek")},{key:"datePicker",value:this.$t("label.pickDate")}],dateItem:""}},computed:{minimumEndDate(){return this.startDate?new Date(this.startDate):null},maximumStartDate(){return this.dueDate?new Date(this.dueDate):null}},watch:{task(t){"{}"!==JSON.stringify(t)&&(this.actualTask=this.task,this.reset())}},mounted(){this.actualTask=this.task,this.reset(),document.addEventListener("closeDates",(()=>{this.$refs.taskStartDate&&this.$refs.taskStartDate.menu&&(this.$refs.taskStartDate.menu=!1),this.$refs.taskDueDate&&this.$refs.taskDueDate.menu&&(this.$refs.taskDueDate.menu=!1)})),$(".taskAssignItem").off("click").on("click",(()=>{this.$refs.taskStartDate&&this.$refs.taskStartDate.menu&&(this.$refs.taskStartDate.menu=!1),this.$refs.taskDueDate&&this.$refs.taskDueDate.menu&&(this.$refs.taskDueDate.menu=!1)}))},methods:{checkDate(t){t||(t=0);const e=new Date;return e.setDate(e.getDate()+t),e},reset(){null!=this.actualTask.id?(this.startDate=null,this.dueDate=null,null!=this.actualTask.startDate&&this.$nextTick().then((()=>{this.startDate=this.toDate(this.actualTask.startDate)})),null!=this.actualTask.dueDate&&this.$nextTick().then((()=>{this.dueDate=this.toDate(this.actualTask.dueDate)}))):(this.startDate=null,this.dueDate=null)},toDate(t){if(!t)return null;if("number"==typeof t)return new Date(t);if("string"==typeof t)return 10===t.indexOf("T")&&t.length>19&&(t=t.substring(0,19)),new Date(t);if("object"==typeof t){const e=`${t.year+1900}/${t.month+1}/${t.date}`;return new Date(e)}},toDateObject(t){if(t=this.toDate(t)){const e={time:"",nanos:"",year:"",month:"",day:"",hours:"",minutes:"",seconds:"",timezoneOffset:"",date:""};return e.time=t.getTime(),e.year=t.getUTCFullYear()-1900,e.month=t.getMonth(),e.day=t.getDay(),e.hours=t.getHours(),e.minutes=t.getMinutes(),e.seconds=t.getSeconds(),e.timezoneOffset=t.getTimezoneOffset(),e.date=t.getDate(),e}return null},addBtnDate(t){if(t){const e=new Date;e.setDate(e.getDate()+t),this.dueDate=e}else this.dueDate=new Date;this.$refs.taskDueDate&&this.$refs.taskDueDate.menu&&(this.$refs.taskDueDate.menu=!1)},addBtnStartDate(t){if(t){const e=new Date;e.setDate(e.getDate()+t),this.startDate=e}else this.startDate=new Date;this.$refs.taskStartDate&&this.$refs.taskStartDate.menu&&(this.$refs.taskStartDate.menu=!1)},resetDueDate(){this.dueDate=null,this.$emit("dueDateChanged","none"),this.$refs.taskDueDate&&this.$refs.taskDueDate.menu&&(this.$refs.taskDueDate.menu=!1)},resetStartDate(){this.startDate=null,this.$emit("startDateChanged","none"),this.$refs.taskStartDate&&this.$refs.taskStartDate.menu&&(this.$refs.taskStartDate.menu=!1)},emitStartDate(t){const e=this.toDateObject(t);(!t&&this.actualTask.startDate||t&&!this.actualTask.startDate||this.actualTask.startDate&&!this.datesEquals(e,this.actualTask.startDate))&&this.$emit("startDateChanged",e)},emitDueDate(t){const e=this.toDateObject(t);(!t&&this.actualTask.dueDate||t&&!this.actualTask.dueDate||this.actualTask.dueDate&&!this.datesEquals(e,this.actualTask.dueDate))&&this.$emit("dueDateChanged",e)},datesEquals:(t,e)=>t.month===e.month&&t.year===e.year&&t.date===e.date}},L=(0,l.Z)(A,S,[],!1,null,null,null).exports;var P=function(){var t=this,e=t._self._c;return t.showTaskChangesDrawer?e("div",{ref:"taskChangesDrawer",staticClass:"taskCommentDrawer",class:t.showTaskChangesDrawer?"showTaskChangesDrawer":""},[e("v-container",{staticClass:"pa-0",attrs:{"fill-height":""}},[e("v-layout",{attrs:{column:""}},[e("v-flex",{staticClass:"mx-0 drawerHeader flex-grow-0"},[e("v-list-item",{staticClass:"pe-0"},[e("v-list-item-content",{staticClass:"drawerTitle d-flex text-header-title text-truncate"},[e("i",{staticClass:"uiIcon uiArrowBAckIcon",on:{click:t.closeDrawer}}),t._v(" "),e("span",{staticClass:"ps-2"},[t._v(t._s(t.$t("label.changes")))])]),t._v(" "),e("v-list-item-action",{staticClass:"drawerIcons align-end d-flex flex-row"},[e("v-btn",{attrs:{icon:""}},[e("v-icon",{on:{click:function(e){return t.closeDrawer()}}},[t._v("mdi-close")])],1)],1)],1)],1),t._v(" "),e("v-divider",{staticClass:"my-0"}),t._v(" "),e("v-flex",{staticClass:"drawerContent flex-grow-1 overflow-auto border-box-sizing"},[e("v-list",{staticClass:"py-0"},t._l(t.logs,(function(s,a){return e("v-list-item",{key:a,staticClass:"pe-0"},[e("v-list-item-content",{staticClass:"mt-n1"},[e("div",{staticClass:"d-flex"},[e("exo-user-avatar",{attrs:{"profile-id":s.author,size:30,url:null,popover:"","align-top":""}}),t._v(" "),e("div",{staticClass:"d-flex mt-n2",domProps:{innerHTML:t._s(t.renderChangeHTML(s))}})],1),t._v(" "),e("div",[e("div",{staticClass:"dateTime caption px-10 my-n3"},[e("date-format",{attrs:{value:s.createdTime,format:t.dateTimeFormat}})],1)])])],1)})),1)],1)],1)],1)],1):t._e()};P._withStripped=!0;const x={props:{logs:{type:Object,default:()=>({})},task:{type:Boolean,default:!1}},data:()=>({showTaskChangesDrawer:!1,dateTimeFormat:{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"},currentUserName:eXo.env.portal.userName,changeAuthor:{},userAvatar:"",avatarUrl:""}),watch:{userAvatar(){this.avatarUrl=this.userAvatar}},mounted(){this.$root.$on("displayTaskChanges",(()=>{this.showTaskChangesDrawer=!0})),this.$root.$on("hideTaskChanges",(()=>{this.showTaskChangesDrawer=!1}))},methods:{closeDrawer(){this.showTaskChangesDrawer=!1},logMsg:t=>`log.${t.actionName}`,renderChangeHTML(t){let e="";if("assign"===t.actionName||"unassign"===t.actionName){const s=t.isTargetFullNameExternal?`${t.targetFullName} (${this.$t("label.external")})`:`${t.targetFullName}`;e=`<p class='text-truncate my-auto text-color ms-1 subtitle-2' title='${t.authorFullName} ${this.$t(this.logMsg(t))} ${s}'><span>${this.$t(this.logMsg(t))}</span><a href='/portal/dw/profile/${t.target}'> ${s} </a></p>`}else e="edit_project"===t.actionName?`<p class='text-truncate my-auto text-color ms-1 subtitle-2' title='${t.authorFullName} ${this.$t(this.logMsg(t))}  ${t.target}'><span>${this.$t(this.logMsg(t))}</span><a href='#'> ${t.target} </a></p>`:"edit_priority"===t.actionName?`<p class='text-truncate my-auto text-color ms-1 subtitle-2' title='${t.authorFullName} ${this.$t(this.logMsg(t))} ${t.task.status.priority}'> ${this.$t(this.logMsg(t))} ${t.task.priority}</p>`:`<p class='text-truncate my-auto text-color ms-1 subtitle-2' title='${t.authorFullName} ${this.$t(this.logMsg(t))} ${t.target}'> ${this.$t(this.logMsg(t))} ${t.target}</p>`;return e}}},I={"task-drawer":c,"task-labels":h,"task-projects":m,"task-assignment":v,"task-description-editor":T,"task-priority":b,"task-status":_,"task-form-date-pickers":L,"task-changes-drawer":(0,l.Z)(x,P,[],!1,null,null,null).exports};for(const t in I)Vue.component(t,I[t]);eXo.env.portal;const O=eXo.env.portal.context||"",M=(eXo.env.portal.portalName,eXo.env.portal.context,eXo.env.portal.rest);function N(t,e,s,a){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${O}/${M}/tasks?status=${t||""}&q=${e||""}&offset=${s||0}&limit=${a||0}&returnDetails=true`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)})).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function B(t,e,s,a,i){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${O}/${M}/tasks/filter?projectId=${i||t.projectId||-2}&query=${t.query||""}&dueDate=${t.dueDate||""}&priority=${t.priority||""}&statusId=${t.statusId||""}&showCompletedTasks=${t.showCompletedTasks||""}&assignee=${t.assignee||""}&watcher=${t.watcher||""}&coworker=${t.coworker||""}&groupBy=${e||t.groupBy||""}&orderBy=${s||t.orderBy||""}&dueCategory=${t.dueCategory||""}&filterLabelIds=${a||t.filterLabelIds||""}&offset=${t.offset||0}&limit=${t.limit||0}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)})).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function R(t){return fetch(`${O}/${M}/tasks/labels/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function U(t){return fetch(`${O}/${M}/tasks/labels/project/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function X(t){return fetch(`${O}/${M}/tasks/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function G(t){return fetch(`${O}/${M}/projects/projects/statuses/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function V(t){return fetch(`${O}/${M}/tasks/project/${t}?returnDetails=true`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function z(t){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${O}/${M}/tasks/updateCompleted/${t.id}?&isCompleted=${t.isCompleted}`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"PUT",body:JSON.stringify(t)}).then((t=>t.json())).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function F(t,e,s,a,i,r){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${O}/${M}/projects/projects?q=${e||""}&spaceName=${t||""}&projectsFilter=${s||""}&offset=${a||0}&limit=${i||0}&participatorParam=${r||!1}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)})).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function J(t){return fetch(`${O}/${M}/projects/project/statistics/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function H(t,e){return fetch(`${O}/${M}/projects/projects/${t}?&participatorParam=${e||!1}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function K(t){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${O}/${M}/projects/createproject`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify(t)}).then((t=>t.json())).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function q(t){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${O}/${M}/projects/updateproject/${t.id}`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"PUT",body:JSON.stringify(t)}).then((t=>t.json())).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function Z(t){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${O}/${M}/projects/${t.id}?&deleteChild=false`,{credentials:"include",method:"DELETE"}).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function W(t){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${O}/${M}/projects/cloneproject`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify(t)}).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function Y(t,e){return fetch(`${O}/${M}/projects/changeProjectColor/${t.id}?&color=${e}`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"PUT",body:JSON.stringify(t)}).then((t=>t.json()))}function Q(t){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/settings/USER,${eXo.env.portal.userName}/APPLICATION,task-${t.projectId}-${t.tabView}/filterTask`,{method:"PUT",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({value:JSON.stringify(t)})}).then((t=>{if(t&&t.ok)return t;throw new Error("Error setting filter  settings")})).then((t=>t))}function tt(t,e){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/settings/USER,${eXo.env.portal.userName}/APPLICATION,task-${t}-${e}/filterTask`,{method:"GET",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}}).then((t=>{if(t&&t.ok)return t.json();if(t&&404===t.status)return null;throw new Error("Error getting filter settings")})).then((t=>t))}function et(t){return fetch(`${O}/${M}/status`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify(t)}).then((t=>t.json()))}function st(t){return fetch(`${O}/${M}/status/${t.id}`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"PUT",body:JSON.stringify(t)}).then((t=>t.json()))}function at(t){return fetch(`${O}/${M}/status/move`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"PUT",body:JSON.stringify(t)}).then((t=>t.json()))}function it(t){return fetch(`${O}/${M}/status/${t}`,{credentials:"include",method:"DELETE"})}function rt(t){return fetch(`/portal/rest/v1/social/users/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting user informations")}))}function ot(t,e){return t?(document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`/portal/rest/tasks/${t}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((t=>t&&t.ok?t.json():t.text().then((t=>{throw new Error(t)})))).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))):Promise.resolve()}function nt(t){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch("/portal/rest/tasks",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",credentials:"include",body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when adding task")})).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function lt(){return fetch("/portal/rest/tasks/labels",{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting my all labels")}))}function ct(t){return fetch(`/portal/rest/tasks/labels/project/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting my all labels")}))}function dt(t){return fetch(`/portal/rest/tasks/labels/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting task labels")}))}function ut(t,e){return fetch(`/portal/rest/tasks/labels/${t}`,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",credentials:"include",body:JSON.stringify(e)}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when adding task to label")}))}function ht(t,e){return fetch(`/portal/rest/tasks/labels/${t}/${e}`,{credentials:"include",method:"DELETE"}).then((t=>{if(!t||!t.ok)throw new Error("Error when deleting task from label")}))}function pt(t){return fetch("/portal/rest/tasks/labels",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",credentials:"include",body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when adding task to label")}))}function kt(t){return fetch(`/portal/rest/tasks/labels/${t.id}`,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"PUT",credentials:"include",body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when updateing label")}))}function mt(t){return fetch(`/portal/rest/tasks/labels/${t}`,{credentials:"include",method:"DELETE"}).then((t=>{if(!t||!t.ok)throw new Error("Error when deleting label")}))}function ft(){return fetch("/portal/rest/projects/projects",{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting projects")}))}function gt(t){return fetch(`/portal/rest/projects/projects/status/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting default status")}))}function vt(t){return fetch(`/portal/rest/projects/projects/statuses/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting project statuses")}))}function $t(){return fetch("/portal/rest/v1/social/users",{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting users")}))}function wt(t){return fetch(`/portal/rest/tasks/logs/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting task logs")}))}function yt(t){return fetch(`/portal/rest/tasks/comments/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting task comments")}))}function Tt(t,e){return fetch(`/portal/rest/tasks/comments/${t}`,{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:e}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when adding task comment")}))}function Dt(t,e,s){return fetch(`/portal/rest/tasks/comments/${e}/${t}`,{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:s}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when adding task sub comment")}))}function Ct(t){return fetch(`/portal/rest/tasks/comments/${t}`,{method:"DELETE",credentials:"include"}).then((t=>{if(!t||!t.ok)throw new Error("Error when removing task comment")}))}function bt(t,e){return fetch(t?`/portal/rest/projects/projectParticipants/${t}/${e}`:`/portal/rest/tasks/usersToMention/${e}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting users to mention")}))}function Et(t,e){return fetch(`/portal/rest/tasks/users/${t}/${e}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting suggested users")}))}function jt(t){return fetch(`/portal/rest/v1/social/users/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting user")}))}function _t(t){return t.replace(/((?:href|src)=")?((((https?|ftp|file):\/\/)|www\.)[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|])/gi,(function(t,e){if(e)return t;let s=t;return 0===s.indexOf("www.")&&(s=`//${s}`),`<a href="${s}" target="_blank">${t}</a>`}))}function St(t){return fetch(`${O}/${M}/tasks/clone/${t}`,{credentials:"include",method:"POST"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when cloning task")}))}if(eXo.env.portal.containerName,eXo.env.portal.language,extensionRegistry){const t=extensionRegistry.loadComponents("TaskDrawer");t&&t.length>0&&t.forEach((t=>{Vue.component(t.componentName,t.componentOptions)}))}Vue.use(Vuetify),Vue.prototype.$tasksService||window.Object.defineProperty(Vue.prototype,"$tasksService",{value:t}),Vue.prototype.$projectService||window.Object.defineProperty(Vue.prototype,"$projectService",{value:e}),Vue.prototype.$statusService||window.Object.defineProperty(Vue.prototype,"$statusService",{value:i}),Vue.prototype.$taskDrawerApi||window.Object.defineProperty(Vue.prototype,"$taskDrawerApi",{value:r})})(),a})()));