define((()=>(()=>{"use strict";var t={d:(e,s)=>{for(var o in s)t.o(s,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:s[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{init:()=>rt});var s={};t.r(s),t.d(s,{filterTasksList:()=>m,getLabelsByProjectId:()=>c,getLabelsByTaskId:()=>l,getMyTasksList:()=>i,getStatusesByProjectId:()=>u,getTaskById:()=>d,getTasksByProjectId:()=>h,updateCompleted:()=>p});var o={};t.r(o),t.d(o,{addLabel:()=>N,addTask:()=>j,addTaskComments:()=>H,addTaskSubComment:()=>F,addTaskToLabel:()=>M,cloneTask:()=>Z,editLabel:()=>z,findUsersToMention:()=>Y,getAllUsers:()=>U,getDefaultStatusByProjectId:()=>P,getMyAllLabels:()=>O,getProjectLabels:()=>A,getProjects:()=>B,getStatusesByProjectId:()=>R,getSuggestedUsers:()=>J,getTaskComments:()=>X,getTaskLabels:()=>L,getTaskLogs:()=>V,getUser:()=>W,getUserInformations:()=>x,removeLabel:()=>G,removeTaskComment:()=>K,removeTaskFromLabel:()=>I,updateTask:()=>S,urlVerify:()=>q});var n=function(){var t=this,e=t._self._c;return e("v-app",{staticClass:"VuetifyApp",attrs:{id:"tasks",flat:""}},[e("v-alert",{attrs:{type:t.type,dismissible:""},model:{value:t.alert,callback:function(e){t.alert=e},expression:"alert"}},[t._v("\n    "+t._s(t.message)+"\n  ")]),t._v(" "),e("v-container",{attrs:{"pa-0":""}},[e("v-layout",{staticClass:"white",attrs:{row:"","mx-3":""}},[e("v-flex",{attrs:{"d-flex":"",xs12:""}},[e("v-layout",{attrs:{row:"","mx-0":"","align-center":""}},[e("v-flex",{attrs:{"d-flex":"",xs12:""}},[e("v-flex",{staticClass:"d-flex my-2"},[e("div",{staticClass:"d-flex align-center"},[e("a",{staticClass:"body-1 text-uppercase color-title px-0",on:{click:function(e){return t.navigateTo("tasks/myTasks","ALL")}}},[t._v("\n                  "+t._s(t.$t("label.tasks.header"))+"\n                ")])]),t._v(" "),e("v-spacer"),t._v(" "),e("v-btn",{attrs:{title:t.$t("label.addTask"),icon:"",text:""},on:{click:t.openTaskDrawer}},[e("v-icon",[t._v("mdi-plus")])],1)],1)],1)],1)],1),t._v(" "),e("v-flex",{class:t.tasks.length>0,attrs:{"d-flex":"",xs12:""}},[e("v-layout",{attrs:{row:"","mx-0":""}},[e("v-flex",{attrs:{xs12:""}},[t.tasks.length>0?e("div",[t.tasksOverdueSize>0?e("div",[e("div",{staticClass:"nameGroup"},[e("span",{staticClass:"nameGroup"},[t._v(t._s(t.$t("label.overdue")))]),t._v(" "),e("div",{staticClass:"amount-item pointer",on:{click:function(e){return t.navigateTo("tasks/myTasks","OVERDUE")}}},[t._v(t._s(t.tasksOverdueSize))]),t._v(" "),e("hr",{staticClass:"v-divider theme&#45;&#45;light separator",attrs:{role:"separator","aria-orientation":"horizontal"}})]),t._v(" "),t._l(t.tasksOverdueList,(function(s){return e("div",{key:s.id,staticClass:"list-item"},[e("task-details",{attrs:{task:s},on:{removeTask:t.removeTask}})],1)}))],2):t._e(),t._v(" "),t.tasksTodaySize>0?e("div",[e("div",{staticClass:"nameGroup"},[e("span",{staticClass:"nameGroup"},[t._v(t._s(t.$t("label.today")))]),t._v(" "),e("div",{staticClass:"amount-item pointer",on:{click:function(e){return t.navigateTo("tasks/myTasks","TODAY")}}},[t._v(t._s(t.tasksTodaySize))]),t._v(" "),e("hr",{staticClass:"v-divider theme&#45;&#45;light separator",attrs:{role:"separator","aria-orientation":"horizontal"}})]),t._v(" "),t._l(t.tasksTodayList,(function(s){return e("div",{key:s.id,staticClass:"list-item"},[e("task-details",{attrs:{task:s},on:{removeTask:t.removeTask}})],1)}))],2):t._e(),t._v(" "),t.tasksTomorrowSize>0?e("div",[e("div",{staticClass:"nameGroup"},[e("span",{staticClass:"nameGroup"},[t._v(t._s(t.$t("label.tomorrow")))]),t._v(" "),e("div",{staticClass:"amount-item pointer",on:{click:function(e){return t.navigateTo("tasks/myTasks","TOMORROW")}}},[t._v(t._s(t.tasksTomorrowSize))]),t._v(" "),e("hr",{staticClass:"v-divider theme&#45;&#45;light separator",attrs:{role:"separator","aria-orientation":"horizontal"}})]),t._v(" "),t._l(t.tasksTomorrowList,(function(s){return e("div",{key:s.id,staticClass:"list-item"},[e("task-details",{attrs:{task:s},on:{removeTask:t.removeTask}})],1)}))],2):t._e(),t._v(" "),t.tasksUpcomingSize>0?e("div",[e("div",{staticClass:"nameGroup"},[e("span",{staticClass:"nameGroup"},[t._v(t._s(t.$t("label.upcoming")))]),t._v(" "),e("div",{staticClass:"amount-item pointer",on:{click:function(e){return t.navigateTo("tasks/myTasks","UPCOMING")}}},[t._v(t._s(t.tasksUpcomingSize))]),t._v(" "),e("hr",{staticClass:"v-divider theme&#45;&#45;light separator",attrs:{role:"separator","aria-orientation":"horizontal"}})]),t._v(" "),t._l(t.tasksUpcomingList,(function(s){return e("div",{key:s.id,staticClass:"list-item"},[e("task-details",{attrs:{task:s},on:{removeTask:t.removeTask}})],1)}))],2):t._e(),t._v(" "),e("div",{staticClass:"text-center"},[e("button",{staticClass:"btn color-title btn-show",attrs:{type:"button"},on:{click:function(e){return t.navigateTo("tasks/myTasks","ALL")}}},[t._v("\n                  "+t._s(t.$t("label.tasks.btn.show"))+"\n                ")])])]):t._e(),t._v(" "),t.loadingTasks||0!==t.tasks.length?t._e():e("div",{staticClass:"noTasks"},[e("div",{staticClass:"noTasksContent"},[e("i",{staticClass:"uiNoTaskIcon"}),t._v(" "),e("div",{staticClass:"noTasksTitle"},[t._v(t._s(t.$t("label.noTask")))])])])])],1)],1)],1),t._v(" "),e("task-drawer",{ref:"taskDrawer",attrs:{task:t.task}})],1)],1)};n._withStripped=!0,eXo.env.portal;const a=eXo.env.portal.context||"",r=(eXo.env.portal.portalName,eXo.env.portal.context,eXo.env.portal.rest);function i(t,e,s,o){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${a}/${r}/tasks?status=${t||""}&q=${e||""}&offset=${s||0}&limit=${o||0}&returnDetails=true`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)})).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function m(t,e,s,o,n){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${a}/${r}/tasks/filter?projectId=${n||t.projectId||-2}&query=${t.query||""}&dueDate=${t.dueDate||""}&priority=${t.priority||""}&statusId=${t.statusId||""}&showCompletedTasks=${t.showCompletedTasks||""}&assignee=${t.assignee||""}&watcher=${t.watcher||""}&coworker=${t.coworker||""}&groupBy=${e||t.groupBy||""}&orderBy=${s||t.orderBy||""}&dueCategory=${t.dueCategory||""}&filterLabelIds=${o||t.filterLabelIds||""}&offset=${t.offset||0}&limit=${t.limit||0}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)})).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function l(t){return fetch(`${a}/${r}/tasks/labels/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function c(t){return fetch(`${a}/${r}/tasks/labels/project/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function d(t){return fetch(`${a}/${r}/tasks/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function u(t){return fetch(`${a}/${r}/projects/projects/statuses/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function h(t){return fetch(`${a}/${r}/tasks/project/${t}?returnDetails=true`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function p(t){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${a}/${r}/tasks/updateCompleted/${t.id}?&isCompleted=${t.isCompleted}`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"PUT",body:JSON.stringify(t)}).then((t=>t.json())).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}eXo.env.portal.containerName,eXo.env.portal.language;var k=function(){var t=this,e=t._self._c;return e("v-app",[e("exo-drawer",{ref:"taskCommentDrawer",staticClass:"taskCommentDrawer",attrs:{id:"taskCommentDrawer",right:""},on:{closed:t.closeDrawer}},[e("template",{slot:"title"},[e("v-flex",{staticClass:"mx-0 drawerHeader flex-grow-0 width-full"},[e("v-list-item",{staticClass:"pe-0"},[e("v-list-item-content",{staticClass:"drawerTitle d-flex text-header-title text-truncate"},[e("i",{staticClass:"uiIcon uiArrowBAckIcon",on:{click:t.closeDrawer}}),t._v(" "),e("span",{staticClass:"ps-2 mt-2"},[t._v(t._s(t.$t("label.comments")))])]),t._v(" "),e("v-list-item-action",{staticClass:"drawerIcons align-end d-flex flex-row"},[e("v-btn",{staticClass:"addCommentBtn float-right",attrs:{disabled:t.isEditorActive,icon:"",title:t.$t("comment.message.addYourComment")},on:{click:function(e){return t.openEditorToBottom(t.commentId)}}},[e("i",{staticClass:"uiIcon uiIconTaskAddComment"})])],1)],1)],1)],1),t._v(" "),e("template",{slot:"content"},[e("v-flex",{staticClass:"drawerContent flex-grow-1 overflow-auto border-box-sizing",attrs:{id:"commentDrawerContent"}},[this.comments&&this.comments.length?e("div",{staticClass:"TaskCommentContent"},t._l(t.comments,(function(s,o){return e("div",{key:o,staticClass:"pe-0 ps-0 TaskCommentItem"},[e("task-comments",{attrs:{task:t.task,comment:s,comments:t.comments,"last-comment":t.commentId,"show-new-comment-editor":t.showNewCommentEditor},on:{confirmDialogOpened:function(e){return t.$emit("confirmDialogOpened")},confirmDialogClosed:function(e){return t.$emit("confirmDialogClosed")}}})],1)})),0):e("div",[e("div",{staticClass:"editorContent commentEditorContainer newCommentEditor"},[e("task-comment-editor",{ref:"commentEditor",staticClass:"subComment subCommentEditor",attrs:{"max-length":t.MESSAGE_MAX_LENGTH,placeholder:t.$t("task.placeholder").replace("{0}",t.MESSAGE_MAX_LENGTH),task:t.task,"show-comment-editor":!0,id:"commentContent-editor"},on:{addNewComment:function(e){return t.addTaskComment(e)}}})],1)])])],1)],2)],1)};function v(t,e,s,o,n,a,r,i){var m,l="function"==typeof t?t.options:t;if(e&&(l.render=e,l.staticRenderFns=s,l._compiled=!0),o&&(l.functional=!0),a&&(l._scopeId="data-v-"+a),r?(m=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},l._ssrRegister=m):n&&(m=i?function(){n.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:n),m)if(l.functional){l._injectStyles=m;var c=l.render;l.render=function(t,e){return m.call(e),c(t,e)}}else{var d=l.beforeCreate;l.beforeCreate=d?[].concat(d,m):[m]}return{exports:t,options:l}}k._withStripped=!0;const f=v({props:{comment:{type:Object,default:()=>({})},comments:{type:Object,default:()=>({})},task:{type:Boolean,default:!1},showTaskCommentDrawer:{type:Boolean,default:!1}},data:()=>({commentId:"",showNewCommentEditor:!1,test:!1,MESSAGE_MAX_LENGTH:1250}),computed:{isEditorActive(){return!this.comments.length}},mounted(){this.$root.$on("displayTaskComment",((t,e)=>{this.openDrawer(),this.commentId=t,this.showNewCommentEditor=e,this.openEditorToBottom(t)})),this.$root.$on("hideTaskComment",(()=>{this.closeDrawer()}))},methods:{addTaskComment(){let t=this.$refs.commentEditor.getMessage();t=this.urlVerify(t),this.$taskDrawerApi.addTaskComments(this.task.id,t).then((t=>{this.comments.push(t)})).then((()=>{this.$root.$emit("update-task-comments",this.comments.length,this.task.id)}))},closeDrawer(){this.$refs.taskCommentDrawer.close(),document.dispatchEvent(new CustomEvent("Task-comments-drawer-closed"))},openDrawer(){this.$refs.taskCommentDrawer.open()},urlVerify(t){return this.$taskDrawerApi.urlVerify(t)},openEditorToBottom(){this.comments.length>0&&this.$root.$emit("showNewCommentEditor"),window.setTimeout((()=>{const t=document.querySelector("#taskCommentDrawer .drawerContent");t.scrollTo({top:t.scrollHeight,behavior:"smooth",block:"start"})}),200)}}},k,[],!1,null,null,null).exports;var C=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"comment-"+t.comment.comment.id}},[e("task-comment-item",{attrs:{comment:t.comment,comments:t.comments,"can-delete":t.canDelete},on:{openConfirmDeleteDialog:function(e){return t.confirmCommentDelete(e)},openCommentEditor:function(e){return t.commentActions(e)}}}),t._v(" "),e("div",{staticClass:"editorContent commentEditorContainer",class:t.comment.comment.id===t.lastComment&&t.newCommentEditor&&"newCommentEditor"},[e("task-comment-editor",{ref:"commentEditor",staticClass:"subComment subCommentEditor",attrs:{"max-length":t.MESSAGE_MAX_LENGTH,placeholder:t.$t("task.placeholder").replace("{0}",t.MESSAGE_MAX_LENGTH),task:t.task,"show-comment-editor":t.comment.comment.id===t.lastComment,"last-comment":t.lastComment,id:"commentContent-"+t.comment.comment.id,"comment-id":t.comment.comment.id},on:{addNewComment:function(e){return t.addTaskComment(e)}}})],1),t._v(" "),e("exo-confirm-dialog",{ref:"CancelSavingCommentDialog",attrs:{message:t.$t("popup.msg.deleteComment"),title:t.$t("popup.confirmation"),"ok-label":t.$t("popup.delete"),"cancel-label":t.$t("popup.cancel"),persistent:""},on:{ok:function(e){return t.removeTaskComment()},"dialog-opened":function(e){return t.$emit("confirmDialogOpened")},"dialog-closed":function(e){return t.$emit("confirmDialogClosed")}}})],1)};C._withStripped=!0;const g=v({props:{comment:{type:Object,default:()=>({})},comments:{type:Object,default:()=>({})},task:{type:Object,default:()=>null},lastComment:{type:String,default:""},showNewCommentEditor:{type:Boolean,default:!1}},data:()=>({MESSAGE_MAX_LENGTH:1250,lang:eXo.env.portal.language,commentId:"",commentToDelete:"",dateTimeFormat:{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}}),mounted(){this.$root.$on("showNewCommentEditor",(()=>{this.lastComment=this.comments[this.comments.length-1].comment.id,this.showNewCommentEditor=!0,this.$root.$emit("newCommentEditor",this.lastComment)}))},computed:{newCommentEditor(){return this.showNewCommentEditor}},methods:{addTaskComment(t){let e=this.$refs.commentEditor.getMessage();e=this.urlVerify(e),this.newCommentEditor?this.$taskDrawerApi.addTaskComments(this.task.id,e).then((t=>{this.comments.push(t)})).then((()=>{this.$root.$emit("update-task-comments",this.comments.length,this.task.id)})):this.$taskDrawerApi.addTaskSubComment(this.task.id,t,e).then((t=>{this.comment.subComments=this.comment.subComments||[],this.comment.subComments.push(t)}))},removeTaskComment(){this.$taskDrawerApi.removeTaskComment(this.commentToDelete).then((()=>{this.comments.forEach(((t,e)=>{t===this.comment&&(this.comment.comment.id===this.commentToDelete?this.comments.splice(e,1):t.subComments.forEach(((t,e)=>{t.comment.id===this.commentToDelete&&this.comment.subComments.splice(e,1)})))}))})),this.$emit("confirmDialogClosed")},displayCommentDate(t){return t&&this.$dateUtil.formatDateObjectToDisplay(new Date(t),this.dateTimeFormat,this.lang)||""},urlVerify(t){return this.$taskDrawerApi.urlVerify(t)},confirmCommentDelete(t){this.commentToDelete=t,this.$refs.CancelSavingCommentDialog.open()},commentActions(t){this.showNewCommentEditor=!1,this.$nextTick().then((()=>this.$root.$emit("showEditor",t)))}}},C,[],!1,null,null,null).exports;var w=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment d-flex align-start",class:t.editorReady?"activeEditor":"inactiveEditor"},[e("exo-user-avatar",{attrs:{"profile-id":t.currentUserName,size:30,url:null,"extra-class":"me-2",avatar:""}}),t._v(" "),e("div",{staticClass:"editorContainer"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.inputVal,expression:"inputVal"}],ref:`editor-${t.id}`,staticClass:"textarea",attrs:{id:t.id,placeholder:t.placeholder,cols:"30",rows:"10",autofocus:""},domProps:{value:t.inputVal},on:{input:function(e){e.target.composing||(t.inputVal=e.target.value)}}}),t._v(" "),e("div",{staticClass:"activityCharsCount",class:t.charsCount>t.maxLength?"tooManyChars":""},[t._v("\n      "+t._s(t.charsCount)+t._s(t.maxLength>-1?" / "+t.maxLength:"")+"\n      "),e("i",{staticClass:"uiIconMessageLength"})]),t._v(" "),e("v-btn",{staticClass:"btn btn-primary ignore-vuetify-classes btnStyle mt-1 mb-2 commentBtn",attrs:{disabled:t.postDisabled,depressed:"",small:"",type:"button"},on:{click:function(e){return t.addNewComment()}}},[t._v("\n      "+t._s(t.$t("comment.label.comment"))+"\n    ")])],1)],1)};w._withStripped=!0;const y=v({props:{value:{type:String,default:""},task:{type:Object,default:null},placeholder:{type:String,default:""},maxLength:{type:Number,default:-1},id:{type:String,default:""},editorReady:{type:Boolean,default:!1},showCommentEditor:{type:Boolean,default:!1},lastComment:{type:String,default:""},commentId:{type:String,default:""}},data(){return{inputVal:this.value,charsCount:0,disabledComment:"",MESSAGE_MAX_LENGTH:1250,currentUserName:eXo.env.portal.userName,currentCommentId:""}},computed:{postDisabled(){if(this.disabledComment)return!0;if(null!==this.inputVal&&""!==this.inputVal){let t=this.inputVal?this.inputVal.replace(/<[^>]*>/g,"").replace(/&nbsp;/g,"").trim():"";const e=document.createElement("div");return e.innerHTML=t,t=e.textContent||e.innerText||"",t.length>this.MESSAGE_MAX_LENGTH}return!0}},watch:{inputVal(t){this.$emit("input",t),this.disabledComment=""===t},editorReady(t){!0===t?this.initCKEditor():CKEDITOR.instances[this.id]&&CKEDITOR.instances[this.id].destroy(!0)}},created(){this.$root.$on("showEditor",(t=>{this.$nextTick().then((()=>{this.showEditor(t)}))}))},mounted(){this.showCommentEditor&&(this.editorReady=!0),this.$root.$on("newCommentEditor",(t=>{this.editorReady=!1,window.setTimeout((()=>{this.showCommentEditor=`commentContent-${t}`===this.id,this.showCommentEditor&&(this.editorReady=!0)}),100)}));const t=this;$("body").suggester("addProvider","task:people",(function(e,s){const o=this,n=t.task.status?t.task.status.project.id:null;t.$taskDrawerApi.findUsersToMention(n,e).then((t=>{const e=[];for(let s=0;s<t.length;s++){const o=t[s],n={uid:o.id.substr(1),name:o.name,avatar:o.avatar};e.push(n)}s.call(o,e)}))}))},methods:{initCKEditor(){let t="suggester,widget,embedsemantic";const e=$(window).width();e>$(window).height()&&e<768&&(t="selectImage"),CKEDITOR.basePath="/commons-extension/ckeditor/";const s=this;$(this.$refs[`editor-${this.id}`]).ckeditor({customConfig:"/commons-extension/ckeditorCustom/config.js",extraPlugins:t,removePlugins:"confirmBeforeReload,maximize,resize",autoGrow_onStartup:!0,on:{instanceReady:function(){s.setFocus()},change:function(t){const e=t.editor.getData();s.inputVal=e;let o=e?e.replace(/<[^>]*>/g,"").replace(/&nbsp;/g,"").trim():"";const n=document.createElement("div");n.innerHTML=o,o=n.textContent||n.innerText||"",s.charsCount=o.length},destroy:function(){s.inputVal="",s.charsCount=0,s.editorReady=!1,s.showCommentEditor=!1}},suggester:{renderMenuItem:'<li data-value="${uid}"><div class="avatarSmall" style="display: inline-block;"><img src="${avatar}"></div>${name} (${uid})</li>',renderItem:'<span class="exo-mention">${name}<a href="#" class="remove"><i class="uiIconClose uiIconLightGray"></i></a></span>',sourceProviders:["task:people"]}})},getMessage(){const t=CKEDITOR.instances[this.id].getData();return t?t.trim():""},setFocus(){CKEDITOR.instances[this.id].focus()},destroyEditor(){CKEDITOR.instances[this.id].destroy()},showEditor(t){this.currentCommentId=t,this.editorReady=`commentContent-${t}`===this.id},addNewComment(){this.$emit("addNewComment",this.commentId),this.destroyEditor()}}},w,[],!1,null,null,null).exports;var T=function(){var t=this,e=t._self._c;return e("div",{staticClass:"commentItem",attrs:{id:`commentItem-${t.comment.comment.id}`}},[e("div",{staticClass:"commentWrapper",on:{mouseover:function(e){t.hover=!0},mouseleave:function(e){t.hover=!1}}},[e("div",{staticClass:"commentHeader d-flex"},[e("exo-user-avatar",{attrs:{"profile-id":t.comment.author.username,"extra-class":"position-relative overflow-hidden",size:30,"bold-title":"","link-style":"",popover:""}}),t._v(" "),e("div",{staticClass:"commentContent ps-3 d-flex align-center flex-grow-0 flex-shrink-0"},[e("span",{staticClass:"dateTime caption font-italic d-block",attrs:{title:t.displayCommentDate(t.comment.comment.createdTime.time)}},[t._v(t._s(t.relativeTime))])]),t._v(" "),e("div",{staticClass:"removeCommentBtn position-relative"},[e("v-btn",t._g({directives:[{name:"show",rawName:"v-show",value:t.showDeleteButtom,expression:"showDeleteButtom"}],staticClass:"deleteComment position-absolute white",attrs:{title:t.$t("label.remove"),size:32,icon:"",small:""},on:{click:function(e){return t.$emit("openConfirmDeleteDialog",t.comment.comment.id)}}},t.on),[e("i",{staticClass:"uiIconTrashMini uiIconLightGray"})])],1)],1),t._v(" "),e("div",{staticClass:"commentBody ms-10 mt-1"},[e("div",{staticClass:"taskContentComment",domProps:{innerHTML:t._s(t.comment.formattedComment)}}),t._v(" "),e("v-btn",{attrs:{id:"reply_btn",depressed:"",text:"",small:"",color:"primary"},on:{click:t.replyComment}},[t._v("\n        "+t._s(t.$t("comment.message.Reply"))+"\n      ")])],1)]),t._v(" "),t.comment&&t.comment.subComments?e("div",{staticClass:"py-0 TaskSubComments"},t._l(t.comment.subComments,(function(s,o){return e("div",{key:o,staticClass:"TaskSubCommentItem pe-0 pb-2"},[e("task-comment-item",{attrs:{comment:s,comments:t.comment.subComments,"avatar-size":30},on:{openCommentEditor:function(e){return t.$emit("openCommentEditor",t.comment.comment.id)},openConfirmDeleteDialog:function(e){return t.$emit("openConfirmDeleteDialog",s.comment.id,!0)}}})],1)})),0):t._e()])};T._withStripped=!0;const _=v({props:{comment:{type:Object,default:()=>({})},replyLastComment:{type:Boolean,default:!1},showOnly:{type:Boolean,default:!0},lastCommentId:{type:String,default:""},comments:{type:Object,default:()=>({})}},data:()=>({hover:!1,lang:eXo.env.portal.language,dateTimeFormat:{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}}),computed:{showDeleteButtom(){return this.hover&&!this.replyLastComment&&eXo.env.portal.userName===this.comment.author.username},relativeTime(){return this.getRelativeTime(this.comment.comment.createdTime.time)}},methods:{displayCommentDate(t){return t&&this.$dateUtil.formatDateObjectToDisplay(new Date(t),this.dateTimeFormat,this.lang)||""},getRelativeTime(t){const e=6e4,s=36e5,o=864e5,n=(new Date).getTime()-t;return n<e?this.$t("task.timeConvert.Less_Than_A_Minute"):n===e?this.$t("task.timeConvert.About_A_Minute"):n<s?this.$t("task.timeConvert.About_?_Minutes").replace("{0}",Math.round(n/e)):n===s?this.$t("task.timeConvert.About_An_Hour"):n<o?this.$t("task.timeConvert.About_?_Hours").replace("{0}",Math.round(n/s)):n===o?this.$t("task.timeConvert.About_A_Day"):n<1728e5?this.$t("task.timeConvert.About_?_Days").replace("{0}",Math.round(n/o)):this.displayCommentDate(this.comment.comment.createdTime.time)},replyComment(){this.replyLastComment?this.$root.$emit("displayTaskComment",this.lastCommentId):this.$emit("openCommentEditor",this.comment.comment.id)}}},T,[],!1,null,null,null).exports;var E=function(){var t=this,e=t._self._c;return e("div",{staticClass:"commentItem",attrs:{id:t.id}},[e("div",{staticClass:"commentHeader d-flex"},[e("exo-user-avatar",{key:t.comment.comment.id,attrs:{"profile-id":t.comment.author.username,size:30,"extra-class":"position-relative overflow-hidden","bold-title":"","link-style":"",popover:""}}),t._v(" "),e("div",{staticClass:"commentContent ps-3 d-flex align-center flex-grow-0 flex-shrink-0"},[e("span",{staticClass:"dateTime caption font-italic d-block text-sub-title",attrs:{title:t.displayCommentDate(t.comment.comment.createdTime.time)}},[t._v(t._s(t.relativeTime))])])],1),t._v(" "),e("div",{staticClass:"commentBody ms-10 mt-1"},[e("div",{staticClass:"taskContentComment",domProps:{innerHTML:t._s(t.comment.formattedComment)}}),t._v(" "),e("v-btn",{attrs:{id:"reply_btn",depressed:"",text:"",small:"",color:"primary"},on:{click:t.openCommentDrawer}},[t._v("\n      "+t._s(t.$t("comment.message.Reply"))+"\n    ")])],1),t._v(" "),t.comment.subComments&&t.comment.subComments.length?e("div",{staticClass:"py-0 TaskSubComments"},t._l(t.comment.subComments,(function(s,o){return e("div",{key:o,staticClass:"TaskSubCommentItem pe-0 pb-2"},[e("task-comment-item",{attrs:{comment:s,comments:t.comment.subComments,"avatar-size":30,"reply-last-comment":!0,"last-comment-id":t.comment.comment.id}})],1)})),0):t._e()])};E._withStripped=!0;const b=v({props:{task:{type:Boolean,default:!1},comment:{type:Object,default:()=>({})}},data:()=>({lang:eXo.env.portal.language,dateTimeFormat:{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}}),computed:{relativeTime(){return this.getRelativeTime(this.comment.comment.createdTime.time)},id(){return`comment-${this.comment.comment.id}`}},methods:{getRelativeTime(t){const e=6e4,s=36e5,o=864e5,n=(new Date).getTime()-t;return n<e?this.$t("task.timeConvert.Less_Than_A_Minute"):n===e?this.$t("task.timeConvert.About_A_Minute"):n<s?this.$t("task.timeConvert.About_?_Minutes").replace("{0}",Math.round(n/e)):n===s?this.$t("task.timeConvert.About_An_Hour"):n<o?this.$t("task.timeConvert.About_?_Hours").replace("{0}",Math.round(n/s)):n===o?this.$t("task.timeConvert.About_A_Day"):n<1728e5?this.$t("task.timeConvert.About_?_Days").replace("{0}",Math.round(n/o)):this.displayCommentDate(this.comment.comment.createdTime.time)},displayCommentDate(t){return t&&this.$dateUtil.formatDateObjectToDisplay(new Date(t),this.dateTimeFormat,this.lang)||""},openCommentDrawer(){this.$root.$emit("displayTaskComment",this.comment.comment.id)}}},E,[],!1,null,null,null).exports;var D=function(){var t=this,e=t._self._c;return e("div",{staticClass:"taskComments"},[t.comments&&t.comments.length?e("div",{staticClass:"taskCommentNumber d-flex pb-3"},[e("span",{staticClass:"ViewAllCommentLabel",on:{click:function(e){return t.$root.$emit("displayTaskComment")}}},[t._v(t._s(t.$t("comment.message.viewAllComment"))+" ("+t._s(t.comments.length)+")")]),t._v(" "),e("div",{staticClass:"addCommentBtn ps-3",attrs:{title:t.$t("comment.message.addYourComment")},on:{click:t.openCommentDrawer}},[e("i",{staticClass:"uiIcon uiIconTaskAddComment"})])]):e("div",{staticClass:"taskCommentEmpty align-center pt-6 pb-3"},[e("i",{staticClass:"uiIcon uiIconComment"}),t._v(" "),e("span",{staticClass:"noCommentLabel"},[t._v(t._s(t.$t("comment.message.noComment")))]),t._v(" "),e("span",{staticClass:"ViewAllCommentText",on:{click:function(e){return t.$root.$emit("displayTaskComment")}}},[t._v(t._s(t.$t("comment.message.addYourComment")))])]),t._v(" "),t.comments&&t.comments.length?e("div",{staticClass:"pe-0 ps-0 TaskCommentItem"},[e("task-last-comment",{attrs:{task:t.task,comment:t.comments[t.comments.length-1]}})],1):t._e()])};function x(t){return fetch(`/portal/rest/v1/social/users/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting user informations")}))}function S(t,e){return t?(document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`/portal/rest/tasks/${t}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((t=>t&&t.ok?t.json():t.text().then((t=>{throw new Error(t)})))).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))):Promise.resolve()}function j(t){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch("/portal/rest/tasks",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",credentials:"include",body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when adding task")})).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function O(){return fetch("/portal/rest/tasks/labels",{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting my all labels")}))}function A(t){return fetch(`/portal/rest/tasks/labels/project/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting my all labels")}))}function L(t){return fetch(`/portal/rest/tasks/labels/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting task labels")}))}function M(t,e){return fetch(`/portal/rest/tasks/labels/${t}`,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",credentials:"include",body:JSON.stringify(e)}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when adding task to label")}))}function I(t,e){return fetch(`/portal/rest/tasks/labels/${t}/${e}`,{credentials:"include",method:"DELETE"}).then((t=>{if(!t||!t.ok)throw new Error("Error when deleting task from label")}))}function N(t){return fetch("/portal/rest/tasks/labels",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",credentials:"include",body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when adding task to label")}))}function z(t){return fetch(`/portal/rest/tasks/labels/${t.id}`,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"PUT",credentials:"include",body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when updateing label")}))}function G(t){return fetch(`/portal/rest/tasks/labels/${t}`,{credentials:"include",method:"DELETE"}).then((t=>{if(!t||!t.ok)throw new Error("Error when deleting label")}))}function B(){return fetch("/portal/rest/projects/projects",{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting projects")}))}function P(t){return fetch(`/portal/rest/projects/projects/status/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting default status")}))}function R(t){return fetch(`/portal/rest/projects/projects/statuses/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting project statuses")}))}function U(){return fetch("/portal/rest/v1/social/users",{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting users")}))}function V(t){return fetch(`/portal/rest/tasks/logs/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting task logs")}))}function X(t){return fetch(`/portal/rest/tasks/comments/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting task comments")}))}function H(t,e){return fetch(`/portal/rest/tasks/comments/${t}`,{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:e}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when adding task comment")}))}function F(t,e,s){return fetch(`/portal/rest/tasks/comments/${e}/${t}`,{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:s}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when adding task sub comment")}))}function K(t){return fetch(`/portal/rest/tasks/comments/${t}`,{method:"DELETE",credentials:"include"}).then((t=>{if(!t||!t.ok)throw new Error("Error when removing task comment")}))}function Y(t,e){return fetch(t?`/portal/rest/projects/projectParticipants/${t}/${e}`:`/portal/rest/tasks/usersToMention/${e}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting users to mention")}))}function J(t,e){return fetch(`/portal/rest/tasks/users/${t}/${e}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting suggested users")}))}function W(t){return fetch(`/portal/rest/v1/social/users/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting user")}))}function q(t){return t.replace(/((?:href|src)=")?((((https?|ftp|file):\/\/)|www\.)[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|])/gi,(function(t,e){if(e)return t;let s=t;return 0===s.indexOf("www.")&&(s=`//${s}`),`<a href="${s}" target="_blank">${t}</a>`}))}function Z(t){return fetch(`${a}/${r}/tasks/clone/${t}`,{credentials:"include",method:"POST"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when cloning task")}))}D._withStripped=!0;const Q={"task-comment-editor":y,"task-comments":g,"task-comments-drawer":f,"task-comment-item":_,"task-last-comment":b,"task-view-all-comments":v({props:{comments:{type:Array,default:()=>[]},task:{type:Object,default:null}},methods:{openCommentDrawer(){this.$root.$emit("displayTaskComment",this.comments[this.comments.length-1].comment.id,!0)}}},D,[],!1,null,null,null).exports};for(const t in Q)Vue.component(t,Q[t]);Vue.prototype.$tasksService||window.Object.defineProperty(Vue.prototype,"$tasksService",{value:s}),Vue.prototype.$taskDrawerApi||window.Object.defineProperty(Vue.prototype,"$taskDrawerApi",{value:o});const tt=v({data(){return{placeholder:"",tasks:[],tasksOverdue:[],tasksToday:[],tasksTomorrow:[],tasksUpcoming:[],tasksOverdueSize:"",tasksTodaySize:"",tasksTomorrowSize:"",tasksUpcomingSize:"",primaryFilterSelected:"ALL",loadingTasks:!0,TasksWithoutUpcomingSize:"",TasksSize:"",task:{id:null,status:{project:this.project},priority:"NONE",description:"",title:""},alert:!1,type:"",message:"",priorityStatus:["High","In Normal","Low","None",null]}},computed:{tasksOverdueList(){return this.tasksOverdue&&this.tasksOverdueSize>10?this.tasksOverdue.slice(0,10):this.tasksOverdue},tasksTodayList(){return this.tasksToday?this.tasksTodaySize&&this.tasksOverdueSize<11?this.tasksToday.slice(0,10-this.tasksOverdueSize):"":this.tasksToday.slice(0,0)},tasksTomorrowList(){return this.tasksTomorrow?this.tasksTomorrowSize&&this.tasksOverdueSize+this.tasksTodaySize<11?this.tasksTomorrow.slice(0,10-this.tasksOverdueSize-this.tasksTodaySize):"":this.tasksTomorrow.slice(0,0)},tasksUpcomingList(){return this.tasksUpcoming?this.tasksUpcomingSize&&this.tasksOverdueSize+this.tasksTodaySize+this.tasksTomorrowSize<11?this.tasksUpcoming.slice(0,10-this.tasksOverdueSize-this.tasksTodaySize-this.tasksTomorrowSize):"":this.tasksUpcoming.slice(0,0)}},created(){this.$root.$on("task-updated",(t=>{this.task=t})),this.$root.$on("update-task-widget-list",(t=>{this.task=t,this.getMyOverDueTasks(),this.getMyTodayTasks(),this.getMyTomorrowTasks(),this.getMyUpcomingTasks()})),this.$root.$on("show-alert",(t=>{this.displayMessage(t)})),this.$root.$on("open-task-drawer",(t=>{this.task=t,this.$refs.taskDrawer.open(this.task)})),this.itemsLimit=this.$parent.$data.itemsLimit,Promise.all([this.getMyOverDueTasks(),this.getMyTodayTasks(),this.getMyTomorrowTasks(),this.getMyUpcomingTasks()]).finally((()=>this.$root.$applicationLoaded()))},methods:{getMyOverDueTasks(){return m({dueCategory:"overDue",offset:0,limit:0,showCompletedTasks:!1},"","priority","","-2").then((t=>{this.tasksOverdue=t.tasks,this.tasksOverdue=this.tasksOverdue.sort(((t,e)=>this.priorityStatus.indexOf(t.task.priority)-this.priorityStatus.indexOf(e.task.priority))),this.tasksOverdueSize=t.tasksNumber,this.tasks=this.tasks.concat(this.tasksOverdue),this.loadingTasks=!1}))},getMyTodayTasks(){return m({dueCategory:"today",offset:0,limit:0,showCompletedTasks:!1},"","priority","","-2").then((t=>{this.tasksToday=t.tasks,this.tasksToday=this.tasksToday.sort(((t,e)=>this.priorityStatus.indexOf(t.task.priority)-this.priorityStatus.indexOf(e.task.priority))),this.tasksTodaySize=t.tasksNumber,this.tasks=this.tasks.concat(this.tasksToday),this.loadingTasks=!1}))},getMyTomorrowTasks(){return m({dueCategory:"tomorrow",offset:0,limit:0,showCompletedTasks:!1},"","priority","","-2").then((t=>{this.tasksTomorrow=t.tasks,this.tasksTomorrow=this.tasksTomorrow.sort(((t,e)=>this.priorityStatus.indexOf(t.task.priority)-this.priorityStatus.indexOf(e.task.priority))),this.tasksTomorrowSize=t.tasksNumber,this.tasks=this.tasks.concat(this.tasksTomorrow),this.loadingTasks=!1}))},getMyUpcomingTasks(){return m({dueCategory:"upcoming",offset:0,showCompletedTasks:!1},"","priority","","-2").then((t=>{this.tasksUpcoming=t.tasks,this.tasksUpcoming=this.tasksUpcoming.sort(((t,e)=>this.priorityStatus.indexOf(t.task.priority)-this.priorityStatus.indexOf(e.task.priority))),this.tasksUpcomingSize=t.tasksNumber,this.tasks=this.tasks.concat(this.tasksUpcoming),this.loadingTasks=!1}))},openTaskDrawer(){const t={id:null,status:{project:this.project},priority:"NONE",description:"",title:""};this.$root.$emit("open-task-drawer",t)},removeTask(t){this.tasks.splice(this.tasks.findIndex((function(e){return e.id===t})),1),document.body.style.overflow="auto"},navigateTo(t,e){this.primaryFilterSelected=e,localStorage.setItem("primary-filter-tasks",this.primaryFilterSelected),location.href=`${eXo.env.portal.context}/${eXo.env.portal.portalName}/${t}`},dateFormatter(t){if(t){const e=new Date(t.time),s=e.getDate(),o=e.getMonth()+1;return`${e.getFullYear()}-${o}-${s}`}},retrieveTask(t){if(t.dueDate){const e=new Date,s=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`,o=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()+1}`,n=this.dateFormatter(t.dueDate);return n===s?this.getMyTodayTasks():new Date(t.dueDate.time).getTime()<e.getTime()?this.getMyOverDueTasks():n===o?this.getMyTomorrowTasks():this.getMyUpcomingTasks()}},displayMessage(t){this.message=t.message,this.type=t.type,this.alert=!0,window.setTimeout((()=>this.alert=!1),5e3)}}},n,[],!1,null,null,null).exports;var et=function(){var t=this,e=t._self._c;return e("v-layout",{staticClass:"white",attrs:{row:"","mx-0":""}},[e("v-flex",{attrs:{"d-flex":"",xs12:"","ps-3":""}},[e("v-layout",{attrs:{row:"","mx-0":""}},[e("v-flex",{attrs:{"d-flex":"",xs6:""}},[e("v-list-item-content",{staticClass:"py-0",staticStyle:{"max-width":"350px"}},[e("a",{ref:"tooltip",staticClass:"taskTitle",attrs:{title:t.task.task.title},on:{click:function(e){return t.openTaskDrawer()}}},[e("v-list-item-title",{domProps:{textContent:t._s(t.task.task.title)}}),t._v(" "),e("v-list-item-subtitle",[e("div",{staticClass:"color-title"},[t._v(t._s(t.dateFormatter(t.task.dueDate)))])])],1)])],1),t._v(" "),null!=t.task.status?e("v-flex",{attrs:{"mt-n2":"","d-flex":"",xs6:"","justify-end":"",align:""}},[e("v-card",{staticClass:"my-3 projectCard text-center flexCard taskTitle",attrs:{title:t.task.status.project.name,color:t.task.status.project.color,flex:"",width:"200",flat:""},on:{click:function(e){return t.navigateTo(t.task.status.project.id)}}},[e("span",[t._v(t._s(t.task.status.project.name))])]),t._v(" "),e("v-card",{staticClass:"my-3 flagCard",class:t.projectBorder,attrs:{width:"18",height:"21",flat:"",center:""},on:{click:function(e){return t.openTaskDrawer()}}},[e("v-icon",{staticClass:"ms-n1",attrs:{color:t.getTaskPriorityColor(t.task.task.priority)}},[t._v("\n            mdi-flag-variant\n          ")])],1)],1):t._e()],1)],1)],1)};et._withStripped=!0;const st=v({props:{task:{type:Object,default:()=>({})}},data:()=>({drawer:!1}),computed:{projectBorder(){return`${this.task.status.project.color}_border`}},created(){this.$root.$on("task-updated",(t=>{this.task?.task?.id===t?.id&&(this.task.task=t)}))},methods:{dateFormatter(t){if(t){const e=new Date(t.time);return`${e.getDate()}-${e.getMonth()+1}-${e.getFullYear()}`}},getTaskPriorityColor(t){switch(t){case"HIGH":return"#bc4343";case"NORMAL":return"#ffb441";case"LOW":return"#2eb58c";case"NONE":return"#476A9C"}},openTaskDrawer(){this.$root.$emit("open-task-drawer",this.task.task)},navigateTo(t){location.href=`${eXo.env.portal.context}/${eXo.env.portal.portalName}/tasks/projectDetail/${t}`}}},et,[],!1,null,null,null).exports;Vue.use(Vuetify),Vue.component("TaskDetails",st);const ot=new Vuetify(eXo.env.portal.vuetifyPreset),nt=eXo&&eXo.env&&eXo.env.portal&&eXo.env.portal.language||"en",at=`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.portlet.taskManagement-${nt}.json`;function rt(t){exoi18n.loadLanguageAsync(nt,at).then((e=>{Vue.createApp({data:{itemsLimit:t},render:t=>t(tt),i18n:e,vuetify:ot},"#tasks","Tasks Widget")}))}return e})()));