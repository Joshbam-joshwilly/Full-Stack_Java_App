define((()=>(()=>{"use strict";var t={d:(e,s)=>{for(var a in s)t.o(s,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:s[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{init:()=>Qe});var s={};t.r(s),t.d(s,{filterTasksList:()=>ae,getLabelsByProjectId:()=>re,getLabelsByTaskId:()=>ie,getMyTasksList:()=>se,getStatusesByProjectId:()=>ne,getTaskById:()=>oe,getTasksByProjectId:()=>le,updateCompleted:()=>ce});var a={};t.r(a),t.d(a,{addProject:()=>pe,cloneProject:()=>ge,deleteProjectInfo:()=>me,getFilterSettings:()=>we,getProject:()=>he,getProjectStats:()=>ue,getProjectsList:()=>de,saveFilterSettings:()=>fe,updateProjectColor:()=>ve,updateProjectInfo:()=>ke});var i={};t.r(i),t.d(i,{createStatus:()=>ye,deleteStatus:()=>$e,moveStatus:()=>be,updateStatus:()=>Te});var r={};t.r(r),t.d(r,{addLabel:()=>xe,addTask:()=>je,addTaskComments:()=>Ve,addTaskSubComment:()=>ze,addTaskToLabel:()=>Le,cloneTask:()=>He,editLabel:()=>Pe,findUsersToMention:()=>qe,getAllUsers:()=>Oe,getDefaultStatusByProjectId:()=>Be,getMyAllLabels:()=>De,getProjectLabels:()=>Se,getProjects:()=>Ne,getStatusesByProjectId:()=>Me,getSuggestedUsers:()=>Ge,getTaskComments:()=>Re,getTaskLabels:()=>Ae,getTaskLogs:()=>Fe,getUser:()=>Xe,getUserInformations:()=>Ce,removeLabel:()=>Ee,removeTaskComment:()=>Ue,removeTaskFromLabel:()=>Ie,updateTask:()=>_e,urlVerify:()=>Ke});var o=function(){var t=this,e=t._self._c;return e("v-app",{attrs:{id:"TasksManagementPortlet"}},[e("v-alert",{attrs:{type:t.type,dismissible:""},model:{value:t.alert,callback:function(e){t.alert=e},expression:"alert"}},[t._v("\n    "+t._s(t.message)+"\n  ")]),t._v(" "),t.showTabs?e("v-tabs",{staticClass:"tasksMenuParent white",attrs:{"slider-size":"4"},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[e("v-tab",{attrs:{href:"#tab-2"},on:{click:function(e){return t.getMyProjects()}}},[t._v("\n      "+t._s(t.$t("label.projects"))+"\n    ")]),t._v(" "),e("v-tab",{attrs:{href:"#tab-1"},on:{click:function(e){return t.getMyTasks()}}},[t._v("\n      "+t._s(t.$t("label.tasks.header"))+"\n    ")])],1):t._e(),t._v(" "),e("v-tabs-items",{model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[e("v-tab-item",{attrs:{value:"tab-1"}},[e("tasks-dashboard")],1),t._v(" "),e("v-tab-item",{attrs:{value:"tab-2"}},[e("project-dashboard",{attrs:{"space-name":t.spaceName,"display-details":t.displayDetails}})],1)],1),t._v(" "),e("add-project-drawer",{ref:"addProjectDrawer"}),t._v(" "),e("task-drawer",{ref:"taskDrawer",attrs:{task:t.task}}),t._v(" "),e("tasks-assignee-coworker-drawer")],1)};function n(t,e,s,a,i,r,o,n){var l,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=s,c._compiled=!0),a&&(c.functional=!0),r&&(c._scopeId="data-v-"+r),o?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=l):i&&(l=n?function(){i.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:i),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(t,e){return l.call(e),d(t,e)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,l):[l]}return{exports:t,options:c}}o._withStripped=!0;const l=n({data:()=>({tab:"",displayDetails:!1,showTabs:!1,spaceName:"",projectId:"",alert:!1,type:"",message:"",task:{type:Object,default:()=>({})}}),computed:{isDrawerClosed(){return!this.$refs.taskDrawer.$refs.addTaskDrawer.drawer}},created(){this.$root.$on("show-alert",(t=>{this.displayMessage(t)})),this.$root.$on("open-project-drawer",(t=>{this.$refs.addProjectDrawer.open(t)})),this.$root.$on("show-project-details-tasks",(t=>{document.dispatchEvent(new CustomEvent("showProjectTasks",{detail:t})),this.tab="tab-2"})),this.$root.$on("set-url",(t=>{"task"===t.type&&this.setTaskUrl(t.id),"project"===t.type&&this.isDrawerClosed&&this.setProjectUrl(t.id),"myProjects"===t.type&&this.getMyProjects()})),this.$root.$on("open-task-drawer",(t=>{this.task=t,t.id&&this.setTaskUrl(t.id),this.$refs.taskDrawer.open(t)})),this.$root.$on("task-drawer-closed",(t=>{"tab-1"===this.tab?this.getMyTasks():t&&t.status&&t.status.project?this.setProjectUrl(t.status.project.id):this.tab="tab-1"}));const t=document.location.pathname;if(t.includes("myTasks"))this.tab="tab-1",this.projectId="",this.showTabs=!0;else if(t.includes("taskDetail")){let e=t.split("taskDetail/")[1].split(/[^0-9]/)[0];e=e&&Number(e)||0,e&&this.$tasksService.getTaskById(e).then((t=>{this.task=t,this.task.status&&this.task.status.project?(this.displayDetails=!0,this.projectId=this.task.status.project.id,this.showTabs=!1,window.setTimeout((()=>{document.dispatchEvent(new CustomEvent("showProjectTasks",{detail:this.task.status.project}))}),20),this.tab="tab-2"):(this.tab="tab-1",this.projectId="",this.showTabs=!0),window.setTimeout((()=>{this.$refs.taskDrawer.open(this.task)}),200)})).finally((()=>this.$root.$applicationLoaded()))}else if(t.includes("projectDetail")){let e=t.split("projectDetail/")[1].split(/[^0-9]/)[0];e=e&&Number(e)||0,e&&(this.projectId=e,this.showTabs=!1,this.$projectService.getProject(e).then((t=>{document.dispatchEvent(new CustomEvent("showProjectTasks",{detail:t}))})).finally((()=>this.$root.$applicationLoaded())),this.displayDetails=!0,this.tab="tab-2")}else this.showTabs=!0,this.tab="tab-2";eXo.env.portal.spaceName&&(this.spaceName=eXo.env.portal.spaceName,this.tab="tab-2",this.showTabs=!1)},methods:{getMyTasks(){this.showTabs=!0,this.displayDetails=!1,window.history.pushState("mytasks","My Tasks",`${eXo.env.portal.context}/${eXo.env.portal.portalName}/tasks/myTasks`)},getMyProjects(){this.projectId="",this.showTabs=!0,this.displayDetails=!1;const t=document.location.pathname;eXo.env.portal.spaceName?window.history.pushState("task","Task details",`${t.split("tasks")[0]}tasks`):window.history.pushState("myprojects","My Projects",`${eXo.env.portal.context}/${eXo.env.portal.portalName}/tasks/myProjects`)},setTaskUrl(t){const e=document.location.pathname;window.history.pushState("task","Task details",`${e.split("tasks")[0]}tasks/taskDetail/${t}`)},setProjectUrl(t){const e=document.location.pathname;this.projectId=t,this.showTabs=!1,this.displayDetails=!0,window.history.pushState("task","Task details",`${e.split("tasks")[0]}tasks/projectDetail/${t}`)},displayMessage(t){this.message=t.message,this.type=t.type,this.alert=!0,window.setTimeout((()=>this.alert=!1),5e3)}}},o,[],!1,null,null,null).exports;var c=function(){var t=this,e=t._self._c;return e("v-app",{staticClass:"tasksListContainer",attrs:{id:"ProjectCardList"}},[t.projects&&t.projects.length||t.loadingProjects?e("div",[e("v-card",{attrs:{flat:""}},[e("v-item-group",{staticClass:"pa-4"},[e("v-container",{staticClass:"pa-0"},[e("v-row",{staticClass:"ma-0 border-box-sizing"},t._l(t.projects,(function(s){return e("v-col",{key:s.id,staticClass:"pa-0 projectItem",attrs:{id:"project-"+s.id,cols:"12",md:"6",lg:"4",xl:"3"}},[e("project-card",{attrs:{project:s},on:{refreshProjects:t.searchProjects}})],1)})),1),t._v(" "),e("v-row",{staticClass:"ma-0 border-box-sizing"},[t.canShowMore?e("v-btn",{staticClass:"loadMoreButton ma-auto mt-4 btn",attrs:{loading:t.loadingProjects,disabled:t.loadingProjects,block:""},on:{click:t.loadNextPage}},[t._v("\n              "+t._s(t.$t("spacesList.button.showMore"))+"\n            ")]):t._e()],1)],1)],1)],1)],1):e("div",{staticClass:"noTasksProject"},[e("div",{staticClass:"noTasksProjectIcon"},[e("i",{staticClass:"uiIcon uiIconClipboard"})]),t._v(" "),e("div",{staticClass:"noTasksProjectLabel"},[e("span",[t._v(t._s(t.$t("label.noProjects")))])])])])};c._withStripped=!0;const d=n({props:{spaceName:{type:String,default:""},keyword:{type:String,default:null},projectFilterSelected:{type:String,default:"ALL"},loadingProjects:{type:Boolean,default:!1}},data:()=>({maxTasksSize:10,projects:[],offset:0,projectSize:0,pageSize:20,limit:20,limitToFetch:0,originalLimitToFetch:0,disableBtn:!1,startSearchAfterInMilliseconds:600,endTypingKeywordTimeout:50,startTypingKeywordTimeout:0}),computed:{canShowMore(){return this.loadingProjects||this.projects.length>=this.limitToFetch}},watch:{keyword(){if(!this.keyword)return this.resetSearch(),void this.searchProjects();this.startTypingKeywordTimeout=Date.now(),this.loadingProjects||(this.loadingProjects=!0,this.waitForEndTyping())},limitToFetch(){this.searchProjects()},projectFilterSelected(){this.searchProjects()}},created(){this.originalLimitToFetch=this.limitToFetch=this.limit,this.$root.$on("update-projects-list",(()=>{this.searchProjects()}))},methods:{searchProjects(){return this.loadingProjects=!0,this.$projectService.getProjectsList(this.spaceName,this.keyword,this.projectFilterSelected,this.offset,this.limitToFetch).then((t=>(this.projects=t&&t.projects||[],this.projectSize=t&&t.projectNumber||0,this.$nextTick()))).then((()=>{this.keyword&&this.projects.length>=this.limitToFetch&&(this.limitToFetch+=this.pageSize)})).finally((()=>{this.loadingProjects=!1,this.$root.$applicationLoaded()}))},resetSearch(){this.limitToFetch!==this.originalLimitToFetch&&(this.limitToFetch=this.originalLimitToFetch)},loadNextPage(){this.originalLimitToFetch=this.limitToFetch+=this.pageSize},waitForEndTyping(){window.setTimeout((()=>{Date.now()-this.startTypingKeywordTimeout>this.startSearchAfterInMilliseconds?this.searchProjects():this.waitForEndTyping()}),this.endTypingKeywordTimeout)}}},c,[],!1,null,null,null).exports;var u=function(){var t=this,e=t._self._c;return e("v-app",{staticClass:"projectAndTasksContainer pa-4 pb-2 transparent",attrs:{id:"projectListApplication",flat:""}},[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.displayDetails,expression:"!displayDetails"}]},[e("project-list-toolbar",{attrs:{keyword:t.keyword,"project-filter-selected":t.projectFilterSelected,"space-name":t.spaceName},on:{"keyword-changed":function(e){t.keyword=e},"filter-changed":function(e){t.projectFilterSelected=e}}}),t._v(" "),e("project-card-list",{attrs:{keyword:t.keyword,"space-name":t.spaceName,"project-filter-selected":t.projectFilterSelected,"loading-projects":t.loadingProjects}})],1),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.displayDetails,expression:"displayDetails"}]},[e("tasks-view-dashboard",{attrs:{project:t.project}})],1),t._v(" "),e("project-manager-drawer")],1)};u._withStripped=!0;const h=n({props:{spaceName:{type:String,default:""},displayDetails:{type:Boolean,default:!1}},data:()=>({project:"",keyword:null,loadingProjects:!1,projectFilterSelected:"ALL"}),created(){document.addEventListener("showProjectTasks",(t=>{t&&t.detail&&(this.project=t.detail,window.setTimeout((()=>{this.$root.$emit("set-url",{type:"project",id:this.project.id})}),200))})),document.addEventListener("hideProjectTasks",(()=>{this.displayDetails=!1}))}},u,[],!1,null,null,null).exports;var p=function(){var t=this,e=t._self._c;return e("v-app",{attrs:{id:"projectBoardToolbar"}},[e("v-toolbar",{staticClass:"tasksToolbar pb-3",class:t.showMobileTaskFilter&&"toolbarLarge",attrs:{id:"ProjectListToolbar",flat:""}},[t.enableCreateButton?e("v-toolbar-title",[e("v-btn",{staticClass:"btn px-2 btn-primary addNewProjectButton",on:{click:t.openDrawer}},[e("v-icon",{staticClass:"d-block d-sm-none",attrs:{dark:""}},[t._v("mdi-plus")]),t._v(" "),e("span",{staticClass:"d-none font-weight-regular d-sm-flex align-center"},[e("i",{staticClass:"uiIcon uiIconPlus"}),t._v(" "),e("span",{staticClass:"addProject"},[t._v(t._s(t.$t("label.addProject")))])])],1)],1):t._e(),t._v(" "),e("v-scale-transition",[e("v-icon",{staticClass:"taskFilterMobile",class:t.showMobileTaskFilter&&"tasksFilterMobile",attrs:{size:"20"},on:{click:function(e){t.showMobileTaskFilter=!t.showMobileTaskFilter}}},[t._v("\n        fas fa-filter\n      ")])],1),t._v(" "),e("v-spacer"),t._v(" "),e("v-scale-transition",[e("v-text-field",{staticClass:"inputTasksFilter inputProjectFilter pa-0 ms-3 me-3 my-auto",class:t.showMobileTaskFilter&&"inputTasksFilterMobile",attrs:{placeholder:t.$t("label.filterProject"),"prepend-inner-icon":"fa-filter","append-outer-icon":t.showMobileTaskFilter&&"mdi-close",clearable:!t.showMobileTaskFilter},on:{"click:append-outer":t.clearMessage},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}})],1),t._v(" "),t.spaceName?t._e():e("v-scale-transition",[e("select",{directives:[{name:"model",rawName:"v-model",value:t.projectFilterSelected,expression:"projectFilterSelected"}],staticClass:"selectTasksFilter my-auto me-2 subtitle-1 ignore-vuetify-classes d-sm-inline",attrs:{id:"filterTaskSelect",name:"projectFilter"},on:{change:[function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.projectFilterSelected=e.target.multiple?s:s[0]},t.changeProjectFilter]}},t._l(t.projectFilter,(function(s){return e("option",{key:s.name,domProps:{value:s.name}},[t._v("\n          "+t._s(t.$t("label.project.filter."+s.name.toLowerCase()))+"\n        ")])})),0)]),t._v(" "),e("v-scale-transition",[e("select",{attrs:{id:"widthTmpSelectTaskFilter"}},[e("option",{attrs:{id:"widthTmpSelectOption"}})])])],1)],1)};p._withStripped=!0;const k=n({props:{keyword:{type:String,default:null},spaceName:{type:String,default:""},projectFilterSelected:{type:String,default:"ALL"}},data:()=>({projectFilter:[{name:"ALL"},{name:"MANAGED"},{name:"COLLABORATED"},{name:"WITH_TASKS"}],showMobileTaskFilter:!1,currentSpace:!1}),watch:{keyword(){this.$emit("keyword-changed",this.keyword)},projectFilterSelected(){this.$emit("filter-changed",this.projectFilterSelected)}},created(){this.retrieveCurrentSpace()},computed:{enableCreateButton(){return!eXo.env.portal.spaceId||this.currentSpace&&this.currentSpace.canEdit}},mounted(){$("#widthTmpSelectOption").html($("#filterTaskSelect option:selected").text());const t=$("#widthTmpSelectTaskFilter").width()+40;$("#filterTaskSelect").width(t)},methods:{retrieveCurrentSpace(){if(eXo.env.portal.spaceId)return this.$spaceService.getSpaceById(eXo.env.portal.spaceId).then((t=>{this.currentSpace=t}))},openDrawer(){this.$root.$emit("open-project-drawer",{})},clearMessage(){this.keyword="",this.showMobileTaskFilter=!this.showMobileTaskFilter},changeProjectFilter(){$("#widthTmpSelectOption").html($("#filterTaskSelect option:selected").text());const t=$("#widthTmpSelectTaskFilter").width()+40;$("#filterTaskSelect").width(t)}}},p,[],!1,null,null,null).exports;var m=function(){var t=this,e=t._self._c;return e("v-app",{attrs:{id:"projectCard"}},[e("v-flex",{class:t.flipCard?"taskCardFlip taskCardFlipped":"taskCardFlip"},[e("div",{staticClass:"taskCardFront pa-3"},[e("project-card-front",{attrs:{project:t.project},on:{openDrawer:t.openEditDrawer,closed:t.onCloseDrawer,refreshProjects:t.refreshProjects,flip:function(e){t.flipCard=!0,t.flip()}}})],1),t._v(" "),e("div",{staticClass:"tasksCardBack pa-3"},[e("project-card-Reverse",{ref:"reversCard",attrs:{project:t.project},on:{flip:function(e){t.flipCard=!1,t.flip()}}})],1)])],1)};m._withStripped=!0;const g=n({props:{project:{type:Object,default:()=>({})}},data:()=>({flipCard:!1}),methods:{openEditDrawer(){this.$root.$emit("open-project-drawer",this.project)},onCloseDrawer:function(t){this.drawer=t},refreshProjects:function(){this.$emit("refreshProjects")},flip:function(){this.flipCard&&this.$refs.reversCard.getStats(this.project)}}},m,[],!1,null,null,null).exports;var v=function(){var t=this,e=t._self._c;return e("v-card",{staticClass:"tasksCardItem",class:t.project.color&&t.project.color+"_border_bottom"||"",attrs:{flat:"",outlined:"",hover:""}},[e("div",{staticClass:"taskItemToolbar d-flex px-2 align-center font-weight-bold"},[e("i",{staticClass:"uiIconInformation taskInfoIcon d-flex",class:t.project.color?"white--text":"toolbarNoColor",attrs:{icon:"",small:""},on:{click:function(e){return t.$emit("flip")}}}),t._v(" "),e("div",{staticClass:"spacer d-none d-sm-inline"}),t._v(" "),e("span",{staticClass:"projectCardTitle py-3",class:t.project.color?"white--text":"toolbarNoColor",on:{click:function(e){return t.showProjectTasksDetails(t.project)}}},[t._v("\n      "+t._s(t.project.name)+"\n    ")]),t._v(" "),e("v-spacer"),t._v(" "),t.project.canManage?e("i",{staticClass:"uiIconVerticalDots taskInfoIcon d-flex",class:t.project.color?"white--text":"toolbarNoColor",attrs:{icon:"",small:""},on:{click:function(e){t.displayActionMenu=!0}}}):t._e(),t._v(" "),e("v-menu",{attrs:{attach:`#project-${t.project.id}`,transition:"slide-x-reverse-transition","content-class":"projectActionMenu","offset-y":""},model:{value:t.displayActionMenu,callback:function(e){t.displayActionMenu=e},expression:"displayActionMenu"}},[e("v-list",{staticClass:"pa-0",attrs:{dense:""}},[e("v-list-item",{staticClass:"menu-list",on:{click:function(e){return t.openEditDrawer()}}},[e("v-list-item-title",{staticClass:"subtitle-2"},[e("i",{staticClass:"uiIcon uiIconEdit pe-1"}),t._v(" "),e("span",[t._v(t._s(t.$t("label.edit")))])])],1),t._v(" "),e("v-list-item",{staticClass:"draftButton",on:{click:function(e){return t.confirmDeleteProject()}}},[e("v-list-item-title",{staticClass:"subtitle-2"},[e("i",{staticClass:"uiIcon uiIconTrash pe-1"}),t._v(" "),e("span",[t._v(t._s(t.$t("label.delete")))])])],1),t._v(" "),e("v-list-item",{staticClass:"clone",on:{click:function(e){return t.confirmCloneProject()}}},[e("v-list-item-title",{staticClass:"subtitle-2"},[e("i",{staticClass:"uiIcon uiIconCloneNode pe-1"}),t._v(" "),e("span",[t._v(t._s(t.$t("label.clone")))])])],1),t._v(" "),e("v-list-item",{staticClass:"px-2 noColorLabel"},[e("v-list-item-title",{staticClass:"noColorLabel caption text-center text&#45;&#45;secondary"},[e("span",{on:{click:function(e){return t.changeColorProject(t.project,"")}}},[t._v(t._s(t.$t("label.noColor")))])])],1),t._v(" "),e("v-list-item",[e("v-list-item-title",{staticClass:"subtitle-2 row projectColorPicker mx-auto my-2"},t._l(t.projectColors,(function(s,a){return e("span",{key:a,staticClass:"projectColorCell",class:[s.class,s.class===t.project.color?"isSelected":""],on:{click:function(e){return t.changeColorProject(t.project,s.class)}}})})),0)],1)],1)],1)],1),t._v(" "),e("div",{staticClass:"taskItemInfo pa-3"},[e("div",{staticClass:"taskItemDescription",class:t.getClassDescription(),on:{click:function(e){return t.showProjectTasksDetails(t.project)}}},[t.project.description?e("p",[t._v("\n        "+t._s(t.getDescription())+"\n      ")]):e("div",[e("span",{staticClass:"noProjectDescription"},[t._v(t._s(t.$t("label.noDescription")))])])]),t._v(" "),e("div",{staticClass:"ProjectSpace"},[t.project.space?e("div",[e("exo-space-avatar",{attrs:{space:t.space,size:28,"link-style":"",popover:""}})],1):t._e()])]),t._v(" "),e("div",{staticClass:"SpaceAdmin"},[e("v-divider"),t._v(" "),e("div",{staticClass:"spaceAdminContainer"},[e("div",{staticClass:"spaceAdminWrapper"},[t.avatarToDisplay&&1===t.avatarToDisplay.length?e("exo-user-avatar",{attrs:{"profile-id":t.avatarToDisplay[0].userName,size:28,"extra-class":"my-2","link-style":"",popover:""}}):e("div",{staticClass:"managerAvatarsList d-flex flex-nowrap my-2",class:t.showAllAvatarList&&"AllManagerAvatar"},[e("exo-user-avatars-list",{attrs:{users:t.avatarToDisplay,max:5,"icon-size":28,"avatar-overlay-position":"","retrieve-extra-information":""},on:{"open-detail":function(e){return t.$root.$emit("displayProjectManagers",t.avatarToDisplay)}}})],1)],1)])],1),t._v(" "),e("exo-confirm-dialog",{ref:"CancelSavingChangesDialog",attrs:{message:t.$t("popup.msg.delete",{0:t.project.name}),title:t.$t("popup.confirm"),"ok-label":t.$t("popup.delete"),"cancel-label":t.$t("popup.cancel")},on:{ok:function(e){return t.deleteProject()}}}),t._v(" "),e("exo-confirm-dialog",{ref:"CancelSavingChangesCloneDialog",attrs:{message:t.$t("popup.msg.clone",{0:t.project.name}),title:t.$t("popup.confirm"),"ok-label":t.$t("popup.clone"),"cancel-label":t.$t("popup.cancel")},on:{ok:function(e){return t.cloneProject()}}})],1)};v._withStripped=!0;const f=n({props:{project:{type:Object,default:null}},data(){return{displayActionMenu:!1,waitTimeUntilCloseMenu:200,projectColors:[{class:"asparagus"},{class:"munsell_blue"},{class:"navy_blue"},{class:"purple"},{class:"red"},{class:"brown"},{class:"laurel_green"},{class:"sky_blue"},{class:"blue_gray"},{class:"light_purple"},{class:"hot_pink"},{class:"light_brown"},{class:"moss_green"},{class:"powder_blue"},{class:"light_blue"},{class:"pink"},{class:"Orange"},{class:"gray"},{class:"green"},{class:"baby_blue"},{class:"light_gray"},{class:"beige"},{class:"yellow"},{class:"plum"}],managerIdentities:this.project&&this.project.managerIdentities,projectSpace:{}}},computed:{avatarToDisplay(){const t=[];return this.managerIdentities&&this.managerIdentities.length&&this.managerIdentities.forEach((e=>{t.push({userName:e.username})})),t},space(){return this.projectSpace}},created(){$(document).on("mousedown",(()=>{this.displayActionMenu&&window.setTimeout((()=>{this.displayActionMenu=!1}),this.waitTimeUntilCloseMenu)})),this.$root.$on("update-projects-list-avatar",(t=>{this.project.managerIdentities=t})),this.project&&this.project.space&&this.project.spaceDetails&&this.retrieveSpaceInformation(this.project.spaceDetails.id)},methods:{showProjectTasksDetails(t){document.dispatchEvent(new CustomEvent("showProjectTasks",{detail:t}))},openEditDrawer(){this.$emit("openDrawer")},onCloseDrawer:function(t){this.drawer=t},confirmDeleteProject:function(){this.$refs.CancelSavingChangesDialog.open()},confirmCloneProject:function(){this.$refs.CancelSavingChangesCloneDialog.open()},deleteProject(){this.$projectService.deleteProjectInfo(this.project).then((()=>this.$emit("refreshProjects"))).then(this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.project.deleted")})).catch((t=>{console.error("Error updating project",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))},cloneProject(){this.$projectService.cloneProject(this.project).then((()=>this.$emit("refreshProjects"))).then(this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.project.cloned")})).catch((t=>{console.error("Error updating project",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))},changeColorProject(t,e){this.$projectService.updateProjectColor(t,e).then((()=>this.$emit("projectChangeColor"))).then(this.project.color=e)},getDescription(){let t=this.project.description;const e=document.createElement("div");return e.innerHTML=t,t=e.textContent||e.innerText||"",t},getClassDescription(){return this.project&&!this.project.space?"largeDescriptionArea":this.project&&this.project.space?"largeDescriptionAreaSpace":void 0},retrieveSpaceInformation(t){this.$spaceService.getSpaceById(t).then((t=>{this.projectSpace=t}))}}},v,[],!1,null,null,null).exports;var w=function(){var t=this,e=t._self._c;return e("v-card",{staticClass:"tasksCardItem",attrs:{flat:"",outlined:"",hover:""}},[e("div",{staticClass:"projectDetailsReverse pa-3"},[e("i",{staticClass:"uiIconInformation taskInfoIcon reverseInfoIcon d-flex",attrs:{icon:"",small:""},on:{click:function(e){return t.$emit("flip")}}}),t._v(" "),e("div",{staticClass:"projectDetails d-flex"},[e("p",{staticClass:"font-weight-bold ma-auto"},[t._v(t._s(t.$t("label.projectDetail")))])])]),t._v(" "),t.totalLeftTasks>0?e("div",{staticClass:"echartStatsContent d-flex justify-space-evently align-center px-2",staticStyle:{margin:"auto"}},[e("div",{staticClass:"echartAndLabel"},[e("div",{staticClass:"echartPieContent",staticStyle:{width:"160px",height:"200px"},attrs:{id:"echartProjectTasks"+t.project.id}}),t._v(" "),e("div",{staticClass:"projectTasksTotalNumber"},[e("span",{staticClass:"totalNumber font-weight-bold"},[t._v(t._s(t.totalLeftTasks))]),t._v(" "),e("span",{staticClass:"text-body-2 totalLabel"},[t._v(t._s(t.$t("exo.tasks.label.leftTasks")))])])]),t._v(" "),t.statistics.length<t.maxStatusToShow?e("div",{staticClass:"projectStatusNumber ps-4"},t._l(t.statistics,(function(s){return e("p",{key:s.name,staticClass:"d-flex justify-space-between mb-1 taskToDoLabel"},[e("span",{staticClass:"caption text-truncate"},[t._v(t._s(s.name))]),t._v(" "),e("span",[t._v(t._s(s.value))])])})),0):t._e()]):e("div",{staticClass:"noTasksProject"},[e("div",{staticClass:"noTasksProjectIcon"},[e("i",{staticClass:"uiIcon uiIconTask"})]),t._v(" "),e("div",{staticClass:"noTasksProjectLabel"},[e("span",[t._v(t._s(t.$t("label.noTasks")))])])])])};w._withStripped=!0;const y=n({props:{project:{type:Object,default:null}},data:()=>({totalLeftTasks:0,statistics:[],maxStatusToShow:7,option:{tooltip:{trigger:"item",formatter:"{b}:<br/> {c} ({d}%)"},series:[{type:"pie",center:["50%","50%"],radius:["80%","75%"],avoidLabelOverlap:!1,label:{show:!1,position:"center"},emphasis:{label:{show:!1,fontSize:"15",fontWeight:"bold"}},labelLine:{show:!1},data:[]}],color:["#476a9c","#ffb441","#bc4343","#2eb58c"]}}),methods:{initChart(t){const e=$(`#echartProjectTasks${this.project.id}`)[0];e&&echarts.init(e).setOption(t,!0)},getStats(t){this.$projectService.getProjectStats(t.id).then((t=>{this.statistics=t.statusStats||[],this.totalLeftTasks=t.totalNumberTasks||0,this.statistics&&this.statistics.length&&(this.option.series[0].data=this.statistics,window.setTimeout((()=>{this.initChart(this.option)}),200))}))}}},w,[],!1,null,null,null).exports;var T=function(){var t=this,e=t._self._c;return e("exo-drawer",{ref:"addProjectDrawer",staticClass:"addProjectDrawer",attrs:{"body-classes":"hide-scroll decrease-z-index-more",right:""},on:{closed:t.cancel}},[e("template",{slot:"title"},[t._v("\n    "+t._s(t.labelDrawer)+"\n  ")]),t._v(" "),e("template",{slot:"content"},[t.projectInformation?e("v-form",{ref:"taskEventForm",staticClass:"flex",attrs:{flat:""}},[e("div",{ref:"addProjectTitle",staticClass:"addProjectTitle d-flex align-center my-3"},[e("i",{staticClass:"uiIcon uiIconProject"}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.projectInformation.name,expression:"projectInformation.name"}],ref:"autoFocusInput1",staticClass:"projectInputTitle ps-3 pt-1",attrs:{placeholder:t.$t("label.label.titleProject"),type:"text","single-line":""},domProps:{value:t.projectInformation.name},on:{change:t.resetCustomValidity,input:function(e){e.target.composing||t.$set(t.projectInformation,"name",e.target.value)}}})]),t._v(" "),e("v-divider",{staticClass:"my-4"}),t._v(" "),e("div",{staticClass:"projectPermissionsUsers"},[e("div",{staticClass:"listOfManager"},[e("div",{staticClass:"editManager"},[e("div",{staticClass:"permisionLabel body-1"},[t._v(" "+t._s(t.$t("label.projectManagers")))]),t._v(" "),e("label",{staticClass:"editManagerInfo"},[e("i",{staticClass:"uiIconInformation uiIconProject"}),t._v("\n              "+t._s(t.$t("label.editManagerInfo"))+"\n            ")]),t._v(" "),e("project-assignee-manager",{ref:"projectManager",attrs:{project:t.project,manager:t.manager},on:{managerAssignmentsOpened:t.closeParticipantAssignement}})],1)]),t._v(" "),e("v-divider",{staticClass:"my-4"}),t._v(" "),e("div",{staticClass:"listOfParticipant"},[e("div",{staticClass:"editParticipant"},[e("div",{staticClass:"permisionLabel body-1"},[t._v(" "+t._s(t.$t("label.projectParticipants")))]),t._v(" "),e("label",{staticClass:"editParticipantInfo"},[e("i",{staticClass:"uiIconInformation uiIconProject"}),t._v("\n              "+t._s(t.$t("label.editParticipantInfo"))+"\n            ")]),t._v(" "),e("project-assignee-participator",{ref:"projectParticipator",attrs:{project:t.project,participator:t.participator},on:{participatorAssignmentsOpened:t.closeManagerAssignement}})],1)])],1),t._v(" "),e("hr"),t._v(" "),e("div",{staticClass:"projectDescription"},[e("v-label",{attrs:{for:"description"}},[t._v("\n          "+t._s(t.$t("label.description"))+"\n        ")]),t._v(" "),e("exo-task-editor",{ref:"richEditor",attrs:{"max-length":t.MESSAGE_MAX_LENGTH,id:t.project.id,placeholder:t.$t("task.placeholder").replace("{0}",t.MESSAGE_MAX_LENGTH)},model:{value:t.projectInformation.description,callback:function(e){t.$set(t.projectInformation,"description",e)},expression:"projectInformation.description"}})],1),t._v(" "),e("v-divider",{staticClass:"py-3"}),t._v(" "),e("div",{staticClass:"projectLabelsName mt-3 mb-3"},[e("v-label",{attrs:{for:"labels"}},[t._v("\n          "+t._s(t.$t("label.labels"))+"\n        ")]),t._v(" "),e("project-labels",{attrs:{project:t.project},on:{"add-label":t.addLabelOnCreate,"edit-label-on-create":t.editLabelBeforeCreate}})],1)],1):t._e()],1),t._v(" "),e("template",{slot:"footer"},[e("div",{staticClass:"d-flex"},[e("v-spacer"),t._v(" "),e("v-btn",{staticClass:"btn me-2",on:{click:t.cancel}},[t._v("\n        "+t._s(t.$t("popup.cancel"))+"\n      ")]),t._v(" "),e("v-btn",{staticClass:"btn btn-primary",attrs:{disabled:t.postDisabled,loading:t.postProject},on:{click:t.saveProject}},[t._v("\n        "+t._s(t.$t("label.save"))+"\n      ")])],1)])],2)};T._withStripped=!0;const b=n({data:()=>({MESSAGE_MAX_LENGTH:255,defaultParticipant:[{avatar:"/portal/rest/v1/social/users/default-image/avatar"}],listOfManager:[],listOfParticipant:[],activityComposerActions:[],projectInformation:null,manager:[],participator:[],postProject:!1,project:{},labelsToAdd:[]}),computed:{postDisabled:function(){if(null!==this.projectInformation){let t=this.projectInformation.description?this.projectInformation.description.replace(/<[^>]*>/g,"").replace(/&nbsp;/g,"").trim():"";const e=document.createElement("div");return e.innerHTML=t,t=e.textContent||e.innerText||"",t.length>this.MESSAGE_MAX_LENGTH}return""},labelDrawer(){return void 0!==this.project.id?this.$t("label.editProject"):this.$t("label.addProject")}},created(){this.$root.$on("task-project-manager",(t=>{this.manager=t})),this.$root.$on("task-project-participator",(t=>{this.participator=t}))},methods:{addLabelOnCreate(t){this.labelsToAdd.push(t)},editLabelBeforeCreate(t){const e=this.labelsToAdd.findIndex((e=>e.name===t.name));this.labelsToAdd[e].name=t.text},open(t){if(t&&t.id)return this.$projectService.getProject(t.id,!0).then((t=>{this.project=t,this.manager=[],this.participator=[],this.projectInformation={name:"",description:"",id:""},window.setTimeout((()=>{document.dispatchEvent(new CustomEvent("loadAllProjectLabels",{detail:this.project}))}),200),null===this.project.name&&""===this.project.name||(this.projectInformation.name=this.project.name),null===this.project.id&&""===this.project.id||(this.projectInformation.id=this.project.id),null===this.project.description&&""===this.project.description||(this.projectInformation.description=this.project.description),this.project&&this.project.manager&&(this.manager=this.project.managersDetail),this.project&&this.project.participator&&this.project.participator.length&&(this.participator=this.project.participatorsDetail),this.$refs.addProjectDrawer.open(),window.setTimeout((()=>this.$refs.addProjectTitle.querySelector("input").focus()),200)}));this.project=t,this.project.spaceName=eXo.env.portal.spaceName,this.manager=[],this.participator=[],this.projectInformation={name:"",description:"",id:""},window.setTimeout((()=>{document.dispatchEvent(new CustomEvent("loadAllProjectLabels",{detail:null}))}),200),this.$refs.addProjectDrawer.open(),window.setTimeout((()=>this.$refs.addProjectTitle.querySelector("input").focus()),200)},cancel(){this.project!=={}&&(this.projectInformation.name=this.project.name,this.projectInformation.description=this.project.description,this.manager=this.project.manager,this.participator=this.project.participator,void 0===this.project.id&&""!==this.projectInformation.description&&(this.projectInformation.description="")),this.$refs.addProjectDrawer.close(),this.$refs.projectManager.showManager_(!1),this.$refs.projectParticipator.showParticipant_(!1)},closeParticipantAssignement(){this.$refs.projectParticipator.showParticipant_(!1)},closeManagerAssignement(){this.$refs.projectManager.showManager_(!1)},resetCustomValidity(){this.$refs.autoFocusInput1&&this.$refs.autoFocusInput1.setCustomValidity("")},validateForm(){if(this.resetCustomValidity(),this.projectInformation.name?(this.projectInformation.name.replace(/<[^>]*>/g,"").replace(/&nbsp;/g,"").trim().length<3||this.projectInformation.name.replace(/<[^>]*>/g,"").replace(/&nbsp;/g,"").trim().length>200)&&this.$refs.autoFocusInput1.setCustomValidity(this.$t("task.message.missingLengthTitle")):this.$refs.autoFocusInput1.setCustomValidity(this.$t("task.message.missingTitle")),this.$refs.taskEventForm.validate()&&this.$refs.taskEventForm.$el.reportValidity())return!0},saveProject(){if(this.validateForm()){const t={id:this.projectInformation.id,name:this.projectInformation.name,description:this.projectInformation.description,manager:[],participator:[]};this.manager&&this.manager.length?this.manager.filter((t=>"space"===t.providerId)).length>0?this.manager.forEach((e=>{"space"===e.providerId?(t.spaceName=eXo.env.portal.spaceName,t.manager.push(`manager:${e.profile.originalName}`),t.participator.push(`member:${e.profile.originalName}`)):t.manager.push(e.remoteId)})):this.manager.forEach((e=>{t.manager.push(e.remoteId)})):t.spaceName=eXo.env.portal.spaceName,this.participator&&this.participator.length&&this.participator.filter((t=>"space"!==t.providerId)).length>0&&this.participator.forEach((e=>{"space"!==e.providerId?t.participator.push(e.remoteId):t.participator.push(`member:/spaces/${e.remoteId}`)}));const e=this.manager;return void 0!==t.id&&""!==t.id?(this.postProject=!0,this.$projectService.updateProjectInfo(t).then((t=>{this.$emit("update-cart",t),this.$root.$emit("update-projects-list",{}),this.postProject=!1,this.$refs.addProjectDrawer.close(),this.$refs.projectManager.showManager_(!1),this.$refs.projectParticipator.showParticipant_(!1),this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.project.updated")})})).then((()=>{this.project.managerIdentities=e.map((t=>({avatar:t.profile.avatarUrl,displayName:t.profile.fullName||t.profile.fullname,username:t.remoteId})))})).then((()=>{this.$root.$emit("update-projects-list-avatar",this.project.managerIdentities)})).catch((t=>{console.error("Error updating project",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")}),this.postProject=!1}))):this.$projectService.addProject(t).then((t=>{this.labelsToAdd.forEach((e=>{e.project=t,this.$taskDrawerApi.addLabel(e)})),this.$emit("update-cart",t),this.$root.$emit("update-projects-list",{}),this.postProject=!1,this.$refs.addProjectDrawer.close(),this.$refs.projectManager.showManager_(!1),this.$refs.projectParticipator.showParticipant_(!1),this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.project.created")})})).catch((t=>{console.error("Error saving project",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")}),this.postProject=!1}))}}}},T,[],!1,null,null,null).exports;var C=function(){var t=this,e=t._self._c;return e("div",{staticClass:"projectDescription",class:t.charsCount>0?"":"emptyEditor",staticStyle:{position:"relative"}},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.inputVal,expression:"inputVal"}],ref:"editor",staticClass:"textarea",attrs:{id:t.descriptionTaskContent,placeholder:t.placeholder,cols:"30",rows:"10"},domProps:{value:t.inputVal},on:{input:function(e){e.target.composing||(t.inputVal=e.target.value)}}}),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.editorReady,expression:"editorReady"}],staticClass:"activityCharsCount",class:t.charsCount>t.maxLength?"tooManyChars":""},[t._v("\n    "+t._s(t.charsCount)+t._s(t.maxLength>-1?" / "+t.maxLength:"")+"\n    "),e("i",{staticClass:"uiIconMessageLength"})])])};C._withStripped=!0;const _=n({props:{value:{type:String,default:""},reset:{type:Boolean,default:!1},placeholder:{type:String,default:""},id:{type:String,default:""},maxLength:{type:Number,default:-1}},data(){return{SMARTPHONE_LANDSCAPE_WIDTH:768,descriptionTaskContent:"",inputVal:this.value,editorReady:!1}},computed:{charsCount(){return this.$utils.htmlToText(this.inputVal).length}},watch:{inputVal(t){this.$emit("input",t)},value(t){for(const e in CKEDITOR.instances)if(CKEDITOR.instances[e].element.$.id===this.descriptionTaskContent){const s=CKEDITOR.instances[e].getData();null!=s&&t!==s&&(""===t?this.initCKEditor(e):(CKEDITOR.instances[e].setData(t),CKEDITOR.instances[e].setData(t)))}},reset(){CKEDITOR.instances[this.descriptionTaskContent].destroy(!0),this.initCKEditor()}},mounted(){""!==this.id||null!==this.id?this.descriptionTaskContent="descriptionTaskContent".concat(this.id):this.descriptionTaskContent="descriptionTaskContent",this.initCKEditor()},methods:{initCKEditor:function(t){CKEDITOR.plugins.addExternal("/commons-extension/eXoPlugins/embedsemantic/","plugin.js"),void 0!==CKEDITOR.instances[t]&&CKEDITOR.instances[t].destroy(!0);let e="simpleLink,widget";const s=$(window).width();s>$(window).height()&&s<this.SMARTPHONE_LANDSCAPE_WIDTH&&(e="simpleLink"),CKEDITOR.basePath="/commons-extension/ckeditor/";const a=this;$(this.$refs.editor).ckeditor({customConfig:"/commons-extension/ckeditorCustom/config.js",extraPlugins:e,allowedContent:!0,removePlugins:"image,confirmBeforeReload,maximize,resize",toolbar:[["Bold","Italic","BulletedList","NumberedList","Blockquote"]],typeOfRelation:"mention_activity_stream",autoGrow_onStartup:!0,on:{instanceReady:function(){a.editorReady=!0},change:function(t){const e=t.editor.getData();a.inputVal=e},destroy:function(){a.inputVal=""}}})},setFocus:function(){CKEDITOR.instances[this.descriptionTaskContent].focus()},getMessage:function(){return CKEDITOR.instances[this.descriptionTaskContent].getData()||""}}},C,[],!1,null,null,null).exports;var j=function(){var t=this,e=t._self._c;return e("exo-drawer",{ref:"managersDrawer",attrs:{right:""}},[e("template",{slot:"title"},[t._v("\n    "+t._s(t.$t("label.projectManager"))+"\n  ")]),t._v(" "),t.projectManagers?e("template",{slot:"content"},[e("v-layout",{staticClass:"ma-3",attrs:{column:""}},t._l(t.projectManagers,(function(t){return e("v-flex",{key:t,staticClass:"flex-grow-1 text-truncate my-2"},[e("exo-user-avatar",{attrs:{"profile-id":t.userName,popover:""}})],1)})),1)],1):t._e()],2)};j._withStripped=!0;const D=n({data:()=>({projectManagers:[]}),mounted(){this.$root.$on("displayProjectManagers",(t=>{this.projectManagers=t,this.$refs.managersDrawer.open()}))}},j,[],!1,null,null,null).exports;var S=function(){var t=this,e=t._self._c;return e("v-flex",{staticClass:"user-suggester"},[t.manager?e("div",{staticClass:"identitySuggester no-border mt-0"},[t.spaces.length?e("div",[e("div",{staticClass:"mt-4"},[t._v(t._s(t.$t("label.spaceManagers")))]),t._v(" "),t._l(t.spaces,(function(s){return e("project-event-form-assignee-and-participator-item",{key:s.id,attrs:{attendee:s,project:t.project,removable:t.manager.length>1},on:{"remove-attendee":t.removeAttendee}})}))],2):t._e(),t._v(" "),t.spaces.length&&t.users.length?e("div",{staticClass:"mt-2 font-weight-bold"},[t._v(t._s(t.$t("label.and")))]):t._e(),t._v(" "),t.users.length?e("div",t._l(t.users,(function(s){return e("project-event-form-assignee-and-participator-item",{key:s.id,attrs:{attendee:s,project:t.project,removable:t.manager.length>1},on:{"remove-attendee":t.removeAttendee}})})),1):t._e()]):t._e(),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.showManager&&t.canEditManager,expression:"!showManager && canEditManager"}],staticClass:"editManager",on:{click:function(e){return t.showManager_(!0)}}},[e("a",{staticClass:"editManager",attrs:{href:"#"}},[e("i",{staticClass:"fas fa-pencil-alt uiIconProject"}),t._v("\n      "+t._s(t.$t("label.editManager"))+"\n    ")])]),t._v(" "),e("exo-identity-suggester",{directives:[{name:"show",rawName:"v-show",value:t.showManager,expression:"showManager"}],ref:"invitedAttendeeAutoComplete",attrs:{labels:t.participantSuggesterLabels,"search-options":t.searchOptions,"ignore-items":t.ignoredMembers,"type-of-relations":t.relationsType,name:"inviteAttendee","include-users":""},model:{value:t.invitedAttendee,callback:function(e){t.invitedAttendee=e},expression:"invitedAttendee"}})],1)};S._withStripped=!0;const A=n({props:{manager:{type:Array,default:()=>[]},project:{type:Object,default:()=>({})},showManager:{type:Boolean,default:!1}},data:()=>({currentUser:null,invitedAttendee:[],users:[],spaces:[]}),computed:{canEditManager(){return!this.project.spaceName},searchOptions(){return this.project.spaceDetails?{spaceURL:this.project.spaceDetails.prettyName,currentUser:this.currentUser}:this.currentUser},relationsType(){return this.project.spaceDetails?"member_of_space":""},participantSuggesterLabels(){return{searchPlaceholder:this.$t("label.searchPlaceholder"),placeholder:this.$t("label.inviteManagers"),noDataLabel:this.$t("label.noDataLabel")}},ignoredMembers(){return this.manager?this.manager.map((t=>`${t.providerId}:${t.remoteId}`)):""}},watch:{currentUser(){this.reset()},project(){this.reset()},invitedAttendee(){this.invitedAttendee?(this.manager||(this.manager=[]),this.manager.find((t=>t.remoteId===this.invitedAttendee.remoteId&&t.providerId===this.invitedAttendee.providerId))||this.manager.push(this.$suggesterService.convertSuggesterItemToIdentity(this.invitedAttendee)),this.spaces=this.manager.filter((t=>"space"===t.providerId)),this.users=this.manager.filter((t=>"organization"===t.providerId)),this.$root.$emit("task-project-manager",this.manager),this.invitedAttendee=null):this.$nextTick(this.$refs.invitedAttendeeAutoComplete.$refs.selectAutoComplete.deleteCurrentItem)}},created(){this.reset()},mounted(){this.$userService.getUser(eXo.env.portal.userName).then((t=>{this.currentUser=t}))},methods:{showManager_(t){this.showManager=t,t&&this.$emit("managerAssignmentsOpened")},reset(){this.manager&&!this.manager.length>0&&(eXo.env.portal.spaceName?this.manager=[{id:`space:${eXo.env.portal.spaceName}`,providerId:"space",remoteId:eXo.env.portal.spaceGroup,profile:{avatar:`/portal/rest/v1/social/spaces/${eXo.env.portal.spaceName}/avatar`,fullname:eXo.env.portal.spaceDisplayName,originalName:eXo.env.portal.spaceGroup}}]:this.currentUser?this.manager=[{id:`organization:${eXo.env.portal.userIdentityId}`,providerId:"organization",remoteId:eXo.env.portal.userName,profile:{avatar:this.currentUser.avatar,fullname:this.currentUser.fullname}}]:this.manager=[]),this.spaces=this.manager.filter((t=>"space"===t.providerId)),this.users=this.manager.filter((t=>"organization"===t.providerId)),this.$refs.invitedAttendeeAutoComplete&&this.$refs.invitedAttendeeAutoComplete.focus(),this.$root.$emit("task-project-manager",this.manager)},removeAttendee(t){const e=this.manager.findIndex((e=>t.remoteId===e.remoteId&&t.providerId===e.providerId));e>=0&&this.manager.splice(e,1),this.spaces=this.manager.filter((t=>"space"===t.providerId)),this.users=this.manager.filter((t=>"organization"===t.providerId)),this.$root.$emit("task-project-manager",this.manager)}}},S,[],!1,null,null,null).exports;var L=function(){var t=this,e=t._self._c;return e("v-chip",{staticClass:"identitySuggesterItem me-2 mt-2",attrs:{close:t.canRemoveAttendee},on:{"click:close":function(e){return t.$emit("remove-attendee",t.attendee)}}},[e("v-avatar",{attrs:{left:""}},[e("v-img",{attrs:{src:t.avatarUrl}})],1),t._v(" "),e("span",{staticClass:"text-truncate"},[t._v("\n    "+t._s(t.displayName)+"\n  ")])],1)};L._withStripped=!0;const I=n({props:{attendee:{type:Object,default:()=>({})},project:{type:Object,default:()=>({})},removable:{type:Boolean,default:!0}},data:()=>({isExternal:!1}),computed:{canRemoveAttendee(){return!(!1===this.removable||this.project.spaceDetails&&this.project.spaceDetails.prettyName&&this.attendee.id===`space:${this.project.spaceDetails.prettyName}`)},avatarUrl(){const t=this.attendee&&(this.attendee.profile||this.attendee.space);return t&&(t.avatarUrl||t.avatar)},displayName(){const t=this.attendee&&(this.attendee.profile||this.attendee.space),e=t&&(t.displayName||t.fullname||t.fullName);return this.isExternal&&e.indexOf(this.$t("label.external"))<0?`${e} (${this.$t("label.external")})`:e}},created(){"organization"===this.attendee.providerId&&this.$userService.getUser(this.attendee.remoteId).then((t=>{this.isExternal="true"===t.external}))}},L,[],!1,null,null,null).exports;var x=function(){var t=this,e=t._self._c;return e("v-flex",{staticClass:"user-suggester"},[t.participator?e("div",{staticClass:"identitySuggester no-border mt-0"},[t.spaces.length?e("div",[e("div",{staticClass:"mt-4"},[t._v(t._s(t.$t("label.spaceMembers")))]),t._v(" "),t._l(t.spaces,(function(s){return e("project-event-form-assignee-and-participator-item",{key:s.id,attrs:{attendee:s,project:t.project,removable:t.participator.length>1},on:{"remove-attendee":t.removeAttendee}})}))],2):t._e(),t._v(" "),t.spaces.length&&t.users.length?e("div",{staticClass:"mt-2 font-weight-bold"},[t._v(t._s(t.$t("label.and")))]):t._e(),t._v(" "),t.users.length?e("div",t._l(t.users,(function(s){return e("project-event-form-assignee-and-participator-item",{key:s.id,attrs:{attendee:s,project:t.project,removable:t.participator.length>1},on:{"remove-attendee":t.removeAttendee}})})),1):t._e()]):t._e(),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.showParticipant&&t.canEditParticipant,expression:"!showParticipant && canEditParticipant"}],staticClass:"editParticipant",on:{click:function(e){return t.showParticipant_(!0)}}},[e("a",{staticClass:"editParticipant",attrs:{href:"#"}},[e("i",{staticClass:"fas fa-plus"}),t._v("\n      "+t._s(t.$t("label.editParticipant"))+"\n    ")])]),t._v(" "),e("exo-identity-suggester",{directives:[{name:"show",rawName:"v-show",value:t.showParticipant&&t.canEditParticipant,expression:"showParticipant && canEditParticipant"}],ref:"invitedAttendeeAutoComplete",attrs:{labels:t.participantSuggesterLabels,"search-options":t.searchOptions,"ignore-items":t.ignoredMembers,"type-of-relations":t.relationsType,name:"inviteAttendee","include-users":"","include-spaces":t.canEditParticipant},model:{value:t.invitedAttendee,callback:function(e){t.invitedAttendee=e},expression:"invitedAttendee"}})],1)};x._withStripped=!0;const P=n({props:{participator:{type:Array,default:()=>[]},project:{type:Object,default:()=>({})}},data:()=>({currentUser:null,invitedAttendee:[],users:[],spaces:[],showParticipant:!1}),computed:{canEditParticipant(){return!(this.project.spaceDetails||this.project.spaceName)},searchOptions(){return this.project.spaceDetails?{spaceURL:this.project.spaceDetails.prettyName,currentUser:this.currentUser}:this.currentUser},relationsType(){return this.project.spaceDetails?"member_of_space":""},participantSuggesterLabels(){return{searchPlaceholder:this.$t("label.searchPlaceholder"),placeholder:this.$t("label.inviteParticipant"),noDataLabel:this.$t("label.noDataLabel")}},ignoredMembers(){return this.participator?this.participator.map((t=>`${t.providerId}:${t.remoteId}`)):""}},watch:{currentUser(){this.reset()},project(){this.reset()},invitedAttendee(){this.invitedAttendee?(this.participator||(this.participator=[]),this.participator.find((t=>t.remoteId===this.invitedAttendee.remoteId&&t.providerId===this.invitedAttendee.providerId))||this.participator.push(this.$suggesterService.convertSuggesterItemToIdentity(this.invitedAttendee)),this.spaces=this.participator.filter((t=>"space"===t.providerId)),this.users=this.participator.filter((t=>"organization"===t.providerId)),this.$root.$emit("task-project-participator",this.participator),this.invitedAttendee=null):this.$nextTick(this.$refs.invitedAttendeeAutoComplete.$refs.selectAutoComplete.deleteCurrentItem)}},created(){this.reset()},mounted(){this.$userService.getUser(eXo.env.portal.userName).then((t=>{this.currentUser=t}))},methods:{showParticipant_(t){this.showParticipant=t,t&&this.$emit("participatorAssignmentsOpened")},reset(){this.participator&&!this.participator.length>0&&(eXo.env.portal.spaceName?this.participator=[{id:`space:${eXo.env.portal.spaceName}`,providerId:"space",remoteId:eXo.env.portal.spaceName,profile:{avatar:`/portal/rest/v1/social/spaces/${eXo.env.portal.spaceName}/avatar`,fullname:eXo.env.portal.spaceDisplayName}}]:this.currentUser?this.participator=[{id:`organization:${eXo.env.portal.userIdentityId}`,providerId:"organization",remoteId:eXo.env.portal.userName,profile:{avatar:this.currentUser.avatar,fullname:this.currentUser.fullname}}]:this.participator=[]),this.spaces=this.participator.filter((t=>"space"===t.providerId)),this.users=this.participator.filter((t=>"organization"===t.providerId)),this.$refs.invitedAttendeeAutoComplete&&this.$refs.invitedAttendeeAutoComplete.focus(),this.$root.$emit("task-project-participator",this.participator)},removeAttendee(t){const e=this.participator.findIndex((e=>t.remoteId===e.remoteId&&t.providerId===e.providerId));e>=0&&this.participator.splice(e,1),this.spaces=this.participator.filter((t=>"space"===t.providerId)),this.users=this.participator.filter((t=>"organization"===t.providerId)),this.$root.$emit("task-project-participator",this.participator)}}},x,[],!1,null,null,null).exports;var E=function(){var t=this,e=t._self._c;return e("div",{on:{click:function(t){t.stopPropagation()}}},[e("v-combobox",{ref:"selectLabel",staticClass:"pt-0 inputProjectLabel",attrs:{id:"labelInput",filter:t.filter,"hide-no-data":!t.search,items:t.items,"search-input":t.search,label:t.$t("label.tapLabel.name"),attach:"","hide-selected":"",multiple:"","small-chips":"","prepend-icon":"",solo:""},on:{"update:searchInput":function(e){t.search=e},"update:search-input":function(e){t.search=e},click:function(e){return t.openLabelsList()},change:function(e){t.search=""}},scopedSlots:t._u([{key:"prepend",fn:function(){return[e("i",{staticClass:"uiIconTag uiIconBlue"})]},proxy:!0},{key:"no-data",fn:function(){return[e("v-list-item",[e("span",{staticClass:"subheading"},[t._v(t._s(t.$t("label.createLabel")))]),t._v(" "),e("v-chip",{attrs:{label:"",small:""}},[t._v("\n          "+t._s(t.search)+"\n        ")])],1)]},proxy:!0},{key:"selection",fn:function({item:s,parent:a}){return[e("editable-labels",{attrs:{item:s,parent:a},on:{"edit-label-on-create":t.editLabelBeforeCreate,"remove-label":t.removeLabel}})]}}]),model:{value:t.model,callback:function(e){t.model=e},expression:"model"}})],1)};E._withStripped=!0;const N=n({props:{project:{type:Object,default:()=>({})}},data:()=>({index:-1,items:[],nonce:1,model:[],x:0,search:null,y:0}),watch:{model(t,e){t.length!==e.length?this.model=t.map((t=>("string"==typeof t&&(t={text:t,name:t},this.items.push(t),this.nonce++,this.addLabel(t)),t))):this.search=null}},created(){$(document).on("mousedown",(()=>{this.$refs.selectLabel&&this.$refs.selectLabel.isMenuActive&&window.setTimeout((()=>{this.$refs.selectLabel.isMenuActive=!1}),200)})),document.addEventListener("closeLabelsList",(()=>{setTimeout((()=>{void 0!==this.$refs.selectLabel&&(this.$refs.selectLabel.isMenuActive=!1)}),100)})),document.addEventListener("loadAllProjectLabels",(t=>{if(this.model=[],t&&t.detail){const e=t.detail;this.model=[],this.getProjectLabels(e.id)}}))},methods:{filter(t,e,s){if(t.header)return!1;const a=function(t){return null!=t?t:""},i=a(s),r=a(e);return i.toString().toLowerCase().indexOf(r.toString().toLowerCase())>-1},getProjectLabels(t){this.$taskDrawerApi.getProjectLabels(t).then((t=>{this.model=t.map((function(t){const e=Object.assign({},t);return e.text=e.name,e.editMenu=!1,e}))}))},addLabel(t){null!=this.project.id?(t.project=this.project,this.$taskDrawerApi.addLabel(t).then((()=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.label.created")}),this.getProjectLabels(this.project.id)})).catch((t=>{console.error("Error when adding labels",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))):this.$emit("add-label",t),this.model.push(t),document.getElementById("labelInput").focus()},removeLabel(t){this.$taskDrawerApi.removeLabel(t.id).then((()=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.label.deleted")})})).catch((t=>{console.error("Error when removibg labels",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))},openLabelsList(){this.$emit("labelsListOpened")},editLabelBeforeCreate(t){this.$emit("edit-label-on-create",t)}}},E,[],!1,null,null,null).exports;var B=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:`label-${t.item.id}`},on:{click:function(t){t.stopPropagation()}}},[e("v-menu",{attrs:{attach:`#label-${t.item.id}`,transition:"slide-x-reverse-transition","content-class":"labelsActionMenu","close-on-content-click":!1,"close-on-click":!0,"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function({on:s}){return[t.item===Object(t.item)?e("v-chip",t._b({staticClass:"pr-1 font-weight-bold",attrs:{id:`label-${t.item.id}`,"input-value":t.selected,label:"",color:`${t.item.color} lighten-3`,outlined:!t.item.color,primary:"",small:""}},"v-chip",t.attrs,!1),[e("span",{staticClass:"pr-2"},[t._v("\n          "+t._s(t.item.text)+"\n        ")]),t._v(" "),e("v-icon",t._g({staticClass:"pr-0",attrs:{"x-small":""},on:{click:t.closeLabelsList}},s),[t._v("\n          edit\n        ")]),t._v(" "),e("v-icon",{staticClass:"pr-0",attrs:{"x-small":""},on:{click:function(e){t.parent.selectItem(t.item),t.removeLabel()}}},[t._v("\n          close\n        ")])],1):t._e()]}}]),model:{value:t.displayActionMenu,callback:function(e){t.displayActionMenu=e},expression:"displayActionMenu"}},[t._v(" "),e("v-list",{staticClass:"pa-0",attrs:{dense:""}},[e("v-list-item",{staticClass:"px-2"},[e("v-list-item-content",[e("v-text-field",{ref:"autoFocusInput1",staticClass:"font-weight-bold text-color mb-1 labels-edit-name",attrs:{type:"text",autofocus:"",outlined:"",dense:""},on:{blur:function(e){return t.cancel(e)}},model:{value:t.item.text,callback:function(e){t.$set(t.item,"text",e)},expression:"item.text"}},[e("i",{staticClass:"uiIcon40x40TickBlue label-btn ma-1",attrs:{slot:"append",dark:""},on:{click:function(e){return t.editLabel()}},slot:"append"}),t._v(" "),e("i",{staticClass:"uiIconClose label-btn ma-1",attrs:{slot:"append",dark:""},on:{click:function(e){return t.cancel(e)}},slot:"append"})])],1)],1),t._v(" "),e("v-list-item",{staticClass:"px-2 noColorLabel"},[e("v-list-item-title",{staticClass:"noColorLabel caption text-center text&#45;&#45;secondary"},[e("span",{on:{click:function(e){t.item.color="",t.editLabel()}}},[t._v(t._s(t.$t("label.noColor")))])])],1),t._v(" "),e("v-list-item",[e("v-list-item-title",{staticClass:"subtitle-2 row projectColorPicker mx-auto my-2"},t._l(t.labelColors,(function(s,a){return e("span",{key:a,staticClass:"projectColorCell",class:[s.class,s.class===t.item.color?"isSelected":""],on:{click:function(e){t.item.color=s.class,t.editLabel()}}})})),0)],1)],1)],1)],1)};B._withStripped=!0;const M=n({props:{item:{type:Object,default:()=>({})},parent:{type:Object,default:()=>({})}},data:()=>({displayActionMenu:!1,labelColors:[{class:"asparagus"},{class:"munsell_blue"},{class:"navy_blue"},{class:"purple"},{class:"red"},{class:"brown"},{class:"laurel_green"},{class:"sky_blue"},{class:"blue_gray"},{class:"light_purple"},{class:"hot_pink"},{class:"light_brown"},{class:"moss_green"},{class:"powder_blue"},{class:"light_blue"},{class:"pink"},{class:"Orange"},{class:"gray"},{class:"green"},{class:"baby_blue"},{class:"light_gray"},{class:"beige"},{class:"yellow"},{class:"plum"}]}),methods:{editLabel(){this.item.project?(this.item.name=this.item.text,this.$taskDrawerApi.editLabel(this.item).then((t=>{this.item=t,this.item.text=this.item.name,this.displayActionMenu=!1,this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.label.updated")})})).catch((t=>{console.error("Error when adding labels",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))):(this.$emit("edit-label-on-create",this.item),this.item.name=this.item.text,this.displayActionMenu=!1)},cancel(t){window.setTimeout((()=>{this.item.text=this.item.name,this.displayActionMenu=!1,t.stopPropagation()}),100)},removeLabel(){this.displayActionMenu=!1,this.$emit("remove-label",this.item)},closeLabelsList(){document.dispatchEvent(new CustomEvent("closeLabelsList"))}}},B,[],!1,null,null,null).exports;var O=function(){var t=this,e=t._self._c;return e("v-app",{staticClass:"projectAndTasksContainer transparent pa-4",attrs:{id:"tasksListApplication",flat:""}},[e("tasks-list-toolbar",{ref:"taskToolBar",attrs:{"task-card-tab":"#tasks-cards","task-list-tab":"#tasks-list",keyword:t.keyword,"show-completed-tasks":t.showCompletedTasks},on:{"keyword-changed":t.keywordChanged,"filter-task-dashboard":t.filterTaskDashboard,"filter-task-query":t.filterTaskQuery,"primary-filter-task":t.getTasksByPrimary,"reset-filter-task-dashboard":t.resetFilterTaskDashboard}}),t._v(" "),t.tasks&&t.tasks.length||t.loadingTasks||t.filterActive?e("div",[t.filterActive&&t.filterTaskQueryResult&&t.filterTaskQueryResult.projectName?e("div",{staticClass:"px-0 pt-8 pb-4"},t._l(t.filterTaskQueryResult.projectName,(function(s,a){return e("div",{key:s.name,staticClass:"pt-5"},[s.value&&s.value.displayName?e("div",{staticClass:"d-flex align-center assigneeFilter"},[e("a",{staticClass:"toggle-collapse-group pointer",attrs:{href:"#"},on:{click:function(e){return t.showDetailsTask(s.rank)}}},[e("i",{staticClass:"uiIcon uiIconMiniArrowDown",staticStyle:{display:"block"},attrs:{id:"uiIconMiniArrowDown"+s.rank}}),t._v(" "),e("i",{staticClass:"uiIcon uiIconMiniArrowRight",staticStyle:{display:"none"},attrs:{id:"uiIconMiniArrowRight"+s.rank}})]),t._v(" "),s.value.avatar?e("exo-user-avatar",{staticClass:"pe-2",attrs:{"profile-id":s.value.username,size:26,popover:""}}):t._e(),t._v(" "),e("span",{staticClass:"amount-item"},[t._v("("+t._s(t.filterTaskQueryResult.tasks[a].length)+")")]),t._v(" "),e("hr",{staticClass:"my-0 v-divider theme--light",attrs:{role:"separator","aria-orientation":"horizontal"}})],1):e("div",{staticClass:"d-flex align-center assigneeFilter"},[e("a",{staticClass:"toggle-collapse-group pointer",attrs:{id:"iconTask"+s.rank,href:"#"},on:{click:function(e){return t.showDetailsTask(s.rank)}}},[e("i",{staticClass:"uiIcon uiIconMiniArrowDown",staticStyle:{display:"block"},attrs:{id:"uiIconMiniArrowDown"+s.rank}}),t._v(" "),e("i",{staticClass:"uiIcon uiIconMiniArrowRight",staticStyle:{display:"none"},attrs:{id:"uiIconMiniArrowRight"+s.rank}})]),t._v(" "),"Unassigned"===s.name?e("div",{staticClass:"defaultAvatar"},[e("img",{attrs:{src:t.defaultAvatar}})]):t._e(),t._v(" "),e("span",{staticClass:"nameGroup"},[t._v(t._s(t.$t(t.getGroupName(s.name))))]),t._v(" "),e("span",{staticClass:"amount-item"},[t._v("("+t._s(t.filterTaskQueryResult.tasks[a].length)+")")]),t._v(" "),e("hr",{staticClass:"my-0 v-divider theme--light",attrs:{role:"separator","aria-orientation":"horizontal"}})]),t._v(" "),e("div",{staticClass:"view-task-group-sort",attrs:{id:"taskView"+s.rank}},[e("tasks-cards-list",{staticClass:"d-md-none",attrs:{tasks:t.filterTaskQueryResult.tasks[a],"show-completed-tasks":t.showCompletedTasks}}),t._v(" "),e("tasks-list",{staticClass:"d-md-block d-none",attrs:{tasks:t.filterTaskQueryResult.tasks[a],"show-completed-tasks":t.showCompletedTasks}})],1)])})),0):e("div",[e("div",{staticClass:"d-md-block d-none"},[e("tasks-list",{attrs:{tasks:t.tasks,"show-completed-tasks":t.showCompletedTasks}})],1),t._v(" "),e("div",{staticClass:"d-md-none"},[e("tasks-cards-list",{attrs:{tasks:t.tasks,"show-completed-tasks":t.showCompletedTasks}})],1)])]):e("div",{staticClass:"noTasksProject"},[e("div",{staticClass:"noTasksProjectIcon"},[e("i",{staticClass:"uiIcon uiIconTask"})]),t._v(" "),e("div",{staticClass:"noTasksProjectLabel"},[e("span",[t._v(t._s(t.$t("label.noTask")))])])]),t._v(" "),e("v-row",{staticClass:"ma-0 border-box-sizing"},[t.canShowMore&&!t.filterActive?e("v-btn",{staticClass:"loadMoreButton ma-auto mt-4 btn",attrs:{loading:t.loadingTasks,disabled:t.loadingTasks,block:""},on:{click:t.loadNextPage}},[t._v("\n      "+t._s(t.$t("spacesList.button.showMore"))+"\n    ")]):t._e()],1)],1)};O._withStripped=!0;const F=n({data(){return{primaryFilter:"ALL",tasks:[],keyword:null,loadingTasks:!1,offset:0,tasksSize:0,pageSize:20,limit:20,limitToFetch:0,originalLimitToFetch:0,startSearchAfterInMilliseconds:600,endTypingKeywordTimeout:50,startTypingKeywordTimeout:0,showCompletedTasks:!1,filterTaskQueryResult:null,filterActive:!1,groupBy:null,orderBy:null,labels:[],taskQueryFilter:{query:"",assignee:"",statusId:"",dueDate:"",priority:"",projectId:-2,showCompletedTasks:this.showCompletedTasks,groupBy:"",orderBy:""},filterTasks:{query:"",assignee:"",watcher:"",coworker:"",statusId:"",dueDate:"",priority:"",projectId:-2,groupBy:"",orderBy:"",offset:this.offset,limit:this.limitToFetch,showCompletedTasks:this.showCompletedTasks},defaultAvatar:"/portal/rest/v1/social/users/default-image/avatar"}},computed:{canShowMore(){return this.loadingTasks||this.tasks.length>=this.limitToFetch}},watch:{limitToFetch(){this.searchTasks()}},created(){this.groupBy=!!localStorage.getItem("filterStorageNone+list")&&JSON.parse(localStorage.getItem("filterStorageNone+list")).groupBy,this.orderBy=!!localStorage.getItem("filterStorageNone+list")&&JSON.parse(localStorage.getItem("filterStorageNone+list")).orderBy,this.showCompletedTasks=!!localStorage.getItem("filterStorageNone+list")&&JSON.parse(localStorage.getItem("filterStorageNone+list")).showCompletedTasks,this.filterTasks.showCompletedTasks=this.showCompletedTasks,this.$root.$on("task-added",(()=>{this.updateTasksList()})),this.$root.$on("task-assignee-coworker-updated",(()=>{this.updateTasksList()})),this.$root.$on("task-priority-updated",(()=>{this.updateTasksList()})),this.$root.$on("task-due-date-updated",(()=>{this.updateTasksList()})),this.$root.$on("deleteTask",(()=>{this.updateTasksList()})),this.$root.$on("update-cart",(t=>{t&&!this.showCompletedTasks&&window.setTimeout((()=>this.tasks=this.tasks.filter((e=>e.id!==t.id))),500)})),this.$root.$on("update-task-completed",(t=>{t&&!this.showCompletedTasks&&window.setTimeout((()=>this.updateTasksList()),500)}))},methods:{keywordChanged(t,e){this.keyword=t,e&&(this.filterTasks.query=this.keyword,this.resetSearch(),this.searchTasks())},resetFilterTaskDashboard(){this.groupBy="",this.orderBy="",this.filterActive=!1,this.resetSearch(),this.getTasksByPrimary(this.primaryFilter)},filterTaskDashboard(t){this.tasks=t.tasks,this.showCompletedTasks=t.showCompletedTasks,this.filterActive=!1},filterTaskQuery(t,e,s){this.showCompletedTasks=t.showCompletedTasks,this.groupBy=e.groupBy,this.orderBy=e.orderBy,this.labels=s.labels,"ALL"===this.primaryFilter?(this.taskQueryFilter=t,this.resetSearch(),this.searchTasks(this.taskQueryFilter)):("OVERDUE"===this.primaryFilter||"TODAY"===this.primaryFilter||"TOMORROW"===this.primaryFilter||"UPCOMING"===this.primaryFilter||"ASSIGNED"===this.primaryFilter&&t.assignee)&&t.dueDate&&t.dueDate!==this.primaryFilter?(this.tasks=[],this.filterActive=!1):("ASSIGNED"!==this.primaryFilter&&(this.filterTasks.assignee=t.assignee),"OVERDUE"!==this.primaryFilter&&"TODAY"!==this.primaryFilter&&"TOMORROW"!==this.primaryFilter&&"UPCOMING"!==this.primaryFilter&&(this.filterTasks.dueDate=t.dueDate),this.filterTasks.query=t.query,this.filterTasks.statusId=t.statusId,this.filterTasks.priority=t.priority,this.filterTasks.showCompletedTasks=t.showCompletedTasks,this.resetSearch(),this.searchTasks())},searchTasks(t){return t||(t=this.filterTasks),this.loadingTasks=!0,t.assignee&&(t.projectId=-2),this.$tasksService.filterTasksList(t,this.groupBy,this.orderBy,this.labels).then((t=>(t.projectName?(this.filterTaskQueryResult=t,this.filterActive=!0):(this.tasks=t&&t.tasks||[],this.tasksSize=t&&t.tasksNumber||0,this.filterActive=!1),this.$nextTick()))).then((()=>{this.keyword&&this.tasks.length>=this.limitToFetch&&(this.limitToFetch+=this.pageSize)})).finally((()=>{this.loadingTasks=!1,this.$root.$applicationLoaded()}))},getTasksByPrimary(t){if(this.primaryFilter=t,!t||"OVERDUE"!==t&&"TODAY"!==t&&"TOMORROW"!==t&&"UPCOMING"!==t)if(t&&"ASSIGNED"===t){if(this.filterTasks.dueDate="",this.filterTasks.assignee="ME",this.filterTasks.watcher="",this.filterTasks.coworker="",this.filterTasks.statusId="",this.filterTasks.priority="",this.filterTasks.query="",this.groupBy="",this.orderBy="",this.filterTasks.projectId=-2,localStorage.getItem("filterStorageNone+list")){const t=JSON.parse(localStorage.getItem("filterStorageNone+list"));this.groupBy=t.groupBy,this.orderBy=t.orderBy}this.resetSearch(),this.searchTasks()}else if(t&&"WATCHED"===t)this.filterTasks.dueDate="",this.filterTasks.assignee="",this.filterTasks.watcher="ME",this.filterTasks.coworker="",this.filterTasks.statusId="",this.filterTasks.priority="",this.filterTasks.query="",this.groupBy="",this.orderBy="",this.filterTasks.projectId=-3,this.resetSearch(),this.searchTasks();else if(t&&"COLLABORATED"===t){if(this.filterTasks.dueDate="",this.filterTasks.assignee="",this.filterTasks.watcher="",this.filterTasks.coworker="ME",this.filterTasks.statusId="",this.filterTasks.priority="",this.filterTasks.query="",this.groupBy="",this.orderBy="",this.filterTasks.projectId=-2,localStorage.getItem("filterStorageNone+list")){const t=JSON.parse(localStorage.getItem("filterStorageNone+list"));this.groupBy=t.groupBy,this.orderBy=t.orderBy}this.resetSearch(),this.searchTasks()}else{if(this.filterTasks.dueDate="",this.filterTasks.assignee="",this.filterTasks.watcher="",this.filterTasks.coworker="",this.filterTasks.statusId="",this.filterTasks.priority="",this.filterTasks.query="",localStorage.getItem("filterStorageNone+list")){const t=JSON.parse(localStorage.getItem("filterStorageNone+list"));this.groupBy=t.groupBy,this.orderBy=t.orderBy}else this.getFilterProject().then((()=>{const t={groupBy:this.groupBy,orderBy:this.orderBy,projectId:"None",tabView:"list",showCompletedTasks:!1};localStorage.setItem("filterStorageNone+list",JSON.stringify(t)),this.filterTasks.projectId=-2,this.searchTasks()}));this.filterTasks.projectId=-2,this.resetSearch(),this.searchTasks()}else this.filterTasks.dueDate=t,this.filterTasks.assignee="",this.filterTasks.watcher="",this.filterTasks.coworker="",this.filterTasks.statusId="",this.filterTasks.priority="",this.filterTasks.query="",this.groupBy="",this.orderBy="",this.filterTasks.projectId=-2,this.resetSearch(),this.searchTasks();this.$refs.taskToolBar&&this.$refs.taskToolBar.resetFields("primary")},resetSearch(){this.limitToFetch!==this.originalLimitToFetch&&(this.limitToFetch=this.originalLimitToFetch)},loadNextPage(){this.limitToFetch+=this.pageSize},waitForEndTyping(){window.setTimeout((()=>{Date.now()-this.startTypingKeywordTimeout>this.startSearchAfterInMilliseconds?this.searchTasks():this.waitForEndTyping()}),this.endTypingKeywordTimeout)},getGroupName:t=>"No project"===t?"label.noProject":"No Label"===t?"label.noLabel":"No due date"===t?"label.noDueDate":"Overdue"===t?"label.overdue":"Today"===t?"label.today":"Tomorrow"===t?"label.tomorrow":"Upcoming"===t?"label.upcoming":t,showDetailsTask(t){const e=document.querySelector(`#uiIconMiniArrowDown${t}`),s=document.querySelector(`#uiIconMiniArrowRight${t}`),a=document.querySelector(`#taskView${t}`);"none"!==a.style.display?(a.style.display="none",e.style.display="none",s.style.display="block"):(a.style.display="block",e.style.display="block",s.style.display="none")},getFilterProject(){return this.$projectService.getFilterSettings("None","list").then((t=>{if(t&&t.value){const e=t.value;"None"===e.split('"')[11]&&(this.groupBy=e.split('"')[3],this.orderBy=e.split('"')[7])}else this.groupBy="none",this.orderBy=""}))},updateTasksList(){const t=this.filterActive?this.taskQueryFilter:this.filterTasks;this.$tasksService.filterTasksList(t,this.groupBy,this.orderBy,this.labels).then((t=>{this.filterActive?this.filterTaskQueryResult=t:this.tasks=t.tasks}))}}},O,[],!1,null,null,null).exports;var R=function(){var t=this,e=t._self._c;return e("v-app",{attrs:{id:"TasksToolbar"}},[e("v-toolbar",{staticClass:"tasksToolbar",class:t.showMobileTaskFilter&&"toolbarLarge",attrs:{id:"TasksListToolbar",flat:""}},[e("v-toolbar-title",[e("v-btn",{staticClass:"btn px-2 btn-primary addNewProjectButton",on:{click:function(e){return t.openTaskDrawer()}}},[e("v-icon",{staticClass:"d-block d-sm-none",attrs:{dark:""}},[t._v("mdi-plus")]),t._v(" "),e("span",{staticClass:"d-none font-weight-regular d-sm-inline"},[t._v("\n          + "+t._s(t.$t("label.addTask"))+"\n        ")])],1)],1),t._v(" "),e("v-scale-transition",[e("v-icon",{staticClass:"taskFilterMobile",class:t.showMobileTaskFilter&&"tasksFilterMobile",attrs:{size:"20"},on:{click:function(e){t.showMobileTaskFilter=!t.showMobileTaskFilter}}},[t._v("\n        fas fa-filter\n      ")])],1),t._v(" "),e("v-spacer"),t._v(" "),e("v-spacer"),t._v(" "),e("v-scale-transition",[e("v-text-field",{staticClass:"inputTasksFilter pa-0 ms-3 me-3 my-auto",class:t.showMobileTaskFilter&&"inputTasksFilterMobile",attrs:{placeholder:t.$t("label.filterTask"),"prepend-inner-icon":"fa-filter","append-outer-icon":t.showMobileTaskFilter&&"mdi-close",clearable:!t.showMobileTaskFilter},on:{"click:append-outer":t.clearMessage},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}})],1),t._v(" "),e("v-scale-transition",[e("select",{directives:[{name:"model",rawName:"v-model",value:t.primaryFilterSelected,expression:"primaryFilterSelected"}],staticClass:"selectPrimaryFilter input-block-level ignore-vuetify-classes pa-0 me-3 my-auto",attrs:{id:"filterTaskSelect",name:"primaryFilter"},on:{change:[function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.primaryFilterSelected=e.target.multiple?s:s[0]},t.changePrimaryFilter]}},t._l(t.primaryFilter,(function(s){return e("option",{key:s.name,domProps:{value:s.name}},[t._v("\n          "+t._s(t.$t("label.dueDate."+s.name.toLowerCase()))+"\n        ")])})),0)]),t._v(" "),e("v-scale-transition",[e("select",{attrs:{id:"widthTmpSelectTaskFilter"}},[e("option",{attrs:{id:"widthTmpSelectOption"}})])]),t._v(" "),e("v-scale-transition",[e("v-btn",{staticClass:"btn px-2 btn-primary filterTasksSetting",attrs:{outlined:""},on:{click:t.openDrawer}},[e("i",{staticClass:"uiIcon uiIconFilterSetting pe-3"}),t._v(" "),e("span",{staticClass:"d-none font-weight-regular caption d-sm-inline"},[t._v("\n          "+t._s(t.$t("label.filter"))+" "+t._s(t.getFilterNum())+"\n        ")])])],1)],1),t._v(" "),e("tasks-filter-drawer",{ref:"filterTasksDrawer",attrs:{query:t.keyword,"show-completed-tasks":t.showCompletedTasks},on:{"filter-num-changed":t.filterNumChanged,"filter-task":t.filterTasks,"reset-filter-task":t.resetFilterTask,"filter-task-query":t.filterTaskquery}})],1)};R._withStripped=!0;const V=n({props:{taskCardTab:{type:String,default:""},taskListTab:{type:String,default:""},showCompletedTasks:{type:Boolean,default:!1}},data:()=>({tasks:null,keyword:null,awaitingSearch:!1,searchOnKeyChange:!0,filterNumber:0,primaryFilterSelected:"ALL",drawer:null,showMobileTaskFilter:!1,primaryFilter:[{name:"ALL"},{name:"ASSIGNED"},{name:"COLLABORATED"},{name:"OVERDUE"},{name:"TODAY"},{name:"TOMORROW"},{name:"UPCOMING"}]}),watch:{keyword(){if(!this.awaitingSearch){const t=this.searchOnKeyChange;setTimeout((()=>{this.$emit("keyword-changed",this.keyword,t),this.awaitingSearch=!1}),1e3)}this.awaitingSearch=!0,this.searchOnKeyChange=!0}},created(){this.primaryFilterSelected=localStorage.getItem("primary-filter-tasks"),localStorage.setItem("primary-filter-tasks","ALL")},mounted(){$("#widthTmpSelectOption").html($("#filterTaskSelect option:selected").text());const t=$("#widthTmpSelectTaskFilter").width()+40;$("#filterTaskSelect").width(t),this.changePrimaryFilter()},methods:{resetFilterTask(){this.$emit("reset-filter-task-dashboard")},filterTaskquery(t,e,s){this.searchOnKeyChange=!1,this.keyword=t.query,this.$emit("filter-task-query",t,e,s)},filterTasks(t){this.tasks=t.tasks.tasks,this.$emit("filter-task-dashboard",{tasks:this.tasks,showCompletedTasks:this.showCompletedTasks})},openDrawer(){this.$refs.filterTasksDrawer.open()},openTaskDrawer(){const t={id:null,status:{project:this.project},priority:"NONE",description:"",title:""};this.$root.$emit("open-task-drawer",t)},changePrimaryFilter(){this.searchOnKeyChange=!1,this.keyword="",this.$emit("primary-filter-task",this.primaryFilterSelected),$("#widthTmpSelectOption").html($("#filterTaskSelect option:selected").text());const t=$("#widthTmpSelectTaskFilter").width()+40;$("#filterTaskSelect").width(t)},resetFields(t){this.searchOnKeyChange=!1,this.keyword="",this.$refs.filterTasksDrawer.resetFields(t)},filterNumChanged(t){this.filterNumber=t},getFilterNum(){return this.filterNumber>0?`(${this.filterNumber})`:""},clearMessage(){this.keyword="",this.showMobileTaskFilter=!this.showMobileTaskFilter}}},R,[],!1,null,null,null).exports;var z=function(){var t=this,e=t._self._c;return e("v-app",{staticClass:"tasksList pt-5"},t._l(t.tasks,(function(s){return e("div",{key:s.id,staticClass:"tasksListItem"},[e("tasks-list-item",{attrs:{task:s,"show-completed-tasks":t.showCompletedTasks}})],1)})),0)};z._withStripped=!0;const U=n({props:{tasks:{type:Array,default:()=>[]},showCompletedTasks:{type:Boolean,default:!1}}},z,[],!1,null,null,null).exports;var q=function(){var t=this,e=t._self._c;return e("div",{staticClass:"taskListItemView px-4 py-3 d-flex align-center",class:[t.getTaskPriorityColor(t.task.task.priority),t.removeCompletedTask?"completedTask":""]},[e("div",{staticClass:"taskCheckBox"},[e("v-switch",{ref:"autoFocusInput2",staticClass:"d-none",attrs:{reset:"","true-value":"true","false-value":"false"}}),t._v(" "),e("i",{class:t.getTaskCompleted(),attrs:{title:t.$t(t.getTaskCompletedTitle())},on:{click:t.updateCompleted}})],1),t._v(" "),e("div",{staticClass:"taskTitleAndId ps-2 d-lg-none",on:{click:function(e){return t.openTaskDrawer()}}},[e("div",{staticClass:"taskId"},[e("span",{staticClass:"caption text-sub-title"},[t._v("ID : "+t._s(t.task.task.id))])]),t._v(" "),e("div",{staticClass:"taskTitle pe-3"},[e("a",{ref:"tooltip",staticClass:"text-truncate",class:t.getTitleTaskClass(),attrs:{title:t.task.task.title}},[t._v("\n        "+t._s(t.task.task.title)+"\n      ")])])]),t._v(" "),e("div",{staticClass:"taskTitle pe-14 d-lg-block d-md-none",on:{click:function(e){return t.openTaskDrawer()}}},[e("a",{ref:"tooltip",staticClass:"text-truncate",class:t.getTitleTaskClass(),attrs:{title:t.task.task.title}},[t._v("\n      "+t._s(t.task.task.title)+"\n    ")])]),t._v(" "),e("div",{staticClass:"taskProject pe-10"},[t.isPersonnalTask?t._e():e("div",{staticClass:"projectSpaceDetails d-flex align-center TasksListViewProject"},[e("div",{staticClass:"spaceAvatar pe-1 d-lg-block d-md-none"},[null!==t.task.space?e("a",{attrs:{href:t.spaceUrl(t.task.space.url)}},[e("v-avatar",{attrs:{size:30,tile:""}},[e("v-img",{staticClass:"mx-auto spaceAvatarImg",attrs:{src:t.task.space.avatarUrl,height:30,width:30,"max-height":30,"max-width":30}})],1)],1):t._e()]),t._v(" "),e("div",{class:t.task.space?"taskProjectNameChipSpace":"taskProjectNameChip"},[e("v-chip",{staticClass:"font-weight-bold",attrs:{color:t.getTaskColor(),"text-color":"white",small:""},on:{click:function(e){return t.showProjectTasksDetails()}}},[e("span",{staticClass:"text-truncate",attrs:{title:t.getNameProject()}},[t._v("\n            "+t._s(t.getNameProject())+"\n          ")])])],1)])]),t._v(" "),e("div",{staticClass:"taskAssignee v-avatar d-flex pe-7 flex-nowrap"},[e("exo-user-avatars-list",{attrs:{users:t.avatarToDisplay,max:1,"icon-size":26,"retrieve-extra-information":""},on:{"open-detail":function(e){return t.$root.$emit("displayTasksAssigneeAndCoworker",t.avatarToDisplay)}}})],1),t._v(" "),e("div",{staticClass:"taskLabels pe-6",on:{click:function(e){return t.openTaskDrawer()}}},[t.task.labels&&1==t.task.labels.length?e("v-chip",{staticClass:"mx-1 font-weight-bold",staticStyle:{"max-width":"70%"},attrs:{color:t.task.labels[0].color,title:t.task.labels[0].name,label:"",small:""}},[e("span",{staticClass:"text-truncate"},[t._v("\n        "+t._s(t.task.labels[0].name)+"\n      ")])]):t.task.labels&&t.task.labels.length>1?e("div",{staticClass:"taskTags d-flex justify-center",attrs:{title:t.getLabelsList(t.task.labels)}},[e("i",{staticClass:"uiIcon uiTagIcon"}),t._v(" "),e("span",{staticClass:"taskAttachNumber caption"},[t._v(t._s(t.task.labels.length))])]):t._e()],1),t._v(" "),e("div",{staticClass:"taskActions d-flex justify-center pe-9 align-center",on:{click:function(e){return t.openTaskDrawer()}}},[t.task.commentCount?e("div",{staticClass:"taskComment d-flex"},[e("i",{staticClass:"uiIcon uiCommentIcon"}),t._v(" "),e("span",{staticClass:"taskCommentNumber caption"},[t._v(t._s(t.task.commentCount))])]):t._e()]),t._v(" "),e("div",{staticClass:"taskStat pe-9 d-lg-block d-md-none",on:{click:function(e){return t.openTaskDrawer()}}},[t.task&&t.task.task&&t.task.task.status&&t.task.task.status?e("span",{staticClass:"taskStatLabel ps-2",attrs:{title:t.getTaskStatusLabel(t.task.task.status.name)}},[t._v("\n      "+t._s(t.getTaskStatusLabel(t.task.task.status.name))+"\n    ")]):t._e()]),t._v(" "),e("div",{staticClass:"taskDateAndStat",on:{click:function(e){return t.openTaskDrawer()}}},[e("div",{staticClass:"taskStat d-lg-none"},[t.task&&t.task.task&&t.task.task.status&&t.task.task.status?e("span",{staticClass:"taskStatLabel ps-2"},[t._v("\n        "+t._s(t.getTaskStatusLabel(t.task.task.status.name))+"\n      ")]):t._e()]),t._v(" "),e("div",{staticClass:"taskDueDate"},[t.taskDueDate?e("div",{class:t.getOverdueTask(t.taskDueDate)?"red--text":""},[e("date-format",{attrs:{value:t.taskDueDate,format:t.dateTimeFormat}})],1):t._e()])])])};q._withStripped=!0;const G=n({props:{task:{type:Object,default:null},showCompletedTasks:{type:Boolean,default:!1}},data(){return{enabled:!1,dateTimeFormat:{year:"numeric",month:"numeric",day:"numeric"},assigneeAndCoworkerArray:[],isPersonnalTask:null===this.task.status,labelList:"",isSpaceProject:null!==this.task.space}},computed:{taskDueDate(){return this.task&&this.task.task.dueDate&&this.task.task.dueDate.time},avatarToDisplay(){const t=[];return this.assigneeAndCoworkerArray&&this.assigneeAndCoworkerArray.length&&this.assigneeAndCoworkerArray.forEach((e=>{t.push({userName:e.username})})),t},removeCompletedTask(){return!0===this.task.task.completed&&!this.showCompletedTasks}},watch:{"task.assignee"(){this.getTaskAssigneeAndCoworkers()},"task.coworker"(){this.getTaskAssigneeAndCoworkers()}},created(){this.$root.$on("task-updated",(t=>{this.task?.task?.id===t?.id&&(this.task.task=t)})),this.$root.$on("update-completed-task",((t,e)=>{this.task.id===e&&(this.task.task.completed=t,!0===this.task.task.completed&&(this.$root.$emit("update-cart",this.task.task),this.$root.$emit("update-task-completed",this.task.task)))})),this.$root.$on("update-task-assignee",((t,e)=>{this.updateTaskAssignee(t,e)})),this.$root.$on("update-remove-task-labels",((t,e)=>{this.updateRemoveTaskLabels(t,e)})),this.$root.$on("update-task-labels",((t,e)=>{this.updateTaskLabels(t,e)})),this.$root.$on("update-task-comments",((t,e)=>{this.updateTaskComments(t,e)})),this.$root.$on("update-task-coworker",((t,e)=>{this.updateTaskCoworker(t,e)})),this.getTaskAssigneeAndCoworkers(),this.$root.$on("update-task-project",(t=>{this.task.task.status&&this.task.task.id===t.id&&(this.isPersonnalTask=!1)}))},methods:{updateRemoveTaskLabels(t,e){this.task.id===e&&(this.task.labels=this.task.labels.filter((e=>e.id!==t)))},updateTaskLabels(t,e){this.task.id===e&&this.task.labels.push(t)},updateTaskComments(t,e){this.task.id===e&&(this.task.commentCount=t)},updateTaskCoworker(t,e){this.task.id===e&&(t&&t.length?(this.task.coworker=[],t.forEach((t=>{this.$identityService.getIdentityByProviderIdAndRemoteId("organization",t).then((t=>{const e={id:`organization:${t.remoteId}`,username:t.remoteId,providerId:"organization",displayName:t.profile.fullname,avatar:t.profile.avatar};e&&!this.task.coworker.includes(e)&&this.task.coworker.push(e)}))}))):this.task.coworker=[],this.$root.$emit("task-assignee-coworker-updated",this.task))},updateTaskAssignee(t,e){this.task.id===e&&(null===t?this.task.assignee=null:this.$identityService.getIdentityByProviderIdAndRemoteId("organization",t).then((t=>{this.task.assignee={id:`organization:${t.remoteId}`,username:t.remoteId,providerId:"organization",displayName:t.profile.fullname,avatar:t.profile.avatar}})),this.$root.$emit("task-assignee-coworker-updated",this.task))},getTaskPriorityColor(t){switch(t){case"HIGH":return"taskHighPriority";case"NORMAL":return"taskNormalPriority";case"LOW":return"taskLowPriority";case"NONE":return"taskNonePriority"}},getTaskColor(){return this.task.task.status?this.task.task.status.project.color?this.task.task.status.project.color:"noProjectColor":null},updateCompleted(){const t={id:this.task.task.id,isCompleted:!this.task.task.completed};if(t.id)return this.$tasksService.updateCompleted(t).then((t=>{t.completed?this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.completed")}):this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.unCompleted")}),this.$root.$emit("update-cart",t),this.$root.$emit("update-task-completed",t),this.task.task.completed=t.completed})).catch((t=>{console.error("Error updating project",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")}),this.postProject=!1}))},getTaskCompleted(){return!0===this.task.task.completed?"uiIconValidate":"uiIconCircle"},getTitleTaskClass(){return!0===this.task.task.completed?"text-color strikethrough":"text-color"},getTaskCompletedTitle(){return!0===this.task.task.completed?"message.markAsUnCompleted":"message.markAsCompleted"},getNameProject(){return this.task.task.status?this.task.task.status.project.name:null},getTaskAssigneeAndCoworkers(){this.assigneeAndCoworkerArray=[],this.task.assignee&&!this.assigneeAndCoworkerArray.includes(this.task.assignee)&&this.assigneeAndCoworkerArray.push(this.task.assignee),(this.task.coworker||this.task.coworker.length>0)&&this.task.coworker.forEach((t=>{t&&!this.assigneeAndCoworkerArray.includes(t)&&this.assigneeAndCoworkerArray.push(t)}))},getTaskStatusLabel(t){switch(t){case"ToDo":return this.$t("exo.tasks.status.todo");case"InProgress":return this.$t("exo.tasks.status.inprogress");case"WaitingOn":return this.$t("exo.tasks.status.waitingon");case"Done":return this.$t("exo.tasks.status.done");default:return t}},getLabelsList(t){if(t.length>1){let e="";return t.forEach((t=>{e+=`${t.name}\r\n`})),e}},openTaskDrawer(){this.$root.$emit("open-task-drawer",this.task.task)},onCloseDrawer:function(t){this.drawer=t},spaceUrl(t){return this.spaceUrl?`${eXo.env.portal.context}/g/:spaces:${t}/`:"#"},showProjectTasksDetails(){this.$root.$emit("show-project-details-tasks",this.task.task.status.project)},dateFormatter(t){if(t){const e=new Date(t),s=e.getDate(),a=e.getMonth()+1;return`${e.getFullYear()}-${a}-${s}`}},getOverdueTask(t){const e=new Date,s=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`;return this.dateFormatter(t)!==s&&new Date(t)<(new Date).getTime()}}},q,[],!1,null,null,null).exports;var X=function(){var t=this,e=t._self._c;return e("v-app",{staticClass:"tasksCardsContainer",attrs:{id:"TasksCardList"}},[e("v-card",{attrs:{flat:""}},[e("v-item-group",{staticClass:"pa-4"},[e("v-container",{staticClass:"pa-0"},[e("v-row",{staticClass:"ma-0 border-box-sizing"},t._l(t.tasks,(function(s){return e("v-col",{key:s.id,staticClass:"pa-0 projectItem",attrs:{id:"tasks-"+s.id,cols:"12",md:"6",lg:"4",xl:"3"}},[e("task-card",{attrs:{task:s,"show-completed-tasks":t.showCompletedTasks}})],1)})),1)],1)],1)],1)],1)};X._withStripped=!0;const K=n({props:{tasks:{type:Array,default:()=>[]},showCompletedTasks:{type:Boolean,default:!1}}},X,[],!1,null,null,null).exports;var H=function(){var t=this,e=t._self._c;return e("v-app",{class:t.removeCompletedTask?"completedTask":"",attrs:{id:"taskCardItem"}},[e("v-card",{staticClass:"taskCard taskViewCard pa-2",class:[t.getTaskPriorityColor(t.task.task.priority)],attrs:{flat:""}},[e("div",{staticClass:"taskTitleId d-flex justify-space-between"},[e("div",{staticClass:"taskCheckBox"},[e("v-switch",{ref:"autoFocusInput2",staticClass:"d-none",attrs:{"true-value":"true","false-value":"false"}}),t._v(" "),e("i",{class:t.getTaskCompleted(),attrs:{title:t.$t(t.getTaskCompletedTitle())},on:{click:t.updateCompleted}})],1),t._v(" "),e("div",{staticClass:"taskTitle d-flex align-start",on:{click:function(e){return t.openTaskDrawer()}}},[e("a",{ref:"tooltip",staticClass:"taskCardViewTitle",class:t.getTitleTaskClass(),attrs:{title:t.task.task.title}},[e("span",{staticClass:"taskTitleEllipsis"},[t._v(t._s(t.task.task.title))])])])]),t._v(" "),t.displayCardBottomSection?e("v-divider"):t._e(),t._v(" "),t.displayCardBottomSection?e("div",{staticClass:"taskActionsAndDate d-flex align-center justify-space-between"},[e("div",{staticClass:"taskActionsAndLabels d-flex align-center"},[t.assigneeAndCoworkerArray&&t.assigneeAndCoworkerArray.length?e("div",{staticClass:"taskWorker justify-space-between pe-2"},[e("div",{staticClass:"taskAssignee d-flex flex-nowrap",class:t.assigneeAndCoworkerArray&&!t.assigneeAndCoworkerArray.length&&t.task&&t.task.labels&&!t.task.labels.length&&"hideTaskAssignee"},[e("exo-user-avatars-list",{attrs:{users:t.avatarToDisplay,max:1,"icon-size":26,"avatar-overlay-position":"","retrieve-extra-information":""},on:{"open-detail":function(e){return t.$root.$emit("displayTasksAssigneeAndCoworker",t.avatarToDisplay)}}})],1)]):t._e(),t._v(" "),t.task.commentCount?e("div",{staticClass:"taskComment d-flex pe-2",on:{click:function(e){return t.openTaskDrawer()}}},[e("i",{staticClass:"uiIcon uiCommentIcon"}),t._v(" "),e("span",{staticClass:"taskCommentNumber caption"},[t._v(t._s(t.task.commentCount))])]):t._e(),t._v(" "),t.task.labels&&t.task.labels.length?e("div",{class:t.getClassLabels(),on:{click:function(e){return t.openTaskDrawer()}}},[t.task.labels&&1==t.task.labels.length?e("v-chip",{staticClass:"mx-1 font-weight-bold theme--light",attrs:{color:t.task.labels[0].color,title:t.task.labels[0].name,label:"",small:""}},[e("span",{staticClass:"text-truncate"},[t._v("\n              "+t._s(t.task.labels[0].name)+"\n            ")])]):t.task.labels&&t.task.labels.length>1?e("div",{staticClass:"taskTags d-flex theme--light",attrs:{title:t.getLabelsList(t.task.labels)}},[e("i",{staticClass:"uiIcon uiTagIcon"}),t._v(" "),e("span",{staticClass:"taskAttachNumber caption"},[t._v(t._s(t.task.labels.length))])]):t._e()],1):t._e()]),t._v(" "),t.taskDueDate?e("div",{staticClass:"taskStatusAndDate",on:{click:function(e){return t.openTaskDrawer()}}},[e("div",{staticClass:"taskDueDate",class:t.getOverdueTask(t.taskDueDate)?"red--text":""},[e("div",[e("date-format",{attrs:{value:t.taskDueDate,format:t.dateTimeFormat}})],1)])]):t._e()]):t._e()],1)],1)};H._withStripped=!0;const J={props:{task:{type:Object,default:()=>({})},showCompletedTasks:{type:Boolean,default:!1}},data(){return{user:{},dateTimeFormat:{year:"numeric",month:"numeric",day:"numeric"},assigneeAndCoworkerArray:[],isPersonnalTask:null===this.task.task.status,drawer:null}},computed:{taskDueDate(){return this.task&&this.task.task.dueDate&&this.task.task.dueDate.time},avatarToDisplay(){const t=[];return this.assigneeAndCoworkerArray&&this.assigneeAndCoworkerArray.length&&this.assigneeAndCoworkerArray.forEach((e=>{t.push({userName:e.username})})),t},showMoreAvatarsNumber(){return this.assigneeAndCoworkerArray.length-this.maxAvatarToShow},displayCardBottomSection(){return this.taskDueDate||this.task.labels&&this.task.labels.length||this.assigneeAndCoworkerArray&&this.assigneeAndCoworkerArray.length||this.task.commentCount},removeCompletedTask(){return!0===this.task.task.completed&&!this.showCompletedTasks}},watch:{"task.assignee"(){this.getTaskAssigneeAndCoworkers()},"task.coworker"(){this.getTaskAssigneeAndCoworkers()}},created(){this.$root.$on("task-updated",(t=>{this.task?.task?.id===t?.id&&(this.task.task=t)})),this.$root.$on("update-completed-task",((t,e)=>{this.task.id===e&&(this.task.task.completed=t,!0!==this.task.task.completed||this.showCompletedTasks||this.$emit("update-task-completed",this.task.task))})),this.$root.$on("update-task-assignee",((t,e)=>{this.updateTaskAssignee(t,e)})),this.$root.$on("update-remove-task-labels",((t,e)=>{this.updateRemoveTaskLabels(t,e)})),this.$root.$on("update-task-labels",((t,e)=>{this.updateTaskLabels(t,e)})),this.$root.$on("update-task-comments",((t,e)=>{this.updateTaskComments(t,e)})),this.$root.$on("update-task-coworker",((t,e)=>{this.updateTaskCoworker(t,e)})),this.getTaskAssigneeAndCoworkers()},methods:{updateRemoveTaskLabels(t,e){this.task.id===e&&(this.task.labels=this.task.labels.filter((e=>e.id!==t)))},updateTaskLabels(t,e){this.task.id!==e||this.task.labels.includes(t)||this.task.labels.push(t)},updateTaskComments(t,e){this.task.id===e&&(this.task.commentCount=t)},updateTaskCoworker(t,e){this.task.id===e&&(t&&t.length?(this.task.coworker=[],t.forEach((t=>{this.$identityService.getIdentityByProviderIdAndRemoteId("organization",t).then((t=>{const e={id:`organization:${t.remoteId}`,username:t.remoteId,providerId:"organization",displayName:t.profile.fullname,avatar:t.profile.avatar};e&&!this.task.coworker.includes(e)&&this.task.coworker.push(e)}))}))):this.task.coworker=[],this.$root.$emit("task-assignee-coworker-updated",this.task))},updateTaskAssignee(t,e){this.task.id===e&&(null===t?this.task.assignee=null:this.$identityService.getIdentityByProviderIdAndRemoteId("organization",t).then((t=>{this.task.assignee={id:`organization:${t.remoteId}`,username:t.remoteId,providerId:"organization",displayName:t.profile.fullname,avatar:t.profile.avatar}})),this.$root.$emit("task-assignee-coworker-updated",this.task))},getTaskPriorityColor(t){switch(t){case"HIGH":return"taskHighPriority";case"NORMAL":return"taskNormalPriority";case"LOW":return"taskLowPriority";case"NONE":return"taskNonePriority"}},getTaskAssigneeAndCoworkers(){this.assigneeAndCoworkerArray=[],this.task.assignee&&!this.assigneeAndCoworkerArray.includes(this.task.assignee)&&this.assigneeAndCoworkerArray.push(this.task.assignee),(this.task.coworker||this.task.coworker.length>0)&&this.task.coworker.forEach((t=>{t&&!this.assigneeAndCoworkerArray.includes(t)&&this.assigneeAndCoworkerArray.push(t)}))},getLabelsList(t){if(t.length>1){let e="";return t.forEach((t=>{e+=`${t.name}\r\n`})),e}},getAssigneeAndCoworkerList(t){if(t.length>1){let e="";return t.forEach((t=>{e+=`${t.displayName}\r\n`})),e}},openTaskDrawer(){this.$root.$emit("open-task-drawer",this.task.task)},onCloseDrawer:function(t){this.drawer=t},getTaskCompleted(){return!0===this.task.task.completed?"uiIconValidate":"uiIconCircle"},getTaskCompletedTitle(){return!0===this.task.task.completed?"message.markAsUnCompleted":"message.markAsCompleted"},updateCompleted(){const t={id:this.task.task.id,isCompleted:!this.task.task.completed};if(t.id)return this.$tasksService.updateCompleted(t).then((e=>{e.completed?this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.completed")}):this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.unCompleted")}),this.$root.$emit("update-task-completed",e),this.task.task.completed=t.isCompleted})).catch((t=>{console.error("Error updating task completed",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")}),this.postProject=!1}))},getTitleTaskClass(){return!0===this.task.task.completed?"text-color strikethrough":"text-color"},dateFormatter(t){if(t){const e=new Date(t),s=e.getDate(),a=e.getMonth()+1;return`${e.getFullYear()}-${a}-${s}`}},getOverdueTask(t){const e=new Date,s=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`;return this.dateFormatter(t)!==s&&new Date(t)<(new Date).getTime()},getClassLabels(){if(this.task&&this.task.labels&&1===this.task.labels.length)return this.assigneeAndCoworkerArray&&this.assigneeAndCoworkerArray.length&&this.task.commentCount?"taskLabelsAssigneeComment":this.assigneeAndCoworkerArray&&this.assigneeAndCoworkerArray.length&&!this.task.commentCount||!this.assigneeAndCoworkerArray&&!this.assigneeAndCoworkerArray.length&&this.task.commentCount?"taskLabelsAssignee":"taskLabels"}}},W=n(J,H,[],!1,null,null,null).exports;var Y=function(){var t=this,e=t._self._c;return e("exo-drawer",{ref:"filterTasksDrawer",staticClass:"filterTasksDrawer",attrs:{"body-classes":"hide-scroll decrease-z-index-more",right:""}},[e("template",{slot:"title"},[t._v("\n    "+t._s(t.$t("label.sortAndFilter"))+"\n  ")]),t._v(" "),e("template",{slot:"content"},[e("div",{staticClass:"VuetifyApp"},[[e("v-card",{staticClass:"taskFilter"},[e("v-toolbar",{attrs:{dense:""}},[e("v-tabs",{model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[e("v-tab",{staticClass:"text-capitalize"},[t._v(t._s(t.$t("label.filter.groupandsort")))]),t._v(" "),"gantt"!=t.taskViewTabName?e("v-tab",{staticClass:"text-capitalize"},[t._v(t._s(t.$t("label.filter.filter")))]):t._e(),t._v(" "),"gantt"!=t.taskViewTabName?e("v-tab",{staticClass:"text-capitalize"},[t._v(t._s(t.$t("label.filter.label")))]):t._e()],1)],1),t._v(" "),e("v-tabs-items",{model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[t.project?t._e():e("v-tab-item",[e("v-card",[e("tasks-group-drawer",{ref:"filterGroupTasksDrawer",model:{value:t.groupBy,callback:function(e){t.groupBy=e},expression:"groupBy"}}),t._v(" "),e("tasks-sort-by-drawer",{ref:"filterSortTasksDrawer",model:{value:t.orderBy,callback:function(e){t.orderBy=e},expression:"orderBy"}})],1)],1),t._v(" "),t.project?e("v-tab-item",[e("v-card",[e("tasks-group-project-drawer",{ref:"filterGroupTasksDrawer",attrs:{"task-view-tab-name":t.taskViewTabName},on:{"scale-changed":t.changeScale},model:{value:t.groupBy,callback:function(e){t.groupBy=e},expression:"groupBy"}}),t._v(" "),"gantt"!=t.taskViewTabName?e("tasks-sort-by-project-drawer",{ref:"filterSortTasksDrawer",model:{value:t.orderBy,callback:function(e){t.orderBy=e},expression:"orderBy"}}):t._e()],1)],1):t._e(),t._v(" "),e("v-tab-item",[e("v-card",[e("form",{ref:"form1",staticClass:"mt-4"},[e("v-label",{attrs:{for:"name"}},[e("span",{staticClass:"font-weight-bold body-2"},[t._v(t._s(t.$t("filter.task.contains")))])]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.query,expression:"query"}],ref:"autoFocusInput1",staticClass:"input-block-level ignore-vuetify-classes my-3",attrs:{placeholder:t.$t("filter.task.contains"),type:"text",name:"name",required:""},domProps:{value:t.query},on:{input:function(e){e.target.composing||(t.query=e.target.value)}}}),t._v(" "),t.project?e("v-label",{attrs:{for:"status"}},[e("span",{staticClass:"font-weight-bold body-2"},[t._v(t._s(t.$t("filter.task.status")))])]):t._e(),t._v(" "),t.project?e("select",{directives:[{name:"model",rawName:"v-model",value:t.statusSelected,expression:"statusSelected"}],staticClass:"input-block-level ignore-vuetify-classes my-3",attrs:{name:"status"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.statusSelected=e.target.multiple?s:s[0]}}},[e("option",{attrs:{value:""}},[t._v(t._s(t.$t("label.priority.")))]),t._v(" "),t._l(t.statusList,(function(s){return e("option",{key:s.id,staticClass:"text-capitalize",domProps:{value:s.id}},[t._v("\n                      "+t._s(t.statusFilterLabel(s.name))+"\n                    ")])}))],2):t._e(),t._v(" "),e("v-label",{attrs:{for:"assignee"}},[e("span",{staticClass:"font-weight-bold body-2"},[t._v(t._s(t.$t("label.assignee")))])]),t._v(" "),e("exo-identity-suggester",{ref:"autoFocusInput3",attrs:{labels:t.suggesterLabels,"search-options":t.searchOptions,name:"assignee","type-of-relations":"user_to_invite",height:"40","include-users":""},model:{value:t.assignee,callback:function(e){t.assignee=e},expression:"assignee"}}),t._v(" "),e("v-label",{attrs:{for:"taskDueDate"}},[e("span",{staticClass:"font-weight-bold body-2"},[t._v(t._s(t.$t("filter.task.due")))])]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.dueDateSelected,expression:"dueDateSelected"}],staticClass:"input-block-level ignore-vuetify-classes my-3",attrs:{name:"taskDueDate"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.dueDateSelected=e.target.multiple?s:s[0]}}},t._l(t.dueDate,(function(s){return e("option",{key:s.name,domProps:{value:s.name}},[t._v("\n                      "+t._s(t.$t("label.dueDate."+s.name.toLowerCase()))+"\n                    ")])})),0),t._v(" "),e("v-label",{attrs:{for:"priority"}},[e("span",{staticClass:"font-weight-bold body-2"},[t._v(t._s(t.$t("label.priority")))])]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.prioritySelected,expression:"prioritySelected"}],staticClass:"input-block-level ignore-vuetify-classes my-3",attrs:{name:"priority"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.prioritySelected=e.target.multiple?s:s[0]}}},t._l(t.priority,(function(s){return e("option",{key:s.name,domProps:{value:s.name}},[t._v("\n                      "+t._s(t.$t("label.priority."+s.name.toLowerCase()))+"\n                    ")])})),0),t._v(" "),e("div",{staticClass:"showCompleteTasks d-flex flex-wrap pt-2"},[e("form",{staticClass:"switchEnabled"},[e("label",{staticClass:"col-form-label pt-0",attrs:{"max-rows":"6"}},[t._v(t._s(t.$t("filter.task.showCompleted"))+":")]),t._v(" "),e("label",{staticClass:"switch"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.showCompletedTasks,expression:"showCompletedTasks"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.showCompletedTasks)?t._i(t.showCompletedTasks,null)>-1:t.showCompletedTasks},on:{change:function(e){var s=t.showCompletedTasks,a=e.target,i=!!a.checked;if(Array.isArray(s)){var r=t._i(s,null);a.checked?r<0&&(t.showCompletedTasks=s.concat([null])):r>-1&&(t.showCompletedTasks=s.slice(0,r).concat(s.slice(r+1)))}else t.showCompletedTasks=i}}}),t._v(" "),e("div",{staticClass:"slider round"},[e("span",{staticClass:"absolute-yes"},[t._v(t._s(t.$t("filter.task.showCompleted.yes","YES")))])]),t._v(" "),e("span",{staticClass:"absolute-no"},[t._v(t._s(t.$t("filter.task.showCompleted.no")))])])])])],1)])],1),t._v(" "),e("v-tab-item",[e("v-card",[e("tasks-labels-drawer",{ref:"filterLabelsTasksDrawer",attrs:{"project-id":t.projectId,labels:t.labels}})],1)],1)],1)],1)]],2)]),t._v(" "),e("template",{slot:"footer"},[e("div",{staticClass:"VuetifyApp flex d-flex"},[e("v-btn",{staticClass:"reset",on:{click:t.reset}},[[e("i",{staticClass:"fas fa-redo"}),t._v("\n          "+t._s(t.$t("popup.reset"))+"\n        ")]],2),t._v(" "),e("v-spacer"),t._v(" "),e("div",{staticClass:"d-btn"},[e("v-btn",{staticClass:"btn me-2",on:{click:t.cancel}},[[t._v("\n            "+t._s(t.$t("popup.cancel"))+"\n          ")]],2),t._v(" "),e("v-btn",{staticClass:"btn btn-primary",attrs:{loading:t.postProject},on:{click:t.filterTasks}},[[t._v("\n            "+t._s(t.$t("label.confirm"))+"\n          ")]],2)],1)],1)])],2)};Y._withStripped=!0;const Q=n({props:{task:{type:Object,default:()=>({})},groupBy:{type:String,default:""},orderBy:{type:String,default:""},project:{type:String,default:""},query:{type:String,default:""},taskViewTabName:{type:String,default:""},statusList:{type:Array,default:()=>[]},showCompletedTasks:{type:Boolean,default:!1}},data:()=>({tab:null,dueDateSelected:"",prioritySelected:"",statusSelected:"",projectId:0,assignee:"",assigneeTask:"",dueDate:[{name:""},{name:"OVERDUE"},{name:"TODAY"},{name:"TOMORROW"},{name:"UPCOMING"}],priority:[{name:""},{name:"NONE"},{name:"LOW"},{name:"NORMAL"},{name:"HIGH"}],labels:[]}),computed:{suggesterLabels(){return{placeholder:this.$t("label.assignee"),noDataLabel:this.$t("label.noDataLabel")}},searchOptions(){if(this.project){const t={includeCurrentUser:!0};return{searchUrl:"/portal/rest/projects/projectParticipants/".concat(this.project).concat("/"),options:t}}return{}}},created(){this.$root.$on("filter-task-labels",(t=>{this.labels=t}))},methods:{open(){const t=document.location.pathname;this.getTabView();const e=t.includes("projectDetail")&&t.split("projectDetail/")[1].split(/[^0-9]/)[0]?Number(t.split("projectDetail/")[1].split(/[^0-9]/)[0]):0;e>0&&window.setTimeout((()=>{document.dispatchEvent(new CustomEvent("loadFilterProjectLabels",{detail:e}))}),200);const s=e>0?`filterStorage${e}+${this.taskViewTabName}`:"filterStorageNone+list",a=localStorage.getItem(s)?JSON.parse(localStorage.getItem(s)):null;this.groupBy=e>0&&a&&a.projectId===e&&a.groupBy||a&&"None"===a.projectId&&a.groupBy?a.groupBy:"",this.orderBy=e>0&&a&&a.projectId===e&&a.orderBy||a&&"None"===a.projectId&&a.orderBy?a.orderBy:"",this.$root.$emit("reset-filter-task-sort",this.orderBy),this.$refs.filterTasksDrawer.open()},cancel(){this.$refs.filterTasksDrawer.close(),this.query=this.task.query,this.assignee=this.task.assignee,this.dueDateSelected="",this.prioritySelected="",this.statusSelected="","list"===this.taskViewTabName?this.groupBy="status":this.groupBy="none",this.orderBy="",this.labels="",this.showCompletedTasks=!1,this.getFilterNumber(),this.$root.$emit("reset-filter-task-group-sort",this.groupBy)},reset(){this.query=this.task.query,this.assignee=this.task.assignee,this.dueDateSelected="",this.prioritySelected="",this.statusSelected="","list"===this.taskViewTabName?this.groupBy="status":this.groupBy="",this.orderBy="",this.labels="",this.showCompletedTasks=!1,this.getFilterNumber();const t={groupBy:this.groupBy,orderBy:this.orderBy,projectId:this.project||"None",tabView:""!==this.taskViewTabName?this.taskViewTabName:"list"};this.saveValueFilterInStorage(t),this.$root.$emit("reset-filter-task-group-sort",this.groupBy),this.$emit("reset-filter-task")},resetFields(t){this.query="",this.assignee="",this.dueDateSelected="",this.prioritySelected="",this.statusSelected="",this.groupBy="",this.orderBy="",this.labels="",this.showCompletedTasks=!1,this.$root.$emit("reset-filter-task-group-sort",this.groupBy),this.getFilterNumber(t)},filterTasks(){if("gantt"===this.taskViewTabName)this.cancel();else{"completed"===this.groupBy&&(this.showCompletedTasks=!0);const t={query:this.query,assignee:"",statusId:this.statusSelected,dueDate:this.dueDateSelected,priority:this.prioritySelected,showCompletedTasks:this.showCompletedTasks,groupBy:this.groupBy,orderBy:this.orderBy},e={groupBy:this.groupBy,orderBy:this.orderBy},s={labels:[]};this.labels&&this.labels.forEach((t=>{s.labels.push(t.id)})),this.assignee&&(t.assignee=this.assignee.remoteId);const a={groupBy:this.groupBy,orderBy:this.orderBy,projectId:this.project||"None",tabView:""!==this.taskViewTabName?this.taskViewTabName:"list"};this.saveValueFilterInStorage(a),this.project?(this.$emit("filter-task",{tasks:t,filterLabels:s,showCompletedTasks:this.showCompletedTasks}),this.getFilterNumber(),this.$refs.filterTasksDrawer&&this.$refs.filterTasksDrawer.close()):(this.$emit("filter-task-query",t,e,s),this.getFilterNumber(),this.$refs.filterTasksDrawer.close())}},getFilterNumber(t){let e=0;this.query&&e++,this.assignee&&e++,this.dueDateSelected&&e++,this.prioritySelected&&e++,this.statusSelected&&e++,this.labels&&this.labels.length>0&&e++,this.showCompletedTasks&&e++,this.$emit("filter-num-changed",e,t)},saveValueFilterInStorage(t){this.$projectService.saveFilterSettings(t).then((e=>{e&&(t.showCompletedTasks=this.showCompletedTasks,this.project?localStorage.setItem(`filterStorage${t.projectId}+${t.tabView}`,JSON.stringify(t)):localStorage.setItem("filterStorageNone+list",JSON.stringify(t)))}))},statusFilterLabel(t){return this.$t(`label.status.${t.toLowerCase()}`).includes("label.status")?t:this.$t(`label.status.${t.toLowerCase()}`)},getTabView(){const t=document.location.pathname;return document.getElementsByClassName("taskTabList")[0]&&t.includes("projectDetail")&&("true"===document.getElementsByClassName("taskTabList")[0].getAttribute("aria-selected")?this.taskViewTabName="list":"true"===document.getElementsByClassName("taskTabBoard")[0].getAttribute("aria-selected")?this.taskViewTabName="board":"true"===document.getElementsByClassName("taskTabGantt")[0].getAttribute("aria-selected")&&(this.taskViewTabName="gantt")),this.taskViewTabName},changeScale(t){this.$root.$emit("scale-value-changed",t)}}},Y,[],!1,null,null,null).exports;var Z=function(){var t=this,e=t._self._c;return e("exo-drawer",{ref:"assigneeAndCoworkerDrawer",attrs:{right:""}},[e("template",{slot:"title"},[t._v("\n    "+t._s(t.$t("label.assigneeAndCoworkers"))+"\n  ")]),t._v(" "),t.tasksAssigneeAndCoworker?e("template",{slot:"content"},[e("v-layout",{staticClass:"ma-3",attrs:{column:""}},t._l(t.tasksAssigneeAndCoworker,(function(t){return e("v-flex",{key:t,staticClass:"flex-grow-1 text-truncate my-2"},[e("exo-user-avatar",{attrs:{"profile-id":t.userName,popover:""}})],1)})),1)],1):t._e()],2)};Z._withStripped=!0;const tt=n({data:()=>({tasksAssigneeAndCoworker:[]}),mounted(){this.$root.$on("displayTasksAssigneeAndCoworker",(t=>{this.tasksAssigneeAndCoworker=t,this.$refs.assigneeAndCoworkerDrawer.open()}))}},Z,[],!1,null,null,null).exports;var et=function(){var t=this,e=t._self._c;return e("div",{ref:"filterGroupTasksDrawer",staticClass:"filterGroupTasksDrawer",attrs:{"body-classes":"hide-scroll decrease-z-index-more",right:""}},[e("form",{ref:"form1",staticClass:"mt-4"},[e("v-label",{attrs:{for:"name"}},[e("span",{staticClass:"font-weight-bold body-2"},[t._v(t._s(t.$t("label.task.groupBy")))])])],1),t._v(" "),e("v-radio-group",{attrs:{mandatory:""},model:{value:t.groupBy,callback:function(e){t.groupBy=e},expression:"groupBy"}},[e("v-radio",{attrs:{label:t.$t("label.task.none"),value:"none"}}),t._v(" "),e("v-radio",{attrs:{label:t.$t("label.task.project"),value:"project"}}),t._v(" "),e("v-radio",{attrs:{label:t.$t("label.task.labels"),value:"label"}}),t._v(" "),e("v-radio",{attrs:{label:t.$t("label.task.dueDate"),value:"dueDate"}}),t._v(" "),e("v-radio",{attrs:{label:t.$t("label.task.assignee"),value:"assignee"}})],1)],1)};et._withStripped=!0;const st=n({props:{value:{type:String,default:""}},data(){return{groupBy:this.value}},watch:{groupBy(t){this.$emit("input",t)}},created(){this.$root.$on("reset-filter-task-group-sort",(t=>{this.groupBy=t}))}},et,[],!1,null,null,null).exports;var at=function(){var t=this,e=t._self._c;return e("div",{ref:"filterSortTasksDrawer",staticClass:"filterSortTasksDrawer",attrs:{"body-classes":"hide-scroll decrease-z-index-more",right:""}},[e("form",{ref:"form1",staticClass:"mt-4"},[e("v-label",{attrs:{for:"name"}},[e("span",{staticClass:"font-weight-bold body-2"},[t._v(t._s(t.$t("label.task.sort")))])])],1),t._v(" "),e("v-radio-group",{attrs:{mandatory:""},model:{value:t.orderBy,callback:function(e){t.orderBy=e},expression:"orderBy"}},[e("v-radio",{attrs:{label:t.$t("label.task.status"),value:"status"}}),t._v(" "),e("v-radio",{attrs:{label:t.$t("label.task.title"),value:"title"}}),t._v(" "),e("v-radio",{attrs:{label:t.$t("label.task.dueDate"),value:"dueDate"}}),t._v(" "),e("v-radio",{attrs:{label:t.$t("label.task.priority"),value:"priority"}}),t._v(" "),e("v-radio",{attrs:{label:t.$t("label.task.rank"),value:"rank"}})],1)],1)};at._withStripped=!0;const it=n({props:{value:{type:String,default:""}},data(){return{orderBy:this.value}},watch:{orderBy(t){this.$emit("input",t)}},created(){this.$root.$on("reset-filter-task-group-sort",(()=>{this.orderBy=""})),this.$root.$on("reset-filter-task-sort",(t=>{this.orderBy=t}))}},at,[],!1,null,null,null).exports;var rt=function(){var t=this,e=t._self._c;return e("div",{ref:"filterLabelsTasksDrawer",staticClass:"filterLabelsTasksDrawer",attrs:{"body-classes":"hide-scroll decrease-z-index-more",right:""}},[e("div",{on:{click:function(t){t.stopPropagation()}}},[e("v-combobox",{ref:"selectLabel",staticClass:"pt-0 inputTaskLabel",attrs:{id:"labelInput",filter:t.filter,"hide-no-data":!t.search,items:t.items,"search-input":t.search,label:t.$t("label.tapLabel.name"),attach:"","hide-selected":"",multiple:"","small-chips":"","prepend-icon":"",solo:""},on:{"update:searchInput":function(e){t.search=e},"update:search-input":function(e){t.search=e},click:function(e){return t.openLabelsList()},change:function(e){t.search=""}},scopedSlots:t._u([{key:"selection",fn:function({attrs:s,item:a,parent:i,selected:r}){return[a===Object(a)?e("v-chip",t._b({staticClass:"pe-1",attrs:{color:`${a.color} lighten-3`,"input-value":r,label:"",small:""}},"v-chip",s,!1),[e("span",{staticClass:"pe-2"},[t._v("\n            "+t._s(a.text)+"\n          ")]),t._v(" "),e("v-icon",{staticClass:"pe-0",attrs:{"x-small":""},on:{click:function(t){return i.selectItem(a)}}},[t._v("\n            close\n          ")])],1):t._e()]}}]),model:{value:t.model,callback:function(e){t.model=e},expression:"model"}})],1)])};rt._withStripped=!0;const ot=n({props:{task:{type:Object,default:()=>({})},projectId:{type:Number,default:0}},data:()=>({index:-1,items:[],nonce:1,model:[],x:0,search:null,y:0}),watch:{model(t,e){if(t&&e){if(t.length===e.length)return void(this.search=null);this.model=t.map((t=>("string"==typeof t&&(t={text:t,name:t},this.items.push(t),this.nonce++),t)))}this.$root.$emit("filter-task-labels",this.model)}},created(){const t=document.location.pathname;if(t.includes("projectDetail")){let e=t.split("projectDetail/")[1].split(/[^0-9]/)[0];e=e&&Number(e)||0,this.getProjectLabels(e),this.projectId=e}else this.getMyAllLabels();document.addEventListener("closeLabelsList",(()=>{setTimeout((()=>{void 0!==this.$refs.selectLabel&&(this.$refs.selectLabel.isMenuActive=!1)}),100)})),document.addEventListener("loadTaskLabels",(t=>{if(t&&t.detail){const e=t.detail;this.model=[],null!=e.id&&(this.getTaskLabels(),this.$taskDrawerApi.getTaskLabels(e.id).then((t=>{this.model=t.map((function(t){const e=Object.assign({},t);return e.text=e.name,e}))})))}})),document.addEventListener("loadFilterProjectLabels",(t=>{t&&t.detail&&(this.projectId=t.detail,this.getProjectLabels(this.projectId))})),this.$root.$on("reset-filter-task-group-sort",(()=>{this.model=null}))},methods:{filter(t,e,s){if(t.header)return!1;const a=function(t){return null!=t?t:""},i=a(s),r=a(e);return i.toString().toLowerCase().indexOf(r.toString().toLowerCase())>-1},getMyAllLabels(){this.$taskDrawerApi.getMyAllLabels().then((t=>{this.items=t.map((function(t){const e=Object.assign({},t);return e.text=e.name,e}))}))},getTaskLabels(){this.$taskDrawerApi.getTaskLabels(this.task.id).then((t=>{this.model=t.map((function(t){const e=Object.assign({},t);return e.text=e.name,e}))}))},getProjectLabels(t){this.$taskDrawerApi.getProjectLabels(t).then((t=>{this.items=t.map((function(t){const e=Object.assign({},t);return e.text=e.name,e}))}))},openLabelsList(){this.$emit("labelsListOpened")}}},rt,[],!1,null,null,null).exports;var nt=function(){var t=this,e=t._self._c;return e("div",{ref:"filterGroupTasksDrawer",staticClass:"filterGroupTasksDrawer",attrs:{"body-classes":"hide-scroll decrease-z-index-more",right:""}},["gantt"===t.taskViewTabName?e("div",[e("form",{ref:"form1",staticClass:"mt-4"},[e("v-label",{attrs:{for:"name"}},[e("span",{staticClass:"font-weight-bold body-2"},[t._v(t._s(t.$t("label.gantt.scale"))+" ")])])],1),t._v(" "),e("v-radio-group",{attrs:{mandatory:""},model:{value:t.scaleBy,callback:function(e){t.scaleBy=e},expression:"scaleBy"}},[e("v-radio",{attrs:{label:t.$t("label.gantt.scale.day"),value:"Day"}}),t._v(" "),e("v-radio",{attrs:{label:t.$t("label.gantt.scale.week"),value:"Week"}}),t._v(" "),e("v-radio",{attrs:{label:t.$t("label.gantt.scale.month"),value:"Month"}})],1)],1):e("div",[e("form",{ref:"form1",staticClass:"mt-4"},[e("v-label",{attrs:{for:"name"}},[e("span",{staticClass:"font-weight-bold body-2"},[t._v(t._s(t.$t("label.task.groupBy")))])])],1),t._v(" "),e("v-radio-group",{attrs:{mandatory:""},model:{value:t.groupBy,callback:function(e){t.groupBy=e},expression:"groupBy"}},["list"!==t.taskViewTabName?e("v-radio",{attrs:{label:t.$t("label.task.none"),value:"none"}}):t._e(),t._v(" "),"list"===t.taskViewTabName?e("v-radio",{attrs:{label:t.$t("label.task.status"),value:"status"}}):t._e(),t._v(" "),e("v-radio",{attrs:{label:t.$t("label.task.assignee"),value:"assignee"}}),t._v(" "),e("v-radio",{attrs:{label:t.$t("label.task.labels"),value:"label"}}),t._v(" "),e("v-radio",{attrs:{label:t.$t("label.task.dueDate"),value:"dueDate"}}),t._v(" "),e("v-radio",{attrs:{label:t.$t("label.task.completed"),value:"completed"}})],1)],1)])};nt._withStripped=!0;const lt=n({props:{value:{type:String,default:""},taskViewTabName:{type:String,default:""}},data(){return{groupBy:this.value,scaleBy:"Week"}},watch:{groupBy(t){this.$emit("input",t)},scaleBy(t){this.$emit("scale-changed",t)}},created(){this.$root.$on("reset-filter-task-group-sort",(t=>{this.groupBy=t}))}},nt,[],!1,null,null,null).exports;var ct=function(){var t=this,e=t._self._c;return e("div",{ref:"filterSortTasksDrawer",staticClass:"filterSortTasksDrawer",attrs:{"body-classes":"hide-scroll decrease-z-index-more",right:""}},[e("form",{ref:"form1",staticClass:"mt-4"},[e("v-label",{attrs:{for:"name"}},[e("span",{staticClass:"font-weight-bold body-2"},[t._v(t._s(t.$t("label.task.sort")))])])],1),t._v(" "),e("v-radio-group",{attrs:{mandatory:""},model:{value:t.orderBy,callback:function(e){t.orderBy=e},expression:"orderBy"}},[e("v-radio",{attrs:{label:t.$t("label.task.dueDate"),value:"dueDate"}}),t._v(" "),e("v-radio",{attrs:{label:t.$t("label.task.priority"),value:"priority"}}),t._v(" "),e("v-radio",{attrs:{label:t.$t("label.task.title"),value:"title"}}),t._v(" "),e("v-radio",{attrs:{label:t.$t("label.task.lastUpdate"),value:"createdTime"}})],1)],1)};ct._withStripped=!0;const dt=n({props:{value:{type:String,default:""}},data(){return{orderBy:this.value}},watch:{orderBy(t){this.$emit("input",t)}},created(){this.$root.$on("reset-filter-task-group-sort",(()=>{this.orderBy=""})),this.$root.$on("reset-filter-task-sort",(t=>{this.orderBy=t}))}},ct,[],!1,null,null,null).exports;var ut=function(){var t=this,e=t._self._c;return e("v-app",{staticClass:"projectTasksDashboard",class:"board"===t.taskViewTabName&&!t.filterProjectActive&&"projectTaskBoardContainer",attrs:{id:"projectTask-"+t.project.id}},[e("exo-confirm-dialog",{ref:"deleteConfirmDialog",attrs:{message:t.deleteConfirmMessage,title:t.$t("popup.deleteStatus"),"ok-label":t.$t("label.ok"),"cancel-label":t.$t("popup.cancel")},on:{ok:function(e){return t.deleteConfirm()}}}),t._v(" "),e("div",{staticClass:"projectTasksWrapper d-flex justify-space-between"},[e("div",{staticClass:"taskViewBreadcrumb text-truncate px-0 pt-1 pb-5"},[e("a",{staticClass:"text-color",on:{click:function(e){return t.hideProjectDetails()}}},[e("i",{staticClass:"uiIcon uiBackIcon"}),t._v(" "),e("span",[t._v(t._s(t.project.name))])])]),t._v(" "),e("div",{staticClass:"projectTasksTabFilter"},[e("tasks-view-toolbar",{attrs:{project:t.project,"status-list":t.statusList,"task-card-tab-view":"#tasks-view-board","task-list-tab-view":"#tasks-view-list","task-gantt-tab-view":"#tasks-view-gantt","show-completed-tasks":t.showCompletedTasks},on:{"keyword-changed":t.filterByKeyword,taskViewChangeTab:t.getChangeTabValue,"filter-task-dashboard":t.filterTaskDashboard,"reset-filter-task-dashboard":t.resetFiltertaskDashboard}})],1)]),t._v(" "),t.filterProjectActive&&t.groupName&&t.groupName.projectName?e("div",{staticClass:"px-0"},t._l(t.groupName.projectName,(function(s,a){return e("div",{key:s.name,staticClass:"pt-5"},[s.value&&s.value.displayName&&""!==s.name?e("div",{staticClass:"d-flex align-center mr-3 assigneeFilter pointer"},[e("a",{staticClass:"toggle-collapse-group",attrs:{href:"#"},on:{click:function(e){return t.showDetailsTask(s.rank)}}},[e("i",{staticClass:"uiIcon uiIconMiniArrowDown",staticStyle:{display:"block"},attrs:{id:"uiIconMiniArrowDown"+s.rank}}),t._v(" "),e("i",{staticClass:"uiIcon uiIconMiniArrowRight",staticStyle:{display:"none"},attrs:{id:"uiIconMiniArrowRight"+s.rank}})]),t._v(" "),s.value.avatar?e("exo-user-avatar",{staticClass:"pe-2",attrs:{"profile-id":s.value.username,size:26,popover:""}}):t._e(),t._v(" "),e("span",{staticClass:"amount-item"},[t._v("("+t._s(t.tasksList[a].length)+")")]),t._v(" "),e("hr",{staticClass:"my-0 v-divider theme--light",attrs:{role:"separator","aria-orientation":"horizontal"}}),t._v(" "),"list"===t.taskViewTabName?e("i",{staticClass:"uiIconSocSimplePlus d-flex",attrs:{icon:"",small:""},on:{click:function(e){return t.openTaskDrawer()}}}):t._e()],1):e("div",{staticClass:"d-flex align-center mr-3 assigneeFilter pointer"},[e("a",{staticClass:"toggle-collapse-group",attrs:{id:"iconTask"+s.rank,href:"#"},on:{click:function(e){return t.showDetailsTask(s.rank)}}},[e("i",{staticClass:"uiIcon uiIconMiniArrowDown",staticStyle:{display:"block"},attrs:{id:"uiIconMiniArrowDown"+s.rank}}),t._v(" "),e("i",{staticClass:"uiIcon uiIconMiniArrowRight",staticStyle:{display:"none"},attrs:{id:"uiIconMiniArrowRight"+s.rank}})]),t._v(" "),"Unassigned"===s.name||""===s.name?e("div",{staticClass:"defaultAvatar"},[e("img",{attrs:{src:t.defaultAvatar}})]):t._e(),t._v(" "),e("span",{staticClass:"nameGroup"},[t._v(t._s(t.$t(t.getNameGroup(s.name))))]),t._v(" "),e("span",{staticClass:"amount-item"},[t._v("("+t._s(t.tasksList[a].length)+")")]),t._v(" "),e("hr",{staticClass:"my-0 v-divider theme--light",attrs:{role:"separator","aria-orientation":"horizontal"}}),t._v(" "),"list"===t.taskViewTabName?e("i",{staticClass:"uiIconSocSimplePlus d-flex",attrs:{icon:"",small:""},on:{click:function(e){return t.openTaskDrawer()}}}):t._e()]),t._v(" "),e("div",{staticClass:"view-project-group-sort",attrs:{id:"taskView"+s.rank}},[e("div",{directives:[{name:"show",rawName:"v-show",value:"board"==t.taskViewTabName,expression:"taskViewTabName == 'board'"}],staticStyle:{display:"block"},attrs:{eager:""}},[e("tasks-view-board",{attrs:{project:t.project,"status-list":t.statusList,"tasks-list":t.tasksList[a],"show-completed-tasks":t.showCompletedTasks},on:{"update-status":t.updateStatus,"create-status":t.createStatus,"move-status":t.moveStatus,"delete-status":t.deleteStatus}})],1),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:"list"==t.taskViewTabName,expression:"taskViewTabName == 'list'"}],attrs:{eager:""}},[e("tasks-view-list",{attrs:{project:t.project,"status-list":t.statusList,"tasks-list":t.tasksList[a],"show-completed-tasks":t.showCompletedTasks}})],1)])])})),0):t._e(),t._v(" "),t.loadingTasks?t._e():e("v-tabs-items",{directives:[{name:"show",rawName:"v-show",value:!t.filterProjectActive,expression:"!filterProjectActive"}]},[e("div",{directives:[{name:"show",rawName:"v-show",value:"board"==t.taskViewTabName,expression:"taskViewTabName == 'board'"}],staticStyle:{display:"block"},attrs:{eager:""}},[e("tasks-view-board",{attrs:{project:t.project,"status-list":t.statusList,"tasks-list":t.tasksList,"show-completed-tasks":t.showCompletedTasks,"filter-no-active":!0},on:{"update-status":t.updateStatus,"create-status":t.createStatus,"move-status":t.moveStatus,"delete-status":t.deleteStatus}})],1),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:"list"==t.taskViewTabName,expression:"taskViewTabName == 'list'"}],attrs:{eager:""}},[e("tasks-view-list",{attrs:{project:t.project,"status-list":t.statusList,"tasks-list":t.tasksList,"show-completed-tasks":t.showCompletedTasks,"filter-by-status":t.filterByStatus=!0},on:{"update-status":t.updateStatus}})],1),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:"gantt"==t.taskViewTabName,expression:"taskViewTabName == 'gantt'"}],attrs:{eager:""}},[e("tasks-view-gantt",{attrs:{"tasks-list":t.allProjectTasks}})],1)]),t._v(" "),e("div",{staticClass:"ma-0 border-box-sizing"},[t.loadingTasks?e("v-btn",{staticClass:"loadMoreButton ma-auto mt-4 btn",attrs:{loading:t.loadingTasks,disabled:t.loadingTasks,block:""},on:{click:t.loadNextPage}},[t._v("\n      "+t._s(t.$t("spacesList.button.showMore"))+"\n    ")]):t._e()],1),t._v(" "),e("tasks-unscheduled-drawer",{attrs:{project:t.project,"show-completed-tasks":t.showCompletedTasks}})],1)};ut._withStripped=!0;const ht=n({props:{project:{type:Number,default:0}},data:()=>({defaultAvatar:"/portal/rest/v1/social/users/default-image/avatar",keyword:null,loadingTasks:!1,tasksFilter:{},taskViewTabName:"board",deleteConfirmMessage:null,statusList:[],tasksList:[],allProjectTasks:[],groupName:null,filterProjectActive:!0,filterByStatus:!1,status:null,showCompletedTasks:!1}),watch:{project(){if(localStorage.getItem(`filterStorage${this.project.id}+${this.taskViewTabName}`)){const t=JSON.parse(localStorage.getItem(`filterStorage${this.project.id}+${this.taskViewTabName}`));this.showCompletedTasks=t.showCompletedTasks,this.tasksFilter={groupBy:t.groupBy,orderBy:t.orderBy,offset:0,limit:0,showCompletedTasks:t.showCompletedTasks}}else this.tasksFilter={groupBy:"",orderBy:"",offset:0,limit:0,showCompletedTasks:!1};this.getStatusByProject(this.project.id),this.tasksList=[],this.getTasksByProject(this.project.id,""),this.getAllProjectTasks(this.project.id)}},created(){this.$root.$on("task-added",(t=>{this.$tasksService.filterTasksList(this.tasksFilter,"","","",this.project.id).then((e=>{if(Array.isArray(e.tasks[0])){const s=e.tasks.findIndex((e=>e.findIndex((e=>e.id===t.id))>-1));this.$set(this.tasksList,s,e.tasks[s])}else{const s=e.tasks.findIndex((e=>e.id===t.id));this.tasksList.splice(s,0,e.tasks[s])}}))})),this.$root.$on("task-isCompleted-updated",(t=>{this.$tasksService.filterTasksList(this.tasksFilter,"","","",this.project.id).then((e=>{if(Array.isArray(e.tasks[0])){const s={query:this.tasksFilter.query,groupBy:this.tasksFilter.groupBy,orderBy:this.tasksFilter.orderBy,offset:0,limit:0,showCompletedTasks:!0};let a=-1;this.$tasksService.filterTasksList(s,"","","",this.project.id).then((s=>{a=s.tasks.findIndex((e=>e.findIndex((e=>e.id===t.id))>-1)),this.$set(this.tasksList,a,e.tasks[a])}))}else this.tasksList=e.tasks}))})),this.$root.$on("task-description-updated",(t=>{this.updateModifiedTask(t)})),this.$root.$on("task-assignee-coworker-updated",(t=>{this.updateModifiedTask(t)})),this.$root.$on("task-priority-updated",(t=>{this.updateModifiedTask(t)})),this.$root.$on("task-start-date-updated",(t=>{this.updateModifiedTask(t)})),this.$root.$on("task-due-date-updated",(t=>{this.updateModifiedTask(t)})),this.$root.$on("task-status-updated",(t=>{this.updateModifiedTask(t)})),this.$root.$on("deleteTask",(t=>{if(t&&t.detail){const e=t.detail;if(Array.isArray(this.tasksList[0])){const t=this.tasksList.findIndex((t=>t.findIndex((t=>t.id===e))>-1)),s=this.tasksList[t].filter((t=>t.id!==e));this.$set(this.tasksList,t,s)}else this.tasksList=this.tasksList.filter((t=>t.id!==e))}}))},methods:{hideProjectDetails(){this.$root.$emit("set-url",{type:"myProjects",id:""}),this.$root.$emit("close-quick-task-form"),document.dispatchEvent(new CustomEvent("hideProjectTasks")),this.taskViewTabName="board",this.$root.$emit("hide-tasks-project")},getChangeTabValue(t){this.taskViewTabName=t,this.getTasksByProject(this.project.id,""),"gantt"===t&&this.getAllProjectTasks(this.project.id)},getAllProjectTasks(t){return this.$tasksService.getTasksByProjectId(t).then((t=>{this.allProjectTasks=[],this.allProjectTasks=t||[],this.$root.$emit("gantt-displayed",this.allProjectTasks)}))},getStatusByProject(t){return this.$tasksService.getStatusesByProjectId(t).then((t=>{this.statusList=t}))},filterByKeyword(t,e){e&&this.getTasksByProject(this.project.id,t)},getTasksByProject(t,e){const s=this.taskViewTabName;if(this.tasksList=[],this.filterProjectActive=!1,this.groupName=null,localStorage.getItem(`filterStorage${t}+${s}`)){const a=JSON.parse(localStorage.getItem(`filterStorage${t}+${s}`));if(a.projectId&&a.projectId===t&&a.tabView&&a.tabView===s)return this.tasksFilter={query:e,groupBy:a.groupBy,orderBy:a.orderBy,offset:0,limit:0,showCompletedTasks:a.showCompletedTasks},this.getFilter(this.tasksFilter,t)}else this.getFilterProject(t,s).then((()=>{this.tasksFilter={query:e,groupBy:"",orderBy:"",offset:0,limit:0,showCompletedTasks:!1},"completed"===this.tasksFilter.groupBy&&(this.tasksFilter.showCompletedTasks=!0);const s={groupBy:this.tasksFilter.groupBy,orderBy:this.tasksFilter.orderBy,projectId:t,tabView:""!==this.taskViewTabName?this.taskViewTabName:"list",showCompletedTasks:this.showCompletedTasks};return localStorage.setItem(`filterStorage${t}+${s.tabView}`,JSON.stringify(s)),this.getFilter(this.tasksFilter,t)}))},resetFiltertaskDashboard(){this.getTasksByProject(this.project.id,""),this.filterByStatus=!1},filterTaskDashboard(t){return this.loadingTasks=!0,this.tasksFilter=t.tasks,this.showCompletedTasks=t.showCompletedTasks,this.tasksFilter.showCompletedTasks=t.showCompletedTasks,"completed"===this.tasksFilter.groupBy&&(this.tasksFilter.showCompletedTasks=!0),"none"===this.tasksFilter.groupBy&&(this.filterByStatus=!1),"status"===this.tasksFilter.groupBy?(this.tasksFilter.groupBy="",this.filterProjectActive=!1,this.filterByStatus=!0,this.$tasksService.filterTasksList(this.tasksFilter,"","",t.filterLabels.labels,this.project.id).then((t=>{this.filterProjectActive=!1,this.filterByStatus=!0,this.tasksList=t&&t.tasks||[]})).finally((()=>this.loadingTasks=!1))):(this.filterByStatus=!1,this.$tasksService.filterTasksList(t.tasks,"","",t.filterLabels.labels,this.project.id).then((t=>{t.projectName?(this.filterProjectActive=!0,this.tasksList=t&&t.tasks||[],this.groupName=t):(this.filterProjectActive=!1,this.tasksList=t&&t.tasks||[])})).finally((()=>this.loadingTasks=!1)))},getNameGroup:t=>"Unassigned"===t||""===t?"label.unassigned":"No Label"===t?"label.noLabel":"No due date"===t?"label.noDueDate":"Completed"===t?"label.task.completed":"Uncompleted"===t?"label.task.uncompleted":t,showDetailsTask(t){const e=document.querySelector(`#uiIconMiniArrowDown${t}`),s=document.querySelector(`#uiIconMiniArrowRight${t}`),a=document.querySelector(`#taskView${t}`);"none"!==a.style.display?(a.style.display="none",e.style.display="none",s.style.display="block"):(a.style.display="block",e.style.display="block",s.style.display="none")},deleteStatus(t){this.deleteConfirmMessage=`${this.$t("popup.msg.deleteStatus")} : ${t.name}? `,this.status=t,this.$refs.deleteConfirmDialog.open()},deleteConfirm(){return this.$statusService.deleteStatus(this.status.id).then((()=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.status.deleted")}),this.getStatusByProject(this.project.id)})).catch((t=>{console.error("Error when deleting status",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))},updateStatus(t){if(null!=t)return this.$statusService.updateStatus(t).then((()=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.status.update")}),this.getStatusByProject(this.project.id)})).then((()=>{this.getTasksByProject(this.project.id,"")})).catch((t=>{console.error("Error when updating status",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}));this.getStatusByProject(this.project.id),this.getTasksByProject(this.project.id,"")},createStatus(){return this.statusList.forEach((function(t,e){t.project||(t.project=this.project),t.rank=e}),this),this.$statusService.createStatus(this.statusList).then((()=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.status.created")}),this.getStatusByProject(this.project.id)})).catch((t=>{console.error("Error when creating status",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))},moveStatus(){return this.statusList.forEach((function(t,e){t.project||(t.project=this.project),t.rank=e}),this),this.$statusService.moveStatus(this.statusList).then((()=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.status.moved")}),this.getStatusByProject(this.project.id)})).catch((t=>{console.error("Error when moving status",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))},getFilter(t,e){"status"===t.groupBy?(t.groupBy="",this.filterProjectActive=!1,this.filterByStatus=!0,this.$tasksService.filterTasksList(this.tasksFilter,"","","",e).then((t=>{this.filterProjectActive=!1,this.tasksList=t&&t.tasks||[]})).finally((()=>this.loadingTasks=!1))):this.$tasksService.filterTasksList(this.tasksFilter,"","","",e).then((t=>{this.filterByStatus=!1,t.projectName?(this.filterProjectActive=!0,this.tasksList=t&&t.tasks||[],this.groupName=t):(this.filterProjectActive=!1,this.tasksList=t&&t.tasks||[])})).finally((()=>this.loadingTasks=!1))},getFilterProject(t,e){return this.$projectService.getFilterSettings(t,e).then((e=>{if(e&&e.value){const s=e.value;s.split('"')[10].split("}")[0].split(":")[1].split(",")[0]===t.toString()&&(this.tasksFilter.groupBy=s.split('"')[3].trim(),this.tasksFilter.orderBy=s.split('"')[7].trim())}else this.tasksFilter.groupBy="none",this.tasksFilter.orderBy=""}))},openTaskDrawer(){const t={id:null,status:{project:this.project},priority:"NONE",description:"",title:""};this.$root.$emit("open-task-drawer",t)},updateModifiedTask(t){this.$tasksService.filterTasksList(this.tasksFilter,"","","",this.project.id).then((e=>{if(Array.isArray(e.tasks[0]))if(e.tasks.length!==this.tasksList.length)this.getTasksByProject(this.project.id,""),"gantt"===this.taskViewTabName&&this.$tasksService.getTasksByProjectId(this.project.id).then((t=>{this.allProjectTasks=t||[],this.$root.$emit("refresh-gantt",this.allProjectTasks)}));else{const s=this.tasksList.findIndex((e=>e.findIndex((e=>e.id===t.id))>-1)),a=e.tasks.findIndex((e=>e.findIndex((e=>e.id===t.id))>-1));this.$set(this.tasksList,s,e.tasks[s]),this.$set(this.tasksList,a,e.tasks[a])}else{const s=this.tasksList.findIndex((e=>e.id===t.id)),a=e.tasks.findIndex((e=>e.id===t.id));this.tasksList.splice(s,1),this.tasksList.splice(a,0,e.tasks[a])}}))}}},ut,[],!1,null,null,null).exports;var pt=function(){var t=this,e=t._self._c;return e("v-app",[e("v-toolbar",{staticClass:"tasksToolbar",attrs:{id:"TasksDashboardToolbar",flat:""}},[e("div",{staticClass:"taskDisplay"},[e("v-tabs",{staticClass:"projectTasksViewTabs"},[e("v-tab",{staticClass:"taskTabBoard",attrs:{href:t.taskCardTabView},on:{change:function(e){return t.changeTaskViewTab("board")}}},[e("i",{staticClass:"uiIcon uiIconBoard"}),t._v(" "),e("span",[t._v(t._s(t.$t("label.boardView")))])]),t._v(" "),e("v-tab",{staticClass:"taskTabList",attrs:{href:t.taskListTabView},on:{change:function(e){return t.changeTaskViewTab("list")}}},[e("i",{staticClass:"uiIcon uiIconList"}),t._v(" "),e("span",[t._v(t._s(t.$t("label.listView")))])]),t._v(" "),e("v-tab",{staticClass:"taskTabGantt",attrs:{href:t.taskGanttTabView},on:{change:function(e){return t.changeTaskViewTab("gantt")}}},[e("i",{staticClass:"uiIcon uiIconGantt"}),t._v(" "),e("span",[t._v(t._s(t.$t("label.ganttView")))])])],1)],1),t._v(" "),e("v-spacer"),t._v(" "),e("v-scale-transition",["gantt"!=t.taskViewTabName?e("v-text-field",{staticClass:"inputTasksFilter pa-0 me-3 my-auto",attrs:{placeholder:t.$t("label.filterTask"),"prepend-inner-icon":"fa-filter",clearable:""},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}):t._e()],1),t._v(" "),e("v-scale-transition",[e("v-btn",{staticClass:"btn px-2 btn-primary filterTasksSetting",attrs:{outlined:""},on:{click:t.openDrawer}},[e("i",{staticClass:"uiIcon uiIconFilterSetting pe-3"}),t._v(" "),e("span",{staticClass:"d-none font-weight-regular caption d-sm-inline"},[t._v("\n          "+t._s(t.$t("label.filter"))+" "+t._s(t.getFilterNum())+"\n        ")])])],1)],1),t._v(" "),e("tasks-filter-drawer",{ref:"filterTasksDrawer",attrs:{project:t.project.id,query:t.keyword,"status-list":t.statusList,"task-view-tab-name":t.taskViewTabName,"show-completed-tasks":t.showCompletedTasks},on:{"filter-num-changed":t.filterNumChanged,"filter-task":t.filterTasks,"reset-filter-task":t.resetFilterTask}})],1)};pt._withStripped=!0;const kt=n({props:{project:{type:Object,default:null},statusList:{type:Array,default:()=>[]},taskCardTabView:{type:String,default:""},taskListTabView:{type:String,default:""},taskGanttTabView:{type:String,default:""},showCompletedTasks:{type:Boolean,default:!1}},data:()=>({keyword:null,awaitingSearch:!1,filterNumber:0,searchonkeyChange:!0,taskViewTabName:""}),watch:{keyword(){if(!this.awaitingSearch){const t=this.searchonkeyChange;setTimeout((()=>{this.$emit("keyword-changed",this.keyword,t),this.awaitingSearch=!1}),1e3)}this.awaitingSearch=!0,this.searchonkeyChange&&this.resetFields("query"),this.searchonkeyChange=!0}},created(){this.$root.$on("hide-tasks-project",(()=>{$("a.v-tab").removeClass("v-tab--active"),$("a.taskTabBoard").addClass("v-tab--active")}))},methods:{openDrawer(){this.$refs.filterTasksDrawer.open()},openTaskDrawer(){const t={id:null,status:{project:this.project},priority:"NONE",description:"",title:""};this.$root.$emit("open-task-drawer",t)},resetFilterTask(){this.searchonkeyChange=!1,this.keyword="",this.searchonkeyChange=!0,this.$emit("reset-filter-task-dashboard")},filterTasks(t){this.searchonkeyChange=!1,this.keyword=t.tasks.query,this.$emit("filter-task-dashboard",{tasks:t.tasks,filterLabels:t.filterLabels,showCompletedTasks:t.showCompletedTasks})},resetFields(t){this.$refs.filterTasksDrawer.resetFields(t)},filterNumChanged(t){this.filterNumber=t},getFilterNum(){return this.filterNumber>0?`(${this.filterNumber})`:""},changeTaskViewTab(t){$("a.v-tab").removeClass("v-tab--active"),"list"===t&&$("a.taskTabList").addClass("v-tab--active"),"board"===t&&$("a.taskTabBoard").addClass("v-tab--active"),"gantt"===t&&$("a.taskTabGantt").addClass("v-tab--active"),this.taskViewTabName=t,this.$emit("taskViewChangeTab",t)}}},pt,[],!1,null,null,null).exports;var mt=function(){var t=this,e=t._self._c;return e("v-card",{staticClass:"tasksView tasksViewBoard tasksCardsContainer",attrs:{flat:""}},[e("v-item-group",{staticClass:"pb-0 pt-5 px-0"},[e("v-container",{staticClass:"pa-0 mx-0"},[e("v-row",{staticClass:"ma-0 border-box-sizing tasksViewBoardRowContainer"},[t.project.canManage?e("div",[e("draggable",{staticClass:"d-flex",attrs:{move:t.checkMoveStatus,list:t.statusList,animation:200,"ghost-class":"ghost-card",options:{handle:".draggHandler"}},on:{start:function(e){t.dragStatus=!0},end:function(e){t.dragStatus=!1}}},t._l(t.statusList,(function(s,a){return e("v-col",{key:a,staticClass:"py-0 px-3 projectTaskItem",attrs:{id:s.id}},[e("tasks-view-board-column",{staticClass:"draggable-palceholder",attrs:{project:t.project,status:s,"tasks-list":t.getTasksByStatus(t.tasksList,s.name),index:a,"show-completed-tasks":t.showCompletedTasks,"status-list-length":t.statusList.length,"filter-no-active":t.filterNoActive},on:{updateTaskCompleted:t.updateTaskCompleted,updateTaskStatus:t.updateTaskStatus,"delete-status":t.deleteStatus,"update-status":t.updateStatus,"add-column":t.addColumn,"move-column":t.moveColumn,"cancel-add-column":t.cancelAddColumn,"create-status":t.createStatus}})],1)})),1)],1):e("div",{staticClass:"d-flex"},t._l(t.statusList,(function(s,a){return e("v-col",{key:a,staticClass:"py-0 px-3 projectTaskItem",attrs:{id:s.id}},[e("tasks-view-board-column",{attrs:{project:t.project,status:s,"tasks-list":t.getTasksByStatus(t.tasksList,s.name),index:a,"show-completed-tasks":t.showCompletedTasks,"status-list-length":t.statusList.length,"filter-no-active":t.filterNoActive},on:{updateTaskCompleted:t.updateTaskCompleted,updateTaskStatus:t.updateTaskStatus,"delete-status":t.deleteStatus,"update-status":t.updateStatus,"add-column":t.addColumn,"move-column":t.moveColumn,"cancel-add-column":t.cancelAddColumn,"create-status":t.createStatus}})],1)})),1)])],1)],1)],1)};mt._withStripped=!0;const gt=n({props:{statusList:{type:Array,default:()=>[]},tasksList:{type:Array,default:()=>[]},project:{type:Number,default:0},showCompletedTasks:{type:Boolean,default:!1},filterNoActive:{type:Boolean,default:!1}},data:()=>({indexItem:-1,dragStatus:!1,indexStatusFrom:0,indexStatusTo:0}),watch:{dragStatus(t){t||(this.$emit("move-status",this.indexStatusTo),Array.from(document.getElementsByClassName("draggable-palceholder")).forEach((t=>t.style.backgroundColor="#FFFFFF")))}},created(){this.$root.$on("update-task-project",(t=>{this.updateTaskProject(t)}))},methods:{updateTaskProject(t){this.tasksList=this.tasksList.filter((e=>e.id!==t.id))},checkMoveStatus(t){t&&(Array.from(document.getElementsByClassName("draggable-palceholder")).forEach((t=>t.style.backgroundColor="#FFFFFF")),Array.from(t.to.parentElement.getElementsByClassName("draggable-palceholder")).forEach((t=>t.style.backgroundColor="#f2f2f2")),this.indexStatusFrom=t.draggedContext.index,this.indexStatusTo=t.draggedContext.futureIndex)},getTasksByStatus(t,e){const s=[];return t.forEach((t=>{t.task&&t.task.status&&t.task.status.name===e&&s.push(t)})),s},updateTaskCompleted(t){this.showCompletedTasks||this.$root.$emit("update-task-completed",t)},updateTaskStatus(t,e){const s=this.statusList.find((t=>t.name==e));s&&(t.status=s,this.updateTask(t))},updateTask(t){null!=t.id&&this.$taskDrawerApi.updateTask(t.id,t).then((()=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.status")})})).catch((t=>{console.error("Error when updating task's status",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))},deleteStatus(t){this.$emit("delete-status",t),this.indexItem=-1},updateStatus(t){this.$emit("update-status",t),this.indexItem=-1},createStatus(){this.$emit("create-status"),this.indexItem=-1},addColumn(t){-1!==this.indexItem&&this.statusList.splice(this.indexItem,1);this.statusList.splice(t,0,{name:"",edit:!0}),this.indexItem=t},moveColumn(t,e){const s=this.statusList[t];this.statusList.splice(t,1),this.statusList.splice(e,0,s),this.$emit("move-status")},cancelAddColumn(t){this.statusList.splice(t,1)}}},mt,[],!1,null,null,null).exports;var vt=function(){var t=this,e=t._self._c;return e("v-app",{staticClass:"tasksList"},[e("v-card",{staticClass:"tasksView tasksListItem tasksViewList pt-5",attrs:{flat:""}},[e("v-item-group",[e("div",{staticClass:"ma-0 border-box-sizing"},[t.filterByStatus?e("div",t._l(t.statusList,(function(s,a){return e("div",{key:a,staticClass:"pt-5 px-3 projectTaskItem"},[e("tasks-view-list-column",{attrs:{status:s,project:t.project,"tasks-list":t.getTasksByStatus(t.tasksList,s.name),"show-completed-tasks":t.showCompletedTasks,"filter-by-status":t.filterByStatus},on:{updateTaskStatus:t.updateTaskStatus}})],1)})),0):e("div",{staticClass:"pt-0 px-3 projectTaskItem"},[e("tasks-view-list-column",{attrs:{"tasks-list":t.tasksList,"show-completed-tasks":t.showCompletedTasks,"filter-by-status":t.filterByStatus},on:{updateTaskStatus:t.updateTaskStatus}})],1)])])],1)],1)};vt._withStripped=!0;const ft=n({props:{statusList:{type:Array,default:()=>[]},tasksList:{type:Array,default:()=>[]},showCompletedTasks:{type:Boolean,default:!1},project:{type:Number,default:0},filterByStatus:{type:Boolean,default:!1}},data:()=>({tasksStatsStartValue:0}),created(){this.$root.$on("update-task-project",(t=>{this.updateTaskProject(t)}))},methods:{updateTaskProject(t){this.tasksList=this.tasksList.filter((e=>e.id!==t.id))},getTasksByStatus(t,e){const s=[];return t.forEach((t=>{t&&t.task&&t.task.status&&t.task.status.name===e&&s.push(t)})),s},updateTaskStatus(t,e){const s=this.statusList.find((t=>t.id.toString()===e||t.name===e));s&&(t.status=s,this.updateTask(t))},updateTask(t){null!=t.id&&this.$taskDrawerApi.updateTask(t.id,t).then((()=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.status")})})).catch((t=>{console.error("Error when updating task's status",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))}}},vt,[],!1,null,null,null).exports;var wt=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:t.status.id}},[!0===t.filterByStatus?e("div",[e("tasks-view-header-status",{attrs:{status:t.status,project:t.project,"view-type":"list","max-tasks-to-show":t.maxTasksToShow,"tasks-number":t.tasksList.length}})],1):t._e(),t._v(" "),e("div",{class:!0===t.filterByStatus?"pt-5 ms-7 me-2":"",attrs:{id:"taskView"+t.status.id}},[e("div",{attrs:{id:t.status.id}},[e("draggable",{key:t.draggableKey,staticClass:"draggable-palceholder",attrs:{move:t.checkMove,animation:200,"ghost-class":"ghost-card",options:{group:"status"}},on:{start:function(e){t.drag=!0},end:function(e){t.drag=!1}},model:{value:t.tasksList,callback:function(e){t.tasksList=e},expression:"tasksList"}},t._l(t.tasksList,(function(s){return e("task-view-list-item",{key:s.task.id,attrs:{task:s,"show-completed-tasks":t.showCompletedTasks},on:{"update-task-completed":t.updateTaskCompleted}})})),1)],1)])])};wt._withStripped=!0;const yt=n({props:{tasksList:{type:Array,default:()=>[]},status:{type:String,default:""},showCompletedTasks:{type:Boolean,default:!1},project:{type:Number,default:0},filterByStatus:{type:Boolean,default:!1}},data:()=>({maxTasksToShow:6,drag:!1,task:null,newStatus:null,draggableKey:1}),watch:{drag(t){!t&&this.task&&this.newStatus&&this.task.status.id.toString()!==this.newStatus&&(this.$emit("updateTaskStatus",this.task,this.newStatus),Array.from(document.getElementsByClassName("draggable-palceholder")).forEach((t=>t.style.backgroundColor="#FFFFFF")))}},methods:{updateTaskCompleted(t){!this.showCompletedTasks&&t.completed&&setTimeout((()=>{this.$root.$emit("task-isCompleted-updated",t)}),500)},checkMove(t){t&&(Array.from(document.getElementsByClassName("draggable-palceholder")).forEach((t=>t.style.backgroundColor="#FFFFFF")),Array.from(t.to.parentElement.getElementsByClassName("draggable-palceholder")).forEach((t=>t.style.backgroundColor="#f2f2f2")),this.task=t.draggedContext.element.task,this.newStatus=t.to.parentElement.id)},reRenderTasks(){this.draggableKey+=1}}},wt,[],!1,null,null,null).exports;var Tt=function(){var t=this,e=t._self._c;return t.hideGantt?e("div",[e("div",{staticClass:"noTasksProject"},[t._m(0),t._v(" "),e("div",{staticClass:"noTasksProjectLabel"},[e("span",[t._v(t._s(t.$t("label.noTasks")))])]),t._v(" "),e("div",{staticClass:"addunscheduledTask"},[e("v-btn",{attrs:{text:""},on:{click:function(e){return t.$root.$emit("displayTasksUnscheduledDrawer",t.unscheduledTaskList)}}},[t._v("\n        "+t._s(t.$t("Unscheduled Tasks"))+"\n      ")])],1)])]):e("div",{staticClass:"gantt-wrapper"},[e("div",{staticClass:"unscheduled-task-container"},[e("v-btn",{staticClass:"unscheduled-task-btn",attrs:{title:t.$t("label.noWorkPlan.tasks"),fab:"",small:"",dark:""},on:{click:function(e){return t.$root.$emit("displayTasksUnscheduledDrawer",t.unscheduledTaskList)}}},[e("v-icon",[t._v("mdi-calendar-range")]),t._v(" "),e("span",{staticClass:"unscheduled-task-badge"},[t._v(t._s(t.unscheduledTaskList.length))])],1)],1),t._v(" "),e("div",{staticClass:"gantt-chart-container",attrs:{id:"gantt-chart"}})])};Tt._withStripped=!0;const bt=n({props:{tasksList:{type:Array,default:()=>[]}},data:()=>({gantt:"",lang:eXo&&eXo.env.portal.language||"en",fullDateFormat:{year:"numeric",month:"numeric",day:"numeric"},tasksToDisplay:[],tasks:[],isGanttDisplayed:!1,ganttScale:"Week",unscheduledTaskList:[],ganttItems:[]}),computed:{ganttTasks(){return this.ganttItems.length},hideGantt(){return this.tasksList&&0===this.tasksList.length||0===this.ganttTasks}},watch:{tasksList(){this.ganttItems=this.getTasksToDisplay(this.tasksList)}},created(){this.$root.$on("update-task-project",(t=>{this.updateTaskProject(t)})),this.$root.$on("hide-tasks-project",(()=>{this.isGanttDisplayed=!1,$("#gantt-chart").empty()})),this.$root.$on("gantt-displayed",(t=>{this.unscheduledTaskList=[],this.isGanttDisplayed=!1,$("#gantt-chart").empty(),t&&t.length&&(this.tasks=t,this.tasksToDisplay=this.getTasksToDisplay(this.tasks),!1===this.isGanttDisplayed&&this.ganttItems.length&&this.initGanttChart(this.tasksToDisplay))})),this.$root.$on("refresh-gantt",(t=>{this.unscheduledTaskList=[];const e=this.getTasksToDisplay(t);this.tasksToDisplay&&this.tasksToDisplay.length&&e.length>this.tasksToDisplay.length&&(this.tasksToDisplay.push(e[e.length-1]),this.gantt&&this.gantt.refresh(this.tasksToDisplay)),this.$root.$emit("refresh-unscheduled-gantt",this.unscheduledTaskList)})),this.$root.$on("task-updated",(t=>{this.unscheduledTaskList=[],this.tasks.forEach(((e,s)=>{e.id===t.id&&(this.tasks[s].task=t)})),this.tasksToDisplay=this.getTasksToDisplay(this.tasks),this.$root.$emit("refresh-unscheduled-gantt",this.unscheduledTaskList),this.ganttTasks>0&&this.$nextTick().then((()=>{this.gantt&&this.gantt.refresh(this.tasksToDisplay)}))}))},mounted(){this.$root.$on("scale-value-changed",(t=>{this.gantt.change_view_mode(t),this.ganttScale=t}))},methods:{updateTaskProject(t){this.tasksList=this.tasksList.filter((e=>e.id!==t.id))},getTasksToDisplay(t){const e=[];return this.unscheduledTaskList=[],t&&t.length&&t.forEach((t=>{const s={id:"",name:"",start:"",end:"",custom_class:"",progress:""};s.id=`Task-${t.task.id}`,s.name=t.task.title,null!=t.task.startDate?(s.start=this.dateFormat(t.task.startDate.time),null===t.task.dueDate?s.end=this.dateFormat(t.task.startDate.time):s.end=this.dateFormat(t.task.dueDate.time)):null!=t.task.dueDate&&(s.start=this.dateFormat(t.task.dueDate.time),s.end=this.dateFormat(t.task.dueDate.time)),s.custom_class=`bar_${t.task.priority}`,null!=t.task.startDate||null!=t.task.dueDate?(s.progress=100,e.push(s)):this.unscheduledTaskList.push(t)})),e},dateFormat(t){const e=new Date(t);return`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`},openTaskDraweryId(t){this.$tasksService.getTaskById(t).then((t=>{this.task=t,this.$root.$emit("open-task-drawer",this.task)}))},updatedTaskDueDate(t,e,s){this.$tasksService.getTaskById(t).then((t=>{if(this.task=t,null!=this.task.id){const t=this.toDateObject(e),a=this.toDateObject(s);this.task.startDate=t,this.task.dueDate=a,this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.date")})})).catch((t=>{console.error("Error when updating task's date",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))}}))},toDate:t=>t?"number"==typeof t?new Date(t):"string"==typeof t?(10===t.indexOf("T")&&t.length>19&&(t=t.substring(0,19)),new Date(t)):"object"==typeof t?new Date(t):void 0:null,toDateObject(t){if(t=this.toDate(t)){const e={time:"",nanos:0,year:"",month:"",day:"",hours:"",minutes:"",seconds:"",timezoneOffset:"",date:""};return e.time=t.getTime(),e.year=t.getUTCFullYear()-1900,e.month=t.getMonth(),e.day=t.getDay(),e.hours=t.getHours(),e.minutes=t.getMinutes(),e.seconds=t.getSeconds(),e.timezoneOffset=t.getTimezoneOffset(),e.date=t.getDate(),e}return null},addScrollToDateArea(){const t=$(".gantt-dates");$(".gantt-grid").scroll((function(){t.prop("scrollLeft",this.scrollLeft)}))},getTaskAssigneeAndCoworkers(t){const e=[];return t.assignee&&!e.includes(t.assignee)&&e.push(t.assignee),(t.coworker||t.coworker.length>0)&&t.coworker.forEach((t=>{t&&!e.includes(t)&&e.push(t)})),e},avatarToDisplay(t){const e=this.getTaskAssigneeAndCoworkers(t);return e.length>1?e.slice(0,2):e},popupTaskDates(t,e){return`<span class="popup-date">${this.$t("label.from")}</span> ${t.split("-").reverse().join("-")} <span class="popup-date">${this.$t("label.to")}</span> ${e.split("-").reverse().join("-")}`},initGanttChart(t){$("#gantt-chart").append('<svg id="gantt"></svg>');const e=this;this.gantt=new Gantt("#gantt",t,{bar_height:18,padding:20,bar_corner_radius:5,language:this.lang,custom_popup_html:function(t){const s=parseInt(t.id.split("-")[1]),a=e.tasks.find((t=>t.id===s)),i=e.avatarToDisplay(a);let r="";return i.length&&i.forEach((t=>{r+=`<a class="assigneeAvatar" style="background-image:url(${t.avatar})"></a>`})),`<div class="popup-container ${t.custom_class}">\n                <p class="popup-title">${t.name}</p>\n                <div class="d-flex justify-space-between align-center">\n                <div class="avatarToDisplay"> ${r}</div>\n                <div class="taskDates"> ${e.popupTaskDates(t.start,t.end)} </div>\n                </div>\n              </div>`},on_click:function(t){const s=t.id.split("-")[1];s&&e.openTaskDraweryId(s),$(".popup-wrapper").css("opacity","0")},on_date_change:function(t,s,a){const i=t.id.split("-")[1];i&&e.updatedTaskDueDate(i,s,a)}}),this.gantt.change_view_mode(this.ganttScale),this.isGanttDisplayed=!0,this.addScrollToDateArea()}}},Tt,[function(){var t=this._self._c;return t("div",{staticClass:"noTasksProjectIcon"},[t("i",{staticClass:"uiIcon uiIconTask"})])}],!1,null,null,null).exports;var $t=function(){var t=this,e=t._self._c;return e("div",{staticClass:"tasksViewHeader d-flex justify-space-between align-center",attrs:{id:"task-"+t.viewType+"-"+t.status.id}},[e("div",{staticClass:"d-flex tasksViewHeaderLeft"},["list"===t.viewType?e("a",{staticClass:"toggle-collapse-group d-flex",attrs:{href:"#"},on:{click:function(e){return t.showDetailsTask(t.viewType,t.status.id)}}},[e("i",{staticClass:"uiIcon uiIconMiniArrowDown",staticStyle:{display:"block"},attrs:{id:"uiIconMiniArrowDown"+t.viewType+t.status.id}}),t._v(" "),e("i",{staticClass:"uiIcon uiIconMiniArrowRight",staticStyle:{display:"none"},attrs:{id:"uiIconMiniArrowRight"+t.viewType+t.status.id}})]):t._e(),t._v(" "),(t.editStatus||t.status.edit)&&t.project.canManage?e("div",[t.editStatus||t.status.edit?e("v-text-field",{ref:"autoFocusInput1",staticClass:"taskStatusNameEdit font-weight-bold text-color mb-1",attrs:{placeholder:t.$t("label.tapStatus.name"),type:"text",rules:t.nameRules,required:"",autofocus:"",outlined:"",dense:""},on:{focus:function(e){return t.editStatusMode(t.project.canManage)},blur:function(e){return t.cancelAddColumn(t.status.name)},keyup:function(e){return t.checkInput(e,t.index)}},model:{value:t.status.name,callback:function(e){t.$set(t.status,"name",e)},expression:"status.name"}},[e("i",{staticClass:"uiIcon40x40TickBlue ma-1",attrs:{slot:"append",dark:""},on:{click:function(e){return t.checkInput(13,t.status.name)}},slot:"append"}),t._v(" "),e("i",{staticClass:"uiIconClose ma-1",attrs:{slot:"append",dark:""},on:{click:function(e){return t.cancelAddColumn(t.status.name)}},slot:"append"})]):t._e()],1):e("div",{staticClass:"d-flex taskStatusName font-weight-bold text-color mb-1",on:{click:function(e){return t.editStatusMode(t.project.canManage)}}},[e("div",{staticClass:"statusName text-truncate",attrs:{title:t.getI18N(t.status.name)}},[t._v("\n        "+t._s(t.getI18N(t.status.name))+"\n      ")]),t._v(" "),e("div",{staticClass:"uiTaskNumber"},[t._v(t._s(t.tasksNumber))])])]),t._v(" "),e("div",{staticClass:"taskNumberAndActions d-flex align-center mb-1",on:{click:function(e){t.editStatus=!1}}},[e("i",{staticClass:"uiIconSocSimplePlus d-flex",attrs:{icon:"",small:"",title:this.$t("label.addTask")},on:{click:function(e){return t.openTaskDrawer()}}}),t._v(" "),t.project.canManage?e("i",{staticClass:"uiIconVerticalDots taskInfoIcon d-flex",attrs:{icon:"",small:""},on:{click:function(e){t.displayActionMenu=!0}}}):t._e(),t._v(" "),t.project.canManage?e("v-menu",{attrs:{attach:`#task-${t.viewType}-${t.status.id}`,transition:"slide-x-reverse-transition","content-class":"taskStatusActionMenu","offset-y":""},model:{value:t.displayActionMenu,callback:function(e){t.displayActionMenu=e},expression:"displayActionMenu"}},[e("v-list",{staticClass:"pa-0",attrs:{dense:""}},[t.index>0?e("v-list-item",{staticClass:"menu-list",on:{click:function(e){return t.moveBeforeColumn(t.index)}}},[e("v-list-item-title",{staticClass:"subtitle-2"},[e("i",{staticClass:"uiIcon uiIconArrowLeft pe-1"}),t._v(" "),e("span",[t._v(t._s(t.$t("label.status.move.before")))])])],1):t._e(),t._v(" "),e("v-list-item",{staticClass:"menu-list",on:{click:function(e){return t.addColumn(t.index)}}},[e("v-list-item-title",{staticClass:"subtitle-2"},[e("i",{staticClass:"uiIcon uiIconRotateLeft pe-1"}),t._v(" "),e("span",[t._v(t._s(t.$t("label.status.before")))])])],1),t._v(" "),e("v-list-item",{staticClass:"menu-list",on:{click:function(e){return t.addColumn(t.index+1)}}},[e("v-list-item-title",{staticClass:"subtitle-2"},[e("i",{staticClass:"uiIcon uiIconRotateRight pe-1"}),t._v(" "),e("span",[t._v(" "+t._s(t.$t("label.status.after"))+" ")])])],1),t._v(" "),t.index<t.statusListLength-1?e("v-list-item",{staticClass:"menu-list",on:{click:function(e){return t.moveAfterColumn(t.index)}}},[e("v-list-item-title",{staticClass:"subtitle-2"},[e("i",{staticClass:"uiIcon uiIconArrowRight pe-1"}),t._v(" "),e("span",[t._v(" "+t._s(t.$t("label.status.move.after")))])])],1):t._e(),t._v(" "),e("v-list-item",{staticClass:"menu-list",on:{click:function(e){return t.deleteStatus()}}},[e("v-list-item-title",{staticClass:"subtitle-2"},[e("i",{staticClass:"uiIcon uiIconDelete pe-1"}),t._v(" "),e("span",[t._v(t._s(t.$t("label.delete")))])])],1)],1)],1):t._e()],1)])};$t._withStripped=!0;const Ct=n({props:{status:{type:Object,default:null},viewType:{type:String,default:""},tasksNumber:{type:Number,default:0},maxTasksToShow:{type:Number,default:0},index:{type:Number,default:0},statusListLength:{type:Number,default:0},project:{type:Number,default:0}},data(){return{displayActionMenu:!1,editStatus:!1,tasksStatsStartValue:1,originalTasksToShow:this.maxTasksToShow,disableBtnLoadMore:!1,rules:[],nameRules:[]}},computed:{initialTasksToShow(){return this.originalTasksToShow},limitTasksToshow(){return this.tasksStatsStartValue},limitStatusLabel(){return this.$t("label.status.name.rules")}},created(){$(document).on("mousedown",(()=>{this.displayActionMenu&&window.setTimeout((()=>{this.displayActionMenu=!1}),200)})),this.nameRules=[t=>!t||t.length>2&&t.length<51||this.limitStatusLabel]},methods:{loadNextTasks(){this.tasksNumber-this.originalTasksToShow>=this.maxTasksToShow?(this.tasksStatsStartValue=this.originalTasksToShow+1,this.originalTasksToShow+=this.maxTasksToShow):(this.tasksStatsStartValue=this.originalTasksToShow,this.originalTasksToShow=this.tasksNumber,this.disableBtnLoadMore=!0)},openTaskDrawer(){const t={id:null,status:this.status,priority:"NONE",description:"",title:""};this.$root.$emit("open-task-drawer",t)},checkInput:function(t,e){13!==t.keyCode&&13!==t||this.saveStatus(e),27===t.keyCode&&this.cancelAddColumn(e)},deleteStatus(){this.$emit("delete-status",this.status)},saveStatus(t){this.status.name.length>=3&&this.status.name.length<=50&&(this.status.id?(this.$emit("update-status",this.status),this.editStatus=!1):(this.status.rank=t,this.$emit("add-status"),this.editStatus=!1))},openQuickAdd(){this.$emit("open-quick-add")},addColumn(t){this.$emit("add-column",t)},moveBeforeColumn(t){this.$emit("move-column",t,t-1)},moveAfterColumn(t){this.$emit("move-column",t,t+1)},cancelAddColumn(t){this.status.id?(this.editStatus=!1,this.status.edit=!1,this.$emit("update-status",null)):(this.editStatus=!1,this.status.edit=!1,this.$emit("cancel-add-column",t),this.$emit("update-status",null))},editStatusMode(t){t&&(this.editStatus=!0)},getI18N(t){const e=`tasks.status.${t}`,s=this.$t(e);return s===e?t:s},showDetailsTask(t,e){const s=document.querySelector(`#uiIconMiniArrowDown${t}${e}`),a=document.querySelector(`#uiIconMiniArrowRight${t}${e}`),i=document.querySelector(`#taskView${e}`);"none"!==i.style.display?(i.style.display="none",s.style.display="none",a.style.display="block"):(i.style.display="block",s.style.display="block",a.style.display="none")}}},$t,[],!1,null,null,null).exports;var _t=function(){var t=this,e=t._self._c;return e("v-app",{staticClass:"taskBoardCardItem",class:t.removeCompletedTask?"completedTask":"",attrs:{id:"taskCardItem"}},[e("v-hover",{scopedSlots:t._u([{key:"default",fn:function({hover:s}){return[e("v-card",{staticClass:"taskCard taskViewCard pa-2",class:[t.taskPriorityColor],attrs:{elevation:s&&!t.isMobile?4:0,flat:""}},[e("div",{staticClass:"taskTitleId d-flex justify-space-between"},[e("div",{staticClass:"taskCheckBox"},[e("v-switch",{ref:"autoFocusInput2",staticClass:"d-none",attrs:{"true-value":"true","false-value":"false"}}),t._v(" "),e("i",{class:t.taskCompletedClass,attrs:{title:t.$t(t.taskCompletedTitle)},on:{click:t.updateCompleted}})],1),t._v(" "),e("div",{staticClass:"taskTitle d-flex align-start",on:{click:function(e){return t.openTaskDrawer()}}},[e("a",{ref:"tooltip",staticClass:"taskCardViewTitle",class:t.getTitleTaskClass(),attrs:{title:t.task.task.title}},[e("span",{staticClass:"taskTitleEllipsis"},[t._v(t._s(t.task.task.title))])])])]),t._v(" "),t.displayCardBottomSection?e("v-divider"):t._e(),t._v(" "),t.displayCardBottomSection?e("div",{staticClass:"taskActionsAndDate d-flex align-center justify-space-between"},[e("div",{staticClass:"taskActionsAndLabels d-flex align-center"},[t.assigneeAndCoworkerArray&&t.assigneeAndCoworkerArray.length?e("div",{staticClass:"taskWorker justify-space-between pe-2"},[e("div",{staticClass:"taskAssignee d-flex flex-nowrap position-relative",class:t.assigneeAndCoworkerArray&&!t.assigneeAndCoworkerArray.length&&t.task&&t.task.labels&&!t.task.labels.length&&"hideTaskAssignee"},[e("exo-user-avatars-list",{attrs:{users:t.avatarToDisplay,max:1,"icon-size":26,"retrieve-extra-information":"","avatar-overlay-position":""},on:{"open-detail":function(e){return t.$root.$emit("displayTasksAssigneeAndCoworker",t.avatarToDisplay)}}})],1)]):t._e(),t._v(" "),t.task.commentCount?e("div",{staticClass:"taskComment d-flex pe-2",on:{click:function(e){return t.openTaskDrawer()}}},[e("i",{staticClass:"uiIcon uiCommentIcon"}),t._v(" "),e("span",{staticClass:"taskCommentNumber caption"},[t._v(t._s(t.task.commentCount))])]):t._e(),t._v(" "),t.task.labels&&t.task.labels.length?e("div",{class:t.getClassLabels(),on:{click:function(e){return t.openTaskDrawer()}}},[t.task.labels&&1==t.task.labels.length?e("v-chip",{staticClass:"mx-1 font-weight-bold theme--light",attrs:{color:t.task.labels[0].color,title:t.task.labels[0].name,label:"",small:""}},[e("span",{staticClass:"text-truncate"},[t._v("\n                "+t._s(t.task.labels[0].name)+"\n              ")])]):t.task.labels&&t.task.labels.length>1?e("div",{staticClass:"taskTags d-flex theme--light",attrs:{title:t.getLabelsList(t.task.labels)}},[e("i",{staticClass:"uiIcon uiTagIcon"}),t._v(" "),e("span",{staticClass:"taskAttachNumber caption"},[t._v(t._s(t.task.labels.length))])]):t._e()],1):t._e()]),t._v(" "),t.taskDueDate?e("div",{staticClass:"taskStatusAndDate",on:{click:function(e){return t.openTaskDrawer()}}},[e("div",{staticClass:"taskDueDate",class:t.getOverdueTask(t.taskDueDate)?"red--text":""},[e("div",[e("date-format",{attrs:{value:t.taskDueDate,format:t.dateTimeFormat}})],1)])]):t._e()]):t._e()],1)]}}])})],1)};_t._withStripped=!0;const jt=n({props:{task:{type:Object,default:()=>({})},showCompletedTasks:{type:Boolean,default:!1}},data(){return{user:{},dateTimeFormat:{year:"numeric",month:"numeric",day:"numeric"},assigneeAndCoworkerArray:[],isPersonnalTask:null===this.task.task.status,drawer:null}},computed:{taskDueDate(){if(this.task?.task?.dueDate?.time){const t=`${this.task.task.dueDate.year+1900}/${this.task.task.dueDate.month+1}/${this.task.task.dueDate.date}`;return new Date(t)}return null},avatarToDisplay(){const t=[];return this.assigneeAndCoworkerArray&&this.assigneeAndCoworkerArray.length&&this.assigneeAndCoworkerArray.forEach((e=>{t.includes({userName:e.username})||t.push({userName:e.username})})),t},displayCardBottomSection(){return this.taskDueDate||this.task.labels&&this.task.labels.length||this.assigneeAndCoworkerArray&&this.assigneeAndCoworkerArray.length||this.task.commentCount},taskCompletedClass(){return!0===this.task.task.completed?"uiIconValidate":"uiIconCircle"},taskCompletedTitle(){return!0===this.task.task.completed?"message.markAsUnCompleted":"message.markAsCompleted"},taskPriorityColor(){switch(this.task.task.priority){case"HIGH":return"taskHighPriority";case"NORMAL":return"taskNormalPriority";case"LOW":return"taskLowPriority";default:return"taskNonePriority"}},removeCompletedTask(){return!0===this.task.task.completed&&!this.showCompletedTasks},isMobile(){return this.$vuetify.breakpoint.mdAndDown}},watch:{"task.assignee"(){this.getTaskAssigneeAndCoworkers()},"task.coworker"(){this.getTaskAssigneeAndCoworkers()}},created(){this.$root.$on("task-updated",(t=>{this.task?.task?.id===t?.id&&(this.task.task=t)})),this.$root.$on("update-completed-task",((t,e)=>{this.task.id===e&&(this.task.task.completed=t,!0!==this.task.task.completed||this.showCompletedTasks||this.$emit("update-task-completed",this.task.task))})),this.$root.$on("update-task-assignee",((t,e)=>{this.updateTaskAssignee(t,e)})),this.$root.$on("update-remove-task-labels",((t,e)=>{this.updateRemoveTaskLabels(t,e)})),this.$root.$on("update-task-labels",((t,e)=>{this.updateTaskLabels(t,e)})),this.$root.$on("update-task-comments",((t,e)=>{this.updateTaskComments(t,e)})),this.$root.$on("update-task-coworker",((t,e)=>{this.updateTaskCoworker(t,e)})),this.getTaskAssigneeAndCoworkers()},methods:{updateRemoveTaskLabels(t,e){this.task.id===e&&(this.task.labels=this.task.labels.filter((e=>e.id!==t)))},updateTaskLabels(t,e){this.task.id===e&&this.task.labels.push(t)},updateTaskComments(t,e){this.task.id===e&&(this.task.commentCount=t)},updateTaskCoworker(t,e){const s=t.coworker;this.task.id===e&&(s&&s.length?(this.task.coworker=[],s.forEach((t=>{this.$identityService.getIdentityByProviderIdAndRemoteId("organization",t).then((t=>{const e={id:`organization:${t.remoteId}`,username:t.remoteId,providerId:"organization",displayName:t.profile.fullname,avatar:t.profile.avatar};e&&!this.task.coworker.includes(e)&&this.task.coworker.push(e)}))}))):this.task.coworker=[],this.$root.$emit("task-assignee-coworker-updated",this.task))},updateTaskAssignee(t,e){this.task.id===e&&(null===t?this.task.assignee=null:this.$identityService.getIdentityByProviderIdAndRemoteId("organization",t).then((t=>{this.task.assignee={id:`organization:${t.remoteId}`,username:t.remoteId,providerId:"organization",displayName:t.profile.fullname,avatar:t.profile.avatar}})),this.$root.$emit("task-assignee-coworker-updated",this.task))},getTaskAssigneeAndCoworkers(){this.assigneeAndCoworkerArray=[],this.task.assignee&&!this.assigneeAndCoworkerArray.includes(this.task.assignee)&&this.assigneeAndCoworkerArray.push(this.task.assignee),(this.task.coworker||this.task.coworker.length>0)&&this.task.coworker.forEach((t=>{t&&!this.assigneeAndCoworkerArray.includes(t)&&this.assigneeAndCoworkerArray.push(t)}))},getLabelsList(t){if(t.length>1){let e="";return t.forEach((t=>{e+=`${t.name}\r\n`})),e}},getAssigneeAndCoworkerList(t){if(t.length>1){let e="";return t.forEach((t=>{e+=`${t.displayName}\r\n`})),e}},openTaskDrawer(){this.$root.$emit("open-task-drawer",this.task.task)},onCloseDrawer:function(t){this.drawer=t},updateCompleted(){const t={id:this.task.task.id,isCompleted:!this.task.task.completed};if(t.id)return this.$tasksService.updateCompleted(t).then((e=>{e.completed?this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.completed")}):this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.unCompleted")}),this.$emit("update-task-completed",e),this.task.task.completed=t.isCompleted})).catch((t=>{console.error("Error updating project",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")}),this.postProject=!1}))},getTitleTaskClass(){return!0===this.task.task.completed?"text-color strikethrough":"text-color"},dateFormatter(t){if(t){const e=new Date(t),s=e.getDate(),a=e.getMonth()+1;return`${e.getFullYear()}-${a}-${s}`}},getOverdueTask(t){const e=new Date,s=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`;return this.dateFormatter(t)!==s&&new Date(t)<(new Date).getTime()},getClassLabels(){if(this.task&&this.task.labels&&1===this.task.labels.length)return this.assigneeAndCoworkerArray&&this.assigneeAndCoworkerArray.length&&this.task.commentCount?"taskLabelsAssigneeComment":this.assigneeAndCoworkerArray&&this.assigneeAndCoworkerArray.length&&!this.task.commentCount||!this.assigneeAndCoworkerArray&&!this.assigneeAndCoworkerArray.length&&this.task.commentCount?"taskLabelsAssignee":"taskLabels"}}},_t,[],!1,null,null,null).exports;var Dt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"taskListItemView px-4 py-3 d-flex align-center",class:[t.getTaskPriorityColor(t.task.task.priority),t.removeCompletedTask?"completedTask":""]},[e("div",{staticClass:"taskCheckBox"},[e("v-switch",{ref:"autoFocusInput2",staticClass:"d-none",attrs:{"true-value":"true","false-value":"false"}}),t._v(" "),e("i",{class:t.getTaskCompleted(),attrs:{title:t.$t(t.getTaskCompletedTitle())},on:{click:t.updateCompleted}})],1),t._v(" "),e("div",{staticClass:"taskTitle pe-10"},[e("a",{ref:"tooltip",staticClass:"text-truncate",class:t.getTitleTaskClass(),attrs:{title:t.task.task.title},on:{click:function(e){return t.openTaskDrawer()}}},[t._v(t._s(t.task.task.title)+"\n    ")])]),t._v(" "),e("div",{staticClass:"taskAssignee d-flex v-avatar flex-nowrap pe-7 justify-start"},[e("exo-user-avatars-list",{attrs:{users:t.avatarToDisplay,max:1,"icon-size":26,"avatar-overlay-position":"","retrieve-extra-information":""},on:{"open-detail":function(e){return t.$root.$emit("displayTasksAssigneeAndCoworker",t.avatarToDisplay)}}})],1),t._v(" "),e("div",{staticClass:"taskLabels pe-7",on:{click:function(e){return t.openTaskDrawer()}}},[t.task.labels&&1==t.task.labels.length?e("v-chip",{staticClass:"mx-1 font-weight-bold",attrs:{color:t.task.labels[0].color,title:t.task.labels[0].name,label:"",small:""}},[e("span",{staticClass:"text-truncate"},[t._v("\n        "+t._s(t.task.labels[0].name)+"\n      ")])]):t.task.labels&&t.task.labels.length>1?e("div",{staticClass:"taskTags d-flex justify-center",attrs:{title:t.getLabelsList(t.task.labels)}},[e("i",{staticClass:"uiIcon uiTagIcon"}),t._v(" "),e("span",{staticClass:"taskAttachNumber caption"},[t._v(t._s(t.task.labels.length))])]):t._e()],1),t._v(" "),e("div",{staticClass:"taskActions d-flex justify-center align-center pe-9",on:{click:function(e){return t.openTaskDrawer()}}},[t.task.commentCount?e("div",{staticClass:"taskComment d-flex"},[e("i",{staticClass:"uiIcon uiCommentIcon"}),t._v(" "),e("span",{staticClass:"taskCommentNumber caption"},[t._v(t._s(t.task.commentCount))])]):t._e()]),t._v(" "),e("div",{staticClass:"taskStat d-lg-block d-md-none pe-9",on:{click:function(e){return t.openTaskDrawer()}}},[t.task&&t.task.task&&t.task.task.status&&t.task.task.status?e("span",{staticClass:"taskStatLabel ps-2",attrs:{title:t.getTaskStatusLabel(t.task.task.status.name)}},[t._v("\n      "+t._s(t.getTaskStatusLabel(t.task.task.status.name))+"\n    ")]):t._e()]),t._v(" "),e("div",{staticClass:"taskDueDate",on:{click:function(e){return t.openTaskDrawer()}}},[t.taskDueDate?e("div",{class:t.getOverdueTask(t.taskDueDate)?"red--text":""},[e("date-format",{attrs:{value:t.taskDueDate,format:t.dateTimeFormat}})],1):t._e()])])};Dt._withStripped=!0;const St=n({props:{task:{type:Object,default:null},showCompletedTasks:{type:Boolean,default:!1}},data(){return{enabled:!1,dateTimeFormat:{year:"numeric",month:"numeric",day:"numeric"},assigneeAndCoworkerArray:[],isPersonnalTask:null===this.task.task.status,labelList:""}},computed:{taskDueDate(){return this.task&&this.task.task.dueDate&&this.task.task.dueDate.time},avatarToDisplay(){const t=[];return this.assigneeAndCoworkerArray&&this.assigneeAndCoworkerArray.length&&this.assigneeAndCoworkerArray.forEach((e=>{t.push({userName:e.username})})),t},removeCompletedTask(){return!0===this.task.task.completed&&!this.showCompletedTasks}},watch:{"task.assignee"(){this.getTaskAssigneeAndCoworkers()},"task.coworker"(){this.getTaskAssigneeAndCoworkers()}},created(){this.getTaskAssigneeAndCoworkers(),this.$root.$on("update-completed-task",((t,e)=>{this.task.id===e&&(this.task.task.completed=t)}))},methods:{getTaskPriorityColor(t){switch(t){case"HIGH":return"taskHighPriority";case"NORMAL":return"taskNormalPriority";case"LOW":return"taskLowPriority";case"NONE":return"taskNonePriority"}},getTaskAssigneeAndCoworkers(){this.assigneeAndCoworkerArray=[],this.task.assignee&&!this.assigneeAndCoworkerArray.includes(this.task.assignee)&&this.assigneeAndCoworkerArray.push(this.task.assignee),(this.task.coworker||this.task.coworker.length>0)&&this.task.coworker.forEach((t=>{t&&!this.assigneeAndCoworkerArray.includes(t)&&this.assigneeAndCoworkerArray.push(t)}))},getLabelsList(t){if(t.length>1){let e="";return t.forEach((t=>{e+=`${t.name}\r\n`})),e}},openTaskDrawer(){this.$root.$emit("open-task-drawer",this.task.task)},getTaskCompleted(){return!0===this.task.task.completed?"uiIconValidate":"uiIconCircle"},getTaskCompletedTitle(){return!0===this.task.task.completed?"message.markAsUnCompleted":"message.markAsCompleted"},updateCompleted(){const t={id:this.task.task.id,isCompleted:!this.task.task.completed};if(t.id)return this.$tasksService.updateCompleted(t).then((e=>{e.completed?this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.completed")}):this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.unCompleted")}),this.$emit("update-task-completed",e),this.task.task.completed=t.isCompleted})).catch((t=>{console.error("Error updating project",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")}),this.postProject=!1}))},getTitleTaskClass(){return!0===this.task.task.completed?"text-color strikethrough":"text-color"},getTaskStatusLabel(t){switch(t){case"ToDo":return this.$t("exo.tasks.status.todo");case"InProgress":return this.$t("exo.tasks.status.inprogress");case"WaitingOn":return this.$t("exo.tasks.status.waitingon");case"Done":return this.$t("exo.tasks.status.done");default:return t}},dateFormatter(t){if(t){const e=new Date(t),s=e.getDate(),a=e.getMonth()+1;return`${e.getFullYear()}-${a}-${s}`}},getOverdueTask(t){const e=new Date,s=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`;return this.dateFormatter(t)!==s&&new Date(t)<(new Date).getTime()}}},Dt,[],!1,null,null,null).exports;var At=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:t.status.id}},[e("tasks-view-header",{staticClass:"draggHandler",attrs:{status:t.status,project:t.project,"view-type":"board","tasks-number":t.tasksList.length,index:t.index,"status-list-length":t.statusListLength},on:{"delete-status":t.deleteStatus,"update-status":t.updateStatus,"add-status":t.createStatus,"cancel-add-column":t.cancelAddColumn,"move-column":t.moveColumn,"open-quick-add":function(e){t.quickAddTask1=!0},"add-column":t.addColumn}}),t._v(" "),e("v-divider"),t._v(" "),e("quick-add-card",{staticClass:"status-add-task",attrs:{status:t.status,"quick-add-task":t.quickAddTask1,"task-title":t.taskTitle1},on:{"close-quick-form":function(e){t.quickAddTask1=!1}}}),t._v(" "),e("draggable",{staticClass:"draggable-palceholder taskBoardColumn",class:t.filterNoActive&&"taskBoardNoFilterColumn",attrs:{move:t.checkMove,animation:200,handle:".taskBoardCardItem",options:{group:"status"}},on:{start:function(e){t.drag=!0},end:t.updateTaskStatus},model:{value:t.tasksList,callback:function(e){t.tasksList=e},expression:"tasksList"}},[t._l(t.tasksList,(function(s){return e("task-view-card",{key:s.task.id,class:{"ghost-card":t.drag},attrs:{task:s,"show-completed-tasks":t.showCompletedTasks},on:{"update-task-completed":t.updateTaskCompleted}})})),t._v(" "),e("quick-add-card",{attrs:{status:t.status,"quick-add-task":t.quickAddTask,"task-title":t.taskTitle},on:{"close-quick-form":function(e){t.quickAddTask=!1}}}),t._v(" "),t.quickAddTask?t._e():e("v-btn",{staticClass:"btn px-2 quickAddNewTaskButton",on:{click:function(e){t.quickAddTask=!0}}},[e("v-icon",{staticClass:"d-block d-sm-none",attrs:{dark:""}},[t._v("mdi-plus")]),t._v(" "),e("span",{staticClass:"d-none font-weight-regular d-sm-inline"},[t._v("\n        + "+t._s(t.$t("label.addTask"))+"\n      ")])],1)],2)],1)};At._withStripped=!0;const Lt=n({props:{tasksList:{type:Array,default:()=>[]},status:{type:String,default:""},index:{type:Number,default:0},project:{type:Number,default:0},statusListLength:{type:Number,default:0},showCompletedTasks:{type:Boolean,default:!1},filterNoActive:{type:Boolean,default:!1}},data:()=>({quickAddTask:!1,quickAddTask1:!1,taskTitle:"",idViewCard:`DatePicker${parseInt(1e4*Math.random())}`,taskTitle1:"",drag:!1,task:null,newStatus:null,draggableKey:1}),created(){this.$root.$on("close-quick-task-form",(()=>{this.closeForm()})),this.$root.$on("task-assignee-updated",(()=>{this.closeForm()}))},methods:{updateTaskStatus(){this.task&&this.newStatus&&this.task.status.name!==this.newStatus&&this.$emit("updateTaskStatus",this.task,this.newStatus),Array.from(document.getElementsByClassName("draggable-palceholder")).forEach((t=>t.style.backgroundColor="#FFFFFF")),this.drag=!1},cancelDrag(){if(event.target&&!$(event.target).parents(`#${this.idViewCard}`).length)return event.preventDefault?event.preventDefault():event.returnValue=!1},updateTaskCompleted(t){!this.showCompletedTasks&&t.completed&&setTimeout((()=>{this.$root.$emit("task-isCompleted-updated",t)}),500)},checkMove(t){t&&(Array.from(document.getElementsByClassName("draggable-palceholder")).forEach((t=>t.style.backgroundColor="#FFFFFF")),Array.from(t.to.parentElement.getElementsByClassName("draggable-palceholder")).forEach((t=>t.style.backgroundColor="#f2f2f2")),this.task=t.draggedContext.element.task,this.newStatus=t.relatedContext.component.$parent.status.name)},deleteStatus(t){this.$emit("delete-status",t)},updateStatus(t){this.$emit("update-status",t)},createStatus(){this.$emit("create-status")},addColumn(t){this.$emit("add-column",t)},moveColumn(t,e){this.$emit("move-column",t,e)},cancelAddColumn(t){this.$emit("cancel-add-column",t)},closeForm(){this.quickAddTask=!1,this.quickAddTask1=!1,this.taskTitle="",this.taskTitle1=""},reRenderTasks(){this.draggableKey+=1}}},At,[],!1,null,null,null).exports;var It=function(){var t=this,e=t._self._c;return t.quickAddTask?e("v-card",{staticClass:"addTaskCard pa-3",attrs:{flat:""}},[e("v-text-field",{staticClass:"ps-0 pt-0 task-name",attrs:{placeholder:t.$t("label.tapTask.name"),autofocus:t.quickAddTask,type:"text","auto-grow":"",rows:"1","row-height":"13",required:""},on:{keyup:function(e){return t.checkImput(e)}},model:{value:t.taskTitle,callback:function(e){t.taskTitle=e},expression:"taskTitle"}}),t._v(" "),e("div",{staticClass:"d-md-none"},[e("v-spacer"),t._v(" "),e("v-btn",{staticClass:"btn me-2",on:{click:t.closeForm}},[t._v("\n      "+t._s(t.$t("popup.cancel"))+"\n    ")]),t._v(" "),e("v-btn",{staticClass:"btn btn-primary",attrs:{disabled:t.disableSaveButton},on:{click:t.addTask}},[t._v("\n      "+t._s(t.$t("label.save"))+"\n    ")])],1)],1):t._e()};It._withStripped=!0;const xt=n({props:{status:{type:Object,default:null},quickAddTask:{type:Boolean,default:!1},taskTitle:{type:String,default:""}},data:()=>({newTask:{title:"",priority:"NONE"}}),computed:{taskTitleValid(){return this.taskTitle&&this.taskTitle.trim()&&this.taskTitle.trim().length>=3&&this.taskTitle.length<1024},disableSaveButton(){return!this.taskTitleValid}},methods:{addTask(){this.newTask.title=this.taskTitle,this.newTask.status=this.status,this.$taskDrawerApi.addTask(this.newTask).then((t=>{this.closeForm(),this.$root.$emit("task-added",t),this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.created")})})).catch((t=>{console.error("Error when adding task title",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))},checkImput:function(t){13===t.keyCode&&this.taskTitle&&this.taskTitle.trim()&&this.taskTitle.trim().length>=3&&this.taskTitle.length<1024&&this.addTask(),27===t.keyCode&&this.closeForm()},openForm(){this.quickAddTask=!0},closeForm(){this.quickAddTask=!1,this.taskTitle="",this.$emit("close-quick-form"),this.$root.$emit("close-quick-task-form")}}},It,[],!1,null,null,null).exports;var Pt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"tasksViewHeaderStatus mr-2 d-flex justify-space-between align-center",attrs:{id:"task-"+t.viewType+"-"+t.status.id}},[e("div",{staticClass:"d-flex align-center assigneeFilter pointer"},[e("a",{staticClass:"toggle-collapse-group d-flex",attrs:{href:"#"},on:{click:function(e){return t.showDetailsTask(t.viewType,t.status.id)}}},[e("i",{staticClass:"uiIcon uiIconMiniArrowDown",staticStyle:{display:"block"},attrs:{id:"uiIconMiniArrowDown"+t.viewType+t.status.id}}),t._v(" "),e("i",{staticClass:"uiIcon uiIconMiniArrowRight",staticStyle:{display:"none"},attrs:{id:"uiIconMiniArrowRight"+t.viewType+t.status.id}})]),t._v(" "),t.editStatus||t.status.edit?e("input",{directives:[{name:"model",rawName:"v-model",value:t.status.name,expression:"status.name"}],ref:"autoFocusInput1",staticClass:"text-truncate subtitle-2 text-color my-auto",attrs:{placeholder:"Status Name",type:"text",required:"",autofocus:""},domProps:{value:t.status.name},on:{keyup:function(e){return t.checkImput(e,t.index)},input:function(e){e.target.composing||t.$set(t.status,"name",e.target.value)}}}):e("div",{staticClass:"text-truncate subtitle-2 text-color my-auto"},[t._v("\n      "+t._s(t.taskStatusLabel)+" "),e("span",{staticClass:"text-truncate subtitle-2 text-color my-auto"},[t._v("("+t._s(t.tasksNumber)+")")])])]),t._v(" "),e("v-divider",{staticClass:"mx-1"}),t._v(" "),e("div",{staticClass:"taskNumberAndActions d-flex align-center mb-1"},[e("i",{staticClass:"uiIconSocSimplePlus d-flex",attrs:{icon:"",small:""},on:{click:function(e){return t.openTaskDrawer()}}})])],1)};Pt._withStripped=!0;const Et=n({props:{status:{type:Object,default:null},viewType:{type:String,default:""},tasksNumber:{type:Number,default:0},maxTasksToShow:{type:Number,default:0},index:{type:Number,default:0},project:{type:Number,default:0}},data(){return{displayActionMenu:!1,editStatus:!1,tasksStatsStartValue:1,originalTasksToShow:this.maxTasksToShow,disableBtnLoadMore:!1}},computed:{initialTasksToShow(){return this.originalTasksToShow},limitTasksToshow(){return this.tasksStatsStartValue},taskStatusLabel(){const t=`exo.tasks.status.${this.status?.name.toLowerCase()}`,e=this.$t(t);return e===t&&this.status?.name||e}},created(){$(document).on("mousedown",(()=>{this.displayActionMenu&&window.setTimeout((()=>{this.displayActionMenu=!1}),200)}))},methods:{loadNextTasks(){this.tasksNumber-this.originalTasksToShow>=this.maxTasksToShow?(this.tasksStatsStartValue=this.originalTasksToShow+1,this.originalTasksToShow+=this.maxTasksToShow):(this.tasksStatsStartValue=this.originalTasksToShow,this.originalTasksToShow=this.tasksNumber,this.disableBtnLoadMore=!0)},openTaskDrawer(){const t={id:null,status:this.status,priority:"NONE",description:"",title:""};this.$root.$emit("open-task-drawer",t)},checkImput:function(t,e){13===t.keyCode&&this.saveStatus(e),27===t.keyCode&&this.cancelAddColumn(e)},deleteStatus(){this.$emit("delete-status",this.status)},saveStatus(t){this.status.id?(this.$emit("update-status",this.status),this.editStatus=!1):(this.status.rank=t,this.$emit("add-status"),this.editStatus=!1)},addColumn(t){this.$emit("add-column",t)},cancelAddColumn(t){this.status.id?(this.editStatus=!1,this.status.edit=!1):this.$emit("cancel-add-column",t)},showDetailsTask(t,e){const s=document.querySelector(`#uiIconMiniArrowDown${t}${e}`),a=document.querySelector(`#uiIconMiniArrowRight${t}${e}`),i=document.querySelector(`#taskView${e}`);"none"!==i.style.display?(i.style.display="none",s.style.display="none",a.style.display="block"):(i.style.display="block",s.style.display="block",a.style.display="none")}}},Pt,[],!1,null,null,null).exports;var Nt=function(){var t=this,e=t._self._c;return e("exo-drawer",{ref:"unscheduledTasksDrawer",staticClass:"unscheduledTasksDrawer",attrs:{right:"","body-classes":"hide-scroll decrease-z-index-more"}},[e("template",{slot:"title"},[e("div",{staticClass:"title-wrapper d-flex align-center justify-space-between"},[e("div",{staticClass:"titleAndFilter"},[t.displayFilterArea?e("v-text-field",{staticClass:"unscheduledTasksFilter pa-0 me-3 my-auto",attrs:{placeholder:t.$t("label.filterTask"),clearable:"",autofocus:""},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}):e("span",{staticClass:"no-work-plan-title"},[t._v(t._s(t.$t("label.noWorkPlan.tasks")))])],1),t._v(" "),e("div",{staticClass:"unscheduledTasksAction"},[!t.displayFilterArea&&t.filtredTasks&&t.filtredTasks.length?e("v-btn",{staticClass:"filter-btn",attrs:{icon:""}},[e("v-icon",{on:{click:function(e){t.showFilter=!t.showFilter}}},[t._v("mdi-filter")])],1):t._e(),t._v(" "),t.displayFilterArea&&t.filtredTasks&&t.filtredTasks.length?e("v-btn",{staticClass:"filter-btn",attrs:{icon:""}},[e("v-icon",{on:{click:function(e){t.showFilter=!t.showFilter}}},[t._v("mdi-close-circle")])],1):t._e(),t._v(" "),e("v-btn",{attrs:{icon:""}},[e("v-icon",{on:{click:function(e){return t.openTaskDrawer()}}},[t._v("mdi-plus")])],1)],1)])]),t._v(" "),t.filtredTasks&&t.filtredTasks.length?e("template",{slot:"content"},t._l(t.filtredTasks,(function(s){return e("task-view-card",{key:s.task.id,attrs:{task:s,"show-completed-tasks":t.showCompletedTasks}})})),1):e("template",{slot:"content"},[e("div",{staticClass:"noUnscheduledTasksFound"},[e("div",{staticClass:"noTasksIcon"},[e("i",{staticClass:"uiIcon uiIconTask"})]),t._v(" "),e("div",{staticClass:"noTasksLabel"},[e("span",[t._v(t._s(t.$t("label.noTask")))])])])])],2)};Nt._withStripped=!0;const Bt={"tasks-management":l,"project-dashboard":h,"project-list-toolbar":k,"project-card-list":d,"project-card":g,"project-card-front":f,"project-card-Reverse":y,"add-project-drawer":b,"exo-task-editor":_,"project-manager-drawer":D,"project-assignee-manager":A,"project-event-form-assignee-and-participator-item":I,"project-assignee-participator":P,"project-labels":N,"editable-labels":M,"tasks-dashboard":F,"tasks-list-toolbar":V,"tasks-list":U,"tasks-list-item":G,"tasks-cards-list":K,"task-card":W,"tasks-filter-drawer":Q,"tasks-assignee-coworker-drawer":tt,"tasks-group-drawer":st,"tasks-sort-by-drawer":it,"tasks-labels-drawer":ot,"tasks-group-project-drawer":lt,"tasks-sort-by-project-drawer":dt,"tasks-view-dashboard":ht,"tasks-view-toolbar":kt,"tasks-view-board":gt,"tasks-view-board-column":Lt,"tasks-view-list":ft,"tasks-view-list-column":yt,"tasks-view-gantt":bt,"tasks-view-header":Ct,"task-view-card":jt,"task-view-list-item":St,"quick-add-card":xt,"tasks-view-header-status":Et,"tasks-unscheduled-drawer":n({props:{project:{type:String,default:""},showCompletedTasks:{type:Boolean,default:!1}},data:()=>({unscheduledTasks:[],keyword:null,showFilter:!1}),computed:{displayFilterArea(){return this.showFilter},filtredTasks(){return null===this.keyword?this.unscheduledTasks:this.unscheduledTasks.filter((t=>t.task.title&&t.task.title.toLowerCase().indexOf(this.keyword.toLowerCase())>=0))}},mounted(){this.$root.$on("displayTasksUnscheduledDrawer",(t=>{this.unscheduledTasks=[],this.showFilter=!1,this.unscheduledTasks=t,this.$refs.unscheduledTasksDrawer.open(),this.$root.$emit("display-back-arrow")})),this.$root.$on("open-task-drawer",(()=>{this.$refs.unscheduledTasksDrawer&&this.$refs.unscheduledTasksDrawer.drawer&&this.$root.$emit("display-back-arrow"),this.$refs.unscheduledTasksDrawer.close()})),this.$root.$on("displayUnscheduledDrawer",(()=>{this.$refs.unscheduledTasksDrawer.open()})),this.$root.$on("refresh-unscheduled-gantt",(t=>{this.unscheduledTasks=[],this.unscheduledTasks=t}))},methods:{openTaskDrawer(){const t={id:null,status:{project:this.project},priority:"NONE",description:"",title:""};this.$root.$emit("open-task-drawer",t),this.$root.$emit("display-back-arrow")}}},Nt,[],!1,null,null,null).exports};for(const t in Bt)Vue.component(t,Bt[t]);if(extensionRegistry){const t=extensionRegistry.loadComponents("TasksManagement");t&&t.length>0&&t.forEach((t=>{Vue.component(t.componentName,t.componentOptions)}))}var Mt=function(){var t=this,e=t._self._c;return e("div",[e("exo-confirm-dialog",{ref:"deleteConfirmDialog",attrs:{message:t.deleteConfirmMessage,title:t.$t("popup.deleteTask"),"ok-label":t.$t("label.ok"),"cancel-label":t.$t("popup.cancel")},on:{ok:function(e){return t.deleteConfirm()}}}),t._v(" "),e("exo-drawer",{ref:"addTaskDrawer",staticClass:"taskDrawer",attrs:{id:"task-Drawer",temporary:t.confirmDrawerClose,"body-classes":"hide-scroll decrease-z-index-more",right:""},on:{closed:t.onCloseDrawer}},[t.task&&t.task.id?e("template",{slot:"title"},[e("div",{staticClass:"drawerTitleAndProject d-flex"},[t.addBackArrow?e("i",{staticClass:"uiIcon uiArrowBAckIcon",on:{click:t.closeTaskDrawer}}):t._e(),t._v(" "),e("span",[t._v(t._s(t.$t("label.drawer.header")))]),t._v(" "),e("div",{staticClass:"taskProjectName"},[e("task-projects",{attrs:{task:t.task},on:{projectsListOpened:function(e){t.closePriority(),t.closeStatus(),t.closeLabelsList(),t.closeTaskDates(),t.closeAssignements()}}})],1)]),t._v(" "),t.menuActions.length?e("div",{attrs:{id:"taskActionMenu"}},[e("i",{staticClass:"uiIcon uiThreeDotsIcon",on:{click:function(e){t.displayActionMenu=!0}}}),t._v(" "),e("v-menu",{attrs:{attach:"#taskActionMenu",transition:"slide-x-reverse-transition","content-class":"taskActionMenu","offset-y":""},model:{value:t.displayActionMenu,callback:function(e){t.displayActionMenu=e},expression:"displayActionMenu"}},[e("v-list",{staticClass:"pa-0",attrs:{dense:""}},t._l(t.menuActions,(function(s){return e("v-list-item",{key:s.title},[e("v-list-item-title",{staticClass:"subtitle-2",on:{click:s.action}},[e("i",{class:`uiIcon ${s.uiIcon} pe-2`}),t._v(" "),e("span",[t._v(t._s(s.title))])])],1)})),1)],1)],1):t._e()]):e("template",{slot:"title"},[e("div",{staticClass:"drawerTitleAndProject d-flex"},[t.addBackArrow?e("i",{staticClass:"uiIcon uiArrowBAckIcon",on:{click:t.closeTaskDrawer}}):t._e(),t._v(" "),e("span",[t._v(t._s(t.$t("label.drawer.header.add")))]),t._v(" "),e("div",{staticClass:"taskProjectName"},[e("task-projects",{attrs:{task:t.task},on:{projectsListOpened:function(e){t.closePriority(),t.closeStatus(),t.closeLabelsList(),t.closeTaskDates(),t.closeAssignements()}}})],1)])]),t._v(" "),e("template",{slot:"content"},[e("div",{staticClass:"taskDrawerDetails pa-4"},[e("div",{staticClass:"taskTitleAndMark d-flex"},[e("v-btn",{staticClass:"ms-n2",attrs:{id:"check_btn",icon:"",dark:""},on:{click:t.updateCompleted}},[t.task&&t.task.completed?e("v-icon",{staticClass:"markAsCompletedBtn"},[t._v("mdi-checkbox-marked-circle")]):e("v-icon",{staticClass:"markAsCompletedBtn"},[t._v("mdi-checkbox-blank-circle-outline")])],1),t._v(" "),e("v-textarea",{ref:"autoFocusInput4",staticClass:"ps-0 pt-0 task-name",class:{taskCompleted:t.task&&t.task.completed},attrs:{placeholder:t.$t("label.tapTask.name"),autofocus:!t.task||!t.task.id,type:"text","auto-grow":"",rows:"1","row-height":"13",required:""},on:{change:t.updateTaskTitle},model:{value:t.taskTitle,callback:function(e){t.taskTitle=e},expression:"taskTitle"}})],1),t._v(" "),t.task&&t.task.id?e("div",{staticClass:"lastUpdatedTask pb-3",attrs:{title:t.$t("tooltip.viewAllChanges")},on:{click:function(e){return t.$root.$emit("displayTaskChanges")}}},[e("span",{staticClass:"pe-2"},[t._v(t._s(t.$t("label.task.lastUpdate"))+"\n            "+t._s(t.displayedDate(t.lastTaskChangesLog))+"\n            "+t._s(t.$t("label.task.lastUpdateBy"))+"\n            "+t._s(t.lastTaskChangesLogAuthor))])]):t._e(),t._v(" "),e("div",{staticClass:"taskAssignement ms-8 pb-3"},[e("task-assignment",{attrs:{task:t.task},on:{updateTaskAssignment:function(e){return t.updateTaskAssignee(e)},updateTaskCoworker:function(e){return t.updateTaskCoworker(e)},assignmentsOpened:function(e){t.closePriority(),t.closeStatus(),t.closeProjectsList(),t.closeTaskDates(),t.closeLabelsList()}}})],1),t._v(" "),e("v-divider",{staticClass:"my-0"}),t._v(" "),e("div",{staticClass:"d-flex pt-4 pb-2"},[e("div",{staticClass:"taskDates"},[e("task-form-date-pickers",{attrs:{task:t.task,"date-picker-top":t.datePickerTop},on:{startDateChanged:function(e){return t.updateTaskStartDate(e)},dueDateChanged:function(e){return t.updateTaskDueDate(e)}}})],1),t._v(" "),e("div",{staticClass:"taskStatusAndPriority"},[e("task-priority",{attrs:{task:t.task},on:{updateTaskPriority:function(e){return t.updateTaskPriority(e)},PriorityListOpened:function(e){t.closeStatus(),t.closeProjectsList(),t.closeLabelsList(),t.closeTaskDates(),t.closeAssignements()}}}),t._v(" "),e("task-status",{attrs:{task:t.task},on:{statusListOpened:function(e){t.closePriority(),t.closeProjectsList(),t.closeLabelsList(),t.closeTaskDates(),t.closeAssignements()},updateTaskStatus:function(e){return t.updateTaskStatus(e)}}})],1)]),t._v(" "),e("v-divider",{staticClass:"my-0"}),t._v(" "),e("div",{staticClass:"taskDescription py-4"},[e("task-description-editor",{attrs:{task:t.task,placeholder:t.$t("editinline.taskDescription.empty")},on:{addTaskDescription:function(e){return t.addTaskDescription(e)}},model:{value:t.taskDescription,callback:function(e){t.taskDescription=e},expression:"taskDescription"}})],1),t._v(" "),e("div",{staticClass:"taskLabelsName mt-3 mb-3"},[t.task&&t.task.status&&t.task.status.project?e("task-labels",{attrs:{task:t.task},on:{labelsListOpened:function(e){t.closePriority(),t.closeStatus(),t.closeProjectsList(),t.closeTaskDates(),t.closeAssignements()}}}):t._e()],1),t._v(" "),e("extension-registry-components",{staticClass:"d-flex",attrs:{params:{taskId:t.task&&t.task.id,spaceId:t.taskSpaceId},name:"TaskDrawer",type:"task-drawer-action",element:"div","element-class":"overflow-hidden"}}),t._v(" "),e("v-divider",{staticClass:"my-0"}),t._v(" "),t.task&&t.task.id?e("v-flex",{staticClass:"pt-2 taskCommentsAndChanges",attrs:{xs12:""}},[e("task-view-all-comments",{attrs:{task:t.task,comments:t.comments}})],1):t._e()],1)]),t._v(" "),t.task&&!t.task.id?e("template",{slot:"footer"},[e("div",{staticClass:"d-flex"},[e("v-spacer"),t._v(" "),e("v-btn",{staticClass:"btn me-2",on:{click:t.cancel}},[t._v("\n          "+t._s(t.$t("popup.cancel"))+"\n        ")]),t._v(" "),e("v-btn",{staticClass:"btn btn-primary",attrs:{disabled:t.disableSaveButton},on:{click:t.addTask}},[t._v("\n          "+t._s(t.$t("label.save"))+"\n        ")])],1)]):t._e()],2),t._v(" "),e("task-comments-drawer",{ref:"taskCommentDrawer",attrs:{task:t.task,comments:t.comments},on:{confirmDialogOpened:function(e){t.isDrawerClose=!1},confirmDialogClosed:function(e){t.isDrawerClose=!0}}}),t._v(" "),e("task-changes-drawer",{ref:"taskChangesDrawer",attrs:{task:t.task,logs:t.logs}})],1)};Mt._withStripped=!0;const Ot=n({props:{task:{type:Object,default:()=>({})}},data(){return{displayActionMenu:!1,menuActions:[],reset:!1,dates:[],commentPlaceholder:this.$t("comment.message.addYourComment"),descriptionPlaceholder:this.$t("editinline.taskDescription.empty"),chips:[],autoSaveDelay:1e3,saveDescription:"",logs:[],comments:[],subEditorIsOpen:!1,taskPriority:"NONE",labelsToAdd:[],assignee:null,taskCoworkers:[],taskDueDate:null,taskStartDate:null,saving:!1,deleteConfirmMessage:null,datePickerTop:!0,enableDelete:!1,enableClone:!1,currentUserName:eXo.env.portal.userName,MESSAGE_MAX_LENGTH:2e3,dateTimeFormat:{year:"numeric",month:"long",day:"numeric"},lang:eXo.env.portal.language,commentId:"",isDrawerClose:!0,oldTask:{},showBackArrow:!1,taskSpace:{},taskTitle:null,taskDescription:null}},computed:{confirmDrawerClose(){return this.isDrawerClose},taskLink(){return null==this.task||null==this.task.id?"":`${eXo.env.portal.context}/${eXo.env.portal.portalName}/tasks/taskDetail/${this.task.id}`},taskTitleValid(){return this.taskTitle?.trim().length>=3&&this.taskTitle.length<1024},taskDescriptionValid(){const t=this.$utils.htmlToText(this.taskDescription);return!t||t.length<=2e3},disableSaveButton(){return this.saving||!this.taskTitleValid||!this.taskDescriptionValid},lastTaskChangesLog(){return this.logs&&this.logs.length&&this.logs[0].createdTime||""},lastTaskChangesLogAuthor(){return this.logs&&this.logs.length&&(this.logs[0].external?`${this.logs[0].authorFullName} (${this.$t("label.external")})`||"":this.logs[0].authorFullName||"")},taskId(){return this.task&&this.task.id},addBackArrow(){return this.showBackArrow},taskStatus(){return this.task&&this.task.status},taskProject(){return this.taskStatus&&this.taskStatus.project},taskProjectId(){return this.taskProject&&this.taskProject.id},taskSpaceId(){return this.taskSpace&&this.taskSpace.id}},watch:{taskId(){this.task&&null!==this.task.id&&void 0!==this.task.id&&this.displayDrawerMenuAction(this.task)}},created(){$(document).on("mousedown",(()=>{this.displayActionMenu&&window.setTimeout((()=>{this.displayActionMenu=!1}),200)})),document.addEventListener("labelListChanged",(t=>{if(t&&t.detail){const e=t.detail;this.labelsToAdd.push(e)}})),document.addEventListener("taskAssigneeChanged",(t=>{t&&t.detail&&(this.assignee=t.detail)})),document.addEventListener("taskCoworkerChanged",(t=>{t&&t.detail&&(this.taskCoworkers=t.detail)})),this.$root.$on("display-back-arrow",(()=>{this.showBackArrow=!0}))},destroyed:function(){document.removeEventListener("keyup",this.escapeKeyListener)},methods:{closePriority(){document.dispatchEvent(new CustomEvent("closePriority"))},closeStatus(){document.dispatchEvent(new CustomEvent("closeStatus"))},closeProjectsList(){document.dispatchEvent(new CustomEvent("closeProjectList"))},closeLabelsList(){document.dispatchEvent(new CustomEvent("closeLabelsList"))},closeTaskDates(){document.dispatchEvent(new CustomEvent("closeDates"))},closeAssignements(){document.dispatchEvent(new CustomEvent("closeAssignments"))},updateTaskTitle(){if(this.task.id&&this.oldTask.title!==this.taskTitle)if(this.taskTitle&&this.taskTitle.length)if(this.taskTitleValid){const t=JSON.parse(JSON.stringify(this.task));t.title=this.taskTitle,this.$taskDrawerApi.updateTask(this.task.id,t).then((()=>{this.task.title=this.oldTask.title=this.taskTitle,this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.title")}),this.$root.$emit("task-updated",JSON.parse(JSON.stringify(this.task)))})).catch((t=>{console.error("Error when updating task's title",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))}else this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error.title.length")});else this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error.title.mandatory")});else this.task.id||(this.task.title=this.oldTask.title=this.taskTitle)},updateCompleted(){const t={id:this.task.id,isCompleted:!this.task.completed};if(t.id)return this.$tasksService.updateCompleted(t).then((t=>{t.completed?this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.completed")}):this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.unCompleted")}),this.$root.$emit("update-task-completed",t)})).then((()=>this.task.completed=t.isCompleted)).then((()=>{this.$root.$emit("update-completed-task",this.task.completed,this.task.id)})).catch((t=>{console.error("Error updating project",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")}),this.postProject=!1}))},updateTaskPriority(t){t.priority&&this.oldTask.priority!==t.priority&&(null!=this.task.id?(this.task.priority=t.priority,this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.oldTask.priority=this.task.priority,this.$root.$emit("task-updated",this.task),this.$root.$emit("task-priority-updated",this.task),this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.priority")})})).catch((t=>{console.error("Error when updating task's priority",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))):this.taskPriority=t.priority)},updateTaskStatus(t){t&&this.oldTask?.status?.id!==t?.id&&null!=this.task.id&&(this.task.status=t,this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.oldTask.status=this.task.status,this.$root.$emit("task-status-updated",this.task),this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.status")})})).catch((t=>{console.error("Error when updating task's status",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})})))},updateTaskStartDate(t){"none"!==t&&1===t.date&&0===t.month&&t.timezoneOffset<0&&(t.year+=1),!t||"none"===t||this.oldTask.startDate&&this.datesEquals(this.oldTask.startDate,t)?"none"===t&&this.oldTask.startDate&&(this.task.startDate=null,this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.startDate")}),this.$root.$emit("task-start-date-updated",this.task)})).catch((t=>{console.error("Error has occurred while removing the start date ",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))):null!=this.task.id?(this.task.startDate=t,this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.oldTask.startDate=this.task.startDate,this.$root.$emit("task-updated",this.task),this.$root.$emit("task-start-date-updated",this.task),this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.startDate")})})).catch((t=>{console.error("Error when updating task's start date",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))):this.taskStartDate=t},updateTaskDueDate(t){"none"!==t&&1===t.date&&0===t.month&&t.timezoneOffset<0&&(t.year+=1),!t||"none"===t||this.oldTask.dueDate&&this.datesEquals(this.oldTask.dueDate,t)?"none"===t&&this.oldTask.dueDate&&(this.task.dueDate=null,this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.oldTask.dueDate=this.task.dueDate,this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.duetDate")})})).catch((t=>{this.logError(t)})).finally((()=>this.$root.$emit("task-due-date-updated",this.task)))):null!==this.task.id?(this.task.dueDate=t,this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.oldTask.dueDate=this.task.dueDate,this.$root.$emit("task-updated",this.task),this.$root.$emit("task-due-date-updated",this.task),this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.duetDate")}),this.$root.$emit("update-task-widget-list",this.task)})).catch((t=>{this.logError(t)})).finally((()=>this.$root.$emit("task-due-date-updated",this.task)))):this.taskDueDate=t},addTask(){document.dispatchEvent(new CustomEvent("onAddTask")),this.task.description=this.taskDescription,this.task.coworker=this.taskCoworkers,this.task.assignee=this.assignee,this.task.startDate=this.taskStartDate,this.task.dueDate=this.taskDueDate,this.task.priority=this.taskPriority,this.$taskDrawerApi.addTask(this.task).then((t=>{this.labelsToAdd.forEach((e=>{this.$taskDrawerApi.addTaskToLabel(t.id,e)})),this.$root.$emit("task-added",t),this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.created")}),this.showEditor=!1,this.$refs.addTaskDrawer.close(),this.labelsToAdd=[]})).catch((t=>{console.error("Error when adding task title",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))},updateTaskAssignee(t){null!==this.task.id&&this.oldTask.assignee!==t?(this.task.assignee=t||null,this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.oldTask.assignee=this.task.assignee,this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.assignee")})})).then((()=>{this.$root.$emit("update-task-assignee",t,this.task.id)})).catch((t=>{console.error("Error when updating task's assignee",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))):this.assignee=t||null},updateTaskCoworker(t){null!==this.task.id?(t&&t.length?this.task.coworker=t:this.task.coworker=[],this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.coworker")})})).then((()=>{this.$root.$emit("update-task-coworker",t,this.task.id)})).catch((t=>{console.error("Error when updating task's coworkers",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))):t&&t.length?this.taskCoworkers=t:this.taskCoworkers=[]},addTaskDescription(t){this.task.description=t},retrieveTaskLogs(){return this.$taskDrawerApi.getTaskLogs(this.task.id).then((t=>{this.logs=t})),this.logs},getTaskComments(){return this.$taskDrawerApi.getTaskComments(this.task.id).then((t=>{this.comments=t})),this.comments},getTaskSpace(){this.taskProjectId?this.$projectService.getProject(this.taskProjectId).then((t=>{this.taskSpace=t.spaceDetails})):this.taskSpace={}},navigateTo(t){window.open(`${eXo.env.portal.context}/${eXo.env.portal.portalName}/${t}`,"_blank")},open(t){this.oldTask=t,this.task=JSON.parse(JSON.stringify(t)),this.taskTitle=this.task.title,this.taskDescription=this.task.description,this.taskCoworkers=null,this.assignee=null,this.taskStartDate=null,this.taskDueDate=null,this.taskPriority="NONE",window.setTimeout((()=>{document.dispatchEvent(new CustomEvent("loadTaskPriority",{detail:t})),document.dispatchEvent(new CustomEvent("loadProjectStatus",{detail:t})),document.dispatchEvent(new CustomEvent("loadProjectName",{detail:t})),document.dispatchEvent(new CustomEvent("loadPlanDates",{detail:t})),document.dispatchEvent(new CustomEvent("loadProjectLabels",{detail:t})),document.dispatchEvent(new CustomEvent("loadTaskLabels",{detail:t})),document.dispatchEvent(new CustomEvent("loadAssignee",{detail:t}))}),200),null!=t.id&&(this.retrieveTaskLogs(),this.getTaskComments(),this.getTaskSpace(),this.$root.$emit("set-url",{type:"task",id:t.id})),this.$refs.addTaskDrawer.open()},cancel(){this.$emit("updateTaskList"),this.showEditor=!1,this.$refs.addTaskDrawer.close()},onCloseDrawer(){this.$root.$emit("task-drawer-closed",this.task),this.showEditor=!1,this.task={},this.comments={},this.$root.$emit("drawerClosed"),document.dispatchEvent(new CustomEvent("loadTaskLabels",{detail:{}})),this.$root.$emit("hideTaskComment"),this.$root.$emit("hideTaskChanges")},deleteTask(){this.deleteConfirmMessage=`${this.$t("popup.msg.deleteTask")} : <strong>${this.task.title}</strong>? `,this.$refs.deleteConfirmDialog.open()},cloneTask(){this.$taskDrawerApi.cloneTask(this.task.id).then((t=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.cloned")}),this.$root.$emit("task-added",t),this.$root.$emit("open-task-drawer",t)})).catch((t=>{console.error("Error when cloning task",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))},deleteConfirm(){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/tasks/${this.task.id}`,{method:"DELETE",credentials:"include"}).then((()=>{this.$root.$emit("deleteTask",{detail:this.task.id}),this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.deleted")}),document.dispatchEvent(new CustomEvent("deleteTask",{detail:this.task.id}))})).catch((t=>{console.error("Error when deleting task",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))},addMenuAction(t,e,s,a){this.menuActions.push({title:t,uiIcon:e,enabled:s,action:this[a]})},displayDrawerMenuAction(t){this.menuActions=[],t&&t.status&&t.status.project&&t.status.project.id?this.$projectService.getProject(t.status.project.id,!0).then((t=>{this.enableDelete=t.managerIdentities.some((t=>t.username===eXo.env.portal.userName)),this.enableClone=this.enableDelete||t.participatorIdentities.some((t=>t.username===eXo.env.portal.userName)),this.addMenuAction(this.$t("label.delete"),"uiIconTrash",this.enableDelete,"deleteTask"),this.addMenuAction(this.$t("label.clone"),"uiIconCloneNode",this.enableClone,"cloneTask"),this.menuActions=this.menuActions.filter((t=>t.enabled))})):t&&t.id&&(this.enableDelete=t.createdBy===eXo.env.portal.userName,this.enableClone=t.assignee===eXo.env.portal.userName||this.task.coworker.includes(eXo.env.portal.userName),this.addMenuAction(this.$t("label.delete"),"uiIconTrash",this.enableDelete,"deleteTask"),this.addMenuAction(this.$t("label.clone"),"uiIconCloneNode",this.enableClone,"cloneTask"),this.menuActions=this.menuActions.filter((t=>t.enabled)))},displayedDate(t){return t&&this.$dateUtil.formatDateObjectToDisplay(new Date(t),this.dateTimeFormat,this.lang)||""},openCommentDrawer(){this.$root.$emit("displayTaskComment",this.comments[this.comments.length-1].comment.id,!0)},datesEquals:(t,e)=>t.month===e.month&&t.year===e.year&&t.date===e.date,closeTaskDrawer(){this.$refs.addTaskDrawer.close(),this.$root.$emit("displayUnscheduledDrawer",""),this.showBackArrow=!1},logError(t){console.error("Error when updating task's due date",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}}},Mt,[],!1,null,null,null).exports;var Ft=function(){var t=this,e=t._self._c;return e("div",{on:{click:function(t){t.stopPropagation()}}},[e("v-combobox",{ref:"selectLabel",staticClass:"pt-0 inputTaskLabel",attrs:{id:"labelInput",filter:t.filter,"hide-no-data":!t.search,items:t.items,"search-input":t.search,label:t.$t("label.tapLabel.name"),attach:"","hide-selected":"",multiple:"","small-chips":"","prepend-icon":"",solo:""},on:{"update:searchInput":function(e){t.search=e},"update:search-input":function(e){t.search=e},click:function(e){return t.openLabelsList()},change:function(e){t.search=""}},scopedSlots:t._u([{key:"prepend",fn:function(){return[e("i",{staticClass:"uiIconTag uiIconBlue"})]},proxy:!0},{key:"no-data",fn:function(){return[e("v-list-item",[e("span",{staticClass:"subheading"},[t._v(t._s(t.$t("label.createLabel")))]),t._v(" "),e("v-chip",{attrs:{label:"",small:""}},[t._v("\n          "+t._s(t.search)+"\n        ")])],1)]},proxy:!0},{key:"selection",fn:function({attrs:s,item:a,parent:i,selected:r}){return[a===Object(a)?e("v-chip",t._b({staticClass:"pe-1 font-weight-bold",attrs:{color:`${a.color} lighten-3`,"input-value":r,label:"",outlined:!a.color,small:""}},"v-chip",s,!1),[e("span",{staticClass:"pe-2"},[t._v("\n          "+t._s(a.text)+"\n        ")]),t._v(" "),a.canEdit?e("v-icon",{staticClass:"pe-0",attrs:{"x-small":""},on:{click:function(e){i.selectItem(a),t.removeTaskFromLabel(a)}}},[t._v("\n          close\n        ")]):t._e()],1):t._e()]}},{key:"item",fn:function({item:s}){return[e("v-list-item",{on:{click:function(e){return t.addTaskToLabel(s)}}},[e("v-chip",{attrs:{color:`${s.color} lighten-3`,outlined:!s.color,label:"",small:""}},[t._v("\n          "+t._s(s.text)+"\n        ")])],1)]}}]),model:{value:t.model,callback:function(e){t.model=e},expression:"model"}})],1)};Ft._withStripped=!0;const Rt=n({props:{task:{type:Object,default:()=>({})}},data:()=>({index:-1,items:[],nonce:1,model:[],x:0,search:null,y:0,currentUserName:eXo.env.portal.userName}),watch:{model(t,e){t.length!==e.length?this.model=t.map((t=>("string"==typeof t&&(t={text:t,name:t,canEdit:this.task.createdBy===this.currentUserName||this.task.status.project.canManage},this.items.push(t),this.nonce++,this.addTaskToLabel(t)),t))):this.search=null}},created(){$(document).on("mousedown",(()=>{this.$refs.selectLabel&&this.$refs.selectLabel.isMenuActive&&window.setTimeout((()=>{this.$refs.selectLabel.isMenuActive=!1}),200)})),document.addEventListener("closeLabelsList",(()=>{setTimeout((()=>{void 0!==this.$refs.selectLabel&&(this.$refs.selectLabel.isMenuActive=!1)}),100)})),document.addEventListener("loadProjectLabels",(t=>{if(t&&t.detail){const e=t.detail;this.model=[],null!=e.status.project&&this.getProjectLabels(e.status.project.id)}})),document.addEventListener("loadTaskLabels",(t=>{if(t&&t.detail){const e=t.detail;this.model=[],null!=e.id&&(this.getTaskLabels(),this.$taskDrawerApi.getTaskLabels(e.id).then((t=>{this.model=t.map((function(t){const e=Object.assign({},t);return e.text=e.name,e}))})))}}))},methods:{filter(t,e,s){if(t.header)return!1;const a=function(t){return null!=t?t:""},i=a(s),r=a(e);return i.toString().toLowerCase().indexOf(r.toString().toLowerCase())>-1},getMyAllLabels(){this.$taskDrawerApi.getMyAllLabels().then((t=>{this.items=t.map((function(t){const e=Object.assign({},t);return e.text=e.name,e}))}))},getProjectLabels(t){this.$taskDrawerApi.getProjectLabels(t).then((t=>{this.items=t.map((function(t){const e=Object.assign({},t);return e.text=e.name,e}))}))},getTaskLabels(){this.$taskDrawerApi.getTaskLabels(this.task.id).then((t=>{this.model=t.map((function(t){const e=Object.assign({},t);return e.text=e.name,e}))}))},addTaskToLabel(t){null!=this.task.id?this.$taskDrawerApi.addTaskToLabel(this.task.id,t).then((()=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.label")}),this.getTaskLabels()})).then((()=>{this.$root.$emit("update-task-labels",t,this.task.id)})).catch((t=>{console.error("Error when updating task's labels",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})})):document.dispatchEvent(new CustomEvent("labelListChanged",{detail:t})),this.model.push(t),document.getElementById("labelInput").focus()},removeTaskFromLabel(t){this.$taskDrawerApi.removeTaskFromLabel(this.task.id,t.id).then((()=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.label")})})).then((()=>{this.$root.$emit("update-remove-task-labels",t.id,this.task.id)})).catch((t=>{console.error("Error when updating task's labels",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))},openLabelsList(){this.$emit("labelsListOpened")}}},Ft,[],!1,null,null,null).exports;var Vt=function(){var t=this,e=t._self._c;return e("div",[e("v-container",{attrs:{"pa-0":"",fluid:"","d-flex":""}},[e("i",{staticClass:"uiIcon icon-ArrowRight uiIconLightGray me-1"}),t._v(" "),e("v-combobox",{ref:"select",staticClass:"pt-0 mb-0 inputTaskProjectName taskInputArea",attrs:{filter:t.filterProjects,items:t.projects,label:t.projectLabel,attach:"",solo:"","prepend-icon":""},on:{click:function(e){return t.$emit("projectsListOpened")},change:function(e){return t.deleteProject()}},scopedSlots:t._u([{key:"selection",fn:function({attrs:s,item:a,parent:i,selected:r}){return[a===Object(a)?e("v-chip",t._b({staticClass:"projectName",attrs:{color:`${a.color} lighten-3`,"input-value":r,title:t.$t("tooltip.clickToEdit"),small:"",close:"","text-color":"white"},on:{click:function(e){return t.$emit("projectsListOpened")},"click:close":t.deleteProject}},"v-chip",s,!1),[e("span",{staticClass:"body-2 text-truncate",on:{click:function(t){return i.selectItem(a)}}},[t._v("\n            "+t._s(a.name)+"\n          ")])]):t._e()]}},{key:"item",fn:function({item:s}){return[e("v-list-item",{on:{click:function(e){return t.updateTaskProject(s)}}},[e("v-chip",{attrs:{color:`${s.color} lighten-3`,dark:"",close:"","text-color":"white",small:""}},[e("span",{staticClass:"text-truncate"},[t._v("\n              "+t._s(s.name)+"\n            ")])])],1)]}}]),model:{value:t.projectModel,callback:function(e){t.projectModel=e},expression:"projectModel"}})],1)],1)};Vt._withStripped=!0;const zt=n({props:{task:{type:Object,default:()=>({})}},data:()=>({projects:[],projectModel:null,search:null,projectLabel:"",menuId:`ProjectMenu${parseInt(1e4*Math.random()).toString().toString()}`}),watch:{projectModel(){this.$refs.select&&this.$refs.select.isMenuActive&&setTimeout((()=>{this.$refs.select.isMenuActive=!1}),50)},task(){this.task&&this.task.status&&this.task.status.project&&!this.task.status.name&&this.$taskDrawerApi.getDefaultStatusByProjectId(this.task.status.project.id).then((t=>{this.task.status=t}))}},created(){this.getProjects(),$(document).on("mousedown",(()=>{this.$refs.select.isMenuActive&&window.setTimeout((()=>{this.$refs.select.isMenuActive=!1}),200)})),document.addEventListener("closeProjectList",(()=>{setTimeout((()=>{void 0!==this.$refs.select&&(this.$refs.select.isMenuActive=!1)}),100)})),document.addEventListener("loadProjectName",(t=>{if(t&&t.detail){const e=t.detail;null!=e.id&&e.status&&e.status.project||null==e.id&&e.status&&e.status.project?(this.projectModel=this.task.status.project,this.projectLabel=this.$t("label.tapProject.name")):(this.projectModel=null,this.projectLabel=this.$t("label.noProject"))}}))},methods:{getProjects(){this.$taskDrawerApi.getProjects().then((t=>{this.projects=t.projects}))},filterProjects:(t,e)=>t.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1||t.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1,updateTask(){this.$taskDrawerApi.updateTask(this.task.id,this.task).then((()=>{this.$root.$emit("update-task-widget-list",this.task),this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.project")})})).catch((t=>{console.error("Error when updating task's title",t),this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})}))},updateTaskProject(t){this.$taskDrawerApi.getDefaultStatusByProjectId(t.id).then((e=>{this.task.status=e,this.updateTask(),this.projectModel=t})).then((()=>{this.$root.$emit("update-task-project",this.task)}))},deleteProject(t){this.task.status=null,this.projectModel=null,this.projectLabel=this.$t("label.noProject"),this.updateTask(),t.preventDefault(),t.stopPropagation()}}},Vt,[],!1,null,null,null).exports;var Ut=function(){var t=this,e=t._self._c;return e("div",{staticClass:"assigneeParent"},[e("v-menu",{staticClass:"taskAssignMenu",attrs:{id:"assigneeMenu","content-class":t.menuId,"close-on-content-click":!1,"nudge-left":0,"max-width":300,attach:"",transition:"scale-transition","offset-y":"","allow-overflow":"",eager:"",bottom:""},scopedSlots:t._u([{key:"activator",fn:function({on:s}){return[e("div",t._g({staticClass:"d-flex align-center taskAssignItem"},s),[t.taskAssigneeObj&&t.taskAssigneeObj.profile&&t.taskAssigneeObj.profile.fullName?e("div",{staticClass:"assigneeName overflow-hidden"},[e("exo-user-avatar",{attrs:{"profile-id":t.taskAssigneeObj.remoteId,url:null,size:24,"extra-class":"pe-2 overflow-hidden",popover:""}})],1):t._e(),t._v(" "),t.taskCoworkers.length>0?e("span",{staticClass:"user-name coworkerNumber pe-2 caption font-italic lighten-2"},[t._v(" +"+t._s(t.taskCoworkers.length)+" "+t._s(t.$t("label.coworker"))+"\n        ")]):t._e(),t._v(" "),e("a",{staticClass:"taskAssignBtn mt-n1"},[e("i",{staticClass:"uiIcon uiAddAssignIcon"}),t._v(" "),e("span",{staticClass:"text-decoration-underline"},[t._v(t._s(t.$t("label.assign")))])])])]}}]),model:{value:t.globalMenu,callback:function(e){t.globalMenu=e},expression:"globalMenu"}},[t._v(" "),e("v-card",{staticClass:"pb-4"},[e("v-card-text",{staticClass:"assignTaskMenu pb-0 d-flex justify-space-between"},[e("span",[t._v(t._s(t.$t("label.assignTo"))+" :")]),t._v(" "),e("a",{staticClass:"ms-4",on:{click:function(e){return t.assignToMe()}}},[e("i",{staticClass:"uiIcon uiAssignToMeIcon"}),t._v(" "),e("span",[t._v(t._s(t.$t("label.addMe")))])])]),t._v(" "),e("exo-identity-suggester",{ref:"autoFocusInput3",attrs:{labels:t.suggesterLabels,value:t.taskAssigneeObj,"search-options":t.searchOptions,name:"taskAssignee","type-of-relations":"''",height:"40","include-users":""},on:{input:function(e){return t.assigneeValueChanged(e)},removeValue:function(e){return t.removeAssignee()}}}),t._v(" "),e("v-divider",{staticClass:"mt-4 mb-4"}),t._v(" "),e("v-card-text",{staticClass:"assignTaskMenu pt-0 pb-0 d-flex justify-space-between"},[e("span",[t._v(t._s(t.$t("label.coworkers"))+" :")]),t._v(" "),e("a",{staticClass:"ms-4",on:{click:function(e){return t.setMeAsCoworker()}}},[e("i",{staticClass:"uiIcon uiAddMeCoworkerIcon"}),t._v(" "),e("span",[t._v(t._s(t.$t("label.addMe")))])])]),t._v(" "),e("exo-identity-suggester",{ref:"autoFocusInput3",attrs:{labels:t.suggesterLabels,value:t.taskCoworkerObj,"search-options":t.searchOptions,name:"taskCoworkers","type-of-relations":"''",height:"40","include-users":"",multiple:""},on:{input:function(e){return t.coworkerValueChanged(e)},removeValue:function(e){return t.removeCoworker(e)}}})],1)],1)],1)};Ut._withStripped=!0;const qt=n({props:{task:{type:Object,default:()=>({})},globalMenu:{type:Boolean,default:!1}},data:()=>({suggestedAssignee:[],suggestedCoworkers:[],taskAssignee:{},taskAssigneeObj:{},taskCoworkerObj:[],taskCoworkers:[],currentUser:eXo.env.portal.userName,menu:!1,menuId:`AssigneeMenu${parseInt(1e4*Math.random()).toString().toString()}`}),computed:{suggesterLabels(){return{placeholder:this.$t("label.assignee"),noDataLabel:this.$t("label.noResultLabel")}},searchOptions(){return{searchUrl:this.task&&this.task.status&&this.task.status.project?`${eXo.env.portal.context}/${eXo.env.portal.rest}/projects/projectParticipants/`.concat(this.task.status.project.id).concat("/"):`${eXo.env.portal.context}/${eXo.env.portal.rest}/tasks/usersToMention/`}}},mounted(){$(document).on("click",(t=>{!t.target||$(t.target).parents(`.${this.menuId}`).length||$(t.target).parents(".v-autocomplete__content").length||(this.globalMenu=!1)}))},created(){document.addEventListener("closeAssignments",(()=>{this.globalMenu&&window.setTimeout((()=>{this.globalMenu=!1}),100)})),document.addEventListener("loadAssignee",(t=>{if(this.taskAssigneeObj={},this.taskCoworkers=[],this.taskCoworkerObj=[],t&&t.detail){const e=t.detail;if(this.task=e,null!=e.id||e.status.project){if(e.coworker&&e.coworker.length)for(let t=0;t<e.coworker.length;t++)this.$identityService.getIdentityByProviderIdAndRemoteId("organization",e.coworker[t]).then((t=>{this.taskCoworkers.push(t.remoteId);const e={id:`organization:${t.remoteId}`,remoteId:t.remoteId,providerId:"organization",profile:{fullName:t.profile.fullname,avatarUrl:t.profile.avatar,external:"true"===t.profile.dataEntity.external}};this.taskCoworkerObj.push(e)}))}else this.$identityService.getIdentityByProviderIdAndRemoteId("organization",this.currentUser).then((t=>{this.taskAssigneeObj={id:`organization:${t.remoteId}`,remoteId:t.remoteId,providerId:"organization",profile:{fullName:t.profile.fullname,avatarUrl:t.profile.avatar,external:"true"===t.profile.dataEntity.external}}}));e.assignee&&this.$identityService.getIdentityByProviderIdAndRemoteId("organization",e.assignee).then((t=>{this.taskAssigneeObj={id:`organization:${t.remoteId}`,remoteId:t.remoteId,providerId:"organization",profile:{fullName:t.profile.fullname,avatarUrl:t.profile.avatar,external:"true"===t.profile.dataEntity.external}}}))}}))},methods:{assignToMe(){this.task.assignee!==this.currentUser&&(this.$identityService.getIdentityByProviderIdAndRemoteId("organization",this.currentUser).then((t=>{this.taskAssigneeObj={id:`organization:${t.remoteId}`,remoteId:t.remoteId,providerId:"organization",profile:{fullName:t.profile.fullname,avatarUrl:t.profile.avatar,external:"true"===t.profile.dataEntity.external}}})),this.$emit("updateTaskAssignment",this.currentUser))},setMeAsCoworker(){null===this.task.id?this.$identityService.getIdentityByProviderIdAndRemoteId("organization",this.currentUser).then((t=>{this.taskCoworkers.push(this.currentUser);const e={id:`organization:${t.remoteId}`,remoteId:t.remoteId,providerId:"organization",profile:{fullName:t.profile.fullname,avatarUrl:t.profile.avatar,external:"true"===t.profile.dataEntity.external}};this.taskCoworkerObj.push(e)})).then((()=>{document.dispatchEvent(new CustomEvent("taskCoworkerChanged",{detail:this.taskCoworkers})),this.isNewTask=!1})):this.taskCoworkers.includes(this.currentUser)||this.$identityService.getIdentityByProviderIdAndRemoteId("organization",this.currentUser).then((t=>{this.taskCoworkers.push(this.currentUser);const e={id:`organization:${t.remoteId}`,remoteId:t.remoteId,providerId:"organization",profile:{fullName:t.profile.fullname,avatarUrl:t.profile.avatar,external:"true"===t.profile.dataEntity.external}};this.taskCoworkerObj.push(e)})).then((()=>{this.$emit("updateTaskCoworker",this.taskCoworkers)}))},assigneeValueChanged(t){t&&t.id&&(t.remoteId!==this.currentUser&&this.task.assignee!==t.remoteId?(this.taskAssigneeObj=t,this.$emit("updateTaskAssignment",t.remoteId)):null===this.task.id&&this.$emit("updateTaskAssignment",this.taskAssigneeObj.remoteId))},coworkerValueChanged(t){void 0!==t&&t&&t.length&&!this.taskCoworkers.includes(t[t.length-1].remoteId)&&(this.taskCoworkers.push(t[t.length-1].remoteId),this.$emit("updateTaskCoworker",this.taskCoworkers),this.taskCoworkerObj.push(t[t.length-1]))},removeCoworker(t){this.taskCoworkers.splice(this.taskCoworkers.findIndex((e=>e===t.remoteId)),1),this.$emit("updateTaskCoworker",this.taskCoworkers)},removeAssignee(){this.taskAssigneeObj={},this.$emit("updateTaskAssignment",null)}}},Ut,[],!1,null,null,null).exports;var Gt=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"taskDescription",class:t.editorReady&&"active",attrs:{id:"taskDescriptionId"}},[e("div",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:t.value,expression:"value"}],staticClass:"py-1 px-2 taskDescriptionToShow",attrs:{"data-text":t.placeholder,title:t.$t("tooltip.clickToEdit"),contentEditable:"true"},on:{click:function(e){return t.showDescriptionEditor(e)}}},[t._v("\n      "+t._s(t.placeholder)+"\n    ")]),t._v(" "),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.value,expression:"value"}],ref:"editor",staticClass:"d-none",attrs:{id:"descriptionContent",cols:"30",rows:"10"},domProps:{value:t.value},on:{input:function(e){e.target.composing||(t.value=e.target.value)}}}),t._v(" "),t.displayEditor&&t.editorReady?e("div",{staticClass:"activityCharsCount",class:t.charsCount>t.MESSAGE_MAX_LENGTH?"tooManyChars":""},[t._v("\n      "+t._s(t.charsCount)+"/"+t._s(t.MESSAGE_MAX_LENGTH)+"\n      "),e("i",{staticClass:"uiIconMessageLength"})]):t._e()]),t._v(" "),t.task.id&&t.displayEditor&&t.editorReady?e("v-btn",{staticClass:"btn mt-2 ml-auto d-flex px-2 btn-primary v-btn v-btn--contained theme--light v-size--default",attrs:{id:"saveDescriptionButton",loading:t.savingDescription,disabled:t.saveDescriptionButtonDisabled,depressed:"",outlined:""},on:{click:t.saveDescription}},[t._v("\n    "+t._s(t.$t("label.apply"))+"\n  ")]):t._e()],1)};Gt._withStripped=!0;const Xt=n({props:{value:{type:String,default:""},placeholder:{type:String,default:""},task:{type:Object,default:function(){return{}}}},data:()=>({MESSAGE_MAX_LENGTH:2e3,inputVal:"",editorReady:!1,showEditor:!1,savingDescription:!1}),computed:{charsCount(){return this.$utils.htmlToText(this.value).length},saveDescriptionButtonDisabled(){return this.savingDescription||this.charsCount>this.MESSAGE_MAX_LENGTH},taskDescription(){return this.task?.description||""},displayEditor(){return this.showEditor}},watch:{inputVal(t){const e=CKEDITOR.instances.descriptionContent&&CKEDITOR.instances.descriptionContent.getData();null!=e&&t!==e&&(""===t?(CKEDITOR.instances.descriptionContent.setData(""),this.initCKEditor()):CKEDITOR.instances.descriptionContent.setData(t)),this.editorReady&&this.$emit("input",t)},editorReady(t){const e=document.querySelectorAll("[id=cke_descriptionContent]");if(!0===t){if(this.initCKEditor(),e)for(let t=0;t<e.length;t++)e[t].classList.remove("hiddenEditor");document.getElementById("taskDescriptionId").classList.remove("taskDescription"),CKEDITOR.instances.descriptionContent&&CKEDITOR.instances.descriptionContent.focus(!0)}else for(let t=0;t<e.length;t++)e[t].classList.add("hiddenEditor"),document.getElementById("taskDescriptionId").classList.add("taskDescription")},reset(){this.hideDescriptionEditor()}},created(){this.$root.$off("drawerClosed"),this.$root.$on("drawerClosed",(()=>{this.hideDescriptionEditor()})),document.addEventListener("onAddTask",(()=>{this.$emit("addTaskDescription",this.inputVal),this.hideDescriptionEditor()})),this.inputVal=this.value||""},methods:{saveDescription(){const t=this.inputVal?.replace("&nbsp;"," ");if(this.task.id&&!isNaN(this.task.id)){this.savingDescription=!0;const e=JSON.parse(JSON.stringify(this.task));e.description=t,this.$taskDrawerApi.updateTask(this.task.id,e).then((()=>{this.task.description=t,this.$root.$emit("show-alert",{type:"success",message:this.$t("alert.success.task.description")}),this.$root.$emit("task-description-updated",this.task),this.hideDescriptionEditor()})).catch((()=>{this.$root.$emit("show-alert",{type:"error",message:this.$t("alert.error")})})).finally((()=>this.savingDescription=!1))}},initCKEditor:function(){CKEDITOR.plugins.addExternal("embedsemantic","/commons-extension/eXoPlugins/embedsemantic/","plugin.js");let t="simpleLink,widget,embedsemantic";const e=$(window).width();e>$(window).height()&&e<768&&(t="simpleLink,selectImage,embedsemantic"),CKEDITOR.basePath="/commons-extension/ckeditor/";const s=this;$(this.$refs.editor).ckeditor({customConfig:"/commons-extension/ckeditorCustom/config.js",extraPlugins:t,removePlugins:"confirmBeforeReload,maximize,resize",toolbarLocation:"bottom",startupFocus:""===s.inputVal||"end",autoGrow_onStartup:!0,on:{blur:function(){$(document.body).trigger("click"),s.hideDescriptionEditor()},change:function(t){const e=t.editor.getData();s.inputVal=e},destroy:function(){s.editorReady=!1,s.showEditor=!1,s.inputVal=""}}})},hideDescriptionEditor(){CKEDITOR.instances.descriptionContent&&CKEDITOR.instances.descriptionContent.destroy(!0),this.editorReady=!1,this.showEditor=!1},showDescriptionEditor:function(t){this.showEditor||"A"===t?.target?.nodeName?"A"===t?.target?.nodeName&&window.open(t.target.href,"_blank"):(this.inputVal=this.value,this.editorReady=!0,this.showEditor=!0)},urlVerify(t){return this.$taskDrawerApi.urlVerify(t)}}},Gt,[],!1,null,null,null).exports;var Kt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"taskPriority"},[e("v-select",{ref:"selectPriority",staticClass:"pt-0 selectFont",attrs:{items:t.priorities,"item-value":"key","item-text":"value",attach:"",solo:"",dense:""},on:{change:function(e){return t.updateTaskPriority()},click:function(e){return t.$emit("PriorityListOpened")}},scopedSlots:t._u([{key:"append",fn:function(){return[e("v-icon",{class:t.priorityDefaultColor,attrs:{size:"20"}},[t._v("mdi-flag-variant")])]},proxy:!0},{key:"item",fn:function(s){return[e("v-list-avatar",{staticClass:"me-2"},[e("v-icon",{class:t.getTaskPriorityColor(s.item.key),attrs:{size:"20"}},[t._v("mdi-flag-variant")])],1),t._v(" "),e("v-list-tile-content",[e("v-list-tile-title",{staticClass:"body-2"},[t._v("\n          "+t._s(s.item.value)+"\n        ")])],1)]}}]),model:{value:t.priority,callback:function(e){t.priority=e},expression:"priority"}})],1)};Kt._withStripped=!0;const Ht=n({props:{task:{type:Object,default:()=>({})}},data(){return{priority:"",priorityDefaultColor:"highPriorityColor",priorities:[{key:"HIGH",value:this.$t("label.priority.high")},{key:"NORMAL",value:this.$t("label.priority.normal")},{key:"LOW",value:this.$t("label.priority.low")},{key:"NONE",value:this.$t("label.priority.none")}]}},watch:{priority(){this.task.priority!==this.priority&&this.updateTaskPriority()}},created(){$(document).on("mousedown",(()=>{this.$refs.selectPriority&&this.$refs.selectPriority.isMenuActive&&window.setTimeout((()=>{this.$refs.selectPriority.isMenuActive=!1}),200)})),document.addEventListener("loadTaskPriority",(t=>{if(t&&t.detail){const e=t.detail;null!=e.id?(this.priority=e.priority,this.priorityDefaultColor=this.getTaskPriorityColor(e.priority)):(this.priority="NONE",this.priorityDefaultColor=this.getTaskPriorityColor("NONE"))}})),document.addEventListener("closePriority",(()=>{this.$refs.selectPriority&&this.$refs.selectPriority.isMenuActive&&window.setTimeout((()=>{this.$refs.selectPriority.isMenuActive=!1}),100)}))},methods:{getTaskPriorityColor(t){switch(t){case"HIGH":return"highPriorityColor";case"NORMAL":return"normalPriorityColor";case"LOW":return"lowPriorityColor";case"NONE":return"nonePriorityColor"}},updateTaskPriority(){this.priorityDefaultColor=this.getTaskPriorityColor(this.priority);const t={priority:this.priority,taskId:this.task.id};this.$emit("updateTaskPriority",t)}}},Kt,[],!1,null,null,null).exports;var Jt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"taskStatus"},[t.task.status&&t.task.status.project?e("div",[e("v-select",{ref:"selectStatus",staticClass:"pt-0 selectFont",attrs:{id:"selectStatus",items:t.projectStatuses,"item-value":"key","item-text":"value",attach:"",dense:"",solo:""},on:{change:function(e){return t.updateTaskStatus()},click:function(e){return t.$emit("statusListOpened")}},model:{value:t.taskStatus,callback:function(e){t.taskStatus=e},expression:"taskStatus"}})],1):t._e()])};Jt._withStripped=!0;const Wt=n({props:{task:{type:Object,default:()=>({})}},data:()=>({taskStatus:"ToDo",projectStatuses:[]}),created(){$(document).on("mousedown",(()=>{this.$refs.selectStatus&&this.$refs.selectStatus.isMenuActive&&window.setTimeout((()=>{this.$refs.selectStatus.isMenuActive=!1}),200)})),document.addEventListener("closeStatus",(()=>{this.$refs.selectStatus&&this.$refs.selectStatus.isMenuActive&&window.setTimeout((()=>{this.$refs.selectStatus.isMenuActive=!1}),100)})),document.addEventListener("loadProjectStatus",this.loadProjectStatus)},destroyed(){document.removeEventListener("loadProjectStatus",this.loadProjectStatus)},methods:{getI18nStatus(t){return this.$te(`tasks.status.${t}`)?this.$t(`tasks.status.${t}`):this.$te(`tasks.status.${t.toLowerCase()}`)&&this.$t(`tasks.status.${t.toLowerCase()}`)||t},updateTaskStatus(){null!=this.taskStatus&&this.$taskDrawerApi.getStatusesByProjectId(this.task.status.project.id).then((t=>{const e=t.find((t=>t.name===this.taskStatus));this.$emit("updateTaskStatus",e)}))},getStatusesByProjectId(t){this.$taskDrawerApi.getStatusesByProjectId(t.status.project.id).then((t=>{this.projectStatuses=t;for(let e=0;e<t.length;e++)this.projectStatuses[e]={key:t[e].name,value:this.getI18nStatus(t[e].name)}}))},loadProjectStatus(t){if(t&&t.detail){const e=t.detail;null!=e.status&&e.status.project?(this.getStatusesByProjectId(e),e.status.name&&(this.taskStatus=e.status.name)):(this.projectStatuses.push({key:"ToDo",value:this.$t("exo.tasks.status.todo")}),this.projectStatuses.push({key:"InProgress",value:this.$t("exo.tasks.status.inprogress")}),this.projectStatuses.push({key:"WaitingOn",value:this.$t("exo.tasks.status.waitingon")}),this.projectStatuses.push({key:"Done",value:this.$t("exo.tasks.status.done")}),this.taskStatus="ToDo")}}}},Jt,[],!1,null,null,null).exports;var Yt=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"taskPlanDateCalender d-flex align-center"},[e("i",{staticClass:"uiIconStartDate uiIconBlue"}),t._v(" "),e("date-picker",{ref:"taskStartDate",staticClass:"flex-grow-1 my-auto",attrs:{"default-value":!1,placeholder:t.$t("label.startDate"),"max-value":t.maximumStartDate,width:"100%"},on:{input:function(e){return t.emitStartDate(t.startDate)}},model:{value:t.startDate,callback:function(e){t.startDate=e},expression:"startDate"}},[e("template",{slot:"footer"},[e("div",{staticClass:"dateFooter"},[e("v-btn-toggle",{staticClass:"d-flex flex-wrap justify-space-between",attrs:{tile:"",color:"primary","background-color":"primary",group:""}},[e("v-btn",{staticClass:"my-0",attrs:{value:"left",small:""},on:{click:function(e){return t.addBtnStartDate()}}},[t._v("\n              "+t._s(t.$t("label.today"))+"\n            ")]),t._v(" "),e("v-btn",{staticClass:"my-0",attrs:{value:"center",small:""},on:{click:function(e){return t.addBtnStartDate(1)}}},[t._v("\n              "+t._s(t.$t("label.tomorrow"))+"\n            ")]),t._v(" "),e("v-btn",{staticClass:"my-0",attrs:{value:"right",small:""},on:{click:function(e){return t.addBtnStartDate(7)}}},[t._v("\n              "+t._s(t.$t("label.nextweek"))+"\n            ")]),t._v(" "),e("v-btn",{staticClass:"my-0",attrs:{value:"right",small:""},on:{click:function(e){return t.resetStartDate()}}},[t._v("\n              "+t._s(t.$t("label.none"))+"\n            ")])],1)],1)])],2)],1),t._v(" "),e("div",{staticClass:"taskDueDateCalender d-flex align-center"},[e("i",{staticClass:"uiIconDueDate uiIconBlue"}),t._v(" "),e("date-picker",{ref:"taskDueDate",staticClass:"flex-grow-1 my-auto",attrs:{"default-value":!1,placeholder:t.$t("label.dueDate"),"min-value":t.minimumEndDate,width:"100%"},on:{input:function(e){return t.emitDueDate(t.dueDate)}},model:{value:t.dueDate,callback:function(e){t.dueDate=e},expression:"dueDate"}},[e("template",{slot:"footer"},[e("div",{staticClass:"dateFooter"},[e("v-btn-toggle",{staticClass:"d-flex flex-wrap justify-space-between",attrs:{tile:"",color:"primary","background-color":"primary",group:""}},[e("v-btn",{staticClass:"my-0",attrs:{value:"left",small:"",disabled:t.startDate>t.checkDate()},on:{click:function(e){return t.addBtnDate()}}},[t._v("\n              "+t._s(t.$t("label.today"))+"\n            ")]),t._v(" "),e("v-btn",{staticClass:"my-0",attrs:{value:"center",small:"",disabled:t.startDate>t.checkDate(1)},on:{click:function(e){return t.addBtnDate(1)}}},[t._v("\n              "+t._s(t.$t("label.tomorrow"))+"\n            ")]),t._v(" "),e("v-btn",{staticClass:"my-0",attrs:{value:"right",small:"",disabled:t.startDate>t.checkDate(7)},on:{click:function(e){return t.addBtnDate(7)}}},[t._v("\n              "+t._s(t.$t("label.nextweek"))+"\n            ")]),t._v(" "),e("v-btn",{staticClass:"my-0",attrs:{value:"right",small:""},on:{click:function(e){return t.resetDueDate()}}},[t._v("\n              "+t._s(t.$t("label.none"))+"\n            ")])],1)],1)])],2)],1)])};Yt._withStripped=!0;const Qt=n({props:{task:{type:Object,default:()=>({})},taskDueDate:{type:String,default:()=>"endDate"},datePickerTop:{type:Boolean,default:!1}},data(){return{startDate:null,dueDate:null,actualDueDate:{},actualTask:{},dateShortCutItems:[{key:"today",value:this.$t("label.today")},{key:"tomorrow",value:this.$t("label.tomorrow")},{key:"nextweek",value:this.$t("label.nextweek")},{key:"datePicker",value:this.$t("label.pickDate")}],dateItem:""}},computed:{minimumEndDate(){return this.startDate?new Date(this.startDate):null},maximumStartDate(){return this.dueDate?new Date(this.dueDate):null}},watch:{task(t){"{}"!==JSON.stringify(t)&&(this.actualTask=this.task,this.reset())}},mounted(){this.actualTask=this.task,this.reset(),document.addEventListener("closeDates",(()=>{this.$refs.taskStartDate&&this.$refs.taskStartDate.menu&&(this.$refs.taskStartDate.menu=!1),this.$refs.taskDueDate&&this.$refs.taskDueDate.menu&&(this.$refs.taskDueDate.menu=!1)})),$(".taskAssignItem").off("click").on("click",(()=>{this.$refs.taskStartDate&&this.$refs.taskStartDate.menu&&(this.$refs.taskStartDate.menu=!1),this.$refs.taskDueDate&&this.$refs.taskDueDate.menu&&(this.$refs.taskDueDate.menu=!1)}))},methods:{checkDate(t){t||(t=0);const e=new Date;return e.setDate(e.getDate()+t),e},reset(){null!=this.actualTask.id?(this.startDate=null,this.dueDate=null,null!=this.actualTask.startDate&&this.$nextTick().then((()=>{this.startDate=this.toDate(this.actualTask.startDate)})),null!=this.actualTask.dueDate&&this.$nextTick().then((()=>{this.dueDate=this.toDate(this.actualTask.dueDate)}))):(this.startDate=null,this.dueDate=null)},toDate(t){if(!t)return null;if("number"==typeof t)return new Date(t);if("string"==typeof t)return 10===t.indexOf("T")&&t.length>19&&(t=t.substring(0,19)),new Date(t);if("object"==typeof t){const e=`${t.year+1900}/${t.month+1}/${t.date}`;return new Date(e)}},toDateObject(t){if(t=this.toDate(t)){const e={time:"",nanos:"",year:"",month:"",day:"",hours:"",minutes:"",seconds:"",timezoneOffset:"",date:""};return e.time=t.getTime(),e.year=t.getUTCFullYear()-1900,e.month=t.getMonth(),e.day=t.getDay(),e.hours=t.getHours(),e.minutes=t.getMinutes(),e.seconds=t.getSeconds(),e.timezoneOffset=t.getTimezoneOffset(),e.date=t.getDate(),e}return null},addBtnDate(t){if(t){const e=new Date;e.setDate(e.getDate()+t),this.dueDate=e}else this.dueDate=new Date;this.$refs.taskDueDate&&this.$refs.taskDueDate.menu&&(this.$refs.taskDueDate.menu=!1)},addBtnStartDate(t){if(t){const e=new Date;e.setDate(e.getDate()+t),this.startDate=e}else this.startDate=new Date;this.$refs.taskStartDate&&this.$refs.taskStartDate.menu&&(this.$refs.taskStartDate.menu=!1)},resetDueDate(){this.dueDate=null,this.$emit("dueDateChanged","none"),this.$refs.taskDueDate&&this.$refs.taskDueDate.menu&&(this.$refs.taskDueDate.menu=!1)},resetStartDate(){this.startDate=null,this.$emit("startDateChanged","none"),this.$refs.taskStartDate&&this.$refs.taskStartDate.menu&&(this.$refs.taskStartDate.menu=!1)},emitStartDate(t){const e=this.toDateObject(t);(!t&&this.actualTask.startDate||t&&!this.actualTask.startDate||this.actualTask.startDate&&!this.datesEquals(e,this.actualTask.startDate))&&this.$emit("startDateChanged",e)},emitDueDate(t){const e=this.toDateObject(t);(!t&&this.actualTask.dueDate||t&&!this.actualTask.dueDate||this.actualTask.dueDate&&!this.datesEquals(e,this.actualTask.dueDate))&&this.$emit("dueDateChanged",e)},datesEquals:(t,e)=>t.month===e.month&&t.year===e.year&&t.date===e.date}},Yt,[],!1,null,null,null).exports;var Zt=function(){var t=this,e=t._self._c;return t.showTaskChangesDrawer?e("div",{ref:"taskChangesDrawer",staticClass:"taskCommentDrawer",class:t.showTaskChangesDrawer?"showTaskChangesDrawer":""},[e("v-container",{staticClass:"pa-0",attrs:{"fill-height":""}},[e("v-layout",{attrs:{column:""}},[e("v-flex",{staticClass:"mx-0 drawerHeader flex-grow-0"},[e("v-list-item",{staticClass:"pe-0"},[e("v-list-item-content",{staticClass:"drawerTitle d-flex text-header-title text-truncate"},[e("i",{staticClass:"uiIcon uiArrowBAckIcon",on:{click:t.closeDrawer}}),t._v(" "),e("span",{staticClass:"ps-2"},[t._v(t._s(t.$t("label.changes")))])]),t._v(" "),e("v-list-item-action",{staticClass:"drawerIcons align-end d-flex flex-row"},[e("v-btn",{attrs:{icon:""}},[e("v-icon",{on:{click:function(e){return t.closeDrawer()}}},[t._v("mdi-close")])],1)],1)],1)],1),t._v(" "),e("v-divider",{staticClass:"my-0"}),t._v(" "),e("v-flex",{staticClass:"drawerContent flex-grow-1 overflow-auto border-box-sizing"},[e("v-list",{staticClass:"py-0"},t._l(t.logs,(function(s,a){return e("v-list-item",{key:a,staticClass:"pe-0"},[e("v-list-item-content",{staticClass:"mt-n1"},[e("div",{staticClass:"d-flex"},[e("exo-user-avatar",{attrs:{"profile-id":s.author,size:30,url:null,popover:"","align-top":""}}),t._v(" "),e("div",{staticClass:"d-flex mt-n2",domProps:{innerHTML:t._s(t.renderChangeHTML(s))}})],1),t._v(" "),e("div",[e("div",{staticClass:"dateTime caption px-10 my-n3"},[e("date-format",{attrs:{value:s.createdTime,format:t.dateTimeFormat}})],1)])])],1)})),1)],1)],1)],1)],1):t._e()};Zt._withStripped=!0;const te={"task-drawer":Ot,"task-labels":Rt,"task-projects":zt,"task-assignment":qt,"task-description-editor":Xt,"task-priority":Ht,"task-status":Wt,"task-form-date-pickers":Qt,"task-changes-drawer":n({props:{logs:{type:Object,default:()=>({})},task:{type:Boolean,default:!1}},data:()=>({showTaskChangesDrawer:!1,dateTimeFormat:{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"},currentUserName:eXo.env.portal.userName,changeAuthor:{},userAvatar:"",avatarUrl:""}),watch:{userAvatar(){this.avatarUrl=this.userAvatar}},mounted(){this.$root.$on("displayTaskChanges",(()=>{this.showTaskChangesDrawer=!0})),this.$root.$on("hideTaskChanges",(()=>{this.showTaskChangesDrawer=!1}))},methods:{closeDrawer(){this.showTaskChangesDrawer=!1},logMsg:t=>`log.${t.actionName}`,renderChangeHTML(t){let e="";if("assign"===t.actionName||"unassign"===t.actionName){const s=t.isTargetFullNameExternal?`${t.targetFullName} (${this.$t("label.external")})`:`${t.targetFullName}`;e=`<p class='text-truncate my-auto text-color ms-1 subtitle-2' title='${t.authorFullName} ${this.$t(this.logMsg(t))} ${s}'><span>${this.$t(this.logMsg(t))}</span><a href='/portal/dw/profile/${t.target}'> ${s} </a></p>`}else e="edit_project"===t.actionName?`<p class='text-truncate my-auto text-color ms-1 subtitle-2' title='${t.authorFullName} ${this.$t(this.logMsg(t))}  ${t.target}'><span>${this.$t(this.logMsg(t))}</span><a href='#'> ${t.target} </a></p>`:"edit_priority"===t.actionName?`<p class='text-truncate my-auto text-color ms-1 subtitle-2' title='${t.authorFullName} ${this.$t(this.logMsg(t))} ${t.task.status.priority}'> ${this.$t(this.logMsg(t))} ${t.task.priority}</p>`:`<p class='text-truncate my-auto text-color ms-1 subtitle-2' title='${t.authorFullName} ${this.$t(this.logMsg(t))} ${t.target}'> ${this.$t(this.logMsg(t))} ${t.target}</p>`;return e}}},Zt,[],!1,null,null,null).exports};for(const t in te)Vue.component(t,te[t]);const ee={ENV:eXo.env.portal||"",PORTAL:eXo.env.portal.context||"",PORTAL_NAME:eXo.env.portal.portalName||"",PORTAL_CONTEXT:eXo.env.portal.context,PORTAL_REST:eXo.env.portal.rest,CONTAINER_NAME:eXo.env.portal.containerName||"",LANG:eXo.env.portal.language};function se(t,e,s,a){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/tasks?status=${t||""}&q=${e||""}&offset=${s||0}&limit=${a||0}&returnDetails=true`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)})).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function ae(t,e,s,a,i){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/tasks/filter?projectId=${i||t.projectId||-2}&query=${t.query||""}&dueDate=${t.dueDate||""}&priority=${t.priority||""}&statusId=${t.statusId||""}&showCompletedTasks=${t.showCompletedTasks||""}&assignee=${t.assignee||""}&watcher=${t.watcher||""}&coworker=${t.coworker||""}&groupBy=${e||t.groupBy||""}&orderBy=${s||t.orderBy||""}&dueCategory=${t.dueCategory||""}&filterLabelIds=${a||t.filterLabelIds||""}&offset=${t.offset||0}&limit=${t.limit||0}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)})).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function ie(t){return fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/tasks/labels/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function re(t){return fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/tasks/labels/project/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function oe(t){return fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/tasks/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function ne(t){return fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/projects/projects/statuses/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function le(t){return fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/tasks/project/${t}?returnDetails=true`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function ce(t){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/tasks/updateCompleted/${t.id}?&isCompleted=${t.isCompleted}`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"PUT",body:JSON.stringify(t)}).then((t=>t.json())).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function de(t,e,s,a,i,r){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/projects/projects?q=${e||""}&spaceName=${t||""}&projectsFilter=${s||""}&offset=${a||0}&limit=${i||0}&participatorParam=${r||!1}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)})).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function ue(t){return fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/projects/project/statistics/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function he(t,e){return fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/projects/projects/${t}?&participatorParam=${e||!1}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function pe(t){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/projects/createproject`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify(t)}).then((t=>t.json())).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function ke(t){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/projects/updateproject/${t.id}`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"PUT",body:JSON.stringify(t)}).then((t=>t.json())).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function me(t){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/projects/${t.id}?&deleteChild=false`,{credentials:"include",method:"DELETE"}).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function ge(t){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/projects/cloneproject`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify(t)}).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function ve(t,e){return fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/projects/changeProjectColor/${t.id}?&color=${e}`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"PUT",body:JSON.stringify(t)}).then((t=>t.json()))}function fe(t){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/settings/USER,${eXo.env.portal.userName}/APPLICATION,task-${t.projectId}-${t.tabView}/filterTask`,{method:"PUT",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({value:JSON.stringify(t)})}).then((t=>{if(t&&t.ok)return t;throw new Error("Error setting filter  settings")})).then((t=>t))}function we(t,e){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/settings/USER,${eXo.env.portal.userName}/APPLICATION,task-${t}-${e}/filterTask`,{method:"GET",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}}).then((t=>{if(t&&t.ok)return t.json();if(t&&404===t.status)return null;throw new Error("Error getting filter settings")})).then((t=>t))}function ye(t){return fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/status`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify(t)}).then((t=>t.json()))}function Te(t){return fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/status/${t.id}`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"PUT",body:JSON.stringify(t)}).then((t=>t.json()))}function be(t){return fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/status/move`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"PUT",body:JSON.stringify(t)}).then((t=>t.json()))}function $e(t){return fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/status/${t}`,{credentials:"include",method:"DELETE"})}function Ce(t){return fetch(`/portal/rest/v1/social/users/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting user informations")}))}function _e(t,e){return t?(document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch(`/portal/rest/tasks/${t}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((t=>t&&t.ok?t.json():t.text().then((t=>{throw new Error(t)})))).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))):Promise.resolve()}function je(t){return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),fetch("/portal/rest/tasks",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",credentials:"include",body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when adding task")})).finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading"))))}function De(){return fetch("/portal/rest/tasks/labels",{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting my all labels")}))}function Se(t){return fetch(`/portal/rest/tasks/labels/project/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting my all labels")}))}function Ae(t){return fetch(`/portal/rest/tasks/labels/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting task labels")}))}function Le(t,e){return fetch(`/portal/rest/tasks/labels/${t}`,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",credentials:"include",body:JSON.stringify(e)}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when adding task to label")}))}function Ie(t,e){return fetch(`/portal/rest/tasks/labels/${t}/${e}`,{credentials:"include",method:"DELETE"}).then((t=>{if(!t||!t.ok)throw new Error("Error when deleting task from label")}))}function xe(t){return fetch("/portal/rest/tasks/labels",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",credentials:"include",body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when adding task to label")}))}function Pe(t){return fetch(`/portal/rest/tasks/labels/${t.id}`,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"PUT",credentials:"include",body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when updateing label")}))}function Ee(t){return fetch(`/portal/rest/tasks/labels/${t}`,{credentials:"include",method:"DELETE"}).then((t=>{if(!t||!t.ok)throw new Error("Error when deleting label")}))}function Ne(){return fetch("/portal/rest/projects/projects",{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting projects")}))}function Be(t){return fetch(`/portal/rest/projects/projects/status/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting default status")}))}function Me(t){return fetch(`/portal/rest/projects/projects/statuses/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting project statuses")}))}function Oe(){return fetch("/portal/rest/v1/social/users",{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting users")}))}function Fe(t){return fetch(`/portal/rest/tasks/logs/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting task logs")}))}function Re(t){return fetch(`/portal/rest/tasks/comments/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting task comments")}))}function Ve(t,e){return fetch(`/portal/rest/tasks/comments/${t}`,{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:e}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when adding task comment")}))}function ze(t,e,s){return fetch(`/portal/rest/tasks/comments/${e}/${t}`,{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:s}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when adding task sub comment")}))}function Ue(t){return fetch(`/portal/rest/tasks/comments/${t}`,{method:"DELETE",credentials:"include"}).then((t=>{if(!t||!t.ok)throw new Error("Error when removing task comment")}))}function qe(t,e){return fetch(t?`/portal/rest/projects/projectParticipants/${t}/${e}`:`/portal/rest/tasks/usersToMention/${e}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting users to mention")}))}function Ge(t,e){return fetch(`/portal/rest/tasks/users/${t}/${e}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting suggested users")}))}function Xe(t){return fetch(`/portal/rest/v1/social/users/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting user")}))}function Ke(t){return t.replace(/((?:href|src)=")?((((https?|ftp|file):\/\/)|www\.)[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|])/gi,(function(t,e){if(e)return t;let s=t;return 0===s.indexOf("www.")&&(s=`//${s}`),`<a href="${s}" target="_blank">${t}</a>`}))}function He(t){return fetch(`${ee.PORTAL}/${ee.PORTAL_REST}/tasks/clone/${t}`,{credentials:"include",method:"POST"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when cloning task")}))}Vue.use(Vuetify),Vue.use(VueEllipsis);const Je=new Vuetify(eXo.env.portal.vuetifyPreset);Vue.prototype.$tasksService||window.Object.defineProperty(Vue.prototype,"$tasksService",{value:s}),Vue.prototype.$projectService||window.Object.defineProperty(Vue.prototype,"$projectService",{value:a}),Vue.prototype.$statusService||window.Object.defineProperty(Vue.prototype,"$statusService",{value:i}),Vue.prototype.$taskDrawerApi||window.Object.defineProperty(Vue.prototype,"$taskDrawerApi",{value:r});const We=eXo&&ee.LANG||"en",Ye=`${ee.PORTAL}/${ee.PORTAL_REST}/i18n/bundle/locale.portlet.taskManagement-${We}.json`;function Qe(){exoi18n.loadLanguageAsync(We,Ye).then((t=>{Vue.createApp({template:"<tasks-management></tasks-management>",i18n:t,vuetify:Je},"#tasksManagement","Tasks")}))}return e})()));