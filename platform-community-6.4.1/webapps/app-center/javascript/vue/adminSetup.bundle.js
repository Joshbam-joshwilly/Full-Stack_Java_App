define((()=>(()=>{"use strict";var e={d:(t,i)=>{for(var a in i)e.o(i,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:i[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:()=>_});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modal-mask uiPopupWrapper"},[t("div",{staticClass:"uiPopup app-center-modal-content",class:e.modalClass},[t("v-list-item",[t("v-list-item-content",[t("span",{staticClass:"PopupTitle popupTitle"},[e._v(e._s(e.title))])]),e._v(" "),t("v-list-item-action",[t("v-btn",{staticClass:"closeBindingModal",attrs:{icon:""},on:{click:e.closeModal}},[t("v-icon",{staticClass:"closeIcon",attrs:{large:"",color:"#5f708a"}},[e._v("\n            close\n          ")])],1)],1)],1),e._v(" "),t("div",{staticClass:"PopupContent popupContent"},[e._t("default")],2)],1)])};function a(e,t,i,a,s,r,o,n){var l,p="function"==typeof e?e.options:e;if(t&&(p.render=t,p.staticRenderFns=i,p._compiled=!0),a&&(p.functional=!0),r&&(p._scopeId="data-v-"+r),o?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),s&&s.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},p._ssrRegister=l):s&&(l=n?function(){s.call(this,(p.functional?this.parent:this).$root.$options.shadowRoot)}:s),l)if(p.functional){p._injectStyles=l;var m=p.render;p.render=function(e,t){return l.call(t),m(e,t)}}else{var d=p.beforeCreate;p.beforeCreate=d?[].concat(d,l):[l]}return{exports:e,options:p}}i._withStripped=!0;const s=a({props:{displayClose:{type:Boolean,default:!0},title:{type:String,default:""},modalClass:{type:String,default:""}},methods:{closeModal(){this.$emit("modal-closed")}}},i,[],!1,null,null,null).exports;var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"generalParams"},[t("div",{staticClass:"form-container appCenter-form"},[t("v-row",{staticClass:"px-12 py-0"},[t("v-list-item",{attrs:{dense:""}},[t("v-list-item-content",[t("span",[e._v("\n            "+e._s(`${e.$t("appCenter.adminSetupForm.maxFavoriteApps")} : ${e.maxFavoriteApps}`)+"\n          ")])]),e._v(" "),t("v-spacer"),e._v(" "),t("v-list-item-action",{staticClass:"setMaxFavorite"},[e.isMaxFavoriteAppsView?e._e():t("v-slider",{attrs:{color:"blue","track-color":"grey","always-dirty":"",min:"0",max:"50"},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("v-icon",{attrs:{color:"blue"},on:{click:e.decrement}},[e._v("\n                mdi-minus\n              ")])]},proxy:!0},{key:"append",fn:function(){return[t("v-icon",{attrs:{color:"blue"},on:{click:e.increment}},[e._v("\n                mdi-plus\n              ")])]},proxy:!0}],null,!1,947667343),model:{value:e.maxFavoriteApps,callback:function(t){e.maxFavoriteApps=t},expression:"maxFavoriteApps"}})],1),e._v(" "),t("v-list-item-action",{staticClass:"editMaxFavorite"},[t("div",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.bottom.body",value:e.$t("appCenter.adminSetupForm.save"),expression:"$t('appCenter.adminSetupForm.save')",modifiers:{bottom:!0,body:!0}}],staticClass:"saveChanges"},[e.isMaxFavoriteAppsView?e._e():t("a",{attrs:{"data-placement":"bottom","data-container":"body"},on:{click:function(t){return t.stopPropagation(),e.setMaxFavoriteApps()}}},[t("i",{staticClass:"uiIconSave uiIconLightGray"})])]),e._v(" "),t("div",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.bottom.body",value:e.$t("appCenter.adminSetupForm.cancel"),expression:"$t('appCenter.adminSetupForm.cancel')",modifiers:{bottom:!0,body:!0}}],staticClass:"cancelEdit"},[e.isMaxFavoriteAppsView?e._e():t("a",{attrs:{"data-placement":"bottom","data-container":"body"},on:{click:function(t){t.stopPropagation(),e.isMaxFavoriteAppsView=!0}}},[t("v-icon",{staticClass:"iconClose"},[e._v("\n                close\n              ")])],1)]),e._v(" "),e.isMaxFavoriteAppsView?t("v-btn",{attrs:{icon:""},on:{click:function(t){t.stopPropagation(),e.isMaxFavoriteAppsView=!1}}},[t("v-icon",[e._v("mdi-pencil")])],1):e._e()],1)],1)],1),e._v(" "),t("v-row",{staticClass:"px-6 my-2"},[t("v-divider")],1),e._v(" "),t("v-row",{staticClass:"px-12 py-0"},[t("v-list-item",{attrs:{dense:""}},[t("v-list-item-content",{staticClass:"defaultAppImage"},[t("span",[e._v("\n            "+e._s(e.$t("appCenter.adminSetupForm.defaultAppImage"))+"\n            "),e.defaultAppImage.fileBody?t("img",{staticClass:"appImage",attrs:{src:`data:image/png;base64,${e.defaultAppImage.fileBody}`}}):t("img",{staticClass:"appImage",attrs:{src:"/app-center/skin/images/defaultApp.png"}})]),e._v(" "),e.defaultAppImage.invalidImage?t("p",{staticClass:"errorInput"},[e._v("\n            "+e._s(e.$t("appCenter.adminSetupForm.imageError"))+"\n          ")]):e._e()]),e._v(" "),t("v-spacer"),e._v(" "),t("v-list-item-action",{staticClass:"setDefaultAppImage"},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.defaultAppImageViewMode&&!e.defaultAppImage.fileName&&!e.defaultAppImage.fileBody,expression:"!defaultAppImageViewMode\n              && !defaultAppImage.fileName &&\n              !defaultAppImage.fileBody"}]},[e.defaultAppImageViewMode?e._e():t("label",{staticClass:"custom-file-upload",attrs:{for:"defaultAppImageFile"}},[t("i",{staticClass:"uiDownloadIcon download-icon"}),e._v(e._s(e.$t("appCenter.adminSetupForm.browse"))+"\n            ")]),e._v(" "),e.defaultAppImageViewMode?e._e():t("input",{ref:"defaultAppImageFile",attrs:{id:"defaultAppImageFile",type:"file",accept:"image/*"},on:{change:function(t){return e.handleDefaultAppImageFileUpload()}}})]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.defaultAppImageViewMode&&e.defaultAppImage.fileName,expression:"!defaultAppImageViewMode && defaultAppImage.fileName"}]},[t("span",[e._v("\n              "+e._s(e.defaultAppImage.fileName)+"\n            ")]),e._v(" "),t("v-btn",{staticClass:"remove-file",attrs:{icon:""},on:{click:e.removeDefaultAppImageFile}},[t("v-icon",{attrs:{small:""}},[e._v("\n                mdi-delete\n              ")])],1)],1)]),e._v(" "),t("v-list-item-action",{staticClass:"editDefaultImage"},[t("div",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.bottom.body",value:e.$t("appCenter.adminSetupForm.save"),expression:"$t('appCenter.adminSetupForm.save')",modifiers:{bottom:!0,body:!0}}],staticClass:"saveChanges"},[e.defaultAppImageViewMode?e._e():t("a",{attrs:{"data-placement":"bottom","data-container":"body"},on:{click:function(t){return t.stopPropagation(),e.submitDefaultAppImage()}}},[t("i",{staticClass:"uiIconSave uiIconLightGray"})])]),e._v(" "),t("div",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.bottom.body",value:e.$t("appCenter.adminSetupForm.cancel"),expression:"$t('appCenter.adminSetupForm.cancel')",modifiers:{bottom:!0,body:!0}}],staticClass:"cancelEdit"},[e.defaultAppImageViewMode?e._e():t("a",{attrs:{"data-placement":"bottom","data-container":"body"},on:{click:function(t){return t.stopPropagation(),e.resetDefaultAppImage()}}},[t("v-icon",{staticClass:"iconClose"},[e._v("\n                close\n              ")])],1)]),e._v(" "),e.defaultAppImageViewMode?t("v-btn",{attrs:{icon:""},on:{click:function(t){t.stopPropagation(),e.defaultAppImageViewMode=!1}}},[t("v-icon",[e._v("mdi-pencil")])],1):e._e()],1)],1)],1)],1)])};r._withStripped=!0;const o=a({name:"AdminSetupGeneralParams",data:()=>({maxFavoriteApps:0,isMaxFavoriteAppsView:!0,defaultAppImageViewMode:!0,defaultAppImage:{fileBody:"",fileName:"",invalidSize:!1,invalidImage:!1}}),watch:{isMaxFavoriteAppsView(){this.isMaxFavoriteAppsView&&document.getElementsByClassName("tooltip")[0].remove()},defaultAppImageViewMode(){this.defaultAppImageViewMode&&document.getElementsByClassName("tooltip")[0].remove()}},created(){this.getAppGeneralSettings()},methods:{getAppGeneralSettings(){return fetch("/portal/rest/app-center/settings",{method:"GET",credentials:"include"}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Error getting favorite applications list")})).then((e=>{this.maxFavoriteApps=e&&e.maxFavoriteApps,Object.assign(this.defaultAppImage,e&&e.defaultApplicationImage)}))},setMaxFavoriteApps(){this.$nextTick().then(fetch(`/portal/rest/app-center/settings/maxFavorites?number=${this.maxFavoriteApps}`,{method:"PATCH",credentials:"include"})).then((()=>{this.isMaxFavoriteAppsView=!0}))},submitDefaultAppImage(){if(""===this.defaultAppImage.fileBody&&""===this.defaultAppImage.fileName)this.setDefaultAppImage();else if(this.$refs.defaultAppImageFile.files.length>0){const e=new FileReader;e.onload=e=>{e.target.result.includes("data:image")?this.$refs.defaultAppImageFile.files[0].size>1e5?this.defaultAppImage.invalidSize=!0:(this.defaultAppImage.fileBody=e.target.result,this.setDefaultAppImage()):this.defaultAppImage.invalidImage=!0},e.readAsDataURL(this.$refs.defaultAppImageFile.files[0])}else this.setDefaultAppImage()},setDefaultAppImage(){return fetch("/portal/rest/app-center/settings/image",{method:"PATCH",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:this.defaultAppImage&&this.defaultAppImage.id,fileName:this.defaultAppImage&&this.defaultAppImage.fileName,fileBody:this.defaultAppImage&&this.defaultAppImage.fileBody})}).then((()=>{this.defaultAppImageViewMode=!0,this.getAppGeneralSettings()})).catch((e=>{throw new Error(`Error when setting the default application image ${e}`)}))},handleDefaultAppImageFileUpload(){this.$refs.defaultAppImageFile.files.length>0?(this.defaultAppImage.fileName=this.$refs.defaultAppImageFile.files[0].name,this.defaultAppImage.invalidSize=!1,this.defaultAppImage.invalidImage=!1):this.removeDefaultAppImageFile()},removeDefaultAppImageFile(){this.defaultAppImage.fileName="",this.defaultAppImage.fileBody="",this.defaultAppImage.invalidSize=!1,this.defaultAppImage.invalidImage=!1,this.$refs.defaultAppImageFile.files.length>0&&(document.getElementById("defaultAppImageFile").value="")},resetDefaultAppImage(){this.defaultAppImageViewMode=!0,this.removeDefaultAppImageFile(),this.getAppGeneralSettings()},increment(){this.maxFavoriteApps++},decrement(){this.maxFavoriteApps--}}},r,[],!1,null,null,null).exports;var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"listApplications"},[e.loading?t("div",[t("v-skeleton-loader",{staticClass:"mx-auto",attrs:{type:"table-heading,table-tbody"}})],1):t("div",[t("v-row",[t("v-col",{attrs:{cols:"3"}},[t("v-btn",{staticClass:"addApplicationBtn",attrs:{depressed:""},on:{click:e.showAddApplicationDrawer}},[t("v-icon",{attrs:{left:""}},[e._v("\n            mdi-plus\n          ")]),e._v("\n          "+e._s(e.$t("appCenter.adminSetupForm.addNewApp"))+"\n        ")],1)],1),e._v(" "),t("v-spacer"),e._v(" "),t("v-col",{staticClass:"appSearch pb-5",attrs:{cols:"3"}},[t("v-text-field",{attrs:{placeholder:`${e.$t("appCenter.adminSetupList.filter")} ...`,"prepend-inner-icon":"mdi-filter","hide-details":""},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}})],1)],1),e._v(" "),t("v-divider"),e._v(" "),t("v-data-table",{attrs:{headers:e.headers,items:e.applicationsList,"footer-props":{itemsPerPageText:`${e.$t("appCenter.adminSetupForm.table.footer.text")}:`},"no-data-text":e.$t("appCenter.adminSetupForm.noApp"),"disable-sort":""},scopedSlots:e._u([{key:"item",fn:function(i){return[t("tr",[t("td",{staticClass:"text-md-start"},[i.item.imageFileId&&i.item.imageFileName?t("img",{attrs:{referrerpolicy:"no-referrer",src:`/portal/rest/app-center/applications/illustration/${i.item.id}?v=${i.item.imageLastModified}`}}):e.defaultAppImage.fileBody?t("img",{attrs:{src:`/portal/rest/app-center/applications/illustration/${i.item.id}?v=${i.item.imageLastModified}`}}):t("img",{attrs:{src:"/app-center/skin/images/defaultApp.png"}})]),e._v(" "),t("td",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.bottom.body",value:i.item.title.length>22?i.item.title:"",expression:"props.item.title.length > 22 ? props.item.title : ''",modifiers:{bottom:!0,body:!0}}],staticClass:"text-md-center tableAppTitle"},[e._v("\n            "+e._s(i.item.displayName?i.item.displayName:i.item.title)+"\n          ")]),e._v(" "),t("td",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.bottom.body",value:i.item.url.length>23?i.item.url:"",expression:"props.item.url.length > 23 ? props.item.url : ''",modifiers:{bottom:!0,body:!0}}],staticClass:"text-md-center appUrl"},[e._v("\n            "+e._s(i.item.url)+"\n          ")]),e._v(" "),t("td",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.bottom.body",value:i.item.description.length>91?i.item.description:"",expression:"props.item.description.length > 91 ? props.item.description : ''",modifiers:{bottom:!0,body:!0}}],staticClass:"text-md-center"},[t("div",{staticClass:"tableAppDescription"},[e._v("\n              "+e._s(i.item.description)+"              \n            ")])]),e._v(" "),t("td",{staticClass:"text-md-center"},[t("div",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.bottom.body",value:i.item.permissions.length>3?i.item.permissions:"",expression:"props.item.permissions.length > 3 ? props.item.permissions : ''",modifiers:{bottom:!0,body:!0}}],staticClass:"tableAppPermissions"},e._l(i.item.permissions,(function(a){return t("div",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.bottom.body",value:a.length>23&&i.item.permissions.length<=3?a:"",expression:"permission.length > 23 && props.item.permissions.length <= 3 ? permission : ''",modifiers:{bottom:!0,body:!0}}],key:a,staticClass:"permission"},[t("span","any"===a?[e._v("*")]:[e._v(" "+e._s(a))])])})),0)]),e._v(" "),t("td",{staticClass:"text-md-center"},[t("v-row",{attrs:{justify:"center"}},[t("v-switch",{on:{change:function(t){return e.updateOption(i.item)}},model:{value:i.item.mandatory,callback:function(t){e.$set(i.item,"mandatory",t)},expression:"props.item.mandatory"}})],1)],1),e._v(" "),t("td",{staticClass:"text-md-center"},[t("v-row",{attrs:{justify:"center"}},[t("v-switch",{on:{change:function(t){return e.updateOption(i.item)}},model:{value:i.item.active,callback:function(t){e.$set(i.item,"active",t)},expression:"props.item.active"}})],1)],1),e._v(" "),t("td",{staticClass:"text-md-center"},[t("v-row",{attrs:{justify:"center"}},[t("v-switch",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.bottom.body",value:e.$t("appCenter.adminSetupForm.table.switch.mobile.tooltip"),expression:"$t('appCenter.adminSetupForm.table.switch.mobile.tooltip')",modifiers:{bottom:!0,body:!0}}],on:{change:function(t){return e.updateOption(i.item)}},model:{value:i.item.mobile,callback:function(t){e.$set(i.item,"mobile",t)},expression:"props.item.mobile"}})],1)],1),e._v(" "),t("td",{staticClass:"text-md-center"},[t("v-row",{attrs:{justify:"center"}},[t("v-btn",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.bottom.body",value:e.$t("appCenter.adminSetupForm.table.editApp.tooltip"),expression:"$t('appCenter.adminSetupForm.table.editApp.tooltip')",modifiers:{bottom:!0,body:!0}}],staticClass:"actionsBtn",attrs:{icon:""},on:{click:function(t){return e.showEditApplicationDrawer(i.item)}}},[t("v-icon",{attrs:{medium:""}},[e._v("\n                  mdi-pencil\n                ")])],1),e._v(" "),t("v-btn",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.bottom.body",value:e.$t("appCenter.adminSetupForm.table.deleteApp.tooltip"),expression:"$t('appCenter.adminSetupForm.table.deleteApp.tooltip')",modifiers:{bottom:!0,body:!0}}],staticClass:"actionsBtn",attrs:{icon:""},on:{click:function(t){return e.toDeleteApplicationModal(i.item)}}},[t("v-icon",{attrs:{medium:""}},[e._v("\n                  mdi-delete\n                ")])],1)],1)],1)])]}}])}),e._v(" "),t("app-center-form-drawer",{ref:"appFormDrawer",attrs:{"form-array":e.formArray,"app-permissions":e.appPermissions,"existing-app-names":e.existingAppNames,"app-to-edit-original-title":e.appToEditOriginalTitle},on:{initApps:e.getApplicationsList,resetForm:e.closeDrawer,closeDrawer:e.closeDrawer}},[e.addApplication?t("span",{staticClass:"appLauncherDrawerTitle"},[e._v(e._s(e.$t("appCenter.adminSetupForm.createNewApp")))]):t("span",{staticClass:"appLauncherDrawerTitle"},[e._v(e._s(e.$t("appCenter.adminSetupForm.editApp")))])]),e._v(" "),t("transition",{attrs:{name:"fade"}},[t("app-center-modal",{directives:[{name:"show",rawName:"v-show",value:e.showDeleteApplicationModal,expression:"showDeleteApplicationModal"}],attrs:{title:e.$t("appCenter.adminSetupForm.modal.DeleteApp")},on:{"modal-closed":e.closeDeleteModal}},[t("p",[e._v(e._s(e.$t("appCenter.adminSetupForm.modal.confirmDelete")))]),e._v(" "),t("div",{staticClass:"uiAction uiActionBorder"},[t("div",{staticClass:"btn",on:{click:e.closeDeleteModal}},[e._v("\n            "+e._s(e.$t("appCenter.adminSetupForm.cancel"))+"\n          ")]),e._v(" "),t("div",{staticClass:"btn btn-primary",attrs:{id:"deleteBtn"},on:{click:e.deleteApplication}},[e._v("\n            "+e._s(e.$t("appCenter.adminSetupForm.modal.delete"))+"\n          ")])])])],1)],1)])};n._withStripped=!0;const l={name:"AdminSetup",data(){return{initialized:!1,loading:!0,headers:[{text:`${this.$t("appCenter.adminSetupList.avatar")}`,align:"center"},{text:`${this.$t("appCenter.adminSetupList.application")}`,align:"center"},{text:`${this.$t("appCenter.adminSetupForm.url")}`,align:"center"},{text:`${this.$t("appCenter.adminSetupForm.description")}`,align:"center"},{text:`${this.$t("appCenter.adminSetupForm.permissions")}`,align:"center"},{text:`${this.$t("appCenter.adminSetupForm.mandatory")}`,align:"center"},{text:`${this.$t("appCenter.adminSetupForm.active")}`,align:"center"},{text:`${this.$t("appCenter.adminSetupForm.mobile")}`,align:"center"},{text:`${this.$t("appCenter.adminSetupList.actions")}`,align:"center"}],defaultAppImage:{fileBody:"",fileName:"",invalidSize:!1,invalidImage:!1,invalidImageFormat:!1},searchText:"",searchApp:"",searchDelay:300,applicationsList:[],formArray:{id:0,title:"",url:"",helpPageURL:"",description:"",active:!0,mandatory:!1,mobile:!0,system:!1,permissions:[],imageFileBody:"",imageFileName:"",imageFileId:"",viewMode:!0,invalidSize:!1,invalidImage:!1,invalidImageFormat:!1},error:"",showDeleteApplicationModal:!1,displayAppDelay:200,addApplication:!0,appPermissions:[],existingAppNames:[],appToEditOriginalTitle:""}},watch:{searchText(){this.searchText&&this.searchText.trim().length?(clearTimeout(this.searchApp),this.searchApp=setTimeout((()=>{this.getApplicationsList()}),this.searchDelay)):this.searchText&&this.searchText.length===this.searchText.split(" ").length-1||this.getApplicationsList()}},created(){Promise.all([this.getApplicationsList(),this.getAppGeneralSettings()]).finally((()=>this.$root.$applicationLoaded())),$(document).on("keydown",(e=>{"Escape"===e.key&&this&&this.closeDeleteModal&&this.closeDeleteModal()}))},methods:{getApplicationsList(){return fetch(`/portal/rest/app-center/applications?offset=0&limit=0&keyword=${this.searchText}`,{method:"GET",credentials:"include"}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Error when getting the favorite applications list")})).then((e=>(this.applicationsList=[],e.applications.forEach((t=>{if(this.existingAppNames.push(t.title),t.system){const i=/\s/.test(t.title)?t.title.replace(/ /g,".").toLowerCase():t.title.toLowerCase();this.$t(`appCenter.system.application.${i}`).startsWith("appCenter.system.application")||(e.applications[this.getAppIndex(e.applications,t.id)].displayName=this.$t(`appCenter.system.application.${i}`))}t.computedUrl=t.url.replace(/^\.\//,`${eXo.env.portal.context}/${eXo.env.portal.portalName}/`),t.computedUrl=t.computedUrl.replace("@user@",eXo.env.portal.userName),t.target=0===t.computedUrl.indexOf("/")?"_self":"_blank"})),this.applicationsList=e.applications,this.$nextTick()))).finally((()=>{this.loading=!1,this.initialized||(this.initialized=!0,window.setTimeout((()=>{this.$root.$emit("application-loaded")}),this.displayAppDelay))}))},deleteApplication(){return fetch(`/portal/rest/app-center/applications/${this.formArray.id}`,{method:"DELETE",credentials:"include"}).then((e=>{if(e&&e.ok)return e.json;throw new Error("Error when deleting application by id")})).then((()=>{this.closeDeleteModal(),this.getApplicationsList()}))},resetForm(){this.error="",this.formArray.id="",this.formArray.title="",this.formArray.url="",this.formArray.helpPageURL="",this.formArray.imageFileName="",this.formArray.imageFileBody="",this.formArray.description="",this.formArray.mandatory=!1,this.formArray.system=!1,this.formArray.active=!0,this.formArray.mobile=!0,this.formArray.permissions=[],this.formArray.invalidSize=!1,this.formArray.invalidImage=!1,this.formArray.invalidImageFormat=!1,this.appToEditOriginalTitle=""},showAddApplicationDrawer(){this.resetForm(),this.$refs.appFormDrawer.open(),$("body").addClass("hide-scroll"),this.addApplication=!0,this.formArray.viewMode=!0},showEditApplicationDrawer(e){this.resetForm(),this.appToEditOriginalTitle=e.title,this.$refs.appFormDrawer.open(),$("body").addClass("hide-scroll"),this.addApplication=!1,Object.assign(this.formArray,e),this.appPermissions=[];for(const e of this.formArray.permissions){const t=e.startsWith("*:")?e.substr(2,e.length-2):e;this.appPermissions.push({id:t,name:t})}},toDeleteApplicationModal(e){this.showDeleteApplicationModal=!0,this.formArray.id=e.id,this.formArray.title=e.title},closeDeleteModal(){this.showDeleteApplicationModal=!1,this.resetForm()},validUrl(e){const t=e&&e.url;return e.system||t&&(0===t.indexOf("/portal/")||0===t.indexOf("./")||t.match(/(http(s)?:\/\/.)[-a-zA-Z0-9@:%._\\+~#=]{2,256}/g))},closeDrawer(){this.$refs.appFormDrawer.close()},getAppGeneralSettings(){return fetch("/portal/rest/app-center/settings",{method:"GET",credentials:"include"}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Error getting favorite applications list")})).then((e=>{Object.assign(this.defaultAppImage,e&&e.defaultApplicationImage)}))},updateOption(e){return fetch("/portal/rest/app-center/applications",{credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},method:"PUT",body:JSON.stringify({id:e.id,title:e.title,url:e.url,helpPageURL:e.helpPageURL,description:e.description,active:e.active,mandatory:e.mandatory,isMobile:e.mobile,system:e.system,permissions:e.permissions,imageFileBody:e.imageFileBody,imageFileName:e.imageFileName,imageFileId:e.imageFileId})}).catch((e=>{401===e.response.status?this.error=this.$t("appCenter.adminSetupForm.unauthorized"):this.error=this.$t("appCenter.adminSetupForm.error")}))},getAppIndex:(e,t)=>e.findIndex((e=>e.id===t))}},p=a(l,n,[],!1,null,null,null).exports;var m=function(){var e=this,t=e._self._c;return t("exo-drawer",{ref:"formDrawer",staticClass:"appCenterDrawer",attrs:{right:!e.$vuetify.rtl,"body-classes":"hide-scroll"}},[t("template",{slot:"title"},[e._t("default")],2),e._v(" "),t("div",{staticClass:"content pa-3",attrs:{slot:"content"},slot:"content"},[t("v-label",{attrs:{for:"title"}},[e._v("\n      "+e._s(e.$t("appCenter.adminSetupForm.title"))+"*\n    ")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.formArray.title,expression:"formArray.title"}],staticClass:"input-block-level ignore-vuetify-classes my-3 required",attrs:{type:"text",name:"title",maxlength:"200",readonly:e.formArray.system,placeholder:e.$t("appCenter.adminSetupForm.titlePlaceholder"),required:""},domProps:{value:e.formArray.title},on:{input:function(t){t.target.composing||e.$set(e.formArray,"title",t.target.value)}}}),e._v(" "),!e.formArray.system&&e.appTitleExists()?t("p",{staticClass:"error"},[e._v("\n      "+e._s(e.$t("appCenter.adminSetupForm.existingTitle.error"))+"\n    ")]):e._e(),e._v(" "),t("v-label",{attrs:{for:"url"}},[e._v("\n      "+e._s(e.$t("appCenter.adminSetupForm.url"))+"*\n    ")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.formArray.url,expression:"formArray.url"}],staticClass:"input-block-level ignore-vuetify-classes my-3 required",attrs:{type:"url",name:"url",maxlength:"500",readonly:e.formArray.system,placeholder:e.$t("appCenter.adminSetupForm.urlPlaceholder"),required:""},domProps:{value:e.formArray.url},on:{input:function(t){t.target.composing||e.$set(e.formArray,"url",t.target.value)}}}),e._v(" "),t("v-row",{staticClass:"uploadImageContainer"},[t("v-col",{staticClass:"uploadImageTitle content-box-sizing",attrs:{cols:"1"}},[t("v-label",{attrs:{for:"image"}},[e._v("\n          "+e._s(e.$t("appCenter.adminSetupForm.image"))+"\n        ")])],1),e._v(" "),t("v-col",{directives:[{name:"show",rawName:"v-show",value:!e.formArray.imageFileName,expression:"!formArray.imageFileName"}],staticClass:"uploadImage content-box-sizing",attrs:{cols:"3"}},[t("label",{staticClass:"custom-file-upload",attrs:{for:"imageFile"}},[t("i",{staticClass:"uiIconFolderSearch uiIcon24x24LightGray"}),e._v(" "),t("span",[e._v("\n            "+e._s(e.$t("appCenter.adminSetupForm.browse"))+"\n          ")])]),e._v(" "),t("input",{ref:"image",attrs:{id:"imageFile",type:"file",accept:"image/*"},on:{change:e.handleFileUpload}})]),e._v(" "),t("v-col",{directives:[{name:"show",rawName:"v-show",value:e.formArray.imageFileName,expression:"formArray.imageFileName"}],staticClass:"imageSet",attrs:{cols:"4"}},[null!=e.formArray.imageFileName&&""!=e.formArray.imageFileName?t("v-list-item",{staticClass:"file-listing"},[t("v-list-item-content",[t("div",{staticClass:"imageTitle"},[e._v("\n              "+e._s(e.formArray.imageFileName)+"\n            ")])]),e._v(" "),t("v-list-item-action",[t("v-btn",{staticClass:"remove-file",attrs:{icon:"",disabled:e.formArray.system},on:{click:e.removeFile}},[t("v-icon",{attrs:{small:""}},[e._v("\n                mdi-delete\n              ")])],1)],1)],1):e._e()],1),e._v(" "),e.formArray.invalidImageFormat?t("v-col",{staticClass:"uploadImageInfo"},[t("p",{class:"imageFormat error"},[t("v-icon",{attrs:{small:""}},[e._v("\n            mdi-information\n          ")]),e._v("\n          "+e._s(e.$t("appCenter.adminSetupForm.imageFormatError"))+"\n        ")],1)]):t("v-col",{staticClass:"uploadImageInfo"},[t("p",{class:"sizeInfo"+(e.formArray.invalidSize?" error":"")},[t("v-icon",{attrs:{small:""}},[e._v("\n            mdi-information\n          ")]),e._v("\n          "+e._s(e.$t("appCenter.adminSetupForm.sizeError"))+"\n        ")],1)])],1),e._v(" "),t("v-label",{attrs:{for:"description"}},[e._v("\n      "+e._s(e.$t("appCenter.adminSetupForm.description"))+"\n    ")]),e._v(" "),t("v-textarea",{staticClass:"appDescription",attrs:{name:"description",rows:"20",counter:"1000",rules:e.rules,placeholder:e.$t("appCenter.adminSetupForm.descriptionPlaceHolder"),"no-resize":""},model:{value:e.formArray.description,callback:function(t){e.$set(e.formArray,"description",t)},expression:"formArray.description"}}),e._v(" "),t("v-row",{staticClass:"applicationProperties"},[t("v-col",[t("v-switch",{staticClass:"mandatoryLabel",attrs:{label:e.$t("appCenter.adminSetupForm.mandatory")},model:{value:e.formArray.mandatory,callback:function(t){e.$set(e.formArray,"mandatory",t)},expression:"formArray.mandatory"}})],1),e._v(" "),t("v-col",[t("v-switch",{attrs:{label:e.$t("appCenter.adminSetupForm.active")},model:{value:e.formArray.active,callback:function(t){e.$set(e.formArray,"active",t)},expression:"formArray.active"}})],1),e._v(" "),t("v-col",[t("v-switch",{attrs:{label:e.$t("appCenter.adminSetupForm.mobile")},model:{value:e.formArray.mobile,callback:function(t){e.$set(e.formArray,"mobile",t)},expression:"formArray.mobile"}})],1)],1),e._v(" "),t("v-label",{attrs:{for:"permissions"}},[e._v("\n      "+e._s(e.$t("appCenter.adminSetupForm.permissions"))+"\n    ")]),e._v(" "),t("app-center-suggester",{staticClass:"input-block-level ignore-vuetify-classes my-3",attrs:{name:"permissions",maxlength:"200",options:e.suggesterOptions,"source-providers":[e.findGroups],"application-permissions":e.appPermissions,placeholder:e.$t("appCenter.adminSetupForm.permissionsPlaceHolder")},model:{value:e.permissions,callback:function(t){e.permissions=t},expression:"permissions"}}),e._v(" "),t("v-label",{attrs:{for:"helpPage"}},[e._v("\n      "+e._s(e.$t("appCenter.adminSetupForm.helpPage"))+"\n    ")]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.formArray.helpPageURL,expression:"formArray.helpPageURL"}],staticClass:"input-block-level ignore-vuetify-classes my-3",attrs:{type:"url",name:"name",maxlength:"500",placeholder:e.$t("appCenter.adminSetupForm.helpPagePlaceholder")},domProps:{value:e.formArray.helpPageURL},on:{input:function(t){t.target.composing||e.$set(e.formArray,"helpPageURL",t.target.value)}}})],1),e._v(" "),t("div",{staticClass:"d-flex",attrs:{slot:"footer"},slot:"footer"},[t("button",{staticClass:"btn ms-auto applicationsActionBtn",attrs:{type:"button"},on:{click:e.close}},[e._v("\n      "+e._s(e.$t("appCenter.adminSetupForm.cancel"))+"\n    ")]),e._v(" "),t("button",{staticClass:"btn btn-primary ms-6 applicationsActionBtn",attrs:{type:"button",disabled:!e.canSaveApplication},on:{click:e.submitForm}},[e._v("\n      "+e._s(e.$t("appCenter.adminSetupForm.save"))+"\n    ")])])],2)};m._withStripped=!0;const d={props:{formArray:{type:Object,default:null},appPermissions:{type:Array,default:()=>[]},existingAppNames:{type:Array,default:()=>[]},appToEditOriginalTitle:{type:Object,default:null}},data(){const e=this;return{isAppMandatory:!1,suggesterOptions:{type:"tag",plugins:["remove_button","restore_on_backspace"],create:!1,createOnBlur:!1,highlight:!1,openOnFocus:!1,valueField:"value",labelField:"text",searchField:["text"],closeAfterSelect:!1,dropdownParent:"body",hideSelected:!0,renderMenuItem:(t,i)=>e.renderMenuItem(t,i),sortField:[{field:"order"},{field:"$score"}]},permissions:[],rules:[e=>e.length<=1e3]}},computed:{canSaveApplication(){return this.formArray.title&&""!==this.formArray.title&&!this.appTitleExists()&&!this.formArray.invalidSize&&!this.formArray.invalidImage&&!this.formArray.invalidImageFormat&&this.validUrl(this.formArray)&&this.formArray.description.length<=1e3&&(this.validHelpPageUrl(this.formArray)||""===this.formArray.helpPageURL)}},watch:{appPermissions(){this.permissions=[];const e=this.appPermissions.map((e=>e.id));this.permissions.push(...e)}},mounted(){$(".formContent").on("scroll",(function(){$(".selectize-dropdown").css("display","none"),$(".selectize-input").find("input").blur()}))},methods:{open(){this.$refs.formDrawer.open()},close(){this.$refs.formDrawer.close()},validUrl(e){const t=e&&e.url;return e.system||t&&(0===t.indexOf("/portal/")||0===t.indexOf("./")||t.match(/(http(s)?:\/\/.)[-a-zA-Z0-9@:%._\\+~#=]{2,256}/g))},validHelpPageUrl(e){const t=e&&e.helpPageURL;return e.system||t&&(0===t.indexOf("/portal/")||0===t.indexOf("./")||t.match(/(http(s)?:\/\/.)[-a-zA-Z0-9@:%._\\+~#=]{2,256}/g))},handleFileUpload(){if(this.$refs.image.files.length>0){if(this.$refs.image.files[0].type.substring(6).includes("svg")&&(this.formArray.invalidImageFormat=!0),this.formArray.imageFileName=this.$refs.image.files[0].name,this.$refs.image.files[0].size>1e5)return void(this.formArray.invalidSize=!0);this.formArray.invalidImage=!1}else this.removeFile()},removeFile(){this.formArray.imageFileName="",this.formArray.imageFileBody="",this.formArray.imageFileId="",this.formArray.invalidSize=!1,this.formArray.invalidImage=!1,this.formArray.invalidImageFormat=!1,this.$refs.image.files.length>0&&(document.getElementById("imageFile").value="")},addOrEditApplication(){return this.$refs.formDrawer.startLoading(),fetch("/portal/rest/app-center/applications",{credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},method:this.formArray.id?"PUT":"POST",body:JSON.stringify({id:this.formArray.id,title:this.formArray.title,url:this.formArray.url,helpPageURL:this.formArray.helpPageURL,description:this.formArray.description,active:this.formArray.active,mandatory:this.formArray.mandatory,isMobile:this.formArray.mobile,system:this.formArray.system,permissions:this.permissions.map((e=>`*:${e}`)),imageFileBody:this.formArray.imageFileBody,imageFileName:this.formArray.imageFileName,imageFileId:this.formArray.imageFileId})}).then((()=>{this.$emit("initApps")})).catch((e=>{401===e.response.status?this.error=this.$t("appCenter.adminSetupForm.unauthorized"):this.error=this.$t("appCenter.adminSetupForm.error")})).finally((()=>{this.$refs.formDrawer.endLoading(),this.close(),this.permissions=[]}))},submitForm(){if(this.$refs.image&&this.$refs.image.files.length>0){this.formArray.imageFileName=this.$refs.image.files[0].name;const e=new FileReader;e.onload=e=>{e.target.result.includes("data:image")?(this.formArray.imageFileBody=e.target.result,this.addOrEditApplication()):this.formArray.invalidImage=!0},e.readAsDataURL(this.$refs.image.files[0])}else this.addOrEditApplication()},resetForm(){this.permissions=[],this.$emit("c")},findGroups(e,t){if(!e.length)return t();this.getGroups(e).then((e=>{const i=[];for(const t of e.entities)i.push({avatarUrl:null,text:`*:${t.id}`,value:t.id,type:"group"});t(i)}))},getGroups:e=>fetch(`/portal/rest/v1/groups?q=${e}`,{credentials:"include"}).then((e=>e.json())),renderMenuItem:(e,t)=>`\n        <div class="item">*:${t(e.value)}</div>\n      `,appTitleExists(){return this.formArray.title!==this.appToEditOriginalTitle&&this.existingAppNames.includes(this.formArray.title)}}},c=a(d,m,[],!1,null,null,null).exports;var u=function(){return(0,this._self._c)("input",{attrs:{type:"text"},domProps:{value:this.selectedItems}})};u._withStripped=!0;const v=a({model:{prop:"selectedItems",event:"change"},props:{options:{type:Object,default:function(){return{}}},sourceProviders:{type:Array,default:()=>[]},selectedItems:{type:Array,default:()=>[]},boundGroups:{type:Array,default:()=>[]},applicationPermissions:{type:Array,default:()=>[]}},watch:{selectedItems(){this.$emit("change",this.selectedItems),this.bindSelectedItems()}},mounted(){const e=this,t={type:"tag",sourceProviders:[],plugins:["remove_button"],providers:{},onChange(t){e.selectedItems=t.split(",")}};this.sourceProviders.forEach((e=>{"function"==typeof e?(t.providers[e.name]=e,t.sourceProviders.push(e.name)):t.sourceProviders.push(e)}));const i=Object.assign({},t,this.options);$(this.$el).suggester(i)},methods:{bindSelectedItems(){const e=$(this.$el)[0].selectize;1!==this.selectedItems.length||this.selectedItems[0].startsWith("/")||this.selectedItems.shift();const t=[],i=[];e.items.forEach((e=>{this.selectedItems.includes(e)||t.push(e)})),t.forEach((t=>{e.removeItem(t,!0)})),this.selectedItems.forEach((t=>{t&&t.startsWith("/")&&!e.items.includes(t)&&i.push(t)})),i&&i.length>0&&i.forEach((e=>{this.addItem(e)}))},addItem(e){if(e&&!this.boundGroups.map((e=>e.group)).includes(e)){const t=$(this.$el)[0].selectize;if(!t.options[`${e}`]){const i=this.getGroup(e);t.options[`${e}`]={avatarUrl:null,text:`*:${i.id}`,value:i.id,type:"group"}}t.addItem(e)}},getGroup(e){return this.applicationPermissions.filter((t=>t.id===e))[0]}}},u,[],!1,null,null,null).exports;var f=function(){var e=this,t=e._self._c;return t("v-app",{staticClass:"applicationsAdmin",attrs:{id:"KudosAdminApp"}},[t("main",[t("v-layout",[t("v-flex",[t("v-tabs",{attrs:{"slider-size":"4"},model:{value:e.selectedTab,callback:function(t){e.selectedTab=t},expression:"selectedTab"}},[t("v-tab",{key:"applications",attrs:{href:"#applications"},on:{click:e.loadApplicationsList}},[e._v("\n            "+e._s(e.$t("appCenter.adminSetupForm.applications"))+"\n          ")]),e._v(" "),t("v-tab",{key:"settings",attrs:{href:"#settings"}},[e._v("\n            "+e._s(e.$t("appCenter.adminSetupForm.generalSettings"))+"\n          ")])],1),e._v(" "),t("v-tabs-items",{staticClass:"mt-2",model:{value:e.selectedTab,callback:function(t){e.selectedTab=t},expression:"selectedTab"}},[t("v-tab-item",{staticClass:"px-4 py-2",attrs:{id:"applications",value:"applications"}},[t("adminSetup-list",{key:e.adminSetupListKey})],1),e._v(" "),t("v-tab-item",{staticClass:"px-4 py-2",attrs:{id:"settings",value:"settings"}},[t("adminSetup-generalParams")],1)],1)],1)],1)],1)])};f._withStripped=!0;const h={"adminSetup-generalParams":o,"adminSetup-list":p,"app-center-modal":s,"app-center-form-drawer":c,"app-center-suggester":v,"app-center-admin-setup":a({data:()=>({selectedTab:"applications",adminSetupListKey:0}),methods:{loadApplicationsList(){this.adminSetupListKey++}}},f,[],!1,null,null,null).exports};for(const e in h)Vue.component(e,h[e]);const g=eXo&&eXo.env&&eXo.env.portal&&eXo.env.portal.language||"en",y=`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.addon.appcenter-${g}.json`,A="adminSetup";function _(e){exoi18n.loadLanguageAsync(g,y).then((t=>{Vue.createApp({data:{preferences:e},template:`<app-center-admin-setup\n                  id="${A}" />`,vuetify:Vue.prototype.vuetifyOptions,i18n:t},`#${A}`,"Application Center Administration")}))}return t})()));