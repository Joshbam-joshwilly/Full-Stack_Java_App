define((()=>(()=>{"use strict";var t={d:(e,r)=>{for(var i in r)t.o(r,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:r[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{init:()=>u});var r=function(){var t=this,e=t._self._c;return e("v-app",{staticClass:"analytics-application",attrs:{id:t.appId,flat:""}},[t.canEdit?[e("analytics-chart-setting",{ref:"chartSettingDialog",staticClass:"mt-0",attrs:{"retrieve-mappings-url":t.retrieveMappingsUrl,settings:t.chartSettings},on:{save:t.saveSettings}})]:t._e(),t._v(" "),e("v-card",{staticClass:"d-flex flex-column ma-auto analytics-chart-percentage analytics-chart-parent white",attrs:{flat:""}},[e("div",{staticClass:"d-flex pa-3 analytics-chart-header",attrs:{flat:""}},[e("v-toolbar-title",{staticClass:"d-flex"},[e("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function({on:r,attrs:i}){return[e("v-btn",t._g(t._b({staticClass:"my-auto me-2 primary",attrs:{height:"20",width:"20",icon:"",small:"",outlined:""}},"v-btn",i,!1),r),[e("v-icon",{attrs:{size:"12"}},[t._v("fa-info")])],1)]}}])},[t._v(" "),e("span",[e("div",[t._v("- "+t._s(t.$t("analytics.totalSamplesCount"))+": "+t._s(t.chartsData.dataCount))]),t._v(" "),e("div",[t._v("- "+t._s(t.$t("analytics.computingTime"))+": "+t._s(t.chartsData.computingTime)+" ms")])])]),t._v(" "),t.title?e("div",{staticClass:"my-auto subtitle-1 text-truncate analytics-chart-title",attrs:{title:t.title}},[t._v("\n          "+t._s(t.$t(t.title))+"\n        ")]):t._e()],1),t._v(" "),e("v-spacer"),t._v(" "),e("analytics-select-period",{attrs:{"hide-time":""},model:{value:t.selectedPeriod,callback:function(e){t.selectedPeriod=e},expression:"selectedPeriod"}}),t._v(" "),t.canEdit?e("v-menu",{attrs:{"offset-y":""},scopedSlots:t._u([{key:"activator",fn:function({on:r}){return[e("v-btn",t._g({staticClass:"ml-2",attrs:{icon:""},on:{blur:function(e){return t.closeMenu()}}},r),[e("v-icon",[t._v("mdi-dots-vertical")])],1)]}}],null,!1,859802859),model:{value:t.showMenu,callback:function(e){t.showMenu=e},expression:"showMenu"}},[t._v(" "),e("v-list",[e("v-list-item",{on:{mousedown:function(t){return t.preventDefault()},click:function(e){return t.$refs.chartSettingDialog.open()}}},[e("v-list-item-title",[t._v(t._s(t.$t("analytics.settings")))])],1)],1)],1):t._e()],1),t._v(" "),t.loading&&"percentageBar"===t.chartType?e("v-card-text",{staticClass:"ma-auto",attrs:{color:"primary"}},[e("v-progress-linear",{attrs:{indeterminate:""}})],1):t.loading&&"percentage"===t.chartType?e("v-progress-circular",{staticClass:"ma-auto",attrs:{color:"primary",indeterminate:""}}):t._e(),t._v(" "),"percentageBar"===t.chartType?e("analytics-percentage-bar-chart",{directives:[{name:"show",rawName:"v-show",value:!t.loading,expression:"!loading"}],ref:"analyticsRateBody",attrs:{colors:t.colors}}):"percentage"===t.chartType?e("analytics-percentage-chart",{directives:[{name:"show",rawName:"v-show",value:!t.loading,expression:"!loading"}],ref:"analyticsRateBody",attrs:{settings:t.chartSettings}}):t._e()],1)],2)};function i(t,e,r,i,s,a,n,o){var l,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=r,c._compiled=!0),i&&(c.functional=!0),a&&(c._scopeId="data-v-"+a),n?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(n)},c._ssrRegister=l):s&&(l=o?function(){s.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:s),l)if(c.functional){c._injectStyles=l;var h=c.render;c.render=function(t,e){return l.call(e),h(t,e)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,l):[l]}return{exports:t,options:c}}r._withStripped=!0;const s=i({props:{retrieveSettingsUrl:{type:String,default:function(){return null}},retrieveMappingsUrl:{type:String,default:function(){return null}},retrieveFiltersUrl:{type:String,default:function(){return null}},retrieveChartDataUrl:{type:String,default:function(){return null}},retrieveChartSamplesUrl:{type:String,default:function(){return null}},saveSettingsUrl:{type:String,default:function(){return null}}},data:()=>({canEdit:!1,value:0,error:null,title:null,chartType:"line",initialized:!1,showMenu:!1,displaySamplesCount:!1,selectedPeriod:null,loading:!0,appId:`AnalyticsApplication${parseInt(1e4*Math.random()).toString().toString()}`,chartsData:{},chartSettings:null,DEFAULT_COLORS:["#319ab3","#f97575","#98cc81","#4273c8","#cea6ac","#bc99e7","#9ee4f5","#774ea9","#ffa500","#bed67e","#bc99e7","#ffaacc"]}),computed:{randomColorIndex(){return Math.floor(Math.random()*this.DEFAULT_COLORS.length)},colors(){return this.chartSettings&&this.chartSettings.colors&&this.chartSettings.colors.length&&this.chartSettings.colors.slice(0,1)||this.DEFAULT_COLORS.slice(this.randomColorIndex,1)}},watch:{selectedPeriod(t,e){e||!t||this.initialized?t&&this.updateChart():(this.initialized=!0,this.init())}},methods:{init(){return this.loading=!0,this.getSettings().then(this.$nextTick).then(this.updateChart).then(this.$nextTick).then(this.getFilters).finally((()=>{this.loading=!1}))},getSettings(){return fetch(this.retrieveSettingsUrl,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error(`Error getting analytics of chart '${this.title}'`)})).then((t=>{this.chartSettings||(this.chartSettings=t),this.canEdit=t&&t.canEdit,this.chartType=t&&t.chartType,this.title=t&&t.title||""})).catch((t=>{console.error("Error retrieving chart filters",t),this.error="Error retrieving chart filters"}))},getFilters(){if(this.canEdit)return fetch(this.retrieveFiltersUrl,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error(`Error getting analytics of ${JSON.stringify(this.settings)}`)})).then((t=>{this.chartSettings=t,t||(this.chartSettings={filters:[],aggregations:[]}),this.chartSettings.value||(this.chartSettings.value={}),this.chartSettings.threshold||(this.chartSettings.threshold={}),this.chartSettings.value.filters||(this.chartSettings.value.filters=[]),this.chartSettings.threshold.filters||(this.chartSettings.threshold.filters=[]),this.chartSettings.xAxisAggregations||(this.chartSettings.xAxisAggregations=[]),this.chartSettings.value.yAxisAggregation||(this.chartSettings.value.yAxisAggregation={}),this.chartSettings.threshold.yAxisAggregation||(this.chartSettings.threshold.yAxisAggregation={})})).catch((t=>{console.error("Error retrieving chart filters",t),this.error="Error retrieving chart filters"}))},saveSettings(t){return this.loading=!0,fetch(this.saveSettingsUrl,{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:$.param({settings:JSON.stringify(t)})}).then((e=>{if(!e||!e.ok)throw new Error("Error saving chart settings",t);return this.chartSettings=JSON.parse(JSON.stringify(t)),this.init()})).catch((t=>{console.error("Error saving chart settings",t),this.error="Error saving chart settings"})).finally((()=>{this.loading=!1}))},updateChart(){if(!this.selectedPeriod)return;this.loading=!0;const t={lang:eXo.env.portal.language&&eXo.env.portal.language.replace("_","-"),periodType:this.selectedPeriod.period||"",min:this.selectedPeriod.min,max:this.selectedPeriod.max+6e4,timeZone:this.$analyticsUtils.USER_TIMEZONE_ID};return t.timeZone=this.$analyticsUtils.USER_TIMEZONE_ID,this.selectedPeriod.period&&(t.date=Date.now()),fetch(this.retrieveChartDataUrl,{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:$.param(t)}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error getting analytics with settings:",this.chartSettings)})).then((t=>{this.chartsData=t,this.$refs.analyticsRateBody.init(this.chartsData)})).catch((t=>{console.error("fetch analytics - error",t),this.error="Error getting analytics"})).finally((()=>this.loading=!1))},closeMenu(){this.showMenu=!1}}},r,[],!1,null,null,null).exports;var a=function(){var t=this,e=t._self._c;return e("v-flex",{staticClass:"analytics-progress-bar-chart-body pa-4 border-box-sizing"},[e("v-progress-linear",{staticClass:"analytics-progress-bar",attrs:{value:t.currentPeriodPercentage,color:t.chartColor,height:"45"}},[t.initialized?e("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function({on:r,attrs:i}){return[e("h3",t._g(t._b({staticClass:"font-weight-bold white--text",style:`margin-left: calc(${t.progressBarValueClass}% - 24px); margin-right: auto;`},"h3",i,!1),r),[t._v("\n          "+t._s(t.currentPeriodPercentage)+"%\n        ")])]}}],null,!1,1674505206)},[t._v(" "),e("span",[t._v(t._s(t.$t("analytics.percentOfValue",{0:t.currentPeriodValue,1:t.currentPeriodThreshold})))])]):t._e()],1),t._v(" "),e("div",{staticClass:"text-no-wrap mt-2"},[e("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function({on:r,attrs:i}){return[e("span",t._g(t._b({class:t.lastPeriodComparaisonClass},"span",i,!1),r),[t._v("\n          "+t._s(t.$t("analytics.points",{0:t.diffSign,1:t.diffWithLastPeriod}))+"\n        ")])]}}])},[t._v(" "),e("span",[t._v(t._s(t.$t("analytics.previousPeriodValue",{0:`${t.lastPeriodPercentage}%`})))])]),t._v(" "),e("span",{staticClass:"text-sub-title"},[t._v("\n      "+t._s(t.$t("analytics.vsLastPeriod"))+"\n    ")])],1)],1)};a._withStripped=!0;const n=i({props:{colors:{type:Array,default:null}},data:()=>({initialized:!1,lastPeriodValue:0,currentPeriodValue:0,lastPeriodThreshold:0,currentPeriodThreshold:0}),computed:{chartColor(){return this.colors&&this.colors.length&&this.colors[0]||"#319ab3"},currentPeriodPercentage(){const t=this.currentPeriodThreshold&&Math.round(this.currentPeriodValue/this.currentPeriodThreshold*1e4)/100||0;return this.$analyticsUtils.toFixed(t)},lastPeriodPercentage(){const t=this.lastPeriodThreshold&&Math.round(this.lastPeriodValue/this.lastPeriodThreshold*1e4)/100||0;return this.$analyticsUtils.toFixed(t)},diffSign(){return this.currentPeriodPercentage===this.lastPeriodPercentage?"":this.currentPeriodPercentage>this.lastPeriodPercentage?"+":"-"},diffWithLastPeriod(){const t=Math.abs(this.currentPeriodPercentage-this.lastPeriodPercentage);return this.$analyticsUtils.toFixed(t)},lastPeriodComparaisonClass(){return this.currentPeriodPercentage===this.lastPeriodPercentage?"":this.currentPeriodPercentage>this.lastPeriodPercentage?"success--text":"error--text"},progressBarValueClass(){return(this.currentPeriodPercentage>9?this.currentPeriodPercentage:10)/2}},watch:{data(){this.init()}},methods:{init(t){t&&(this.currentPeriodValue=t.currentPeriodValue,this.currentPeriodThreshold=t.currentPeriodThreshold,this.lastPeriodValue=t.previousPeriodValue,this.lastPeriodThreshold=t.previousPeriodThreshold),this.$nextTick().then((()=>this.initialized=!0))}}},a,[],!1,null,null,null).exports;var o=function(){var t=this,e=t._self._c;return e("v-flex",{staticClass:"analytics-percentage-chart-body align-center border-box-sizing"},[t.initialized?e("h1",{staticClass:"font-weight-bold display-2",style:`color: ${t.chartColor};`},[t._v("\n    "+t._s(t.currentPeriodPercentage)+"%\n  ")]):t._e(),t._v(" "),t.isUserLimit?[e("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function({on:r,attrs:i}){return[e("div",t._g(t._b({staticClass:"text-sub-title text-no-wrap mt-2"},"div",i,!1),r),[t._v("\n          "+t._s(t.$t("analytics.ofActiveUsers"))+"\n          "),e("span",{staticClass:"primary--text"},[t._v(t._s(t.$t("analytics.percentOfUsers",{0:t.percentage})))])])]}}],null,!1,4228320163)},[t._v(" "),e("ul",{staticClass:"ps-0"},[e("li",[t._v("- "+t._s(t.$t("analytics.currentPeriodUsers",{0:t.currentPeriodLimit})))]),t._v(" "),e("li",[t._v("- "+t._s(t.$t("analytics.previousPeriodUsers",{0:t.lastPeriodLimit})))])])])]:t._e(),t._v(" "),e("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function({on:r,attrs:i}){return[e("div",t._g(t._b({staticClass:"text-no-wrap mt-1"},"div",i,!1),r),[e("span",{class:t.lastPeriodComparaisonClass},[t._v("\n          "+t._s(t.$t("analytics.points",{0:t.diffSign,1:t.diffWithLastPeriod}))+"\n        ")]),t._v(" "),e("span",{staticClass:"text-sub-title"},[t._v("\n          "+t._s(t.$t("analytics.vsLastPeriod"))+"\n        ")])])]}}])},[t._v(" "),e("span",[t._v(t._s(t.$t("analytics.previousPeriodValue",{0:`${t.lastPeriodPercentage}%`})))])])],2)};o._withStripped=!0;const l={"analytics-rate-application":s,"analytics-percentage-bar-chart":n,"analytics-percentage-chart":i({props:{settings:{type:Object,default:null}},data:()=>({initialized:!1,lastPeriodValue:0,currentPeriodValue:0,lastPeriodThreshold:0,currentPeriodThreshold:0,lastPeriodLimit:0,currentPeriodLimit:0}),computed:{hasLimit(){return this.settings&&this.settings.percentageLimit},isUserLimit(){return this.hasLimit&&"userId"===this.settings.percentageLimit.field},percentage(){return this.hasLimit&&this.settings.percentageLimit.percentage},chartColor(){return this.settings&&this.settings.colors&&this.settings.colors.length&&this.settings.colors[0]||"#319ab3"},currentPeriodPercentage(){const t=this.currentPeriodThreshold&&Math.round(this.currentPeriodValue/this.currentPeriodThreshold*1e4)/100||0;return this.$analyticsUtils.toFixed(t)},lastPeriodPercentage(){const t=this.lastPeriodThreshold&&Math.round(this.lastPeriodValue/this.lastPeriodThreshold*1e4)/100||0;return this.$analyticsUtils.toFixed(t)},diffSign(){return this.currentPeriodPercentage===this.lastPeriodPercentage?"":this.currentPeriodPercentage>this.lastPeriodPercentage?"+":"-"},diffWithLastPeriod(){const t=Math.abs(this.currentPeriodPercentage-this.lastPeriodPercentage);return this.$analyticsUtils.toFixed(t)},lastPeriodComparaisonClass(){return this.currentPeriodPercentage===this.lastPeriodPercentage?"":this.currentPeriodPercentage>this.lastPeriodPercentage?"success--text":"error--text"},progressBarValueClass(){return(this.currentPeriodPercentage>9?this.currentPeriodPercentage:10)/2}},watch:{data(){this.init()}},methods:{init(t){t&&(this.currentPeriodValue=t.currentPeriodValue,this.currentPeriodThreshold=t.currentPeriodThreshold,this.lastPeriodValue=t.previousPeriodValue,this.lastPeriodThreshold=t.previousPeriodThreshold,this.currentPeriodLimit=t.currentPeriodLimit||0,this.lastPeriodLimit=t.previousPeriodLimit||0),this.$nextTick().then((()=>this.initialized=!0))}}},o,[],!1,null,null,null).exports};for(const t in l)Vue.component(t,l[t]);Vue.use(Vuetify);const c=new Vuetify(eXo.env.portal.vuetifyPreset),h=eXo&&eXo.env&&eXo.env.portal&&eXo.env.portal.language||"en",d=`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.portlet.Analytics-${h}.json`;function u(t){exoi18n.loadLanguageAsync(h,d).then((e=>{const r=$(`#${t}`),i=r.attr("data-settings-url"),s=r.attr("data-mappings-url"),a=r.attr("data-filters-url"),n=r.attr("data-chart-data-url"),o=r.attr("data-chart-samples-url"),l=r.attr("data-field-values-url"),h=r.attr("data-save-settings-url");new Vue({data:()=>({retrieveSettingsURL:i,retrieveMappingsURL:s,retrieveFiltersURL:a,retrieveChartDataURL:n,retrieveChartSamplesURL:o,retrieveFieldValuesUrl:l,saveSettingsURL:h}),mounted(){document.dispatchEvent(new CustomEvent("hideTopBarLoading"))},template:`\n        <analytics-rate-application\n           id="${t}"\n           :retrieve-settings-url="retrieveSettingsURL"\n           :retrieve-mappings-url="retrieveMappingsURL"\n           :retrieve-filters-url="retrieveFiltersURL"\n           :retrieve-chart-data-url="retrieveChartDataURL"\n           :retrieve-field-values-url="retrieveFieldValuesUrl"\n           :retrieve-chart-samples-url="retrieveChartSamplesURL"\n           :save-settings-url="saveSettingsURL"\n           data-id="${t}"\n           data-settings-url="${i}"\n           data-mappings-url="${s}"\n           data-filters-url="${a}"\n           data-chart-data-url="${n}"\n           data-chart-samples-url="${o}"\n           data-field-values-url="${l}"\n           data-save-settings-url="${h}" />`,vuetify:c,i18n:e}).$mount(`#${t}`)}))}return document.dispatchEvent(new CustomEvent("displayTopBarLoading")),e})()));