define((()=>(()=>{var t={996:()=>{extensionRegistry.registerExtension("AnalyticsSamples","SampleItem",{type:"userId",options:{rank:10,vueComponent:Vue.options.components["analytics-profile-sample-item-attribute"],match:t=>"userId"===t||"modifierSocialId"===t,options:{isUser:!0}}}),extensionRegistry.registerExtension("AnalyticsSamples","SampleItem",{type:"spaceId",options:{rank:10,vueComponent:Vue.options.components["analytics-profile-sample-item-attribute"],match:t=>"spaceId"===t,options:{isSpace:!0}}}),extensionRegistry.registerExtension("AnalyticsSamples","SampleItem",{type:"time",options:{rank:30,vueComponent:Vue.options.components["analytics-date-sample-item-attribute"],match:(t,e)=>t.toLowerCase().includes("time")&&Number.isInteger(Number(e))&&Number(e)>16e11&&Number(e)<3e12}})}},e={};function i(a){var s=e[a];if(void 0!==s)return s.exports;var l=e[a]={exports:{}};return t[a](l,l.exports,i),l.exports}i.d=(t,e)=>{for(var a in e)i.o(e,a)&&!i.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};return(()=>{"use strict";i.r(a);var t={};i.r(t),i.d(t,{USER_TIMEZONE_ID:()=>at,buildPageLinkRecursively:()=>rt,getPage:()=>nt,loadSpace:()=>lt,loadUser:()=>st,toFixed:()=>ot});var e=function(){var t=this,e=t._self._c;return e("exo-drawer",{ref:"chartSettingDrawer",attrs:{"drawer-width":t.drawerWidth,"allow-expand":"",right:""}},[e("template",{slot:"title"},[t._v("\n    "+t._s(t.$t("analytics.settings"))+"\n  ")]),t._v(" "),e("template",{slot:"content"},[e("v-card-text",[e("v-tabs",{attrs:{"background-color":"transparent",color:"primary"},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[e("v-tab",[t._v(t._s(t.$t("analytics.general")))]),t._v(" "),e("v-tab",[t._v(t._s(t.$t("analytics.colors")))]),t._v(" "),t.isPercentageBar?[e("v-tab",[t._v(t._s(t.$t("analytics.percentageValue")))]),t._v(" "),e("v-tab",[t._v(t._s(t.$t("analytics.percentageThreshold")))])]:[e("v-tab",[t._v(t._s(t.$t("analytics.xAxis")))]),t._v(" "),e("v-tab",[t._v(t._s(t.$t("analytics.yAxis")))]),t._v(" "),e("v-tab",[t._v(t._s(t.$t("analytics.multipleCharts")))]),t._v(" "),e("v-tab",[t._v(t._s(t.$t("analytics.dataFilters")))])]],2),t._v(" "),e("v-tabs-items",{model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[e("v-tab-item",{attrs:{eager:""}},[e("analytics-general-setting-form",{ref:"settingForm",attrs:{settings:t.chartSettings}})],1),t._v(" "),e("v-tab-item",{attrs:{eager:""}},[e("analytics-colors-setting-form",{ref:"colorsForm",attrs:{settings:t.chartSettings}})],1),t._v(" "),t.isPercentageBar?[e("v-tab-item",{attrs:{eager:""}},[e("h3",[t._v(t._s(t.$t("analytics.computingRule")))]),t._v(" "),e("analytics-y-axis-form",{ref:"yAxis",attrs:{"fields-mappings":t.fieldsMappings,"y-axis-aggregation":t.chartSettings.value.yAxisAggregation}}),t._v(" "),e("v-divider",{staticClass:"my-4"}),t._v(" "),e("analytics-search-filter-form",{ref:"searchFilter",attrs:{"fields-mappings":t.fieldsMappings,filters:t.chartSettings.value.filters}}),t._v(" "),e("analytics-limit-filter-form",{ref:"searchFilter",attrs:{"fields-mappings":t.fieldsMappings,settings:t.chartSettings}})],1),t._v(" "),e("v-tab-item",{attrs:{eager:""}},[e("h3",[t._v(t._s(t.$t("analytics.computingRule")))]),t._v(" "),e("analytics-y-axis-form",{ref:"yAxis",attrs:{"fields-mappings":t.fieldsMappings,"y-axis-aggregation":t.chartSettings.threshold.yAxisAggregation}}),t._v(" "),e("v-divider",{staticClass:"my-4"}),t._v(" "),e("analytics-search-filter-form",{ref:"searchFilter",attrs:{"fields-mappings":t.fieldsMappings,filters:t.chartSettings.threshold.filters}})],1)]:[e("v-tab-item",{attrs:{eager:""}},[e("analytics-x-axis-form",{ref:"xAxis",attrs:{"fields-mappings":t.fieldsMappings,settings:t.chartSettings}})],1),t._v(" "),e("v-tab-item",{attrs:{eager:""}},[e("analytics-y-axis-form",{ref:"yAxis",attrs:{"fields-mappings":t.fieldsMappings,"y-axis-aggregation":t.chartSettings.yAxisAggregation}})],1),t._v(" "),e("v-tab-item",{attrs:{eager:""}},[e("analytics-multiple-charts",{ref:"multipleCharts",attrs:{"fields-mappings":t.fieldsMappings,settings:t.chartSettings}})],1),t._v(" "),e("v-tab-item",{attrs:{eager:""}},[e("analytics-search-filter-form",{ref:"searchFilter",attrs:{"fields-mappings":t.fieldsMappings,filters:t.chartSettings.filters,"no-title":""}})],1)]],2)],1)],1),t._v(" "),e("template",{slot:"footer"},[e("div",{staticClass:"d-flex"},[e("v-spacer"),t._v(" "),e("button",{staticClass:"btn ignore-vuetify-classes me-1",on:{click:t.close}},[t._v("\n        "+t._s(t.$t("analytics.close"))+"\n      ")]),t._v(" "),e("button",{staticClass:"btn btn-primary ignore-vuetify-classes ms-1",on:{click:t.save}},[t._v("\n        "+t._s(t.$t("analytics.save"))+"\n      ")])],1)])],2)};e._withStripped=!0;function s(t,e,i,a,s,l,r,n){var o,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=i,c._compiled=!0),a&&(c.functional=!0),l&&(c._scopeId="data-v-"+l),r?(o=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},c._ssrRegister=o):s&&(o=n?function(){s.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:s),o)if(c.functional){c._injectStyles=o;var u=c.render;c.render=function(t,e){return o.call(e),u(t,e)}}else{var p=c.beforeCreate;c.beforeCreate=p?[].concat(p,o):[o]}return{exports:t,options:c}}const l=s({props:{retrieveMappingsUrl:{type:String,default:function(){return null}},settings:{type:Object,default:function(){return null}}},data:()=>({chartSettings:{},fieldsMappings:[],dialog:!1,tab:0,drawerWidth:"650px"}),computed:{settingJsonContent(){return this.settings&&JSON.stringify(this.settings,null,2)},chartType(){return this.chartSettings&&this.chartSettings.chartType},isPercentageBar(){return"percentageBar"===this.chartType||"percentage"===this.chartType}},watch:{dialog(){this.dialog&&this.init()},isPercentageBar(){this.isPercentageBar?this.chartSettings.multipleChartsField=null:this.chartSettings.multipleChartsField=this.settings.multipleChartsField}},methods:{init(){return this.loading=!0,fetch(this.retrieveMappingsUrl,{method:"GET",credentials:"include",headers:{Accept:"application/json"}}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error getting analytics fields mappings:")})).then((t=>(this.fieldsMappings=t,this.$nextTick()))).then((()=>{this.$refs&&Object.keys(this.$refs).forEach((t=>{const e=this.$refs[t];e&&e.init&&e.init()}))})).catch((t=>{console.error("fetch analytics - error",t),this.error="Error getting analytics"})).finally((()=>this.loading=!1))},open(){this.chartSettings=JSON.parse(JSON.stringify(this.settings)),this.dialog=!0,this.$refs.chartSettingDrawer.open()},save(){this.$emit("save",this.chartSettings),this.dialog=!1,this.$refs.chartSettingDrawer.close()},close(){this.dialog=!1,this.$refs.chartSettingDrawer.close()}}},e,[],!1,null,null,null).exports;var r=function(){var t=this,e=t._self._c;return e("v-dialog",{staticClass:"editChatSettings",attrs:{id:"jsonChartSettingsModal","content-class":"uiPopup with-overflow",width:"750px","max-width":"100vw","min-height":"450px","max-height":"100%",persistent:""},on:{keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"]))return null;t.dialog=!1}},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[e("v-card",{staticClass:"elevation-12"},[e("div",{staticClass:"ignore-vuetify-classes popupHeader ClearFix"},[e("a",{staticClass:"uiIconClose pull-right",attrs:{"aria-hidden":"true"},on:{click:function(e){t.dialog=!1}}}),t._v(" "),e("span",{staticClass:"ignore-vuetify-classes PopupTitle popupTitle"},[t._v("\n        JSON Panel of chart "),e("span",{staticClass:"primary--text"},[t._v(t._s(t.settings&&t.$t(t.settings.title)))])])]),t._v(" "),e("v-card-text",[e("v-textarea",{staticClass:"jsonSetting",attrs:{"row-height":15,readonly:""},model:{value:t.settingJsonContent,callback:function(e){t.settingJsonContent=e},expression:"settingJsonContent"}})],1),t._v(" "),e("v-card-actions",[e("v-spacer"),t._v(" "),e("button",{staticClass:"btn ignore-vuetify-classes",on:{click:function(e){t.dialog=!1}}},[t._v("\n        Close\n      ")]),t._v(" "),e("v-spacer")],1)],1)],1)};r._withStripped=!0;const n=s({props:{settings:{type:Object,default:function(){return null}}},data:()=>({dialog:!1}),computed:{chartSettings(){return Object.assign({},this.settings)},settingJsonContent(){return this.settings&&JSON.stringify(this.chartSettings,null,2)}},methods:{open(){this.dialog=!0}}},r,[],!1,null,null,null).exports;var o=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:t.id}},[e("v-autocomplete",{ref:"fieldSelectAutoComplete",staticClass:"pt-0 pb-3",attrs:{items:t.items,label:t.label,"value-comparator":t.selectedValueComparator,"return-object":!1,"menu-props":"closeOnClick, maxHeight = 100","item-text":"label","item-value":"name","return-value":"",filled:"",attach:"","persistent-hint":"",dense:"",chips:""},on:{input:t.updateData},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1)};o._withStripped=!0;const c=s({props:{value:{type:String,default:function(){return null}},items:{type:Array,default:function(){return[]}},label:{type:String,default:function(){return null}},placeholder:{type:String,default:function(){return null}}},data:()=>({id:`FieldSelection${parseInt(1e4*Math.random()).toString().toString()}`}),mounted(){$(`#${this.id} input`).on("blur",(()=>{this.$refs.fieldSelectAutoComplete.isFocused=!1}))},methods:{updateData(){this.$emit("input",this.value),this.$emit("change",this.value),this.$forceUpdate()},selectedValueComparator:(t,e)=>(t&&t.value||t)===(e&&e.value||e)}},o,[],!1,null,null,null).exports;var u=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:t.id}},[e("v-autocomplete",{ref:"fieldSelectAutoComplete",staticClass:"operatorInput pa-0",attrs:{items:t.fields,label:t.label,placeholder:t.placeholder,"value-comparator":t.selectedValueComparator,"return-object":!1,"item-value":t.aggregation?"aggregationFieldName":"searchFieldName","menu-props":t.menuProps,"item-text":"label",filled:"","persistent-hint":"",chips:"",dense:""},on:{change:t.updateData},scopedSlots:t._u([{key:"selection",fn:function(i){return[e("v-chip",t._b({attrs:{"input-value":i.selected,title:i.item&&i.item.label||i.item},on:{click:i.select}},"v-chip",i.attrs,!1),[t._v("\n        "+t._s(i.item&&i.item.label||i.item)+"\n      ")])]}},{key:"item",fn:function(i){return[e("v-list-item-content",{domProps:{textContent:t._s(i.item.label)}})]}}]),model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1)};u._withStripped=!0;const p=s({props:{fieldsMappings:{type:Array,default:function(){return[]}},aggregation:{type:Boolean,default:function(){return!1}},numeric:{type:Boolean,default:function(){return!1}},value:{type:String,default:function(){return null}},label:{type:String,default:function(){return null}},placeholder:{type:String,default:function(){return null}},attach:{type:Boolean,default:!1}},data:()=>({id:`FieldSelection${parseInt(1e4*Math.random()).toString().toString()}`}),computed:{menuProps(){return this.attach?"closeOnClick, maxHeight = 100":""},fieldNames(){return this.fieldsMappings.forEach((t=>{if(!t.label){const e=t.name,i=`analytics.field.label.${e.indexOf(".")>=0?e.substring(e.lastIndexOf(".")+1):e}`,a=this.$t(i);t.label=a===i?`${this.$t("analytics.field.label.default")} ${e}`:a}})),this.fieldsMappings},fields(){return this.fieldNames.filter((t=>(!this.aggregation||t.aggregation)&&(!this.numeric||t.numeric||t.date))).sort(((t,e)=>t.label.toLowerCase().localeCompare(e.label.toLowerCase())))}},mounted(){$(`#${this.id} input[type="text"]`).on("blur",(()=>{this.$refs.fieldSelectAutoComplete.isFocused=!1}))},methods:{updateData(){this.$emit("input",this.value),this.$emit("change",this.value),this.$forceUpdate()},selectedValueComparator:(t,e)=>(t&&t.value||t)===(e&&e.value||e)}},u,[],!1,null,null,null).exports;var d=function(){var t=this,e=t._self._c;return e("v-layout",{staticClass:"analytics-field-filter"},[e("v-flex",{staticClass:"mb-auto",attrs:{xs3:""}},[e("analytics-field-selection",{attrs:{"fields-mappings":t.fieldsMappings,placeholder:t.$t("analytics.fieldNamePlaceholder"),attach:t.attach},model:{value:t.filter.field,callback:function(e){t.$set(t.filter,"field",e)},expression:"filter.field"}})],1),t._v(" "),e("v-flex",{staticClass:"d-flex mb-auto content-box-sizing",attrs:{xs4:""}},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.filter.type,expression:"filter.type"}],staticClass:"operatorInput border-color my-auto mx-1 text-truncate ignore-vuetify-classes",attrs:{placeholder:t.$t("analytics.operatorPlaceholder"),title:t.searchFilterTypeLabel},on:{change:[function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.filter,"type",e.target.multiple?i:i[0])},t.filterTypeChanged]}},t._l(t.searchFilterTypes,(function(i){return e("option",{key:i.value,staticClass:"text-truncate",attrs:{title:i.text},domProps:{value:i.value}},[t._v("\n        "+t._s(i.text)+"\n      ")])})),0)]),t._v(" "),e("v-flex",{staticClass:"mb-auto",attrs:{xs4:""}},[t.isMultipleValuesSelection?[e("analytics-multiple-values-selection",{attrs:{filter:t.filter,"suggester-labels":t.suggesterLabels,"field-label":t.selectedFieldLabel,aggregation:t.isSelectedFieldAggregation,placeholder:t.valuesComparatorPlaceholder}})]:t.isSingleValueSelection?["spaceId"===t.filter.field?e("analytics-space-field-filter",{attrs:{filter:t.filter,"suggester-labels":t.suggesterLabels}}):"userId"===t.filter.field?e("analytics-user-field-filter",{attrs:{filter:t.filter,"suggester-labels":t.suggesterLabels}}):t.isSelectedFieldAggregation?e("analytics-text-value-filter",{attrs:{filter:t.filter,"suggester-labels":t.suggesterLabels}}):e("input",{directives:[{name:"model",rawName:"v-model",value:t.filter.valueString,expression:"filter.valueString"}],staticClass:"ignore-vuetify-classes width-auto pa-0 my-auto",attrs:{type:"text",placeholder:t.valuesComparatorPlaceholder,required:""},domProps:{value:t.filter.valueString},on:{input:function(e){e.target.composing||t.$set(t.filter,"valueString",e.target.value)}}})]:"LESS"===t.filter.type||"GREATER"===t.filter.type?e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.filter.valueString,expression:"filter.valueString",modifiers:{number:!0}}],staticClass:"ignore-vuetify-classes width-auto pa-0 my-auto",attrs:{type:"number",placeholder:t.$t("analytics.numberValuePlaceholder"),required:""},domProps:{value:t.filter.valueString},on:{input:function(e){e.target.composing||t.$set(t.filter,"valueString",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}):"RANGE"===t.filter.type&&t.filter.range?[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.filter.range.min,expression:"filter.range.min",modifiers:{number:!0}}],staticClass:"ignore-vuetify-classes width-auto pa-0 my-auto",attrs:{type:"number",placeholder:t.$t("analytics.minPlaceholder"),required:""},domProps:{value:t.filter.range.min},on:{input:function(e){e.target.composing||t.$set(t.filter.range,"min",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.filter.range.max,expression:"filter.range.max",modifiers:{number:!0}}],staticClass:"ignore-vuetify-classes pa-0 width-auto my-auto",attrs:{type:"number",placeholder:t.$t("analytics.maxPlaceholder"),required:""},domProps:{value:t.filter.range.max},on:{input:function(e){e.target.composing||t.$set(t.filter.range,"max",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]:t._e()],2),t._v(" "),e("div",{staticClass:"mx-auto",attrs:{xs1:""}},[e("v-btn",{attrs:{icon:""},on:{click:function(e){return t.$emit("delete")}}},[e("v-icon",[t._v("fa-minus-circle")])],1)],1)],1)};d._withStripped=!0;const h=s({props:{filter:{type:Object,default:function(){return null}},fieldsMappings:{type:Array,default:function(){return[]}},attach:{type:Boolean,default:!1}},data:()=>({users:[],spaces:[],searchOptions:{currentUser:""}}),computed:{suggesterLabels(){return{searchPlaceholder:this.$t("analytics.searchPlaceholder"),placeholder:this.$t("analytics.searchPlaceholder"),noDataLabel:this.$t("analytics.noDataLabel")}},selectedFieldMapping(){return this.filter&&this.filter.field?this.fieldsMappings.find((t=>t.searchFieldName===this.filter.field)):null},isSelectedFieldAggregation(){return this.selectedFieldMapping&&this.selectedFieldMapping.aggregation},selectedFieldLabel(){return this.selectedFieldMapping&&this.selectedFieldMapping.label||""},searchFilterTypes(){return[{text:this.$t("analytics.equals"),value:"EQUAL",placeholder:this.$t("analytics.fieldValuePlaceholder")},{text:this.$t("analytics.notEquals"),value:"NOT_EQUAL",placeholder:this.$t("analytics.fieldValuePlaceholder")},{text:this.$t("analytics.inValues"),value:"IN_SET",placeholder:this.$t("analytics.setPlaceholder")},{text:this.$t("analytics.notInValues"),value:"NOT_IN_SET",placeholder:this.$t("analytics.setPlaceholder")},{text:this.$t("analytics.inRange"),value:"RANGE",placeholder:this.$t("analytics.rangePlaceholder")},{text:this.$t("analytics.less"),value:"LESS",placeholder:this.$t("analytics.lessPlaceholder")},{text:this.$t("analytics.greater"),value:"GREATER",placeholder:this.$t("analytics.greaterPlaceholder")},{text:this.$t("analytics.isNull"),value:"IS_NULL",placeholder:this.$t("analytics.isEmptyPlaceholder")},{text:this.$t("analytics.isNotNull"),value:"NOT_NULL",placeholder:this.$t("analytics.isNotNullPlaceholder")}]},filterField(){return this.filter&&this.filter.field},isIdentitySuggester(){return"userId"===this.filterField||"spaceId"===this.filterField},searchFilterTypesObject(){const t={};return this.searchFilterTypes.forEach((e=>t[e.value]=e.text)),t},operatorType(){return this.filter&&this.filter.type},isMultipleValuesSelection(){return"IN_SET"===this.operatorType||"NOT_IN_SET"===this.operatorType},isSingleValueSelection(){return"EQUAL"===this.operatorType||"NOT_EQUAL"===this.operatorType},valuesComparatorPlaceholder(){return("EQUAL"===this.operatorType||"NOT_EQUAL"===this.operatorType)&&this.$t("analytics.valuePlaceholder")||("IN_SET"===this.operatorType||"NOT_IN_SET"===this.operatorType)&&this.$t("analytics.setPlaceholder")},multipleOperator(){return"IN_SET"===this.operatorType||"NOT_IN_SET"===this.operatorType},searchFilterTypeLabel(){return this.operatorType&&this.searchFilterTypesObject[this.operatorType]||""}},watch:{filterField(){this.filterTypeChanged()}},methods:{filterTypeChanged(){this.filter.valueString="",this.filter.users=null,this.filter.spaces=null,this.users=[],this.spaces=[],"RANGE"===this.operatorType?this.filter.range={}:this.filter.range=null}}},d,[],!1,null,null,null).exports;var m=function(){var t=this,e=t._self._c;return e("v-flex",{staticClass:"d-flex flex-column"},[e("exo-identity-suggester",{ref:"spaceSuggester",staticClass:"analytics-suggester",attrs:{labels:t.suggesterLabels,"ignore-items":t.spaceIds,"include-spaces":""},on:{input:t.selectIdentity},model:{value:t.selectedSpace,callback:function(e){t.selectedSpace=e},expression:"selectedSpace"}}),t._v(" "),t.spaces&&t.multipleOperator?e("div",{staticClass:"d-flex flex-column"},t._l(t.spaces,(function(i){return e("div",{key:i},[e("v-chip",{staticClass:"identitySuggesterItem mt-2",attrs:{title:i.profile.fullName,color:"primary",close:""},on:{"click:close":function(e){return t.remove(i)}}},[e("v-avatar",{attrs:{left:""}},[e("v-img",{attrs:{src:i.profile.avatarUrl}})],1),t._v(" "),e("span",{staticClass:"text-truncate"},[t._v("\n          "+t._s(i.profile.fullName)+"\n        ")])],1)],1)})),0):t._e()],1)};m._withStripped=!0;const g=s({props:{filter:{type:Object,default:function(){return null}},suggesterLabels:{type:Array,default:function(){return[]}}},data:()=>({selectedSpace:null,spaces:[]}),computed:{operatorType(){return this.filter&&this.filter.type},multipleOperator(){return"IN_SET"===this.operatorType||"NOT_IN_SET"===this.operatorType},spaceIds(){return this.spaces.map((t=>t.id))}},created(){if(this.filter.valueString){const t=this.filter.valueString.split(","),e=[],i=[];t.forEach((t=>{const a=this.$spaceService.getSpaceById(t).then((t=>{if(t){const e={id:`space:${t.prettyName}`,providerId:"space",remoteId:t.prettyName,spaceId:t.id,profile:{fullName:t.displayName,avatarUrl:t.avatarUrl}};i.push(e)}})).catch((e=>console.error("Error retrieving space with id",t,e)));e.push(a)})),Promise.all(e).finally((()=>{this.multipleOperator?this.spaces=i:this.selectedSpace=i&&i[0]||null}))}},methods:{selectIdentity(t){if(this.multipleOperator){const e=t&&(t.length&&t[0].id||t.id);if(!e)return;if(this.spaceIds.includes(e))return void(this.selectedSpace=null)}else this.filter.valueString="";if(t){const e=Array.isArray(t)&&t||[t],i=this.multipleOperator&&this.filter.valueString&&this.filter.valueString.split(",")||[],a=[];e.forEach((t=>{if(t.spaceId)i.push(t.spaceId),this.multipleOperator&&this.spaces.push(t);else{const e=this.$identityService.getIdentityByProviderIdAndRemoteId(t.providerId,t.remoteId).then((t=>{t.space&&(i.push(t.space.id),this.multipleOperator&&this.spaces.push({id:`space:${t.space.prettyName}`,providerId:"space",remoteId:t.space.prettyName,spaceId:t.space.id,profile:{fullName:t.space.displayName,avatarUrl:t.space.avatarUrl}}))})).catch((e=>console.error("Error retrieving identity with id",t.id,e)));a.push(e)}})),Promise.all(a).finally((()=>{this.filter.valueString=i.join(","),this.multipleOperator&&(this.selectedSpace=null)}))}},remove(t){t&&this.spaces.includes(t)&&(this.spaces.splice(this.spaces.indexOf(t),1),this.filter.valueString=this.spaces.map((t=>t.spaceId||t.id)).join(","))}}},m,[],!1,null,null,null).exports;var f=function(){var t=this,e=t._self._c;return e("v-flex",{staticClass:"d-flex flex-column"},[e("exo-identity-suggester",{ref:"userSuggester",staticClass:"analytics-suggester",attrs:{"search-options":t.searchOptions,labels:t.suggesterLabels,"ignore-items":t.userIds,"include-users":""},on:{input:t.selectIdentity},model:{value:t.selectedUser,callback:function(e){t.selectedUser=e},expression:"selectedUser"}}),t._v(" "),t.users&&t.multipleOperator?e("div",{staticClass:"d-flex flex-column"},t._l(t.users,(function(i){return e("div",{key:i},[e("v-chip",{staticClass:"identitySuggesterItem mt-2",attrs:{title:i.profile.fullName,color:"primary",close:""},on:{"click:close":function(e){return t.remove(i)}}},[e("v-avatar",{attrs:{left:""}},[e("v-img",{attrs:{src:i.profile.avatarUrl}})],1),t._v(" "),e("span",{staticClass:"text-truncate"},[t._v("\n          "+t._s(i.profile.fullName)+"\n        ")])],1)],1)})),0):t._e()],1)};f._withStripped=!0;const v=s({props:{filter:{type:Object,default:function(){return null}},suggesterLabels:{type:Array,default:function(){return[]}}},data:()=>({selectedUser:null,users:[],searchOptions:{currentUser:""}}),computed:{operatorType(){return this.filter&&this.filter.type},multipleOperator(){return"IN_SET"===this.operatorType||"NOT_IN_SET"===this.operatorType},userIds(){return this.users.map((t=>t.id))}},created(){if(this.filter.valueString){const t=this.filter.valueString.split(","),e=[],i=[];t.forEach((t=>{const a=this.$identityService.getIdentityById(t.trim()).then((t=>{if(t&&t.profile){const e={id:`${t.providerId}:${t.remoteId}`,providerId:t.providerId,remoteId:t.remoteId,identityId:t.id,profile:{fullName:t.profile.fullname,avatarUrl:t.profile.avatar}};i.push(e)}})).catch((e=>console.error("Error retrieving user with identity id",t,e)));e.push(a)})),Promise.all(e).finally((()=>{this.multipleOperator?this.users=i:this.selectedUser=i&&i[0]||null}))}},methods:{selectIdentity(t){if(this.multipleOperator){const e=t&&(t.length&&t[0].id||t.id);if(!e)return;if(this.userIds.includes(e))return void(this.selectedUser=null)}else this.filter.valueString="";if(t){const e=Array.isArray(t)&&t||[t],i=this.multipleOperator&&this.filter.valueString&&this.filter.valueString.split(",")||[],a=[];e.forEach((t=>{if(t.identityId)i.push(t.identityId),this.multipleOperator&&this.users.push(t);else{const e=this.$identityService.getIdentityByProviderIdAndRemoteId(t.providerId,t.remoteId).then((t=>{t.profile&&(i.push(t.id),this.multipleOperator&&this.users.push({id:`${t.providerId}:${t.remoteId}`,providerId:t.providerId,remoteId:t.remoteId,identityId:t.id,profile:{fullName:t.profile.fullname,avatarUrl:t.profile.avatar}}))})).catch((e=>console.error("Error retrieving identity with id",t.id,e)));a.push(e)}})),Promise.all(a).finally((()=>{this.filter.valueString=i.join(","),this.multipleOperator&&(this.selectedUser=null)}))}},remove(t){t&&this.users.indexOf(t)>=0&&(this.users.splice(this.users.indexOf(t),1),this.filter.valueString=this.users.map((t=>t.identityId||t.id)).join(","))}}},f,[],!1,null,null,null).exports;var y=function(){var t=this,e=t._self._c;return e("v-flex",{staticClass:"d-flex flex-column"},[e("analytics-text-value-suggester",{ref:"valueSuggester",staticClass:"analytics-suggester",attrs:{filter:t.filter,labels:t.suggesterLabels},on:{input:t.selectValue},model:{value:t.selectedValue,callback:function(e){t.selectedValue=e},expression:"selectedValue"}}),t._v(" "),t.values&&t.multipleOperator?e("div",{staticClass:"d-flex flex-column"},t._l(t.values,(function(i){return e("div",{key:i},[e("v-chip",{staticClass:"identitySuggesterItem mt-2",attrs:{title:i,color:"primary",close:""},on:{"click:close":function(e){return t.remove(i)}}},[e("span",{staticClass:"text-truncate"},[t._v("\n          "+t._s(i.label)+"\n        ")])])],1)})),0):t._e()],1)};y._withStripped=!0;const x=s({props:{filter:{type:Object,default:function(){return null}},suggesterLabels:{type:Array,default:function(){return[]}}},data:()=>({selectedValue:null,values:[]}),computed:{operatorType(){return this.filter&&this.filter.type},multipleOperator(){return"IN_SET"===this.operatorType||"NOT_IN_SET"===this.operatorType},valueIds(){return this.values.map((t=>t.id))}},created(){if(this.filter.valueString){const t=this.filter.valueString.split(","),e=[];t.forEach((t=>{t&&e.push({value:t,label:this.computeI18NLabel(t)})})),this.multipleOperator?this.values=e:this.selectedValue=e&&e[0]||null}},methods:{computeI18NLabel(t){const e=`analytics.${t}`,i=this.$t(e);return i===e?t:i},selectValue(t){if(this.multipleOperator){const e=t&&(t.length&&t[0].value||t.value);if(!e)return;if(this.valueIds.includes(e))return this.selectedValue=null,void this.$refs.valueSuggester.clear()}else this.filter.valueString="";if(t){const e=this.multipleOperator&&this.filter.valueString&&this.filter.valueString.split(",")||[],i=t&&t.value||t,a=Array.isArray(i)&&i||[i];e.push(...a),this.filter.valueString=e.join(","),this.multipleOperator&&e.forEach((t=>{t&&!this.values.find((e=>e.value===t))&&this.values.push({value:t,label:this.computeI18NLabel(t)})}))}this.multipleOperator&&(this.selectedValue=null,this.$refs.valueSuggester.clear())},remove(t){t&&this.values.indexOf(t)>=0&&(this.values.splice(this.values.indexOf(t),1),this.filter.valueString=this.values.map((t=>t.value)).join(","))}}},y,[],!1,null,null,null).exports;var _=function(){var t=this,e=t._self._c;return e("v-flex",{attrs:{id:t.id}},[e("v-autocomplete",{ref:"selectAutoComplete",staticClass:"identitySuggester identitySuggesterInputStyle",class:t.autocompleteClass,attrs:{label:t.labels.label,placeholder:t.labels.placeholder,loading:t.loadingSuggestions>0,required:t.required&&!t.value,items:t.filteredItems,"search-input":t.searchTerm,filter:t.filterIgnoredItems,"hide-no-data":t.hideNoData,"prepend-inner-icon":t.prependInnerIcon,"append-icon":"","menu-props":"closeOnClick, maxHeight = 100","content-class":"identitySuggesterContent",width:"100%","max-width":"100%","item-text":"label","item-value":"value","return-object":"","persistent-hint":"","hide-selected":"",chips:"",dense:"",flat:"",attach:""},on:{"update:searchInput":function(e){t.searchTerm=e},"update:search-input":[function(e){t.searchTerm=e},function(e){t.searchTerm=e}],focus:t.search},scopedSlots:t._u([{key:"selection",fn:function({item:i,selected:a}){return[i.value?e("v-chip",{staticClass:"identitySuggesterItem ml-0",attrs:{"input-value":a,close:!t.disabled},on:{"click:close":function(e){return t.remove(i)}}},[e("span",{staticClass:"text-truncate"},[t._v("\n          "+t._s(i.label)+"\n        ")])]):t._e()]}},{key:"item",fn:function(i){return[e("v-list-item-title",{staticClass:"text-truncate",style:t.menuItemStyle,domProps:{textContent:t._s(i.item.label)}}),t._v(" "),e("v-list-item-action",{staticClass:"ma-0 pe-2 text-no-wrap"},[e("v-list-item-action-text",[t._v("\n          ("+t._s(t.$t("analytics.itemsCount",{0:i.item.count||0}))+")\n        ")])],1)]}}]),model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},[e("template",{slot:"no-data"},[e("v-list-item",{staticClass:"pa-0"},[t.displaySearchPlaceHolder?e("v-list-item-title",{staticClass:"px-2",style:t.menuItemStyle},[t._v("\n          "+t._s(t.labels.searchPlaceholder)+"\n        ")]):t.labels.noDataLabel?e("v-list-item-title",{staticClass:"px-2",style:t.menuItemStyle},[t._v("\n          "+t._s(t.labels.noDataLabel)+"\n        ")]):t._e()],1)],1)],2)],1)};_._withStripped=!0;const b=s({props:{value:{type:Object,default:function(){return null}},filter:{type:Object,default:function(){return null}},labels:{type:Object,default:()=>({label:"",placeholder:"",searchPlaceholder:"",noDataLabel:""})}},data:()=>({id:`AutoComplete${parseInt(1e4*Math.random()).toString().toString()}`,previousSearchTerm:null,searchTerm:null,searchStarted:null,items:[],limit:20,pageSize:20,searched:!1,loadingSuggestions:0}),computed:{prependInnerIcon(){return this.filterStyle?"fa-filter":""},filterField(){return this.filter&&this.filter.field},autocompleteClass(){return(this.required&&!this.value?"required-field invalid":this.required&&"required-field")||""},displaySearchPlaceHolder(){return this.labels.searchPlaceholder&&(!this.searchStarted||!this.value)},hideNoData(){return!this.labels.noDataLabel&&!this.labels.searchPlaceholder},menuItemStyle(){return this.width&&`width:${this.width}px;max-width:${this.width}px;min-width:${this.width}px;`||""},filteredItems(){if(this.searchTerm){const t=this.searchTerm.toLowerCase();return this.items.filter((e=>e.label.toLowerCase().indexOf(t)>=0))}return this.items}},watch:{filterField(){this.searched=!1,this.value=null,this.limit=this.pageSize,this.items=[],this.search()},loadingSuggestions(){this.loadingSuggestions>0&&!this.searchStarted&&(this.searchStarted=!0)},searchTerm(t){this.search(t)},value(){this.emitSelectedValue(this.value),this.init()}},mounted(){$(`#${this.id} input`).on("blur",(()=>{this.$refs.selectAutoComplete.isFocused=!1})),this.init(),this.filter.valueString||this.search()},methods:{init(){const t=this.value&&(this.value.value&&[this.value]||this.value.split&&this.value.split(",")||this.value.length&&this.value)||[];t&&t.length&&t.forEach((t=>{t&&this.items.push({value:t.value||t,count:t.count||0,label:t.label||this.computeI18NLabel(t)})}))},search(t){this.filterField?this.searched&&(this.items.length<this.limit||this.filteredItems.length>=this.pageSize)||(this.searched&&(this.limit+=this.pageSize),window.setTimeout((()=>{if(!this.previousSearchTerm||this.previousSearchTerm===this.searchTerm)return this.loadingSuggestions=1,fetch(this.$root.retrieveFieldValuesUrl,{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded",pragma:"no-cache","cache-control":"no-cache"},body:$.param({field:this.filter.field,limit:this.limit})}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error getting field values with name:",this.filter.field)})).then((e=>(e&&e.length&&e.forEach((t=>{this.items.find((e=>e.value===t.value))||this.items.push({value:t.value,count:t.count||0,label:this.computeI18NLabel(t.value)})})),this.searched=!0,this.search(t)))).finally((()=>{this.searched=!0,this.loadingSuggestions--}));this.previousSearchTerm=this.searchTerm}),400)):this.items=[]},computeI18NLabel(t){const e=`analytics.${t}`,i=this.$t(e);return i===e?t:i},emitSelectedValue(t){this.$emit("input",t),this.searchTerm=null},canAddItem(t){return!t||!t.value||this.ignoreItems.indexOf(t.value)<0},filterIgnoredItems(t,e,i){return!(e&&i.toLowerCase().indexOf(e.toLowerCase())<0)&&(!this.ignoreItems||!this.ignoreItems.length||this.canAddItem(t))},focus(){this.$refs.selectAutoComplete.focus()},clear(){this.value=null,this.searchTerm=null,this.$refs.selectAutoComplete.reset()},remove(t){if(this.value)if(this.value.splice){const e=this.value.findIndex((e=>e.value===t.value));e>=0&&this.value.splice(e,1)}else this.value=null;this.$emit("removeValue",t)}}},_,[],!1,null,null,null).exports;var S=function(){var t=this,e=t._self._c;return e("div",[e("v-btn",{staticClass:"primary--text",attrs:{link:"",text:""},on:{click:function(e){return t.$refs.multipleValuesDrawer.open()}}},[t._v("\n    "+t._s(t.$t("analytics.openItemsList"))+"\n  ")]),t._v(" "),e("exo-drawer",{ref:"multipleValuesDrawer",attrs:{"drawer-width":"650px",right:""},on:{closed:function(e){return t.$emit("closed")}}},[e("template",{slot:"content"},[e("v-flex",{staticClass:"mx-0 drawerHeader flex-grow-0"},[e("v-list-item",{staticClass:"pr-0",attrs:{ripple:!1,selectable:!1,inactive:""}},[e("v-list-item-action",{staticClass:"drawerIcons align-end d-flex flex-row"},[e("v-btn",{attrs:{icon:""}},[e("v-icon",{on:{click:function(e){return t.$refs.multipleValuesDrawer.close()}}},[t._v("mdi-arrow-left")])],1)],1),t._v(" "),e("v-list-item-content",{staticClass:"drawerTitle align-start text-header-title text-truncate"},[t._v("\n            "+t._s(t.fieldLabel)+"\n          ")])],1)],1),t._v(" "),e("v-divider",{staticClass:"my-0"}),t._v(" "),e("v-flex",{staticClass:"pa-5"},["spaceId"===t.filterField?e("analytics-space-field-filter",{attrs:{filter:t.filter,"suggester-labels":t.suggesterLabels}}):"userId"===t.filterField?e("analytics-user-field-filter",{attrs:{filter:t.filter,"suggester-labels":t.suggesterLabels}}):t.aggregation?e("analytics-text-value-filter",{attrs:{filter:t.filter,"suggester-labels":t.suggesterLabels}}):e("input",{directives:[{name:"model",rawName:"v-model",value:t.filter.valueString,expression:"filter.valueString"}],staticClass:"ignore-vuetify-classes width-auto pa-0 my-auto",attrs:{type:"text",placeholder:t.placeholder,required:""},domProps:{value:t.filter.valueString},on:{input:function(e){e.target.composing||t.$set(t.filter,"valueString",e.target.value)}}})],1)],1)],2)],1)};S._withStripped=!0;const C=s({props:{fieldLabel:{type:Object,default:function(){return null}},filter:{type:Object,default:function(){return null}},suggesterLabels:{type:Object,default:function(){return null}},placeholder:{type:String,default:null},aggregation:{type:Boolean,default:!1}},computed:{filterField(){return this.filter&&this.filter.field}}},S,[],!1,null,null,null).exports;var w=function(){var t=this,e=t._self._c;return e("v-layout",[e("v-flex",{attrs:{xs10:""}},[e("analytics-field-selection",{attrs:{"fields-mappings":t.fieldsMappings,label:t.$t("analytics.fieldName"),aggregation:""},model:{value:t.aggregation.field,callback:function(e){t.$set(t.aggregation,"field",e)},expression:"aggregation.field"}}),t._v(" "),e("v-flex",{staticClass:"px-2 mt-2 d-flex flex-row"},[e("v-switch",{staticClass:"my-auto text-no-wrap",attrs:{label:t.$t("analytics.limitResults")},model:{value:t.limitResults,callback:function(e){t.limitResults=e},expression:"limitResults"}}),t._v(" "),t.limitResults?e("input",{directives:[{name:"model",rawName:"v-model",value:t.aggregation.limit,expression:"aggregation.limit"}],staticClass:"ignore-vuetify-classes inputSmall mt-1 ml-3",attrs:{type:"number"},domProps:{value:t.aggregation.limit},on:{input:function(e){e.target.composing||t.$set(t.aggregation,"limit",e.target.value)}}}):t._e(),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.aggregation.sortDirection,expression:"aggregation.sortDirection"}],staticClass:"ignore-vuetify-classes ml-2 mt-1 width-auto",on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.aggregation,"sortDirection",e.target.multiple?i:i[0])}}},[e("option",{attrs:{value:"desc"}},[t._v(t._s(t.$t("analytics.descending")))]),t._v(" "),e("option",{attrs:{value:"asc"}},[t._v(t._s(t.$t("analytics.ascending")))])])],1)],1),t._v(" "),t.displayDelete?e("v-flex",{staticClass:"my-auto",attrs:{xs1:""}},[e("v-btn",{attrs:{icon:""},on:{click:function(e){return t.$emit("delete")}}},[e("v-icon",[t._v("fa-minus-circle")])],1)],1):t._e(),t._v(" "),t.displayAdd?e("v-flex",{staticClass:"my-auto",attrs:{xs1:""}},[e("v-btn",{attrs:{icon:""},on:{click:function(e){return t.$emit("add")}}},[e("v-icon",[t._v("fa-plus-circle")])],1)],1):t._e()],1)};w._withStripped=!0;const T=s({props:{aggregation:{type:Object,default:function(){return null}},fieldsMappings:{type:Array,default:function(){return[]}},displayAdd:{type:Boolean,default:!1},displayDelete:{type:Boolean,default:!1}},data:()=>({limitResults:!1}),watch:{limitResults(){!this.limitResults&&this.aggregation&&(this.aggregation.limit=0)}},mounted(){this.limitResults=this.aggregation&&this.aggregation.limit>0||!1}},w,[],!1,null,null,null).exports;var I=function(){var t=this,e=t._self._c;return e("div",[e("v-divider",{staticClass:"my-4"}),t._v(" "),e("h3",[t._v(t._s(t.$t("analytics.limitFilters")))]),t._v(" "),e("v-switch",{staticClass:"my-auto text-no-wrap",attrs:{label:t.$t("analytics.limitResults")},model:{value:t.limitResults,callback:function(e){t.limitResults=e},expression:"limitResults"}}),t._v(" "),e("div",{staticClass:"d-flex flex-row"},[t.limitResults&&t.percentageLimit?[e("input",{directives:[{name:"model",rawName:"v-model",value:t.percentage,expression:"percentage"}],staticClass:"ignore-vuetify-classes inputSmall my-auto",attrs:{type:"number",min:"0",max:"100",step:"0.1"},domProps:{value:t.percentage},on:{input:function(e){e.target.composing||(t.percentage=e.target.value)}}}),t._v(" "),e("span",{staticClass:"my-auto ml-1"},[t._v("%")]),t._v(" "),e("span",{staticClass:"my-auto ml-1"},[t._v(t._s(t.$t("analytics.ofField")))]),t._v(" "),e("analytics-field-selection",{staticClass:"ml-1",attrs:{"fields-mappings":t.fieldsMappings,aggregation:""},model:{value:t.field,callback:function(e){t.field=e},expression:"field"}})]:t._e()],2),t._v(" "),e("v-divider",{staticClass:"my-4"}),t._v(" "),t.limitResults&&t.percentageLimit?[e("h3",[t._v(t._s(t.$t("analytics.limitComputingRule")))]),t._v(" "),e("analytics-y-axis-form",{attrs:{"fields-mappings":t.fieldsMappings,"y-axis-aggregation":t.yAxisAggregation}}),t._v(" "),e("v-divider",{staticClass:"my-4"}),t._v(" "),e("analytics-search-filter-form",{attrs:{"fields-mappings":t.fieldsMappings,filters:t.filters}},[e("h3",[t._v(t._s(t.$t("analytics.limitComputingFilters")))])])]:t._e()],2)};I._withStripped=!0;const A=s({props:{settings:{type:Object,default:function(){return null}},fieldsMappings:{type:Array,default:function(){return[]}}},data:()=>({initialized:!1,limitResults:!1,percentage:0,field:null,yAxisAggregation:null,filters:null}),computed:{percentageLimit(){return this.settings&&this.settings.percentageLimit}},watch:{field(){this.initialized&&this.percentageLimit&&(this.percentageLimit.field=this.field)},percentage(){this.initialized&&this.percentageLimit&&(this.percentageLimit.percentage=this.percentage)},limitResults(){if(this.initialized)if(this.limitResults){if(this.percentageLimit)return;this.filters=[],this.yAxisAggregation={type:"COUNT"},this.field=null,this.percentage=0,this.settings.percentageLimit={aggregation:{yAxisAggregation:this.yAxisAggregation,filters:this.filters},percentage:this.percentage,field:this.field}}else this.settings.percentageLimit=null}},created(){this.percentageLimit&&this.percentageLimit.aggregation&&(this.percentage=this.percentageLimit.percentage||0,this.field=this.percentageLimit.field||null,this.filters=this.percentageLimit.aggregation.filters||[],this.yAxisAggregation=this.percentageLimit.aggregation.yAxisAggregation||{type:"COUNT"},this.limitResults=!0),this.$nextTick().then((()=>this.initialized=!0))}},I,[],!1,null,null,null).exports;var D=function(){var t=this,e=t._self._c;return e("v-dialog",{ref:"dialog",attrs:{color:"white",width:"290px","content-class":"overflow-hidden"},scopedSlots:t._u([{key:"activator",fn:function({on:i}){return[e("div",{staticClass:"themeColor"},[e("div",t._g({staticClass:"colorSelected",style:{backgroundColor:t.value}},i)),t._v(" "),e("div",{staticClass:"themeDetails"},[e("label",t._g({staticClass:"pa-3 box-border-sizing border-radius white--text",style:`background-color: ${t.value};`,attrs:{title:t.$t("analytics.label.clickToChange")}},i),[t._v(t._s(t.value))])])])]}}]),model:{value:t.modal,callback:function(e){t.modal=e},expression:"modal"}},[t._v(" "),e("v-color-picker",{attrs:{swatches:t.swatches,"show-swatches":"",mode:"hexa","dot-size":"25"},on:{"update:color":function(e){return t.$emit("updated",t.value)}},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}}),t._v(" "),e("v-row",{staticClass:"mx-0 white"},[e("v-col",{staticClass:"center pt-0"},[e("v-btn",{attrs:{text:"",color:"primary"},on:{click:t.cancel}},[t._v("\n        Cancel\n      ")])],1),t._v(" "),e("v-col",{staticClass:"center pt-0"},[e("v-btn",{attrs:{text:"",color:"primary"},on:{click:t.save}},[t._v("\n        OK\n      ")])],1)],1)],1)};D._withStripped=!0;const O=s({props:{label:{type:String,default:function(){return null}},value:{type:String,default:function(){return null}}},data:()=>({modal:!1,originalValue:null,swatches:[["#ffaacc","#f97575","#98cc81"],["#4273c8","#cea6ac","#bc99e7"],["#9ee4f5","#774ea9","#ffa500"],["#bed67e","#0E100F","#319ab3"]]}),watch:{modal(){this.modal&&(this.originalValue=this.value)}},methods:{cancel(){this.value=this.originalValue,this.modal=!1},save(){this.$emit("input",this.value),this.modal=!1}}},D,[],!1,null,null,null).exports;var k=function(){var t=this,e=t._self._c;return e("v-form",{ref:"form",staticClass:"generalSettingForm",on:{submit:function(t){t.preventDefault(),t.stopPropagation()}}},[e("v-layout",{attrs:{wrap:"",xs12:""}},[e("v-flex",{staticClass:"my-auto px-2",attrs:{md6:"",xs12:"","pt-1":""}},[e("v-text-field",{attrs:{label:t.$t("analytics.chartTitle"),required:""},model:{value:t.settings.title,callback:function(e){t.$set(t.settings,"title",e)},expression:"settings.title"}})],1),t._v(" "),e("v-flex",{staticClass:"my-auto px-2",attrs:{md6:"",xs12:"","pb-4":""}},[e("v-select",{staticClass:"operatorInput",attrs:{items:t.chartTypes,"value-comparator":t.selectedValueComparator,"item-text":"text","item-value":"value",label:t.$t("analytics.chartType"),"persistent-hint":"",chips:""},on:{change:function(e){return t.$emit("type-changed")}},model:{value:t.settings.chartType,callback:function(e){t.$set(t.settings,"chartType",e)},expression:"settings.chartType"}})],1)],1)],1)};k._withStripped=!0;const N=s({props:{settings:{type:Object,default:function(){return null}}},computed:{isPercentageBar(){return"percentageBar"===this.settings.chartType||"percentage"===this.settings.chartType},chartTypes(){return this.isPercentageBar?[{text:"Percentage Bar",value:"percentageBar"},{text:"Percentage",value:"percentage"}]:[{text:this.$t("analytics.bar"),value:"bar"},{text:this.$t("analytics.line"),value:"line"},{text:this.$t("analytics.pie"),value:"pie"}]}},methods:{selectedValueComparator:(t,e)=>(t&&t.value||t)===(e&&e.value||e)}},k,[],!1,null,null,null).exports;var E=function(){var t=this,e=t._self._c;return e("v-form",{ref:"form",staticClass:"generalSettingForm",on:{submit:function(t){t.preventDefault(),t.stopPropagation()}}},[e("v-layout",{attrs:{wrap:"",xs12:""}},t._l(t.chartColors,(function(i,a){return e("v-flex",{key:a,staticClass:"mx-auto px-3 my-3",attrs:{xs4:""}},[e("analytics-setting-color-picker",{on:{input:function(e){return t.setColor(e,a)}},model:{value:t.colors[a],callback:function(e){t.$set(t.colors,a,e)},expression:"colors[index]"}})],1)})),1)],1)};E._withStripped=!0;const P=s({props:{settings:{type:Object,default:function(){return null}}},data:()=>({DEFAULT_COLORS:["#319ab3","#f97575","#98cc81","#4273c8","#cea6ac","#bc99e7","#9ee4f5","#774ea9","#ffa500","#bed67e","#0E100F","#ffaacc"],colors:[]}),computed:{multipleCharts(){return this.settings&&(this.settings.multipleChartsField||"pie"===this.settings.chartType)},chartColors(){return this.multipleCharts?this.colors||[]:this.colors&&this.colors.slice(0,1)||[]}},methods:{init(){this.colors=this.settings&&this.settings.colors&&this.settings.colors.length&&this.settings.colors.slice()||this.DEFAULT_COLORS},setColor(t,e){this.colors.splice(e,1,t),this.settings.colors=this.colors}}},E,[],!1,null,null,null).exports;var L=function(){var t=this,e=t._self._c;return e("v-layout",{attrs:{column:""}},[e("v-flex",{staticClass:"d-flex flex-nowrap",attrs:{xs12:""}},[t.noTitle?t._e():e("span",{staticClass:"me-2"},[t.$slots.title?[t._t("title")]:e("h4",[t._v(t._s(t.$t("analytics.dataFilters")))])],2),t._v(" "),e("v-btn",{staticClass:"my-auto",attrs:{icon:""},on:{click:t.addFilter}},[e("v-icon",[t._v("fa-plus-circle")])],1)],1),t._v(" "),t.filters&&t.filters.length?e("v-flex",{attrs:{xs12:""}},[e("v-form",{ref:"form",staticClass:"searchFilterForm",on:{submit:function(t){t.preventDefault(),t.stopPropagation()}}},t._l(t.filters,(function(i,a){return e("analytics-field-filter",{key:i,staticClass:"my-2",attrs:{filter:i,"fields-mappings":t.fieldsMappings,attach:t.attach},on:{delete:function(e){return t.deleteFilter(a)}}})})),1)],1):t._e()],1)};L._withStripped=!0;const F=s({props:{filters:{type:Array,default:function(){return null}},fieldsMappings:{type:Array,default:function(){return[]}},attach:{type:Boolean,default:!1},noTitle:{type:Boolean,default:!1}},computed:{searchFilterTypes(){return[{text:this.$t("analytics.equals"),value:"EQUAL",placeholder:this.$t("analytics.fieldValuePlaceholder")},{text:this.$t("analytics.notEquals"),value:"NOT_EQUAL",placeholder:this.$t("analytics.fieldValuePlaceholder")},{text:this.$t("analytics.inValues"),value:"IN_SET",placeholder:this.$t("analytics.setPlaceholder")},{text:this.$t("analytics.notInValues"),value:"NOT_IN_SET",placeholder:this.$t("analytics.setPlaceholder")},{text:this.$t("analytics.inRange"),value:"RANGE",placeholder:this.$t("analytics.rangePlaceholder")},{text:this.$t("analytics.less"),value:"LESS",placeholder:this.$t("analytics.lessPlaceholder")},{text:this.$t("analytics.greater"),value:"GREATER",placeholder:this.$t("analytics.greaterPlaceholder")},{text:this.$t("analytics.isNull"),value:"IS_NULL",placeholder:this.$t("analytics.isEmptyPlaceholder")},{text:this.$t("analytics.isNotNull"),value:"NOT_NULL",placeholder:this.$t("analytics.isNotNullPlaceholder")}]}},methods:{deleteFilter(t){this.filters.splice(t,1),this.$forceUpdate()},addFilter(){this.filters.push({type:"EQUAL"}),this.$forceUpdate()}}},L,[],!1,null,null,null).exports;var M=function(){var t=this,e=t._self._c;return e("v-form",{ref:"form",staticClass:"aggregationForm",on:{submit:function(t){t.preventDefault(),t.stopPropagation()}}},[e("v-card-text",[e("v-layout",{attrs:{wrap:""}},[[e("v-flex",{staticClass:"my-auto px-2",attrs:{xs4:""}},[e("v-radio-group",{model:{value:t.dateInterval,callback:function(e){t.dateInterval=e},expression:"dateInterval"}},[t._l(t.dateFields,(function(t){return e("v-radio",{key:t.value,attrs:{label:t.text,value:t.value}})})),t._v(" "),e("v-radio",{attrs:{label:t.$t("analytics.perCustomField"),value:"custom"}})],2)],1),t._v(" "),t.dateAggregationType?t._e():e("v-flex",{staticClass:"my-auto px-2",attrs:{xs8:""}},t._l(t.xAxisAggregations,(function(i,a){return e("analytics-x-axis-aggregation-field",{key:a,attrs:{aggregation:i,"fields-mappings":t.fieldsMappings,"display-add":a+1===t.xAxisAggregations.length,"display-delete":t.xAxisAggregations.length>1},on:{delete:function(e){return t.deleteAggregation(a)},add:t.addAggregation}})})),1)]],2)],1)],1)};M._withStripped=!0;const j=s({props:{settings:{type:Object,default:function(){return null}},fieldsMappings:{type:Array,default:function(){return[]}}},data:()=>({dateAggregationType:!0,dateInterval:"custom",dateAggregation:{type:"DATE",field:"timestamp",sortDirection:"asc",interval:"day"},fieldAggregation:{type:"TERMS",field:"module",sortDirection:"desc",limit:0}}),computed:{dateFields(){return[{text:this.$t("analytics.perDay"),value:"day"},{text:this.$t("analytics.perWeek"),value:"week"},{text:this.$t("analytics.perMonth"),value:"month"},{text:this.$t("analytics.perQuarter"),value:"quarter"},{text:this.$t("analytics.perYear"),value:"year"}]},xAxisAggregations(){return this.settings&&this.settings.xAxisAggregations},xAxisAggregation(){return this.hasAggregations&&this.settings.xAxisAggregations[0]||null},hasAggregations(){return this.xAxisAggregations&&this.xAxisAggregations.length}},watch:{dateInterval(t,e){e!==t&&(this.dateAggregationType="custom"!==this.dateInterval,this.changeAggregationType())}},mounted(){this.xAxisAggregations&&this.xAxisAggregations.length?(this.dateAggregationType=this.xAxisAggregations&&1===this.xAxisAggregations.length&&"DATE"===this.xAxisAggregations[0].type,this.dateAggregationType&&(this.dateInterval=this.xAxisAggregations[0].interval)):this.dateInterval="day"},methods:{changeAggregationType(){if(this.dateAggregationType){const t=Object.assign({},this.dateAggregation);t.interval=this.dateInterval,this.settings.xAxisAggregations.splice(0,this.settings.xAxisAggregations.length,t)}else this.settings.xAxisAggregations.splice(0,this.settings.xAxisAggregations.length,Object.assign({},this.fieldAggregation));this.$forceUpdate()},deleteAggregation(t){this.xAxisAggregations.splice(t,1)},addAggregation(){this.xAxisAggregations.push({type:"TERMS",sortDirection:"desc",limit:0}),this.$forceUpdate()}}},M,[],!1,null,null,null).exports;var V=function(){var t=this,e=t._self._c;return e("v-form",{ref:"form",staticClass:"aggregationForm",on:{submit:function(t){t.preventDefault(),t.stopPropagation()}}},[e("v-card-text",[e("v-layout",{attrs:{wrap:""}},[e("v-flex",{staticClass:"my-auto px-2",attrs:{xs6:""}},[e("v-radio-group",{model:{value:t.aggregationType,callback:function(e){t.aggregationType=e},expression:"aggregationType"}},t._l(t.aggregationTypes,(function(t){return e("v-radio",{key:t.value,attrs:{label:t.text,value:t.value}})})),1)],1),t._v(" "),e("v-flex",{directives:[{name:"show",rawName:"v-show",value:!t.yAxisAggregationCount,expression:"!yAxisAggregationCount"}],staticClass:"my-auto px-2",attrs:{xs6:""}},[e("analytics-field-selection",{attrs:{"fields-mappings":t.fieldsMappings,placeholder:t.yAxisAggregationCardinality?t.$t("analytics.distinctAggregationField"):t.$t("analytics.numericAggregationField"),numeric:!t.yAxisAggregationCardinality,aggregation:""},model:{value:t.yAxisAggregation.field,callback:function(e){t.$set(t.yAxisAggregation,"field",e)},expression:"yAxisAggregation.field"}})],1)],1)],1)],1)};V._withStripped=!0;const U=s({props:{yAxisAggregation:{type:Object,default:function(){return null}},fieldsMappings:{type:Array,default:function(){return[]}},type:{type:String,default:function(){return null}}},data:()=>({aggregationType:"MAX"}),computed:{aggregationTypes(){return[{text:this.$t("analytics.count"),value:"COUNT"},{text:this.$t("analytics.cardinality"),value:"CARDINALITY"},{text:this.$t("analytics.sum"),value:"SUM"},{text:this.$t("analytics.avg"),value:"AVG"},{text:this.$t("analytics.max"),value:"MAX"},{text:this.$t("analytics.min"),value:"MIN"}]},yAxisAggregationCount(){return"COUNT"===this.aggregationType},yAxisAggregationCardinality(){return"CARDINALITY"===this.aggregationType}},watch:{yAxisAggregationCount(){this.yAxisAggregation.field=null},aggregationType(){this.yAxisAggregation.type=this.aggregationType}},created(){this.yAxisAggregation.type?this.aggregationType=this.yAxisAggregation.type:this.aggregationType="COUNT"}},V,[],!1,null,null,null).exports;var R=function(){var t=this,e=t._self._c;return e("v-form",{ref:"form",staticClass:"aggregationForm",on:{submit:function(t){t.preventDefault(),t.stopPropagation()}}},[e("v-card-text",[e("v-layout",{attrs:{wrap:""}},[e("v-flex",{staticClass:"my-auto px-2",attrs:{xs6:""}},[e("v-switch",{attrs:{label:t.$t("analytics.multipleCharts"),required:""},model:{value:t.multipleCharts,callback:function(e){t.multipleCharts=e},expression:"multipleCharts"}})],1),t._v(" "),t.multipleCharts?e("v-flex",{staticClass:"my-auto px-2",attrs:{xs6:""}},[e("analytics-field-selection",{attrs:{"fields-mappings":t.fieldsMappings,label:t.$t("analytics.fieldComparator"),aggregation:""},model:{value:t.settings.multipleChartsField,callback:function(e){t.$set(t.settings,"multipleChartsField",e)},expression:"settings.multipleChartsField"}})],1):t._e()],1)],1)],1)};R._withStripped=!0;const B=s({props:{settings:{type:Object,default:function(){return null}},fieldsMappings:{type:Array,default:function(){return[]}}},data:()=>({multipleCharts:!1}),computed:{yAxisAggregation(){return this.settings&&this.settings.yAxisAggregation}},watch:{settings(){this.multipleCharts=this.settings&&this.settings.multipleChartsField},multipleCharts(){this.multipleCharts||(this.settings.multipleChartsField=null)}},mounted(){this.multipleCharts=this.settings&&this.settings.multipleChartsField}},R,[],!1,null,null,null).exports;var z=function(){var t=this,e=t._self._c;return e("exo-drawer",{ref:"samplesDrawer",staticClass:"samplesDrawer",attrs:{right:"","body-classes":"hide-scroll"},on:{closed:function(e){return t.$emit("cancel")}}},[e("template",{slot:"title"},[t._v("\n    "+t._s(t.title)+"\n  ")]),t._v(" "),e("template",{slot:"titleIcons"},[e("v-btn",{staticClass:"mx-2",attrs:{disabled:t.loading,icon:"",color:"primary"},on:{click:t.refresh}},[e("v-icon",[t._v("\n        refresh\n      ")])],1)],1),t._v(" "),e("template",{slot:"content"},[e("v-row",{staticClass:"ma-0 analyticsDrawerContent",attrs:{justify:"center"}},[t.chartDatas?e("v-expansion-panels",{attrs:{accordion:""}},t._l(t.chartDatas,(function(i){return e("analytics-sample-item",{key:i.id,attrs:{"chart-data":i,"sample-item-extensions":t.sampleItemExtensions}})})),1):t._e()],1)],1),t._v(" "),t.canLoadMore?e("template",{slot:"footer"},[e("div",{staticClass:"d-flex"},[e("v-btn",{staticClass:"ma-auto",attrs:{disabled:t.loading,color:"primary",text:""},on:{click:t.loadMore}},[t._v("\n        Load More\n      ")])],1)]):t._e()],2)};z._withStripped=!0;const q=s({props:{selectedPeriod:{type:Object,default:function(){return null}},title:{type:String,default:function(){return null}},retrieveSamplesUrl:{type:String,default:function(){return null}}},data:()=>({loading:!1,chartDatas:null,pageSize:10,limit:10,canLoadMore:!1,extensionApp:"AnalyticsSamples",sampleItemExtensionType:"SampleItem",sampleItemExtensions:{}}),watch:{loading(){this.loading?this.$refs.samplesDrawer.startLoading():(this.$refs.samplesDrawer.endLoading(),this.computeCanLoadMore())}},created(){this.$root.users||(this.$root.users={}),this.$root.spaces||(this.$root.spaces={}),document.addEventListener(`extension-${this.extensionApp}-${this.sampleItemExtensionType}-updated`,this.refreshSampleItemExtensions),this.refreshSampleItemExtensions()},methods:{open(){this.$refs.samplesDrawer.open(),this.$nextTick().then(this.refresh)},loadMore(){this.limit+=this.pageSize,this.loadData()},refresh(){this.loadData()},loadData(){if(!this.selectedPeriod)return;const t={lang:eXo.env.portal.language&&eXo.env.portal.language.replace("_","-"),min:this.selectedPeriod.min,max:this.selectedPeriod.max+6e4,timeZone:this.$analyticsUtils.USER_TIMEZONE_ID,limit:this.limit};return this.loading=!0,fetch(this.retrieveSamplesUrl,{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded",pragma:"no-cache","cache-control":"no-cache"},body:$.param(t)}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Error getting analytics samples with filters:",t)})).then((t=>this.chartDatas=t)).catch((t=>{console.error("fetch analytics - error",t),this.error="Error getting analytics"})).finally((()=>this.loading=!1))},computeCanLoadMore(){if(this.chartDatas){const t=Object.keys(this.chartDatas).length;this.canLoadMore=t>=this.limit}else this.canLoadMore=!1},refreshSampleItemExtensions(){const t=extensionRegistry.loadExtensions(this.extensionApp,this.sampleItemExtensionType);let e=!1;t.forEach((t=>{!t.type||!t.options||this.sampleItemExtensions[t.type]&&this.sampleItemExtensions[t.type]===t.options||(this.sampleItemExtensions[t.type]=t.options,e=!0)})),e&&(this.sampleItemExtensions=Object.assign({},this.sampleItemExtensions))}}},z,[],!1,null,null,null).exports;var Q=function(){var t=this,e=t._self._c;return t.loading?e("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}}):e("div",{staticClass:"d-flex flex-row"},[t.identity?[t.isSpace?e("exo-space-avatar",{attrs:{space:t.identity,"extra-class":"me-2",size:"24",popover:"","link-style":""}}):e("exo-user-avatar",{staticClass:"me-2",attrs:{identity:t.identityProfile,size:"24",popover:"","link-style":""}}),t._v(" "),t.displayValue?e("span",{staticClass:"text-seconday"},[t._v("\n      ("+t._s(t.profileId)+")\n    ")]):t._e()]:e("code",[t._v("\n    "+t._s(t.profileId)+"\n  ")])],2)};Q._withStripped=!0;const G=s({props:{profileId:{type:String,default:null},isSpace:{type:Boolean,default:!1},displayValue:{type:Boolean,default:!1}},data:()=>({identity:null,loading:!0}),computed:{identityProfile(){return!this.isSpace&&this.identity?.profile}},created(){this.isSpace?this.$analyticsUtils.loadSpace(this.$root.spaces,this.profileId).then((t=>this.identity=t)).finally((()=>this.loading=!1)):this.$analyticsUtils.loadUser(this.$root.users,this.profileId).then((t=>this.identity=t)).finally((()=>this.loading=!1))}},Q,[],!1,null,null,null).exports;var J=function(){var t=this,e=t._self._c;return e("v-expansion-panel",{staticClass:"border-box-sizing"},[e("v-expansion-panel-header",[e("v-row",{staticClass:"sampleItemHeader",attrs:{"no-gutters":""}},[e("v-col",{staticClass:"text-truncate",attrs:{cols:"4"}},[t.userId?e("analytics-profile-chip",{attrs:{"profile-id":t.userId}}):t._e()],1),t._v(" "),e("v-col",{staticClass:"text-truncate",attrs:{cols:"4",title:t.operationLabel}},[t.chartData.operation?e("strong",[t._v(t._s(t.operationLabel))]):t._e()]),t._v(" "),e("v-col",{staticClass:"text-right",attrs:{cols:"4"}},[e("date-format",{attrs:{value:t.chartDataTime,format:t.dateFormat}})],1)],1)],1),t._v(" "),e("v-expansion-panel-content",[t.chartDataProps?t._l(t.chartDataProps,(function(i){return e("analytics-sample-item-attribute",{key:i,staticClass:"ma-2 no-gutters",attrs:{"attr-key":i,"attr-value":t.chartData[i],"sample-item-extensions":t.sampleItemExtensions}})})):t._e(),t._v(" "),t.chartDataParameters?t._l(t.chartDataParameters,(function(i){return e("analytics-sample-item-attribute",{key:i,staticClass:"ma-2 no-gutters",attrs:{"attr-key":i,"attr-value":t.chartData.parameters[i],"sample-item-extensions":t.sampleItemExtensions}})})):t._e()],2)],1)};J._withStripped=!0;const K=s({props:{chartData:{type:Object,default:function(){return null}},sampleItemExtensions:{type:Object,default:function(){return{}}}},data:()=>({dateFormat:{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}}),computed:{chartDataTime(){return this.chartData&&this.chartData.timestamp&&new Date(this.chartData.timestamp)},chartDataProps(){return(this.chartData&&Object.keys(this.chartData).sort()).filter((t=>"parameters"!==t&&this.chartData[t]))},chartDataParameters(){return this.chartData&&this.chartData.parameters&&Object.keys(this.chartData.parameters).sort()},userId(){return this.chartData.userId||this.chartData.modifierSocialId},operationLabel(){const t=`analytics.${this.chartData.operation}`;return this.$te(t)?this.$t(t):this.chartData.operation}}},J,[],!1,null,null,null).exports;var X=function(){var t=this,e=t._self._c;return e("v-row",[e("v-col",[t._v(t._s(t.keyLabel))]),t._v(" "),t.sampleItemExtension?e("v-col",[e("extension-registry-component",{attrs:{component:t.extendedSampleItemComponent,params:t.extendedSampleItemComponentParams}})],1):e("v-col",{staticClass:"text--secondary"},[t._v("\n    "+t._s(t.valueLabel)+"\n  ")])],1)};X._withStripped=!0;const H=s({props:{attrKey:{type:Object,default:function(){return null}},attrValue:{type:Object,default:function(){return null}},sampleItemExtensions:{type:Object,default:function(){return{}}}},computed:{keyLabel(){const t=`analytics.field.label.${this.attrKey}`;return this.$te(t)?this.$t(t):this.attrKey},valueLabel(){const t=`analytics.${this.attrValue}`;return this.$te(t)?this.$t(t):this.attrValue},sampleItemExtension(){return this.sampleItemExtensions&&Object.values(this.sampleItemExtensions).sort(((t,e)=>(t.rank||0)-(e.rank||0))).find((t=>t.match&&t.match(this.attrKey,this.attrValue)))||null},extendedSampleItemComponent(){return this.sampleItemExtension&&{componentName:"sample-item",componentOptions:{vueComponent:this.sampleItemExtension?.vueComponent}}||null},extendedSampleItemComponentParams(){return this.sampleItemExtension&&{attrKey:this.attrKey,attrValue:this.attrValue,options:this.sampleItemExtension?.options}||null}}},X,[],!1,null,null,null).exports;var Y=function(){var t=this;return(0,t._self._c)("analytics-profile-chip",{attrs:{"profile-id":t.attrValue,"is-space":t.isSpace,"display-value":""}})};Y._withStripped=!0;const W=s({props:{attrKey:{type:Object,default:function(){return null}},attrValue:{type:Object,default:function(){return null}},options:{type:Object,default:function(){return null}}},computed:{isSpace(){return this.options?.isSpace}}},Y,[],!1,null,null,null).exports;var Z=function(){var t=this,e=t._self._c;return e("div",[e("date-format",{attrs:{value:t.date,format:t.dateFormat}}),t._v("\n  ( "+t._s(t.attrValue)+" )\n")],1)};Z._withStripped=!0;const tt=s({props:{attrKey:{type:Object,default:function(){return null}},attrValue:{type:Object,default:function(){return null}},options:{type:Object,default:function(){return null}}},data:()=>({dateFormat:{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}}),computed:{date(){return new Date(Number(this.attrValue))}}},Z,[],!1,null,null,null).exports;var et=function(){var t=this,e=t._self._c;return e("v-menu",{staticClass:"analytics-selected-period-menu",attrs:{"content-class":`${t.menuId} white analytics-selected-period-menu-content`,"close-on-content-click":!1,transition:"scale-transition",left:t.left,right:t.right,"offset-y":"",attach:"","min-width":"auto"},scopedSlots:t._u([{key:"activator",fn:function({on:i,attrs:a}){return[e("v-text-field",t._g(t._b({staticClass:"analytics-selected-period-input pt-0 mt-0",attrs:{value:t.rangeDate,title:t.rangeDateTimeTitle,"prepend-inner-icon":"mdi-calendar",rel:"tooltip",readonly:""}},"v-text-field",a,!1),i))]}}]),model:{value:t.menu,callback:function(e){t.menu=e},expression:"menu"}},[t._v(" "),e("div",{staticClass:"d-flex flex-column"},[e("v-date-picker",{staticClass:"analyticsDatePicker pb-2",attrs:{locale:t.lang,max:t.maxDate,width:"100%","show-current":"","show-week":"","first-day-of-week":"1",range:"",scrollable:""},on:{input:t.selectCustomDates},model:{value:t.dates,callback:function(e){t.dates=e},expression:"dates"}}),t._v(" "),e("v-divider"),t._v(" "),e("v-btn-toggle",{staticClass:"d-flex flex-wrap justify-space-between analytics-period-selection",attrs:{tile:"",color:"primary","background-color":"primary",group:""},model:{value:t.selectedPeriodName,callback:function(e){t.selectedPeriodName=e},expression:"selectedPeriodName"}},t._l(t.periodOptions,(function(i,a){return e("v-btn",{key:a,staticClass:"ma-0",attrs:{value:i.value,small:""},on:{click:function(e){return t.selectPeriodItem(i.value)}}},[e("div",[t._v(t._s(i.text))])])})),1),t._v(" "),e("v-divider"),t._v(" "),e("div",{staticClass:"analytics-date-time-selection caption mx-auto pa-2 text-center muted"},[e("span",{staticClass:"text-capitalize"},[t._v(t._s(t.$t("analytics.from")))]),t._v(" "),e("span",{staticClass:"primary--text"},[t._v(t._s(t.fromDateTitle))]),t._v(" "),t.hideTime?t._e():e("input",{directives:[{name:"model",rawName:"v-model",value:t.fromTime,expression:"fromTime"}],staticClass:"ignore-vuetify-classes analytics-time-picker",attrs:{name:"fromTime",type:"time"},domProps:{value:t.fromTime},on:{change:t.updatePeriodTime,input:function(e){e.target.composing||(t.fromTime=e.target.value)}}}),t._v(" "),e("span",{staticClass:"text-capitalize"},[t._v(t._s(t.$t("analytics.toDate")))]),t._v(" "),e("span",{staticClass:"primary--text"},[t._v(t._s(t.toDateTitle))]),t._v(" "),t.hideTime?t._e():e("input",{directives:[{name:"model",rawName:"v-model",value:t.toTime,expression:"toTime"}],staticClass:"ignore-vuetify-classes analytics-time-picker",attrs:{name:"toTime",type:"time"},domProps:{value:t.toTime},on:{change:t.updatePeriodTime,input:function(e){e.target.composing||(t.toTime=e.target.value)}}})])],1)])};et._withStripped=!0;const it=s({props:{value:{type:String,default:function(){return null}},hideTime:{type:Boolean,default:!1},right:{type:Boolean,default:!1},left:{type:Boolean,default:!1}},data:()=>({menu:!1,lang:eXo.env.portal.language&&eXo.env.portal.language.replace("_","-"),dates:[],fromTime:"00:00",toTime:"23:59",selectedPeriodName:"thisMonth",menuId:`AnalyticsDatePickerMenu${parseInt(1e4*Math.random()).toString().toString()}`,shortDateFormat:{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"},dateFormat:{year:"numeric",month:"short",day:"numeric"}}),computed:{periodOptions(){return[{value:"thisYear",text:this.$t("analytics.periodOptions.thisYear")},{value:"thisSemester",text:this.$t("analytics.periodOptions.thisSemester")},{value:"thisQuarter",text:this.$t("analytics.periodOptions.thisQuarter")},{value:"thisMonth",text:this.$t("analytics.periodOptions.thisMonth")},{value:"thisWeek",text:this.$t("analytics.periodOptions.thisWeek")},{value:"today",text:this.$t("analytics.periodOptions.today")}]},fromDate(){return this.value&&new Date(this.value.min)},toDate(){return this.value&&new Date(this.value.max)},maxDate:()=>(new Date).toLocaleDateString("sv-SV"),maxDateTime(){const t=new Date;return t.setHours(23),t.setMinutes(59),t},fromDateTitle(){return this.fromDate&&this.fromDate.toLocaleString(this.lang,this.dateFormat)},toDateTitle(){return this.toDate&&this.toDate.toLocaleString(this.lang,this.dateFormat)},rangeDateTimeTitle(){return this.$t("analytics.period",{0:this.fromFullDateFormat,1:this.toFullDateFormat})},rangeDate(){return this.fromDate&&this.toDate?`${this.fromDate.toLocaleString(this.lang,this.dateFormat)}~${this.toDate.toLocaleString(this.lang,this.dateFormat)}`:""},fromFullDateFormat(){return this.fromDate&&this.fromDate.toLocaleString(this.lang,this.shortDateFormat)},toFullDateFormat(){return this.toDate&&this.toDate.toLocaleString(this.lang,this.shortDateFormat)}},watch:{menu(t,e){t&&!e&&t!==e&&this.value&&(this.dates=[this.fromDate.toLocaleDateString("sv-SV"),this.toDate.toLocaleDateString("sv-SV")],this.fromTime=this.fromDate.toLocaleTimeString("sv-SV").substring(0,5),this.toTime=this.toDate.toLocaleTimeString("sv-SV").substring(0,5))}},mounted(){$(document).on("click",(t=>{t.target&&!$(t.target).parents(`.${this.menuId}`).length&&this.close()})),this.selectPeriodItem(this.selectedPeriodName)},methods:{selectDates(){const t={};if(this.selectedPeriodName){t.period=this.selectedPeriodName,this.fromTime="00:00",this.toTime="23:59";const e=new Date;switch(this.selectedPeriodName){case"today":{const t=e.toISOString().slice(0,10);this.dates=[t,t];break}case"thisWeek":{const t=e.getDay(),i=e.getDate()-t+(0===t?-6:1),a=new Date((new Date).setDate(i));let s=new Date(new Date(a).setDate(a.getDate()+6));s>this.maxDateTime&&(s=this.maxDateTime),this.dates=[a.toISOString().slice(0,10),s.toISOString().slice(0,10)];break}case"thisMonth":{const t=new Date((new Date).setDate(1));let i=new Date(new Date((new Date).setMonth(e.getMonth()+1)).setDate(0));i>this.maxDateTime&&(i=this.maxDateTime),this.dates=[t.toISOString().slice(0,10),i.toISOString().slice(0,10)];break}case"thisQuarter":{const t=e.getMonth()-(e.getMonth()-1)%3-1,i=new Date(new Date((new Date).setMonth(t)).setDate(1));let a=new Date(new Date(new Date(i).setMonth(t+3)).setDate(0));a>this.maxDateTime&&(a=this.maxDateTime),this.dates=[i.toISOString().slice(0,10),a.toISOString().slice(0,10)];break}case"thisSemester":{const t=e.getMonth()-(e.getMonth()-1)%6-1,i=new Date(new Date((new Date).setMonth(t)).setDate(1));let a=new Date(new Date(new Date(i).setMonth(t+6)).setDate(0));a>this.maxDateTime&&(a=this.maxDateTime),this.dates=[i.toISOString().slice(0,10),a.toISOString().slice(0,10)];break}case"thisYear":this.dates=[`${e.getYear()+1900}-01-01`,this.maxDate]}}if(this.dates&&2===this.dates.length){if(new Date(this.dates[0])>new Date(this.dates[1])){const t=this.dates[0];this.dates[0]=this.dates[1],this.dates[1]=t}return t.min=new Date(`${this.dates[0]}T${this.fromTime||"00:00"}`).getTime(),t.max=new Date(`${this.dates[1]}T${this.toTime||"23:59"}`).getTime(),this.$emit("input",t),!0}return!1},selectCustomDates(){this.selectedPeriodName=null,this.fromTime="00:00",this.toTime="23:59",this.selectDates()},updatePeriodTime(){this.selectedPeriodName=null,this.selectDates()},selectPeriodItem(t){this.selectedPeriodName=t,this.selectDates()&&this.close()},close(){this.$nextTick().then((()=>{this.menu=!1}))}}},et,[],!1,null,null,null).exports,at=(new window.Intl.DateTimeFormat).resolvedOptions().timeZone;function st(t,e){if(!e)return Promise.resolve(null);e=parseInt(e);const i=t[e];return i?i.catch&&i||Promise.resolve(i):t[e]=fetch(`/portal/rest/v1/social/identities/${e}`).then((t=>{if(t&&t.ok)return t.json()})).then((i=>t[e]=i))}function lt(t,e){if(!e)return Promise.resolve(null);e=parseInt(e);const i=t[e];return i?i.catch&&i||Promise.resolve(i):t[e]=fetch(`/portal/rest/v1/social/spaces/${e}`).then((t=>{if(t&&t.ok)return t.json()})).then((i=>t[e]=i))}function rt(t,e){e&&(e.uri&&e.pageKey&&(e.link=`${t}/${e.uri}`),e.children&&e.children.length&&e.children.forEach((e=>rt(t,e))))}function nt(t,e,i){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/navigations/${t}/?siteName=${e}&scope=all&visibility=displayed&visibility=system`,{method:"GET",credentials:"include"}).then((t=>{if(!t||!t.ok)throw new Error("Error retrieving pages of current site");return t.json()})).then((t=>t?ct(t,i):null))}function ot(t,e=2){const i=Number.parseFloat(t).toFixed(e).replace(/(\..*[1-9])0+$/,"$1").replace(/\.0*$/,"");return Number(i)}function ct(t,e){for(const i in t){const a=t[i];if(a.name===e)return a}for(const i in t){const a=t[i];if(a.children&&a.children.length){const t=ct(a.children,e);if(t)return t}}}const ut={"analytics-profile-chip":G,"analytics-sample-item":K,"analytics-sample-item-attribute":H,"analytics-profile-sample-item-attribute":W,"analytics-date-sample-item-attribute":tt,"analytics-setting-color-picker":O,"analytics-identity-field-selection":c,"analytics-field-selection":p,"analytics-multiple-values-selection":C,"analytics-space-field-filter":g,"analytics-user-field-filter":v,"analytics-text-value-filter":x,"analytics-text-value-suggester":b,"analytics-field-filter":h,"analytics-x-axis-aggregation-field":T,"analytics-limit-filter-form":A,"analytics-general-setting-form":N,"analytics-colors-setting-form":P,"analytics-search-filter-form":F,"analytics-x-axis-form":j,"analytics-y-axis-form":U,"analytics-multiple-charts":B,"analytics-select-period":it,"analytics-chart-setting":l,"analytics-json-panel-dialog":n,"analytics-view-samples-drawer":q};for(const t in ut)Vue.component(t,ut[t]);Vue.prototype.$analyticsUtils||window.Object.defineProperty(Vue.prototype,"$analyticsUtils",{value:t}),i(996),Vue.use(Vuetify)})(),a})()));