define((()=>(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:()=>l});var n=function(){var e=this,t=e._self._c;return t("v-app",{attrs:{flat:""}},[t("exo-documents",{attrs:{documents:e.displayedDocuments}}),e._v(" "),e.loading||0!==e.displayedDocuments.length?e._e():t("div",{staticClass:"noDocuments"},[t("div",{staticClass:"noDocumentsContent"},[t("i",{staticClass:"uiNoDocumentsIcon"}),e._v(" "),t("div",{staticClass:"noDocumentsTitle"},[e._v("\n        "+e._s(e.$t("documents.label.noDocument"))+"\n      ")])])])],1)};function o(e){return fetch(e,{method:"GET",credentials:"include"}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Error when getting documents")}))}n._withStripped=!0;var i=function(e,t,n,o,i,s,c,r){var a,l="function"==typeof e?e.options:e;if(t&&(l.render=t,l.staticRenderFns=[],l._compiled=!0),a)if(l.functional){l._injectStyles=a;var d=l.render;l.render=function(e,t){return a.call(t),d(e,t)}}else{var u=l.beforeCreate;l.beforeCreate=u?[].concat(u,a):[a]}return{exports:e,options:l}}({props:{query:{type:String,default:null},folder:{type:String,default:null},type:{type:String,default:null},limit:{type:String,default:null},cacheRecentDocuments:{type:Boolean,default:!1}},data:()=>({documents:[],cachedDocuments:[],twoMinInMS:12e4,loading:!0}),computed:{displayedDocuments(){return[...this.cachedDocuments,...this.documents].slice(0,parseInt(this.limit))},documentMimeTypeRegex(){return"recent"===this.type?/pdf|presentation|sheet|word|plain/:/pdf|presentation|sheet|word|plain|image/}},watch:{loading(){this.loading||(this.retrieveCachedDocuments(),this.$nextTick().then((()=>this.$root.$applicationLoaded())))}},created(){this.retrieveDocuments(),this.cacheRecentDocuments&&document.addEventListener("attachments-upload-finished",(e=>{e&&e.detail&&"recent"===this.type&&this.cacheRecentUploadedDocuments(e.detail.list)}))},methods:{retrieveDocuments(){var e,t;null!=this.query&&"null"!==this.query?(e=this.query,t=this.limit,o(`/portal/rest/documents/query?query=${e}&limit=${t}`)).then((e=>{this.documents=e})).finally((()=>this.loading=!1)):null!=this.folder&&"null"!==this.folder?function(e,t){return o(`/portal/rest/documents/folder?folder=${e}&limit=${t}`)}(this.folder,this.limit).then((e=>{this.documents=e})).finally((()=>this.loading=!1)):null!=this.type&&("recent"===this.type&&function(e){return o(`/portal/rest/search/documents/recent?myWork=true&limit=${e}`)}(this.limit).then((e=>this.documents=e)).finally((()=>this.loading=!1)),"recentSpaces"===this.type&&function(e){return o(`/portal/rest/search/documents/recentSpaces?limit=${e}`)}(this.limit).then((e=>this.documents=e)).finally((()=>this.loading=!1)),"favorite"===this.type&&function(e){return o(`/portal/rest/documents/favorite?limit=${e}`)}(this.limit).then((e=>this.documents=e)).finally((()=>this.loading=!1)),"shared"===this.type&&function(e){return o(`/portal/rest/documents/shared?limit=${e}`)}(this.limit).then((e=>this.documents=e)).finally((()=>this.loading=!1)))},retrieveCachedDocuments(){if(!this.cacheRecentDocuments)return;this.cachedDocuments=[];const e=this.getCachedDocuments();e&&e.length&&(e.sort(((e,t)=>t.date-e.date)).slice(0,parseInt(this.limit)).forEach((e=>{const t=this.documents.some((t=>(t.id||t.UUID)===e.id));!e.timestamp||Date.now()-e.timestamp>this.twoMinInMS&&t||t?this.removeDocumentFromCache(e.id):this.cachedDocuments.push(e)})),this.cachedDocuments.sort(((e,t)=>t.date-e.date)))},cacheRecentUploadedDocuments(e){e.forEach((e=>{e.fileType=e.mimetype,e.id=e.UUID||e.id,e.date=new Date(e.date).getTime(),e.timestamp=Date.now(),e.fileType.match(this.documentMimeTypeRegex)&&this.addDocumentToCache(e)})),this.retrieveCachedDocuments()},getCachedDocuments(){const e=localStorage.getItem("newlyUploadedAttachments");if(e){const t=JSON.parse(e);return Object.keys(t).map((e=>t[e]))}return[]},addDocumentToCache(e){const t=localStorage.getItem("newlyUploadedAttachments")||"{}",n=JSON.parse(t);n[e.id]=e,localStorage.setItem("newlyUploadedAttachments",JSON.stringify(n))},removeDocumentFromCache(e){const t=localStorage.getItem("newlyUploadedAttachments")||"{}",n=JSON.parse(t);delete n[e],localStorage.setItem("newlyUploadedAttachments",JSON.stringify(n))}}},n);const s={documents:i.exports};for(const e in s)Vue.component(e,s[e]);if(extensionRegistry){const e=extensionRegistry.loadComponents("documents");e&&e.length>0&&e.forEach((e=>{Vue.component(e.componentName,e.componentOptions)}))}Vue.use(Vuetify);const c=new Vuetify(eXo.env.portal.vuetifyPreset),r=eXo&&eXo.env&&eXo.env.portal&&eXo.env.portal.language||"en",a=`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.portlet.documents-${r}.json`;function l(e,t,n,o,i,s){s="true"===s,exoi18n.loadLanguageAsync(r,a).then((r=>{const a=document.createElement("div");a.id=e,Vue.createApp({template:`<documents app-id="${e}" id="${e}" v-cacheable query="${t}" folder="${n}" type="${o}" limit="${i}" :cache-recent-documents="${s}"></documents>`,i18n:r,vuetify:c},a,"Recent Documents")}))}return t})()));