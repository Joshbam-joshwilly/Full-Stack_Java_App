define((()=>(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{destroy:()=>X,init:()=>P,openAttachmentsDrawer:()=>_});var n={};t.r(n),t.d(n,{checkExistence:()=>b,convertXmlToJson:()=>A,createFolder:()=>s,createNewDoc:()=>x,deleteFolderOrFile:()=>d,downloadFiles:()=>S,fetchFoldersAndFiles:()=>i,getAttachmentByEntityAndId:()=>v,getAttachmentById:()=>$,getDrivers:()=>c,getEntityAttachments:()=>g,isCloudDriveEnabled:()=>p,linkUploadedAttachmentToEntity:()=>u,log:()=>h,moveAttachmentToNewPath:()=>E,removeAllAttachmentsFromEntity:()=>y,removeEntityAttachment:()=>w,renameFolder:()=>l,updateLinkedAttachmentsToEntity:()=>f,uploadAttachment:()=>m});var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"attachment-application border-box-sizing transparent",class:t.entityType&&t.entityId&&"v-card__text pl-0",attrs:{id:"attachmentIntegration"}},[e("div",{staticClass:"d-flex attachmentsIntegrationSlot"},[t.$scopedSlots.attachmentsButton?e("div",{staticClass:"openAttachmentsButton me-2",on:{click:function(e){return t.openAttachmentsAppDrawer()}}},[t._t("attachmentsButton")],2):t.entityId&&t.entityType?e("div",{class:!t.attachments.length&&"v-main align-center"},[e("v-icon",{attrs:{size:"18",color:"primary"}},[t._v("\n        fa-paperclip\n      ")]),t._v(" "),t.attachments.length?t._e():e("div",{staticClass:"addAttachments d-flex align-center ms-3",on:{click:function(e){return t.openAttachmentsAppDrawer()}}},[e("a",{staticClass:"addAttachmentLabel primary--text font-weight-bold text-decoration-underline"},[t._v(t._s(t.$t("attachments.add")))]),t._v(" "),e("v-btn",{attrs:{icon:"",color:"primary"}},[e("v-icon",{attrs:{size:"16"}},[t._v("\n            fa-plus\n          ")])],1)],1)],1):t._e(),t._v(" "),t.$scopedSlots.attachmentsList?e("div",{staticClass:"attachedFilesList",on:{click:function(e){return t.openAttachmentsDrawerList()}}},[t._t("attachedFilesList",null,{attachments:t.attachments})],2):t.entityId&&t.entityType?e("div",{staticClass:"attachmentsPreview v-card__text ms-3 pa-0"},[t.attachments.length?e("div",{staticClass:"attachmentsList"},[e("a",{staticClass:"viewAllAttachments primary--text font-weight-bold text-decoration-underline",on:{click:function(e){return t.openAttachmentsDrawerList()}}},[t._v("\n          "+t._s(t.$t("attachments.view.all"))+" ("+t._s(t.attachments&&t.attachments.length)+")\n        ")]),t._v(" "),t.$scopedSlots.attachmentsList?t._e():e("v-list",{attrs:{dense:""}},[e("v-list-item-group",t._l(t.attachments.slice(0,2),(function(t){return e("attachment-item",{key:t.id,attrs:{attachment:t,"can-access":t.acl&&t.acl.canAccess,"allow-to-detach":!1,"allow-to-edit":!1,"allow-to-preview":"","small-attachment-icon":""}})})),1)],1)],1):t._e()]):t._e()]),t._v(" "),e("attachments-notification-alerts")],1)};r._withStripped=!0;var a=function(t,e,n,r,a,o,i,c){var s,d="function"==typeof t?t.options:t;if(e&&(d.render=e,d.staticRenderFns=[],d._compiled=!0),s)if(d.functional){d._injectStyles=s;var l=d.render;d.render=function(t,e){return s.call(e),l(t,e)}}else{var h=d.beforeCreate;d.beforeCreate=h?[].concat(h,s):[s]}return{exports:t,options:d}}({props:{entityId:{type:String,default:""},entityType:{type:String,default:""},defaultDrive:{type:Object,default:()=>null},defaultFolder:{type:String,default:""},spaceId:{type:String,default:""}},data:()=>({attachments:[]}),computed:{attachmentAppConfiguration(){return{entityId:this.entityId,entityType:this.entityType,defaultDrive:this.defaultDrive,defaultFolder:this.defaultFolder,spaceId:this.spaceId,attachments:this.attachments}}},watch:{entityType(){this.initEntityAttachmentsList()},entityId(){this.initEntityAttachmentsList()}},created(){Promise.resolve(this.initEntityAttachmentsList()).finally((()=>this.$root.$applicationLoaded())),document.addEventListener("entity-attachments-updated",(()=>{this.initEntityAttachmentsList()}))},methods:{openAttachmentsAppDrawer(){document.dispatchEvent(new CustomEvent("open-attachments-app-drawer",{detail:this.attachmentAppConfiguration}))},openAttachmentsDrawerList(){document.dispatchEvent(new CustomEvent("open-attachments-list-drawer",{detail:this.attachmentAppConfiguration}))},initEntityAttachmentsList(){this.entityType&&this.entityId&&this.$attachmentService.getEntityAttachments(this.entityType,this.entityId).then((t=>{t.forEach((t=>{t.name=t.title})),this.attachments=t}))}}},r);const o=a.exports;function i(t,e,n){return n?(n.startsWith("/")&&(n=n.substr(1)),n.endsWith("/")&&(n=n.substr(0,n.length-1))):n="",fetch(`/portal/rest/managedocument/getFoldersAndFiles/?driveName=${t}&workspaceName=${e}&currentFolder=${n}`,{}).then((t=>t.ok?t.text():t.text().then((t=>{throw h(`Error get data: ${t}`),new Error(t)})))).then((t=>(new window.DOMParser).parseFromString(t,"text/xml"))).then((t=>{if(t)return t})).catch((t=>{throw h(`Error get data: ${t.errorMessage?t.errorMessage:t}`),new Error(`Error getting folders and files of the current path ${t}`)}))}function c(){return fetch("/portal/rest/wcmDriver/getDrivers",{}).then((t=>t.ok?t.text():t.text().then((t=>{throw h(`Error get data: ${t}`),new Error(t)})))).then((t=>(new window.DOMParser).parseFromString(t,"text/xml"))).then((t=>{if(t)return t})).catch((t=>{throw h(`Error get drives data: ${t.errorMessage?t.errorMessage:t}`),new Error(`Error getting drivers ${t}`)}))}function s(t,e,n,r,a,o){const i=new FormData;t&&i.append("driveName",t),e&&i.append("workspaceName",e),n&&i.append("currentFolder",n),r&&i.append("folderName",r),a&&i.append("folderNodeType",a),o&&i.append("isSystem",o);const c=new URLSearchParams(i).toString();return fetch(`/portal/rest/managedocument/createFolder?${c}`,{}).then((t=>t.ok?t.text():t.text().then((t=>{throw h(`Error post data: ${t}`),new Error(t)})))).then((t=>(new window.DOMParser).parseFromString(t,"text/xml"))).then((t=>{if(t)return t})).catch((t=>{throw h(`Error creating folder: ${t.errorMessage?t.errorMessage:t}`),new Error(`Error creating a new folder ${t}`)}))}function d(t,e,n){return fetch(`/portal/rest/managedocument/deleteFolderOrFile/?driveName=${t}&workspaceName=${e}&itemPath=${n}`,{}).then((t=>t.ok?t.text():t.text().then((t=>{throw h(`Error delete data: ${t}`),new Error(t)})))).then((t=>(new window.DOMParser).parseFromString(t,"text/xml"))).then((t=>{if(t)return t})).catch((t=>{throw h(`Error deleting the folder: ${t.errorMessage?t.errorMessage:t}`),new Error(`Error deleting the folder or the file ${t}`)}))}function l(t,e){return fetch(`/portal/rest/contents/rename/rename?oldPath=${t}&newTitle=${e}`,{credentials:"include",method:"GET"}).then((t=>{if(t&&t.ok)return t.ok})).catch((t=>{throw h(`Error rename folder: ${t.errorMessage?t.errorMessage:t.errorCode}`),new Error(`Error rename this folder ${t}`)}))}function h(t,e){const n="[attachmentsSelector] ";if("undefined"!=typeof console&&void 0!==console.log){const r=`--${(new Date).toISOString()}`;let a=t;e?(a+=". Error: ",e.name||e.message?(e.name&&(a+=`[${e.name}]`),e.message&&(a+=e.message)):a+="string"==typeof e?e:JSON.stringify(e)+(e.toString&&"function"==typeof e.toString?`; ${e.toString()}`:""),console.log(n+a+r),void 0!==e.stack&&console.log(e.stack)):(null!=e&&(a+=`. Error: ${e}`),console.log(n+a+r))}}function p(){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/clouddrive/features/status/enabled`,{credentials:"include",method:"GET"}).then((t=>{if(t&&t.ok)return t.json()}))}function m(t,e,n,r,a,o,i,c,s){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/managedocument/uploadFile/control?workspaceName=${t}&driveName=${e}&currentFolder=${n}&currentPortal=${r}&uploadId=${a}&fileName=${o}&language=${i}&existenceAction=${c}&action=${s}`,{credentials:"include",method:"GET"}).then((t=>t.ok?t.text():t.text().then((t=>{throw h(`Error uploading attachment: ${t}`),new Error(t)})))).then((t=>(new window.DOMParser).parseFromString(t,"text/xml"))).then((t=>{if(t)return t}))}function u(t,e,n){if(!n)throw new Error("Attachment Id can't be empty");return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/${e}/${t}/${n}`,{credentials:"include",method:"POST"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error linking attachments to the entity")}))}function f(t,e,n){n.forEach((t=>{if(!t)throw new Error("Attachment Id can't be empty")}));const r=new FormData;return n&&Object.keys(n).forEach((t=>{r.append("attachmentId",n[t])})),fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/${e}/${t}`,{credentials:"include",method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(r).toString()}).then((t=>{if(!t||!t.ok)throw new Error("Error updating entity's linked attachments list")}))}function w(t,e,n){if(!n)throw new Error("Attachment Id can't be empty");return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/${e}/${t}/${n}`,{credentials:"include",method:"DELETE"}).then((t=>{if(!t||!t.ok)throw new Error("Error removing entity's linked attachment")}))}function y(t,e){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/${e}/${t}`,{credentials:"include",method:"DELETE"}).then((t=>{if(!t||!t.ok)throw new Error("Error removing entity's linked attachment")}))}function g(t,e){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/${t}/${e}`,{credentials:"include",method:"GET"}).then((t=>{if(t||t.ok)return t.json();throw new Error("Error getting entity's linked attachments")}))}function v(t,e,n){if(!n)throw new Error("Attachment Id can't be empty");if(!t)throw new Error("Entity Type can't be empty");if(!e)throw new Error("Entity Id can't be empty");return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/${t}/${e}/${n}`,{credentials:"include",method:"GET"}).then((t=>{if(t||t.ok)return t.json();throw new Error("Error getting entity's linked attachment")}))}function $(t){if(!t)throw new Error("Attachment Id can't be empty");return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/${t}`,{credentials:"include",method:"GET"}).then((t=>{if(t||t.ok)return t.json();throw new Error("Error getting entity's linked attachment")}))}function E(t,e,n,r,a){if(!n)throw new Error("Attachment Id can't be empty");const o=new FormData;return o.append("newPath",e||""),t&&o.append("newPathDrive",t),r&&o.append("entityType",r),a&&o.append("entityId",a),fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/${n}/move`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(o).toString()}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error moving attachment to the new destination path")}))}function x(t,e,n,r){const a=new FormData;return t&&a.append("title",t),e&&a.append("templateName",e),n&&a.append("pathDrive",n),r&&a.append("path",r),fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/newDoc`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(a).toString()}).then((t=>{if(t&&t.ok)return t.json();if(409===t.status)return t;throw new Error("Error creating new document")}))}function A(t){let e,n,r,a,o,i,c={};if(1===t.nodeType){if(t.attributes.length>0)for(c={},n=0;n<t.attributes.length;n+=1)r=t.attributes.item(n),c[r.nodeName]=r.nodeValue}else 3===t.nodeType&&(c=t.nodeValue);if(t.hasChildNodes())for(e=0;e<t.childNodes.length;e+=1)a=t.childNodes.item(e),o=a.nodeName,void 0===c[o]?c=A(a):(void 0===c[o].push&&(i=c[o],c[o]=[],c[o].push(i)),c[o].push(A(a)));return c}function S(t,e){const n=e&&window.encodeURIComponent(e)||"";return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/downloadByPath?fileName=${n}`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.blob();throw new Error(`Error downloading file '${e}' from server`)})).then((t=>{const n=window.URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=e.replace(/\[[0-9]*\]$/g,""),document.body.appendChild(r),r.click(),r.remove()}))}function b(t,e,n,r){const a=new FormData;e&&a.append("workspaceName",e),t&&a.append("driveName",t),n&&a.append("currentFolder",n),r&&a.append("fileName",r);const o=new URLSearchParams(a).toString();return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/managedocument/uploadFile/exist?${o}`,{credentials:"include",method:"GET",headers:{"Content-Type":"application/json"}}).then((t=>t&&t.text())).then((t=>(new DOMParser).parseFromString(t,"text/xml")))}Vue.component("AttachmentApp",o),Vue.prototype.$attachmentService||window.Object.defineProperty(Vue.prototype,"$attachmentService",{value:n}),Vue.use(Vuetify);const k=new Vuetify(eXo.env.portal.vuetifyPreset),T="undefined"!=typeof eXo?eXo.env.portal.language:"en",F=`/portal/rest/i18n/bundle/locale.portlet.attachments-${T}.json`;if(extensionRegistry){const t=extensionRegistry.loadComponents("attachmentIntegration");t&&t.length>0&&t.forEach((t=>{Vue.component(t.componentName,t.componentOptions)}))}exoi18n.loadLanguageAsync(T,F).then((t=>{new Vue({i18n:t})}));const D="attachmentIntegration";let I;function P(t,e,n,r,a){exoi18n.loadLanguageAsync(T,F).then((o=>{I=Vue.createApp({data:()=>({entityId:t||"",entityType:e||"",defaultDrive:n||null,defaultFolder:r||"",spaceId:a||""}),template:`<attachment-app\n                  :entity-id=entityId\n                  :entity-type=entityType\n                  :default-drive=defaultDrive\n                  :default-folder=defaultFolder\n                  :space-id=spaceId\n                  id="${D}" />`,vuetify:k,i18n:o},`#${D}`,"File Attachments")}))}function _(){I&&I.$root.$emit("open-attachments-app-drawer")}function X(){I&&I.$destroy()}return e})()));