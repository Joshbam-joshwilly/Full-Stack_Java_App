define((()=>(()=>{"use strict";var t={d:(e,i)=>{for(var a in i)t.o(i,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:i[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{destroy:()=>At,init:()=>Dt,openAttachmentsDrawer:()=>xt});var i={};t.r(i),t.d(i,{checkExistence:()=>mt,convertXmlToJson:()=>ht,createFolder:()=>K,createNewDoc:()=>dt,deleteFolderOrFile:()=>q,downloadFiles:()=>pt,fetchFoldersAndFiles:()=>Q,getAttachmentByEntityAndId:()=>ot,getAttachmentById:()=>lt,getDrivers:()=>W,getEntityAttachments:()=>rt,isCloudDriveEnabled:()=>tt,linkUploadedAttachmentToEntity:()=>it,log:()=>Z,moveAttachmentToNewPath:()=>ct,removeAllAttachmentsFromEntity:()=>nt,removeEntityAttachment:()=>st,renameFolder:()=>J,updateLinkedAttachmentsToEntity:()=>at,uploadAttachment:()=>et});var a={};t.r(a),t.d(a,{getDocumentsTransferRules:()=>vt,getTransfertRulesDownloadDocumentStatus:()=>ut});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"attachments-drawer"},[e("exo-drawer",{ref:"attachmentsAppDrawer",staticClass:"attachmentsAppDrawer",attrs:{"confirm-close":t.newUploadedFilesInProgress,"confirm-close-labels":t.confirmAbortUploadLabels,right:""},on:{closed:t.closeAttachmentsAppDrawer}},[e("template",{slot:"title"},[e("div",{staticClass:"attachmentsDrawerHeader"},[e("span",[t._v(t._s(t.$t("attachments.upload.document")))])])]),t._v(" "),e("template",{slot:"content"},[e("div",{staticClass:"attachmentsContent pt-0 pa-5"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.showSelectedAttachmentsFromOtherDriveInfo,expression:"showSelectedAttachmentsFromOtherDriveInfo"}],staticClass:"alert alert-info attachmentsAlert"},[t._v("\n          "+t._s(t.$t("attachments.alert.sharing.attachedFrom"))+"\n          "+t._s(t.selectedFromOtherDriveLabel)+"\n          "),e("b",{directives:[{name:"show",rawName:"v-show",value:t.fromAnotherSpacesAttachments,expression:"fromAnotherSpacesAttachments"}]},[t._v("\n            "+t._s(t.fromAnotherSpacesAttachments)+"\n          ")]),t._v("\n          "+t._s(t.$t("attachments.alert.sharing.availableFor"))+" "),e("b",[t._v(t._s(t.currentSpaceDisplayName))]),t._v(" "+t._s(t.$t("attachments.alert.sharing.members"))+"\n        ")]),t._v(" "),(t.entityType||t.entityId)&&t.attachToEntity?t._e():e("attachment-create-document-input",{attrs:{attachments:t.attachments,"max-files-count":t.maxFilesCount,"max-files-size":t.maxFileSize,"current-drive":t.currentDrive,"path-destination-folder":t.pathDestinationFolder}}),t._v(" "),e("attachments-upload-input",{attrs:{attachments:t.attachments,"max-files-count":t.maxFilesCount,"max-files-size":t.maxFileSize,"current-drive":t.currentDrive,"path-destination-folder":t.pathDestinationFolder}}),t._v(" "),t.entityId&&t.entityType||!t.attachToEntity?e("attachments-select-from-drive"):t._e(),t._v(" "),e("attachments-uploaded-files",{attrs:{attachments:t.attachments,"new-uploaded-files":t.newUploadedFiles,"schema-folder":t.schemaFolder,"max-files-count":t.maxFilesCount,"current-space":t.currentSpace,"current-drive":t.currentDrive,"entity-id":t.entityId,"entity-type":t.entityType},on:{"keep-both":function(e){return t.uploadManually(e,"keep")},"create-version":function(e){return t.uploadManually(e,"createVersion")}}})],1),t._v(" "),e("attachments-drive-explorer-drawer",{attrs:{"entity-id":t.entityId,"entity-type":t.entityType,"default-drive":t.defaultDrive,"extension-refs":t.$refs,"default-folder":t.defaultFolder,"attached-files":t.attachments}}),t._v(" "),t._l(t.attachmentsComposerActions,(function(i){return e("div",{key:i.key,class:`${i.appClass}Action`},[i.component?e(i.component.name,t._b({directives:[{name:"dynamic-events",rawName:"v-dynamic-events",value:i.component.events,expression:"action.component.events"}],ref:i.key,refInFor:!0,tag:"component"},"component",i.component.props?i.component.props:{},!1)):t._e()],1)}))],2)],2)],1)};s._withStripped=!0;let n=null;function r(){if(null==n||!n.length){const t=("attachments-composer-action",extensionRegistry.loadExtensions("AttachmentsComposer","attachments-composer-action"));n=t.filter((t=>function(t){if(t.hasOwnProperty("enabled")){if("boolean"==typeof t.enabled)return t.enabled;if(o(t.enabled))return t.enabled.call()}return!0}(t)))}return n}function o(t){return t&&"[object Function]"==={}.toString.call(t)}function l(t,e,i,a,s,n,r,o){var l,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=i,c._compiled=!0),a&&(c.functional=!0),n&&(c._scopeId="data-v-"+n),r?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},c._ssrRegister=l):s&&(l=o?function(){s.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:s),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(t,e){return l.call(e),d(t,e)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,l):[l]}return{exports:t,options:c}}const c=l({props:{maxFilesCount:{type:Number,required:!1,default:parseInt(`${eXo.env.portal.maxToUpload}`)},maxFileSize:{type:Number,required:!1,default:parseInt(`${eXo.env.portal.maxFileSize}`)},showAttachmentsBackdrop:{type:Boolean,default:!0},entityId:{type:String,default:""},entityType:{type:String,default:""},sourceApp:{type:String,default:""},defaultDrive:{type:Object,default:()=>null},defaultFolder:{type:String,default:""},attachments:{type:Array,default:()=>[]},files:{type:Array,default:()=>[]},entityHasAttachments:{type:Boolean,default:!1},attachToEntity:{type:Boolean,default:!0},currentSpace:{type:{},default:()=>null}},data:()=>({showDestinationFolder:!1,message:"",uploadingCount:0,maxProgress:100,maxUploadInProgressCount:2,uploadingFilesQueue:[],MESSAGES_DISPLAY_TIME:5e3,pathDestinationFolder:"",showDestinationPath:!1,schemaFolder:[],cloudDriveConnecting:!1,connectedDrive:{},isActivityStream:!0,drivesInProgress:{},attachmentInfo:!1,defaultDestinationFolderPath:"",defaultSchemaFolder:[],workspace:"collaboration",dragAndDropEventListenerInitialized:!1,currentDrive:{},uploadedFiles:[],attachmentsChanged:!1,newUploadedFiles:[],creationType:"",saveMode:"keep"}),computed:{uploadFinished(){return this.attachments.length>0&&(this.attachments.every((t=>!t.uploadId))||this.attachments.every((t=>t.waitAction)))},entityHasNewAttachments(){return this.uploadedFiles.length>0},newUploadedFilesAdded(){return this.newUploadedFiles&&this.newUploadedFiles.some((t=>t.uploadId))},filesUploadedSuccessLabel(){return this.entityType&&this.entityId&&this.$t("attachments.upload.success")||this.$t("documents.upload.success")},newUploadedFilesInProgress(){return this.newUploadedFiles&&this.newUploadedFiles.some((t=>t.uploadProgress<100))},confirmAbortUploadLabels(){return{title:this.$t("attachment.cancel.upload"),message:this.$t("attachment.abort.upload"),ok:this.$t("attachments.yes"),cancel:this.$t("attachments.no")}}},watch:{attachments:{deep:!0,handler(){this.attachmentsChanged=!0,this.displayMessageDestinationFolder=!this.attachments.some((t=>null!=t.uploadId&&""!==t.uploadId)),0===this.attachments.length&&(this.pathDestinationFolder=this.defaultDestinationFolderPath,this.schemaFolder=this.defaultSchemaFolder)}},uploadFinished(){this.uploadFinished&&0===this.uploadingCount&&this.entityHasNewAttachments&&(this.$root.$emit("entity-attachments-updated"),document.dispatchEvent(new CustomEvent("entity-attachments-updated")),this.displaySuccessMessage(),this.$refs.attachmentsAppDrawer.endLoading())},defaultDrive(){this.initDefaultDestinationFolderPath(this.defaultFolder)}},created(){this.$root.$on("open-attachments-app-drawer",(()=>{this.attachmentsChanged=!1,this.openAttachmentsAppDrawer()})),this.$root.$on("attachments-default-folder-path-initialized",((t,e)=>{this.initDefaultDestinationFolderPath(t,e)})),this.$root.$on("remove-destination-for-file",(t=>{this.deleteDestinationPathForFile(t)})),this.$root.$on("select-destination-path-for-all",((t,e,i,a)=>{this.addDestinationFolderForAll(t,e,i,a)})),this.$root.$on("link-new-added-attachments",(()=>{this.uploadAddedAttachments()})),this.$root.$on("add-new-uploaded-file",(t=>{this.creationType=this.$t("attachments.uploaded.from.device"),this.newUploadedFiles.push(t)})),this.$root.$on("attachments-changed-from-drives",((t,e)=>{this.manageFilesFromDrives(t,e)})),this.$root.$on("add-destination-path-for-file",((t,e,i,a)=>{this.moveFileToNewDestinationFile(t,e,i,a)})),this.$root.$on("abort-uploading-new-file",this.abortUploadingNewFile),this.$root.$on("remove-attached-file",this.removeAttachedFile),this.$root.$on("start-loading-attachment-drawer",(()=>this.$refs.attachmentsAppDrawer.startLoading())),this.$root.$on("end-loading-attachment-drawer",(()=>this.$refs.attachmentsAppDrawer.endLoading())),this.$root.$on("add-new-created-document",(t=>{this.creationType=this.$t("attachments.added.by.platform"),this.addNewCreatedDocument(t),document.dispatchEvent(new CustomEvent("entity-attachments-updated"))})),document.addEventListener("extension-AttachmentsComposer-attachments-composer-action-updated",(()=>this.attachmentsComposerActions=r())),this.attachmentsComposerActions=r(),this.$root.$on("continue-upload-to-destination-path",(t=>{this.uploadFileToDestinationPath(t),this.$root.$emit("entity-attachments-updated"),document.dispatchEvent(new CustomEvent("entity-attachments-updated"))}))},methods:{startLoading(){this.$refs.attachmentsAppDrawer.startLoading()},endLoading(){this.$refs.attachmentsAppDrawer.endLoading()},handleProvidedFiles(){this.files&&this.files.length>0&&this.$root.$emit("handle-provided-files",this.files)},openAttachmentsAppDrawer(){document.addEventListener("paste",this.onPaste,!1),this.$root.$on("open-select-from-drives",(()=>{this.creationType=this.$t("attachments.uploaded.from.cloud"),this.openSelectFromDrivesDrawer()})),this.$refs.attachmentsAppDrawer.open(),this.$root.$emit("attachments-app-drawer-opened"),window.setTimeout((()=>this.handleProvidedFiles()),400)},closeAttachmentsAppDrawer(){this.resetAttachmentsDrawer(),this.$root.$emit("reset-attachments-upload-input"),document.removeEventListener("paste",this.onPaste,!1),this.$refs.attachmentsAppDrawer.close()},uploadAddedAttachments(){this.newUploadedFilesAdded?(this.$refs.attachmentsAppDrawer.startLoading(),this.attachments.filter((t=>t.uploadId&&!t.waitAction)).forEach((t=>{this.queueUpload(t)}))):this.attachmentsChanged&&this.updateLinkedAttachmentsToEntity()},queueUpload(t){this.uploadingCount<this.maxUploadInProgressCount?this.uploadFileToDestinationPath(t):-1===this.uploadingFilesQueue.findIndex((e=>e.uploadId===t.uploadId))&&this.uploadingFilesQueue.push(t)},processNextQueuedUpload:function(){this.uploadingFilesQueue.length>0&&this.uploadFileToDestinationPath(this.uploadingFilesQueue.shift())},uploadManually(t,e){this.saveMode=e,t.waitAction=!1,this.$root.$emit("attachment-continue-upload",t),t.actions=[]},uploadFileToDestinationPath:function(t){t.uploadId&&!t.waitAction&&(this.uploadingCount++,this.$attachmentService.uploadAttachment(this.workspace,t.fileDrive.name,t.destinationFolder,eXo.env.portal.portalName,t.uploadId,encodeURIComponent(t.title),eXo.env.portal.language,this.saveMode,"save").then((e=>{e&&(e=this.$attachmentService.convertXmlToJson(e),this.sendDocumentAnalytics(e),this.addNewUploadedFileToAttachments(t,e),this.entityType&&this.entityId?this.linkUploadedAttachmentToEntity(t):(t.uploadId="",t.acl=e.acl,this.uploadingCount--,document.dispatchEvent(new CustomEvent("attachment-added",{detail:{attachment:t,entityType:this.entityType,entityId:this.entityId}})),this.processNextQueuedUpload())),this.saveMode="keep",this.waitingActionUploads()})).catch((()=>{this.uploadingCount--,this.processNextQueuedUpload(),this.$emit("uploadingCountChanged",this.uploadingCount),this.$root.$emit("attachments-notification-alert",{message:this.$t("attachments.upload.failed").replace("{0}",t.title),type:"error"})})))},waitingActionUploads(){this.attachments.every((t=>t.waitAction||100===t.uploadProgress))&&!this.uploadFinished&&(this.$root.$emit("entity-attachments-updated"),document.dispatchEvent(new CustomEvent("entity-attachments-updated")),this.$root.$emit("refresh-uploaded-files-list"),this.displaySuccessMessage())},addDestinationFolderForAll(t,e,i,a){this.currentDrive=a,this.pathDestinationFolder=t,this.schemaFolder=i.split("/"),this.$root.$emit("add-destination-path-for-all",this.defaultDestinationFolderPath,e,a)},moveFileToNewDestinationFile(t,e,i,a){this.$attachmentService.moveAttachmentToNewPath(a.name,e,t.id,this.entityType,this.entityId).then((e=>{this.$root.$emit("entity-attachments-updated"),document.dispatchEvent(new CustomEvent("entity-attachments-updated"));const s=this.newUploadedFiles.findIndex((e=>e.id===t.id)),n=Object.assign({},this.newUploadedFiles[s]);n.pathDestinationFolderForFile=i,n.fileDrive=a,this.newUploadedFiles.splice(s,1,n);const r=this.uploadedFiles.findIndex((e=>e.id===t.id));e.drive=i,e.date=e.created,this.uploadedFiles.splice(r,1,e)}))},deleteDestinationPathForFile(t){this.$attachmentService.moveAttachmentToNewPath(this.currentDrive.name,this.pathDestinationFolder,t,this.entityType,this.entityId).then((()=>{this.newUploadedFiles.filter((e=>e.id===t)).map((t=>{t.pathDestinationFolderForFile="",t.fileDrive=this.currentDrive}))}))},setCloudDriveProgress({progress:t}){this.cloudDriveConnecting=!!t},onPaste(t){if(t.clipboardData&&t.clipboardData.items){const e=Array.from(t.clipboardData.items),i=e.filter((t=>~t.type.indexOf("text")))[0]||null,a=i?i.type:"",s=e.filter((t=>~t.type.indexOf("image")))[0]||null;if(s){const t=s.getAsFile();this.getFilename(i,a,(e=>{const i=new File([t],e,{type:t.type});this.$root.$emit("handle-pasted-files-from-clipboard",[i])}))}}},getFilename(t,e,i){let a;const s=this;t?t.getAsString((t=>{if("text/plain"===e)a=decodeURI(t).split("/").pop();else if("text/html"===e){const e=s.parseHTML(t).querySelectorAll("img")[0];a=e.src.split("/").pop()}i(a)})):(a=`image-${Date.now()}.png`,i(a))},parseHTML(t){const e=document.createElement("template");return e.innerHTML=t,e.content.cloneNode(!0)},addCloudDrive(t){this.connectedDrive=t},changeCloudDriveProgress(t){this.drivesInProgress=t},initDefaultDestinationFolderPath(t,e){if(this.defaultDestinationFolderPath=t||"",e){this.defaultSchemaFolder=[];const t=e.split("/");for(let e=0;e<t.length;e++)this.defaultSchemaFolder[e]=t[e]}this.pathDestinationFolder=this.defaultDestinationFolderPath,this.schemaFolder=this.defaultSchemaFolder,this.currentDrive=this.defaultDrive},resetAttachmentsDrawer(){this.abortUploadingFiles(),this.newUploadedFiles=[],this.$refs.attachmentsAppDrawer.endLoading();const t=this.uploadedFiles.sort(((t,e)=>e.date-t.date)).slice(-10);document.dispatchEvent(new CustomEvent("attachments-upload-finished",{detail:{list:Object.values(t)}})),this.uploadedFiles=[],this.$root.$emit("hide-create-new-document-input"),this.$root.$emit("attachments-app-drawer-closed")},linkUploadedAttachmentToEntity(t){return this.$attachmentService.linkUploadedAttachmentToEntity(this.entityId,this.entityType,t.id).then((e=>{t.acl=e.acl,t.uploadId="",this.uploadingCount--,document.dispatchEvent(new CustomEvent("attachment-added",{detail:{attachment:t,entityType:this.entityType,entityId:this.entityId}})),this.processNextQueuedUpload()})).catch((t=>{console.error(t),this.$refs.attachmentsAppDrawer.endLoading(),this.$root.$emit("attachments-notification-alert",{message:this.$t("attachments.link.failed"),type:"error"})}))},updateLinkedAttachmentsToEntity(){const t=this.attachments.filter((t=>t.id)).map((t=>t.id));return 0===t.length?this.removeAllAttachmentsFromEntity(this.entityId,this.entityType):this.attachToEntity?this.$attachmentService.updateLinkedAttachmentsToEntity(this.entityId,this.entityType,t).then((()=>{this.$root.$emit("entity-attachments-updated"),document.dispatchEvent(new CustomEvent("entity-attachments-updated")),this.displaySuccessMessage()})).catch((t=>{console.error(t),this.$refs.attachmentsAppDrawer.endLoading(),this.$root.$emit("attachments-notification-alert",{message:this.$t("attachments.link.failed"),type:"error"})})):void 0},removeAllAttachmentsFromEntity(t,e){return this.$attachmentService.removeAllAttachmentsFromEntity(t,e).then((()=>{this.$root.$emit("entity-attachments-updated"),document.dispatchEvent(new CustomEvent("entity-attachments-updated")),this.displaySuccessMessage()})).catch((t=>{console.error(t),this.$refs.attachmentsAppDrawer.endLoading(),this.$root.$emit("attachments-notification-alert",{message:this.$t("attachments.link.failed"),type:"error"})}))},displaySuccessMessage(){this.$root.$emit("attachments-notification-alert",{message:this.filesUploadedSuccessLabel,type:"success"})},openSelectFromDrivesDrawer(){this.$root.$emit("open-select-from-drives-drawer")},addNewUploadedFileToAttachments(t,e){t.drive=t.fileDrive.title,t.id=e.UUID,e.drive=t.fileDrive.title,e.id=e.UUID,e.size=t.size,e.previewBreadcrumb=JSON.parse(e.previewBreadcrumb),e.acl=JSON.parse(e.acl),this.uploadedFiles.push(e)},abortUploadingFiles(){this.newUploadedFilesInProgress&&(this.$root.$emit("abort-attachments-new-upload",this.attachments.filter((t=>!t.uploadId))),this.newUploadedFiles.forEach((t=>{t.uploadProgress<100?this.$uploadService.abortUpload(t.uploadId):this.$uploadService.deleteUpload(t.uploadId)})))},manageFilesFromDrives(t,e){(t&&t.length||e&&e.length)&&(this.attachmentsChanged=!0,this.newUploadedFiles.push(...t),t.forEach((t=>document.dispatchEvent(new CustomEvent("attachment-added",{detail:{attachment:t,entityType:this.entityType,entityId:this.entityId}})))),this.uploadAddedAttachments())},abortUploadingNewFile(t){if(t&&t.uploadId){const e=this.newUploadedFiles.findIndex((e=>e.uploadId===t.uploadId));this.newUploadedFiles.splice(e,1)}},removeAttachedFile(t){if(t&&t.id){const e=this.newUploadedFiles.findIndex((e=>e.id===t.id));this.newUploadedFiles.splice(e,1)}},addNewCreatedDocument(t){t&&t.id&&(document.dispatchEvent(new CustomEvent("attachment-added",{detail:{attachment:t,entityType:this.entityType,entityId:this.entityId}})),this.sendDocumentAnalytics(t),this.newUploadedFiles.push(t))},sendDocumentAnalytics(t){if(t&&t.UUID||t.id){const e=this.sourceApp||this.entityType||eXo.env.portal.selectedNodeUri,i=t.UUID||t.id,a=t.title.split(".").pop(),s={module:"Drive",subModule:"attachment-drawer",parameters:{documentId:i,origin:e.toLowerCase(),documentSize:t.size,documentName:t.title,documentExtension:a,creationType:this.creationType},userId:eXo.env.portal.userIdentityId,spaceId:eXo.env.portal.spaceId,userName:eXo.env.portal.userName,operation:"fileCreated",timestamp:Date.now()};document.dispatchEvent(new CustomEvent("exo-statistic-message",{detail:s}))}}}},s,[],!1,null,null,null).exports;var d=function(){var t=this,e=t._self._c;return e("v-main",[e("div",{staticClass:"attachment d-flex",class:t.allowToPreview&&"clickable"},[e("v-list-item-avatar",{staticClass:"border-radius",class:t.smallAttachmentIcon?"me-0":"me-3",on:{click:function(e){return t.openFile()}}},[t.attachment.uploadProgress<100?e("div",{staticClass:"fileProgress"},[e("v-progress-circular",{attrs:{rotate:-90,size:40,width:4,value:t.attachment.uploadProgress,color:"primary"}},[t._v("\n          "+t._s(t.attachment.uploadProgress)+"\n        ")])],1):e("div",{staticClass:"fileType",class:t.smallAttachmentIcon&&"smallAttachmentIcon"},[e("v-icon",{attrs:{size:"41",color:t.icon.color}},[t._v("\n          "+t._s(t.icon.class)+"\n        ")])],1)]),t._v(" "),e("v-list-item-content",{on:{click:function(e){return t.openFile()}}},[e("v-list-item-title",{staticClass:"uploadedFileTitle",attrs:{title:t.attachmentTitle}},[t._v("\n        "+t._s(t.attachmentTitle||t.notAccessibleAttachmentTitle)+"\n      ")]),t._v(" "),t.canMoveAttachment?e("v-list-item-subtitle",{staticClass:"d-flex v-messages uploadedFileSubTitle"},[t.attachment.pathDestinationFolderForFile?e("v-chip",{staticClass:"attachment-location px-2",attrs:{close:"",small:""},on:{"click:close":function(e){return t.$root.$emit("remove-destination-for-file",t.attachment.id)},click:function(e){return t.openSelectDestinationFolderForFile(t.attachment)}}},[t._v("\n          "+t._s(t.attachment.pathDestinationFolderForFile)+"\n        ")]):t._e(),t._v(" "),t.attachment.pathDestinationFolderForFile?t._e():e("a",{staticClass:"attachmentDestinationPath primary--text",attrs:{title:t.$t("attachments.ChangeLocation"),rel:"tooltip","data-placement":"top"},on:{click:function(e){return t.openSelectDestinationFolderForFile(t.attachment)}}},[t._v(t._s(t.$t("attachments.ChangeLocation")))])],1):t._e()],1),t._v(" "),e("v-list-item-action",{staticClass:"d-flex flex-row align-center"},[t.attachment.isSelectedFromDrives&&t.fromAnotherSpaceAttachment||t.fromAnotherDriveAttachment?e("v-icon",{attrs:{title:t.attachmentPrivacyLabel,size:"14",color:"primary",depressed:""}},[t._v("\n        fa-info-circle\n      ")]):t._e(),t._v(" "),t.canAccess?t._e():e("v-icon",{attrs:{title:t.notAccessibleAttachmentTooltip,size:"14",color:"primary",depressed:""}},[t._v("\n        fa-info-circle\n      ")]),t._v(" "),t.attachmentInProgress?e("v-btn",{staticClass:"d-flex align-end",attrs:{outlined:"","x-small":"",height:"18",width:"18"},on:{click:function(e){return t.detachFile(t.attachment)}}},[e("i",{staticClass:"uiIconCloseCircled error--text"})]):t._e(),t._v(" "),t.allowToDetach&&t.canAccess?e("div",{staticClass:"remove-button",class:!t.canDetachAttachment&&"not-allowed",attrs:{title:!t.canDetachAttachment&&t.$t("attachments.remove.notAuthorize")||t.$t("attachment.detach")}},[e("v-btn",{staticClass:"d-flex",attrs:{disabled:!t.canDetachAttachment,outlined:"","x-small":"",height:"24",width:"24"},on:{click:function(e){return t.detachFile(t.attachment)}}},[e("v-icon",{staticClass:"fas fa-unlink",class:t.canDetachAttachment?"error--text":"grey--text",attrs:{small:""}})],1)],1):t._e()],1)],1),t._v(" "),e("div",{staticClass:"d-flex"},t._l(t.attachment.actions,(function(i){return e("p",{key:i,staticClass:"docActionItem me-4 ml-4 clickable",on:{click:function(e){return t.$emit(`${i}`,t.attachment)}}},[t._v("\n      "+t._s(t.$t(`attachments.upload.action.${i}`))+"\n    ")])})),0)])};d._withStripped=!0;const h={props:{attachment:{type:Object,default:()=>null},allowToDetach:{type:Boolean,default:!0},allowToEdit:{type:Boolean,default:!0},allowToPreview:{type:Boolean,default:!1},openInEditor:{type:Boolean,default:!1},isFileEditable:{type:Boolean,default:!1},canEdit:{type:Boolean,default:!1},entityId:{type:String,default:""},canAccess:{type:Boolean,default:!0},smallAttachmentIcon:{type:Boolean,default:!1},currentSpace:{type:{},default:()=>null},currentDrive:{type:{},default:()=>null}},data:()=>({BYTES_IN_KB:1024,BYTES_IN_MB:1048576,BYTES_IN_GB:1073741824,MB_IN_GB:10,measure:"bytes"}),computed:{fromAnotherSpaceAttachment(){return this.attachmentSpaceId&&this.attachmentSpaceId!==this.currentSpaceId&&this.attachmentSpaceId||!1},fromAnotherDriveAttachment(){return this.attachmentCurrentDriveName&&this.currentDriveName!==this.attachmentCurrentDriveName&&!this.attachmentSpaceId||!1},selectedFromOtherDriveLabel(){return this.$t(`attachments.alert.sharing.${this.otherDriveType}`)},otherDriveType(){return this.fromAnotherSpaceAttachment?"space":this.fromAnotherDriveAttachment?"otherDrive":""},attachmentSpaceDisplayName(){return this.attachment&&this.attachment.space&&this.attachment.space.title},attachmentCurrentDriveName(){return this.attachment&&this.attachment.fileDrive&&this.attachment.fileDrive.title},currentSpaceId(){return this.currentSpace&&this.currentSpace.groupId&&this.currentSpace.groupId.split("/spaces/")[1]},currentDriveName(){return this.currentDrive&&this.currentDrive.title},attachmentSpaceId(){return this.attachment&&this.attachment.space&&this.attachment.space.name&&this.attachment.space.name.split(".spaces.")[1]},attachedFromOtherDrivesLabel(){return`${this.$t("attachments.alert.sharing.attachedFrom")} ${this.selectedFromOtherDriveLabel} ${this.fromAnotherSpaceAttachment&&this.attachmentSpaceDisplayName||this.fromAnotherDriveAttachment&&this.attachmentCurrentDriveName||""}.`},attachmentsWillBeDisplayedForLabel(){return this.$t("attachments.alert.sharing.availableFor")},attachmentPrivacyLabel(){return`${this.attachedFromOtherDrivesLabel} ${this.attachmentsWillBeDisplayedForLabel}`},canDetachAttachment(){return this.attachmentHasPermission&&this.attachmentHasPermission.canDetach||!this.attachment.id||this.attachment.isSelectedFromDrives||!this.entityId},canMoveAttachment(){return this.canEdit&&this.allowToEdit&&!this.attachment.isSelectedFromDrives},attachmentHasPermission(){return this.attachment&&this.attachment.acl},notAccessibleAttachmentTitle(){return!this.canAccess&&this.$t("attachment.notAccessible.title")||""},notAccessibleAttachmentTooltip(){return this.$t("attachment.notAccessible.tooltip")},attachmentInProgress(){return this.attachment.uploadProgress<100},attachmentTitle(){return this.attachment&&this.attachment.title&&unescape(this.attachment.title)},icon(){const t=this.attachment&&this.attachment.mimetype||"";return t.includes("pdf")?{class:"fas fa-file-pdf",color:"#FF0000"}:t.includes("presentation")||t.includes("powerpoint")?{class:"fas fa-file-powerpoint",color:"#CB4B32"}:t.includes("sheet")||t.includes("excel")||t.includes("csv")?{class:"fas fa-file-excel",color:"#217345"}:t.includes("word")||t.includes("opendocument")||t.includes("rtf")?{class:"fas fa-file-word",color:"#2A5699"}:t.includes("plain")?{class:"fas fa-file-alt",color:"#385989"}:t.includes("image")?{class:"fas fa-file-image",color:"#999999"}:t.includes("video")||t.includes("octet-stream")||t.includes("ogg")?{class:"fas fa-file-video",color:"#79577A"}:t.includes("zip")||t.includes("war")||t.includes("rar")?{class:"fas fa-file-archive",color:"#717272"}:t.includes("illustrator")||t.includes("eps")?{class:"fas fa-file-contract",color:"#E79E24"}:t.includes("html")||t.includes("xml")||t.includes("css")?{class:"fas fa-file-code",color:"#6cf500"}:{class:"fas fa-file",color:"#476A9C"}}},methods:{detachFile(){this.canDetachAttachment&&this.$root.$emit("remove-attachment-item",this.attachment)},openSelectDestinationFolderForFile(t){this.$root.$emit("change-attachment-destination-path",t)},absoluteDateModified(t){const e=eXo&&eXo.env&&eXo.env.portal&&eXo.env.portal.language||"en";return new Date(this.attachment.date).toLocaleString(e,t).split("/").join("-")},fileInfo(){return`${this.$t("documents.preview.updatedOn")} ${this.absoluteDateModified()} ${this.$t("documents.preview.updatedBy")} ${this.attachment.lastEditor} ${this.attachment.size}`},openFileInEditor(){this.attachment&&this.attachment.id&&window.open(`${eXo.env.portal.context}/${eXo.env.portal.portalName}/oeditor?docId=${this.attachment.id}&source=peview`,"_blank")},openFile(){this.openInEditor&&this.isFileEditable&&this.attachment.acl?.canEdit?this.openFileInEditor():this.openPreview()},openPreview(){if(this.allowToPreview&&this.attachment.id){const t=this;documentPreview.init({doc:{id:t.attachment.id,repository:"repository",workspace:"collaboration",path:t.attachment.nodePath||t.attachment.path,title:t.attachment.title,downloadUrl:t.attachment.downloadUrl,openUrl:t.attachment.url||t.attachment.openUrl,breadCrumb:t.attachment.previewBreadcrumb,fileInfo:t.fileInfo(),size:t.attachment.size,isCloudDrive:t.attachment.cloudDrive},version:{number:t.attachment.version},showComments:!1})}}}},p=l(h,d,[],!1,null,null,null).exports;var m=function(){var t=this,e=t._self._c;return e("v-menu",{attrs:{"position-x":t.folderActionsMenuLeft,"position-y":t.folderActionsMenuTop,"close-on-content-click":!1,absolute:"","offset-y":""},model:{value:t.showDropdownMenu,callback:function(e){t.showDropdownMenu=e},expression:"showDropdownMenu"}},[e("v-list",{staticClass:"attachments-folder-action-menu pa-0"},[e("v-list-item",{staticClass:"pa-0",class:t.selectedFolder.canRemove?"clickable":"not-allowed"},[e("v-list-item-title",{staticClass:"folder-actions-menu-item no-border px-3 border-bottom-color delete",on:{click:function(e){return t.deleteFolder()}}},[e("i",{staticClass:"uiIconTrash pr-2"}),t._v(t._s(t.$t("attachments.filesFoldersSelector.action.delete"))+"\n      ")])],1),t._v(" "),e("v-list-item",{staticClass:"pa-0",class:t.selectedFolder.canRemove?"clickable":"not-allowed"},[e("v-list-item-title",{staticClass:"folder-actions-menu-item no-border px-3 rename",on:{click:function(e){return t.renameFolder()}}},[e("i",{staticClass:"uiIconEdit pr-2"}),t._v(t._s(t.$t("attachments.filesFoldersSelector.action.rename"))+"\n      ")])],1)],1)],1)};m._withStripped=!0;const u=l({props:{folderActionsMenuTop:{type:Number,default:0},folderActionsMenuLeft:{type:Number,default:0},selectedFolder:{type:Object,required:!1,default:function(){return new Object}}},data:()=>({showDropdownMenu:!1}),methods:{openMenu(){this.showDropdownMenu=!0},closeMenu(){this.showDropdownMenu=!1},deleteFolder(){this.$emit("deleteFolder")},renameFolder(){this.$emit("renameFolder")}}},m,[],!1,null,null,null).exports;var v=function(){var t=this,e=t._self._c;return e("v-app",[e("div",{staticClass:"attachments-application border-box-sizing transparent",class:t.entityType&&t.entityId&&"v-card__text pl-0"},[e("attachments-drawer",{ref:"attachmentsAppDrawer",attrs:{attachments:t.attachments,"entity-has-attachments":t.entityHasAttachments,"entity-id":t.entityId,"entity-type":t.entityType,"default-drive":t.defaultDrive,"default-folder":t.defaultFolder,"current-space":t.currentSpace,"attach-to-entity":t.attachToEntity,files:t.files}}),t._v(" "),e("attachments-list-drawer",{ref:"attachmentsListDrawer",attrs:{"supported-documents":t.supportedDocuments,attachments:t.attachments,"open-attachments-in-editor":t.openAttachmentsInEditor}}),t._v(" "),e("attachments-notification-alerts")],1)])};v._withStripped=!0;const f=l({data:()=>({attachments:[],files:[],currentSpace:{},defaultDrive:null,defaultFolder:null,spaceId:null,entityType:null,entityId:null,sourceApp:null,drawerList:!1,attachToEntity:!0,supportedDocuments:null,openAttachmentsInEditor:!1}),computed:{entityHasAttachments(){return this.attachments&&this.attachments.length}},created(){this.$root.$on("entity-attachments-updated",(()=>this.initEntityAttachmentsList())),this.$root.$on("remove-attachment-item",(t=>{this.removeAttachedFile(t)})),this.$root.$on("add-new-created-document",(t=>{this.attachments.push(t)})),this.$root.$on("add-new-uploaded-file",(t=>{this.attachments.push(t)})),this.$root.$on("attachments-changed-from-drives",((t,e)=>{this.updateAttachmentsFromDrives(t,e)})),this.$root.$on("add-destination-path-for-all",((t,e,i)=>{this.addDestinationFolderForAll(t,e,i)})),this.$root.$on("reset-attachment-list",(()=>{this.attachments=[]})),document.addEventListener("open-attachments-app-drawer",(t=>{this.drawerList=!1,this.readConfiguration(t.detail),this.initAttachmentEnvironment(),this.openAttachmentsAppDrawer()})),document.addEventListener("open-attachments-list-drawer",(t=>{this.drawerList=!0,this.readConfiguration(t.detail),this.initAttachmentEnvironment(),this.openAttachmentsDrawerList()})),document.addEventListener("documents-supported-document-types-updated",this.refreshSupportedDocumentExtensions),this.refreshSupportedDocumentExtensions()},mounted(){this.$root.$applicationLoaded()},methods:{refreshSupportedDocumentExtensions(){this.supportedDocuments=extensionRegistry.loadExtensions("documents","supported-document-types")},openAttachmentsAppDrawer(){this.$root.$emit("open-attachments-app-drawer")},readConfiguration(t){t=t||{},this.spaceId=this.getURLQueryParam("spaceId")||t.spaceId||eXo.env.portal.spaceId,this.spaceId?this.$spaceService.getSpaceById(this.spaceId).then((t=>{if(t){this.currentSpace=t;const e=t.groupId.split("/spaces/")[1];this.defaultDrive={name:`.spaces.${e}`,title:t.displayName,isSelected:!0}}})):this.defaultDrive=t.defaultDrive||{isSelected:!0,name:eXo.env.portal.spaceGroup&&`.spaces.${eXo.env.portal.spaceGroup}`||"Personal Documents",title:eXo.env.portal.spaceDisplayName||"Personal Documents"},this.defaultFolder=t.defaultFolder||eXo.env.portal.spaceId&&"/"||"Public",this.sourceApp=t.sourceApp||null,this.files=t.files||null,this.attachments=t.attachments||[],void 0!==t.attachToEntity&&(this.attachToEntity=t.attachToEntity,this.attachments.forEach((t=>{t.acl&&(t.acl.canDetach=!0)}))),this.entityType=t.entityType,this.entityId=t.entityId,this.openAttachmentsInEditor=t.openAttachmentsInEditor||!1},startLoadingList(){this.drawerList&&this.$refs.attachmentsListDrawer?this.$refs.attachmentsListDrawer.startLoading():!this.drawerList&&this.$refs.attachmentsAppDrawer&&this.$refs.attachmentsAppDrawer.startLoading()},endLoadingList(){this.drawerList&&this.$refs.attachmentsListDrawer?this.$refs.attachmentsListDrawer.endLoading():!this.drawerList&&this.$refs.attachmentsAppDrawer&&this.$refs.attachmentsAppDrawer.endLoading()},initAttachmentEnvironment(){this.entityType&&this.entityId&&this.attachToEntity&&(this.startLoadingList(),this.initEntityAttachmentsList().finally((()=>this.endLoadingList())))},initEntityAttachmentsList(){if(this.entityType&&this.entityId)return this.$attachmentService.getEntityAttachments(this.entityType,this.entityId).then((t=>{t.forEach((t=>t.name=t.title)),Object.assign(this.attachments,t)}))},openAttachmentsDrawerList(){this.$root.$emit("open-attachments-list-drawer")},removeAttachedFile:function(t){if(t.id)if(this.attachToEntity)this.startLoadingList(),this.$attachmentService.removeEntityAttachment(this.entityId,this.entityType,t.id).then((()=>{this.$root.$emit("remove-attached-file",t);const e=this.attachments.findIndex((e=>e.id===t.id));this.attachments.splice(e,e>=0?1:0),this.$root.$emit("attachments-notification-alert",{message:this.$t("attachments.detach.success"),type:"success"}),this.initEntityAttachmentsList(),document.dispatchEvent(new CustomEvent("entity-attachments-updated")),document.dispatchEvent(new CustomEvent("attachment-removed",{detail:t}))})).catch((e=>{console.error(e),this.$root.$emit("attachments-notification-alert",{message:this.$t("attachments.delete.failed").replace("{0}",t.title),type:"error"})})).finally((()=>this.endLoadingList()));else{document.dispatchEvent(new CustomEvent("attachment-removed",{detail:t})),this.$root.$emit("remove-attached-file",t);const e=this.attachments.findIndex((e=>e.id===t.id));this.attachments.splice(e,e>=0?1:0)}else{const e=this.attachments.findIndex((e=>e.uploadId===t.uploadId));this.attachments.splice(e,e>=0?1:0),t.uploadProgress!==this.maxProgress&&this.$root.$emit("abort-uploading-new-file",t),0===this.attachments.length&&this.$root.$emit("end-loading-attachment-drawer")}},addDestinationFolderForAll(t,e,i){this.attachments.forEach((a=>{!a.id||a.destinationFolder&&a.destinationFolder!==t||this.$attachmentService.moveAttachmentToNewPath(i.name,e,a.id,this.entityType,this.entityId).then((()=>{this.$root.$emit("entity-attachments-updated"),document.dispatchEvent(new CustomEvent("entity-attachments-updated"))}))}))},getURLQueryParam(t){const e=new URLSearchParams(window.location.search);if(e.has(t))return e.get(t)},updateAttachmentsFromDrives(t,e){t.length&&this.attachments.push(...t),e.length&&e.forEach((t=>{const e=this.attachments.findIndex((e=>e.id===t.id));-1!==e&&this.attachments.splice(e,1)}))}}},v,[],!1,null,null,null).exports;var y=function(){var t=this,e=t._self._c;return e("div",{staticClass:"attachment"},[e("a",{staticClass:"fileTitle d-flex flex-column v-messages",attrs:{title:t.file.name,rel:"tooltip","data-placement":"bottom"}},[e("div",{staticClass:"fileType d-flex",class:t.file.isSelected&&"selected"},[e("div",{staticClass:"file-type-icon pa-0 col-9 text-right pt-2"},[e("i",{class:t.getIconClassFromFileMimeType(t.file.mimetype)})]),t._v(" "),e("v-icon",{directives:[{name:"show",rawName:"v-show",value:t.file.isSelected,expression:"file.isSelected"}],staticClass:"align-self-start pe-1",attrs:{color:"primary",size:"18"}},[t._v("fas fa-check-square\n      ")])],1),t._v(" "),e("div",{staticClass:"selectionLabel text-truncate text-color center"},[t._v(t._s(t.file.name))])])])};y._withStripped=!0;const g=l({props:{file:{type:Object,default:()=>null}},methods:{getIconClassFromFileMimeType:function(t){if(t){const e=t.replace(/\./g,"").replace("/","").replace("\\","");return this.file.isCloudFile?`uiIcon32x32${t.replace(/[/.]/g,"")}`:`uiIconFileType${e} uiIconFileTypeDefault`}return"uiIconFileTypeDefault"}}},y,[],!1,null,null,null).exports;var w=function(){var t=this,e=t._self._c;return e("v-alert",{staticClass:"white position-relative",attrs:{type:t.alertType,border:"left",elevation:"2",dismissible:"","colored-border":"",outlined:""},scopedSlots:t._u([{key:"close",fn:function({toggle:i}){return e("v-btn",{attrs:{icon:"",small:"",light:""},on:{click:i}},[e("v-icon",[t._v("close")])],1)}}]),model:{value:t.displayAlert,callback:function(e){t.displayAlert=e},expression:"displayAlert"}},[e("span",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:t.alertMessage,expression:"alertMessage"}],staticClass:"text-color"}),t._v(" "),t.alert.click?e("v-btn",{staticClass:"primary--text",attrs:{text:""},on:{click:t.alert.click}},[t._v("\n    "+t._s(t.alert.clickMessage)+"\n  ")]):t._e()],1)};w._withStripped=!0;const F=l({props:{alert:{type:Object,default:null}},data:()=>({displayAlert:!0}),computed:{alertMessage(){return this.alert.message},alertType(){return this.alert.type}},watch:{displayAlert(){this.displayAlert||this.$emit("dismissed")}}},w,[],!1,null,null,null).exports;var $=function(){var t=this,e=t._self._c;return e("v-snackbar",{attrs:{value:t.displayAlerts,color:"transparent",elevation:"0",app:"",bottom:"",left:""}},t._l(t.alerts,(function(i){return e("attachments-notification-alert",{key:i.message,attrs:{alert:i},on:{dismissed:function(e){return t.deleteAlert(i)}}})})),1)};$._withStripped=!0;const D=l({props:{name:{type:String,default:null}},data:()=>({alerts:[]}),computed:{displayAlerts(){return this.alerts&&this.alerts.length}},created(){this.$root.$on("attachments-notification-alert",this.addAlert),document.addEventListener("attachments-notification-alert",(t=>{if(t&&t.detail&&t.detail.messageObject){const e={message:t.detail.messageObject.message,type:t.detail.messageObject.type};this.addAlert(e)}}))},methods:{addAlert(t){t&&(this.alerts.push(t),window.setTimeout((()=>this.deleteAlert(t)),5e3))},deleteAlert(t){const e=this.alerts.indexOf(t);this.alerts.splice(e,1),this.$forceUpdate()}}},$,[],!1,null,null,null).exports;var x=function(){var t=this,e=t._self._c;return e("exo-drawer",{ref:"attachmentsListDrawer",staticClass:"attachmentsListDrawer",attrs:{right:""}},[e("template",{slot:"title"},[e("div",{staticClass:"drawerHeader d-flex align-center justify-space-between"},[e("div",{staticClass:"drawerTitle"},[e("v-btn",{attrs:{icon:"",color:"grey"},on:{click:function(e){return t.closeAttachmentsListDrawer()}}},[e("v-icon",[t._v("mdi-keyboard-backspace")])],1),t._v(" "),e("span",[t._v(t._s(t.$t("attachments.list")))])],1)])]),t._v(" "),e("template",{slot:"titleIcons"},[e("v-btn",{attrs:{icon:"",color:"primary"},on:{click:function(e){return t.openAttachmentsAppDrawer()}}},[e("v-icon",{attrs:{size:"20"}},[t._v("\n        fa-plus\n      ")])],1)],1),t._v(" "),e("template",{slot:"content"},[t.attachments.length?e("div",{staticClass:"uploadedFilesItems ml-5"},[e("transition-group",{staticClass:"d-flex flex-column",attrs:{name:"list-complete",tag:"div"}},t._l(t.attachments,(function(i){return e("span",{key:i,staticClass:"list-complete-item"},[e("attachment-item",{attrs:{"open-in-editor":t.openAttachmentsInEditor,"is-file-editable":t.isFileEditable(i),"allow-to-edit":!1,attachment:i,"can-access":i.acl&&i.acl.canAccess,"allow-to-preview":""}})],1)})),0)],1):e("div",{staticClass:"no-files-attached d-flex flex-column align-center text-sub-title"},[e("div",{staticClass:"d-flex pl-6 not-files-icon"},[e("i",{staticClass:"uiIconAttach uiIcon64x64"}),t._v(" "),e("i",{staticClass:"uiIconCloseCircled uiIcon32x32"})]),t._v(" "),e("span",[t._v(t._s(t.$t("no.attachments")))])])]),t._v(" "),e("template",{slot:"header"})],2)};x._withStripped=!0;const A=l({props:{attachments:{type:Array,default:()=>[]},supportedDocuments:{type:Array,default:()=>[]},openAttachmentsInEditor:{type:Boolean,default:()=>!1}},created(){this.$root.$on("open-attachments-list-drawer",(()=>this.openAttachmentsListDrawer()))},methods:{isFileEditable(t){const e=t&&t.mimetype||"";return this.supportedDocuments&&this.supportedDocuments.filter((i=>i.edit&&i.mimeType===e&&!t.cloudDriveFile)).length>0},startLoading(){this.$refs.attachmentsListDrawer.startLoading()},endLoading(){this.$refs.attachmentsListDrawer.endLoading()},openAttachmentsListDrawer(){this.$refs.attachmentsListDrawer.open()},closeAttachmentsListDrawer(){this.$refs.attachmentsListDrawer.close()},openAttachmentsAppDrawer(){this.closeAttachmentsListDrawer(),this.$root.$emit("open-attachments-app-drawer")}}},x,[],!1,null,null,null).exports;var _=function(){var t=this,e=t._self._c;return e("div",{staticClass:"attachmentsUploadBlock"},[e("div",{staticClass:"d-flex align-center"},[e("v-subheader",{staticClass:"text-sub-title pl-0 d-flex"},[t._v("\n      "+t._s(t.$t("attachments.upload"))+"\n    ")]),t._v(" "),e("v-divider")],1),t._v(" "),e("div",{staticClass:"multiUploadFilesSelector d-flex flex-column"},[e("div",{ref:"dropFileBox",staticClass:"dropFileBox py-10 ml-5 d-flex flex-column align-center theme--light",attrs:{id:"DropFileBox","aria-controls":""},on:{click:t.uploadFile}},[e("i",{staticClass:"uiIconEcmsUploadVersion uiIcon32x32"}),t._v(" "),e("v-subheader",{staticClass:"upload-drag-drop-label text-sub-title mt-3 d-flex flex-column"},[e("span",[t._v(t._s(t.$t("attachments.drawer.uploadOrDrop")))]),t._v(" "),e("span",[t._v("("+t._s(t.$t("attachments.drawer.maxFileSize").replace("{0}",t.maxFileSize))+")")])])],1),t._v(" "),e("div",{staticClass:"fileHidden d-none"},[e("input",{ref:"uploadInput",staticClass:"file",staticStyle:{display:"none"},attrs:{name:"file",type:"file",multiple:"multiple"},on:{change:function(e){return t.handleFileUpload(t.$refs.uploadInput.files)}}})])])])};_._withStripped=!0;const C=l({props:{attachments:{type:Array,default:()=>[]},maxFilesCount:{type:Number,default:parseInt(`${eXo.env.portal.maxToUpload}`)},maxFileSize:{type:Number,default:parseInt(`${eXo.env.portal.maxFileSize}`)},currentDrive:{type:Object,default:()=>null},pathDestinationFolder:{type:Object,default:()=>null}},data:()=>({MESSAGES_DISPLAY_TIME:5e3,BYTES_IN_MB:1048576,maxUploadInProgressCount:2,uploadingFilesQueue:[],uploadingCount:0,maxProgress:100,newUploadedFiles:[],abortUploading:!1}),computed:{maxFileCountErrorLabel:function(){return this.$t("attachments.drawer.maxFileCount.error").replace("{0}",`<b> ${this.maxFilesCount} </b>`)},maxFileSizeErrorLabel:function(){return this.$t("attachments.drawer.maxFileSize.error").replace("{0}",`<b> ${this.maxFileSize} </b>`)},isNewUploadedFilesEmpty(){return this.newUploadedFiles&&0===this.newUploadedFiles.length},uploadFinished(){return!this.isNewUploadedFilesEmpty&&this.newUploadedFiles.every((t=>t.uploadProgress&&100===t.uploadProgress))}},watch:{uploadFinished(){this.uploadFinished&&0===this.uploadingCount&&(this.$root.$emit("link-new-added-attachments"),this.newUploadedFiles=[])}},created(){this.initDragAndDropEvents(),this.$root.$on("handle-pasted-files-from-clipboard",this.handleFileUpload),this.$root.$on("reset-attachments-upload-input",(()=>this.resetUploadInput())),this.$root.$on("abort-attachments-new-upload",(()=>this.abortUploadingNewAttachments())),this.$root.$on("abort-uploading-new-file",this.abortUploadingNewFile),this.$root.$on("handle-provided-files",(t=>this.handleFileUpload(t))),this.$root.$on("attachment-continue-upload",(t=>{this.sendFileToServer(t,!0)}))},beforeDestroy(){this.$root.$off("handle-pasted-files-from-clipboard",this.handleFileUpload),this.$root.$off("reset-attachments-upload-input",this.resetUploadInput),this.$root.$off("abort-attachments-new-upload",this.abortUploadingNewAttachments),this.$root.$off("abort-uploading-new-file",this.abortUploadingNewFile),this.$root.$off("handle-provided-files",this.handleFileUpload)},methods:{initDragAndDropEvents(){this.$nextTick((()=>{this.dragAndDropEventListenerInitialized||(["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(function(t){document.addEventListener(t,function(t){t.preventDefault(),t.stopPropagation()}.bind(this),!1)}.bind(this)),document.addEventListener("dragover",function(){this.$refs.dropFileBox.classList.add("dragStart")}.bind(this)),this.$refs.dropFileBox.addEventListener("drop",function(t){this.$refs.dropFileBox.classList.remove("dragStart"),this.handleFileUpload(t.dataTransfer.files)}.bind(this)),document.addEventListener("dragleave",function(){this.$refs.dropFileBox.classList.remove("dragStart")}.bind(this)),document.addEventListener("drop",function(){this.$refs.dropFileBox.classList.remove("dragStart")}.bind(this)),window.require(["SHARED/jquery"],(function(t){t('#exoAttachmentsApp *[rel="tooltip"]').tooltip()})),this.dragAndDropEventListenerInitialized=!0)}))},uploadFile:function(){this.$refs.uploadInput.click()},handleFileUpload:function(t){this.abortUploading=!1;const e=Array.from(t);e.sort((function(t,e){return t.size-e.size})),this.newUploadedFiles=[];const i=[];e.forEach((t=>{const e=(new AbortController).signal;i.push({originalFileObject:t,fileDrive:this.currentDrive,title:t.name,size:t.size,mimetype:t.type,acl:t.acl,uploadId:this.getNewUploadId(),uploadProgress:0,destinationFolder:this.pathDestinationFolder,pathDestinationFolderForFile:"",isPublic:!0,signal:e})}));const a=i.filter((t=>this.attachments.some((e=>e.title===t.title))));if(a.length>0){const t=1===a.length?a.map((t=>t.title)):a.length;let e=1===a.length?this.$t("attachments.drawer.sameFile.error"):this.$t("attachments.drawer.sameFiles.error");e=e.replace("{0}",`<b> ${t} </b>`),this.$root.$emit("attachments-notification-alert",{message:e,type:"error"})}i.filter((t=>!this.attachments.some((e=>e.title===t.title)))).forEach(((t,e)=>{this.attachments.length!==this.maxFilesCount?this.queueUpload(t):(this.newUploadedFiles[e-1]||0===e)&&this.$root.$emit("attachments-notification-alert",{message:this.maxFileCountErrorLabel,type:"error"})})),this.$refs.uploadInput.value=null},queueUpload:function(t){t.size/this.BYTES_IN_MB>this.maxFileSize?this.$root.$emit("attachments-notification-alert",{message:this.maxFileSizeErrorLabel,type:"error"}):this.checkExistenceActions(t.title).then((e=>{e.length>0&&(t.actions=e,t.waitAction=!0,this.$root.$emit("attachments-notification-alert",{message:this.$t("attachments.upload.conflict.message"),type:"warning"}),this.$root.$emit("start-loading-attachment-drawer")),this.$root.$emit("add-new-uploaded-file",t),this.newUploadedFiles.push(t),this.uploadingCount<this.maxUploadInProgressCount?this.sendFileToServer(t):this.uploadingFilesQueue.push(t)}))},checkExistenceActions(t){const e=[];return this.$attachmentService.checkExistence(this.currentDrive.name,"collaboration",this.pathDestinationFolder,t).then((t=>{const i=t&&t.firstChild,a=i&&i.firstChild;return i&&"Existed"===i.tagName&&e.push("keepBoth"),!a||"Versioned"!==a.tagName&&"CanVersioning"!==a.tagName||e.push("createVersion"),e}))},sendFileToServer(t,e){t.aborted||t.waitAction?this.processNextQueuedUpload():(this.uploadingCount++,this.$uploadService.upload(t.originalFileObject,t.uploadId,t.signal).then((()=>delete t.originalFileObject)).catch((()=>{this.$root.$emit("attachments-notification-alert",{message:this.$t("attachments.link.failed"),type:"error"}),this.removeAttachedFile(t)})),this.controlUpload(t,e))},controlUpload(t,e){t.aborted?(this.uploadingCount--,this.processNextQueuedUpload()):window.setTimeout((()=>{this.$uploadService.getUploadProgress(t.uploadId).then((i=>{if(!this.abortUploading&&(t.uploadProgress=Number(i),!t.uploadProgress||t.uploadProgress<100?this.controlUpload(t):(this.uploadingCount--,this.processNextQueuedUpload()),100===t.uploadProgress&&e)){this.$root.$emit("continue-upload-to-destination-path",t);const e=this.newUploadedFiles.findIndex((e=>e.id===t.id));this.newUploadedFiles.splice(e,1)}})).catch((()=>{this.removeAttachedFile(t),this.$root.$emit("attachments-notification-alert",{message:this.$t("attachments.link.failed"),type:"error"})}))}),200)},processNextQueuedUpload:function(){this.uploadingFilesQueue.length>0&&this.sendFileToServer(this.uploadingFilesQueue.shift())},getNewUploadId:function(){return Math.floor(1e5*Math.random())},removeAttachedFile(t){this.$root.$emit("remove-attachment-item",t)},resetUploadInput(){this.newUploadedFiles=[],this.uploadingCount=0},abortUploadingNewAttachments(){this.resetUploadInput(),this.abortUploading=!0},abortUploadingNewFile(t){if(t&&t.uploadId){const e=this.newUploadedFiles.findIndex((e=>e.uploadId===t.uploadId));this.newUploadedFiles.splice(e,1)}t.aborted=!0,this.$uploadService.abortUpload(t.uploadId)}}},_,[],!1,null,null,null).exports;var b=function(){var t=this,e=t._self._c;return e("div",{staticClass:"uploadedFiles"},[e("div",{staticClass:"attachments-list d-flex align-center"},[e("v-subheader",{staticClass:"text-sub-title pl-0 d-flex"},[t._v("\n      "+t._s(t.$t("attachments.drawer.title"))+" ("+t._s(t.attachments.length)+"/"+t._s(t.maxFilesCount)+")\n    ")]),t._v(" "),e("v-divider")],1),t._v(" "),0===t.attachments.length?e("div",{staticClass:"no-files-attached d-flex flex-column align-center text-sub-title"},[t._m(0),t._v(" "),e("span",[t._v(t._s(t.$t("no.attachments")))])]):t._e(),t._v(" "),t._e(),t._v(" "),t.attachments.length?e("div",{staticClass:"uploadedFilesItems ml-5"},[e("transition-group",{staticClass:"d-flex flex-column",attrs:{name:"list-complete",tag:"div"}},t._l(t.newUploadedFiles,(function(i){return e("span",{key:i.title,staticClass:"list-complete-item"},[e("attachment-item",{attrs:{attachment:i,"can-edit":i.acl&&i.acl.canEdit,"allow-to-preview":!1,"current-space":t.currentSpace,"current-drive":t.currentDrive,"entity-id":t.entityId,"allow-to-detach":t.allowToDetach,"allow-to-edit":""},on:{keepBoth:function(e){return t.$emit("keep-both",i)},createVersion:function(e){return t.$emit("create-version",i)}}})],1)})),0)],1):t._e()])};b._withStripped=!0;const I=l({props:{attachments:{type:Array,default:()=>[]},schemaFolder:{type:Object,default:()=>null},maxFilesCount:{type:Number,default:null},currentSpace:{type:{},default:()=>null},currentDrive:{type:{},default:()=>null},newUploadedFiles:{type:{},default:()=>null},entityId:{type:String,default:""},entityType:{type:String,default:""}},created(){this.$root.$on("refresh-uploaded-files-list",(()=>{this.$forceUpdate()}))},computed:{displayMessageDestinationFolder(){return!this.attachments.length||this.attachments.some((t=>null!=t.uploadId&&""!==t.uploadId))},allowToDetach(){return!!this.entityId&&!!this.entityType}},methods:{openSelectDestinationFolderDrawer(){this.$root.$emit("open-drive-explorer-drawer",this.currentDrive)}}},b,[function(){var t=this._self._c;return t("div",{staticClass:"d-flex pl-6 not-files-icon"},[t("i",{staticClass:"uiIconAttach uiIcon64x64"}),this._v(" "),t("i",{staticClass:"uiIconCloseCircled uiIcon32x32"})])},function(){var t=this._self._c;return t("div",[t("span",{staticClass:"uiIconArrowRight colorIcon"})])},function(){var t=this._self._c;return t("div",[t("span",{staticClass:"uiIconArrowRight colorIcon"})])},function(){var t=this._self._c;return t("div",[t("span",{staticClass:"uiIconArrowRight colorIcon"})])},function(){var t=this._self._c;return t("div",[t("span",{staticClass:"uiIconArrowRight colorIcon"})])}],!1,null,null,null).exports;var E=function(){var t=this,e=t._self._c;return e("exo-drawer",{ref:"driveExplorerDrawer",staticClass:"driveExplorerDrawer",attrs:{right:""}},[e("template",{slot:"title"},[e("div",{staticClass:"drawerHeader"},[e("v-btn",{attrs:{icon:""}},[e("v-icon",{on:{click:function(e){return t.closeAttachmentsDriveExplorerDrawer()}}},[t._v("\n          mdi-keyboard-backspace\n        ")])],1),t._v(" "),e("span",[t._v(t._s(t.driveExplorerDrawerTitle))])],1)]),t._v(" "),e("template",{slot:"content"},[e("div",{staticClass:"serverFiles pt-0 pa-3",on:{click:t.closeFolderActionsMenu}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.connectedMessage,expression:"connectedMessage"}],staticClass:"alert alert-info attachmentsAlert"},[e("b",[t._v(t._s(t.$t("attachments.alert.connected"))+" "+t._s(t.connectedMessage)+"!")]),t._v(t._s(t.$t("attachments.alert.pleaseNote"))+"\n      ")]),t._v(" "),e("div",{staticClass:"contentHeader border-bottom-color d-flex align-center pb-2 ma-3"},[t.showSearchInput?t._e():e("div",{staticClass:"currentDirectory d-flex align-center mr-2"},[e("div",{staticClass:"documents clickable d-flex align-center",on:{click:function(e){return t.fetchUserDrives()}}},[e("i",{staticClass:"uiIconFolder mr-1"}),t._v(" "),e("span",{staticClass:"documents",attrs:{"data-toggle":"tooltip",rel:"tooltip","data-placement":"bottom","data-original-title":"Documents"}},[t._v("\n              "+t._s(t.$t("attachments.drawer.drives"))+"\n            ")])]),t._v(" "),t.currentDrive?e("div",{staticClass:"currentDrive d-flex clickable align-center",on:{click:function(e){return t.openDrive(t.currentDrive)}}},[e("span",{staticClass:"uiIconArrowRight"}),t._v(" "),e("a",{staticClass:"currentDriveTitle text-truncate",class:t.currentDrive.isSelected?"active font-weight-bold":"",attrs:{title:t.currentDrive.title,"data-toggle":"tooltip",rel:"tooltip","data-placement":"bottom"}},[t._v("\n              "+t._s(t.currentDrive.title)+"\n            ")])]):t._e(),t._v(" "),t.foldersHistory.length>2?e("div",{staticClass:"longFolderHistory d-flex align-center"},[e("span",{staticClass:"uiIconArrowRight"}),t._v(" "),e("div",{staticClass:"btn-group"},[e("button",{staticClass:"dropdown-toggle px-2 py-1",attrs:{"data-toggle":"dropdown"}},[t._v("\n                ...\n              ")]),t._v(" "),e("ul",{staticClass:"dropdown-menu folders-menu"},t._l(t.foldersHistory.slice(0,t.foldersHistory.length-2),(function(i){return e("li",{key:i},[e("a",{on:{click:function(e){return t.openFolder(i)}}},[t._v(t._s(i.title))])])})),0)])]):t._e(),t._v(" "),e("div",{staticClass:"foldersHistory d-flex"},t._l(t.foldersHistory.slice(t.foldersHistory.length-2,t.foldersHistory.length),(function(i){return e("div",{key:i,staticClass:"folderHistory d-flex align-center text-truncate"},[e("span",{staticClass:"uiIconArrowRight"}),t._v(" "),e("a",{staticClass:"currentSpaceDirectory text-truncate clickable",class:i.isSelected?"active font-weight-bold":"",attrs:{title:i.title,"data-toggle":"tooltip",rel:"tooltip","data-placement":"bottom"},on:{click:function(e){return t.openFolder(i)}}},[t._v("\n                "+t._s(i.title)+"\n              ")])])})),0)]),t._v(" "),e("div",{staticClass:"selectorActions d-flex align-center",class:t.showSearchInput?"visible":""},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchFilesFolders,expression:"searchFilesFolders"}],ref:"searchServerAttachments",staticClass:"searchInput ma-0",attrs:{id:"searchServerAttachments",type:"text"},domProps:{value:t.searchFilesFolders},on:{input:function(e){e.target.composing||(t.searchFilesFolders=e.target.value)}}}),t._v(" "),e("a",{staticClass:"uiIconLightGray mr-1",class:t.showSearchInput?"uiIconCloseServerAttachments":"uiIconFilter",on:{click:function(e){return t.showSearchDocumentInput()}}}),t._v(" "),(t.modeFolderSelectionForFile||t.modeFolderSelection)&&t.currentDrive?e("a",{staticClass:"uiIconLightGray uiIconAddFolder",attrs:{title:t.$t("attachments.filesFoldersSelector.button.addNewFOlder.tooltip"),rel:"tooltip","data-placement":"bottom"},on:{click:function(e){return t.addNewFolder()}}}):t._e()]),t._v(" "),t._l(t.attachmentsComposerActions,(function(i){return e("div",{key:i.key,staticClass:"actionBox ml-1 align-center",class:`${i.appClass}Action`},[t.modeFolderSelection?t._e():e("div",{staticClass:"actionBoxLogo",on:{click:function(e){return t.executeAction(i)}}},[i.iconName?e("v-icon",{staticClass:"uiActionIcon pa-2"},[t._v("\n              "+t._s(i.iconName)+"\n            ")]):e("i",{staticClass:"uiActionIcon",class:i.iconClass})],1)])}))],2),t._v(" "),e("transition",{attrs:{name:"fade",mode:"in-out"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.showErrorMessage,expression:"showErrorMessage"}],staticClass:"alert foldersFilesSelectorAlert alert-error mx-auto"},[e("i",{staticClass:"uiIconError"}),t._v(t._s(t.errorMessage)+"\n        ")])]),t._v(" "),e("div",{staticClass:"contentBody"},[t.currentDrive?e("div",{staticClass:"selectionBox"},[t.loadingFolders||t.driveExplorerInitializing?e("div",{staticClass:"loader flex-column d-flex align-center"},[e("v-progress-circular",{staticClass:"loadingRing",attrs:{size:30,width:3,indeterminate:"",color:"#476A9C"}})],1):e("div",{staticClass:"content-explorer px-5 d-flex flex-wrap"},[t.emptyFolder?e("div",{staticClass:"emptyFolder my-10 mx-auto flex-column d-flex align-center"},[e("i",{staticClass:"uiIconEmptyFolder"}),t._v(" "),e("p",[t._v(t._s(t.$t("attachments.drawer.destination.folder.empty")))])]):t._e(),t._v(" "),t._l(t.filteredFolders,(function(i){return e("div",{key:i.id,staticClass:"folderSelection ma-2",class:"new_folder"===i.type?"boxOfFolder d-flex flex-column":"",attrs:{id:i.id,title:i.name},on:{click:function(e){return t.openFolder(i)},contextmenu:function(e){return t.openFolderActionsMenu(i,e)}}},["new_folder"===i.type?e("a",{staticClass:"closeIcon pt-1 pr-1 align-self-end",attrs:{href:"javascript:void(0);"},on:{mousedown:function(e){return t.cancelCreatingNewFolder(e)}}},[e("span",[t._v("x")])]):t._e(),t._v(" "),e("div",{class:"new_folder"===i.type?"boxOfTitle px-1":""},[e("a",{staticClass:"folderTitle d-flex flex-column v-messages",attrs:{title:i.title,href:"javascript:void(0);",rel:"tooltip","data-placement":"bottom"}},[e("i",{staticClass:"uiIcon24x24FolderDefault uiIconEcmsLightGray selectionIcon center",class:i.folderTypeCSSClass}),t._v(" "),e("i",{directives:[{name:"show",rawName:"v-show",value:i.isCloudDrive,expression:"folder.isCloudDrive"}],staticClass:"uiIcon-clouddrive",class:t.getFolderIcon(i)}),t._v(" "),"new_folder"===i.type?e("input",{directives:[{name:"model",rawName:"v-model",value:t.newFolderName,expression:"newFolderName"}],ref:i.ref,refInFor:!0,staticClass:"newFolderInput ignore-vuetify-classes",attrs:{type:"text"},domProps:{value:t.newFolderName},on:{blur:function(e){return t.createNewFolder(e)},keyup:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.target.blur()},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.cancelCreatingNewFolder(e)}],input:function(e){e.target.composing||(t.newFolderName=e.target.value)}}}):t.renameFolderAction&&i.id===t.selectedFolder.id?e("input",{directives:[{name:"model",rawName:"v-model",value:t.newName,expression:"newName"}],ref:"rename",refInFor:!0,staticClass:"newFolderInput ignore-vuetify-classes",attrs:{id:i.id,type:"text"},domProps:{value:t.newName},on:{blur:function(e){return t.saveNewNameFolder()},keyup:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.target.blur()},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.cancelRenameNewFolder(e)}],input:function(e){e.target.composing||(t.newName=e.target.value)}}}):e("div",{staticClass:"selectionLabel text-truncate text-color center"},[t._v(t._s(i.title))])])])])})),t._v(" "),e("attachments-folder-actions-menu",{ref:"folderActionsMenu",attrs:{"folder-actions-menu-left":t.folderActionsMenuLeft,"folder-actions-menu-top":t.folderActionsMenuTop,"selected-folder":t.selectedFolder},on:{renameFolder:function(e){return t.renameFolder()},deleteFolder:t.deleteFolder,closeMenu:t.closeFolderActionsMenu}}),t._v(" "),t.emptyFolderForSelectDestination&&t.modeFolderSelection&&!t.emptyFolder?e("div",{staticClass:"emptyFolder d-flex flex-column align-center mx-auto mt-10"},[e("i",{staticClass:"uiIconEmptyFolder"}),t._v(" "),e("p",[t._v(t._s(t.$t("attachments.drawer.destination.subfolder.empty")))])]):t._e(),t._v(" "),t._l(t.filteredFiles,(function(i){return e("div",{directives:[{name:"show",rawName:"v-show",value:!t.modeFolderSelection,expression:"!modeFolderSelection"}],key:i.id,staticClass:"fileSelection",class:i.isSelected?"selected":"",attrs:{id:i.idAttribute,title:i.idAttribute},on:{click:function(e){return t.selectFile(i)}}},[e("attachments-drive-explorer-file-item",{attrs:{file:i}})],1)}))],2)]):e("div",{staticClass:"categorizedDrives"},[e("v-list",{staticClass:"drivesList",attrs:{dense:"",flat:""}},[e("v-list-group",{staticClass:"categories",attrs:{value:"true",eager:""}},t._l(t.filteredDrivers,(function(i,a){return e("v-list-group",{key:a,staticClass:"category",attrs:{ripple:!1,"sub-group":"","no-action":"",value:"true","active-class":"categoryActive"},scopedSlots:t._u([{key:"activator",fn:function(){return[e("v-list-item-content",{staticClass:"categoryContent"},[t._v("\n                    "+t._s(a)+"\n                  ")])]},proxy:!0}],null,!0)},[t._v(" "),e("div",{staticClass:"selectionBox px-5 d-flex flex-wrap"},t._l(i.drives,(function(i){return e("div",{key:i.name,staticClass:"folderSelection ma-2 d-flex flex-column",attrs:{title:i.title},on:{click:function(e){return t.openDrive(i,a)}}},[e("a",{staticClass:"driveTitle d-flex flex-column v-messages",attrs:{"data-original-title":i.title,rel:"tooltip","data-placement":"bottom"}},[e("i",{directives:[{name:"show",rawName:"v-show",value:!t.drivesInProgress[i.title],expression:"!drivesInProgress[driver.title]"}],staticClass:"uiIconEcmsLightGray drive-icon selectionIcon center",class:i.isCloudDrive?i.driveTypeCSSClass:`uiIconEcms24x24DriveGroup ${i.driveTypeCSSClass}`}),t._v(" "),e("div",{staticClass:"text-center connectingDrive"},[e("v-progress-circular",{directives:[{name:"show",rawName:"v-show",value:t.drivesInProgress[i.title]>=0||t.drivesInProgress[i.title]<=100,expression:"drivesInProgress[driver.title] >= 0 || drivesInProgress[driver.title] <= 100"}],staticClass:"connectingDriveProgress",attrs:{indeterminate:!1,rotate:0,size:40,value:t.drivesInProgress[i.title],width:4,color:"var(--allPagesPrimaryColor, #476A9C)"}},[t._v(t._s(t.drivesInProgress[i.title])),e("span",{staticClass:"connectingDriveProgressPercent"},[t._v("%")])])],1),t._v(" "),e("div",{staticClass:"selectionLabel text-truncate text-color center",class:{connectingDriveTitle:t.drivesInProgress[i.title]>=0||t.drivesInProgress[i.title]<=100}},[t._v(t._s(i.mainTitle)+"\n                      ")])])])})),0)])})),1)],1)],1)])],1),t._v(" "),e("exo-confirm-dialog",{ref:"confirmDialog",attrs:{title:t.titleLabel,message:t.popupBodyMessage,"ok-label":t.okLabel,"cancel-label":t.cancelLabel},on:{ok:t.okConfirmDialog}})],1),t._v(" "),e("template",{slot:"footer"},[e("div",{staticClass:"d-flex"},[t.modeFolderSelection?t._e():e("span",{staticClass:"countLimit",class:t.filesCountClass},[t._v("\n        "+t._s(t.$t("attachments.drawer.maxFileCountLeft").replace("{0}",t.filesCountLeft))+"\n      ")]),t._v(" "),e("v-spacer"),t._v(" "),e("v-btn",{staticClass:"btn mr-3",on:{click:function(e){return t.closeAttachmentsDriveExplorerDrawer()}}},[t._v("\n        "+t._s(t.$t("attachments.drawer.cancel"))+"\n      ")]),t._v(" "),e("v-btn",{staticClass:"btn btn-primary",attrs:{disabled:!t.selectFromDrivesEnabled},on:{click:function(e){return t.selectActionDriveExplorerDrawer()}}},[t._v("\n        "+t._s(t.$t("attachments.drawer.select"))+"\n      ")])],1)])],2)};E._withStripped=!0;const S=l({props:{spaceId:{type:String,default:""},attachedFiles:{type:Array,default:()=>[]},extensionRefs:{type:Array,default:()=>[]},connectedDrive:{type:Object,default:()=>({})},cloudDrivesInProgress:{type:Object,default:()=>({})},entityId:{type:String,default:""},entityType:{type:String,default:""},defaultDrive:{type:Object,default:()=>null},defaultFolder:{type:String,default:""}},data:()=>({workspace:"collaboration",driveRootPath:"",drivers:[],folders:[],files:[],space:{},currentDrive:{},selectedFiles:[],removedFiles:[],maxFilesCount:20,foldersHistory:[],showSearchInput:!1,searchFilesFolders:"",loadingFolders:!0,filesCountClass:"",selectedFolderPath:"",schemaFolder:"",folderDestinationForFile:"",attachmentsComposerActions:[],creatingNewFolder:!1,newFolderName:"",currentAbsolutePath:"",popupBodyMessage:"",folderActionsMenuTop:"0px",folderActionsMenuLeft:"0px",selectedFolder:{},windowPositionLimit:25,MESSAGE_TIMEOUT:5e3,showErrorMessage:!1,errorMessage:"",renameFolderAction:!1,newName:"",MESSAGES_DISPLAY_TIME:5e3,privateDestinationForFile:!1,fromSpace:{},okLabel:"",cancelLabel:"",titleLabel:"",okAction:!1,modeFolderSelection:!0,modeFolderSelectionForFile:!1,movedFile:{},driveExplorerInitializing:!1,currentFolder:{},folderPath:"",destinationFolder:""}),computed:{filteredFolders(){let t=this.folders.slice();if(this.searchFilesFolders&&this.searchFilesFolders.trim().length){const e=this.searchFilesFolders.trim().toLowerCase();t=this.folders.filter((t=>t.name.toLowerCase().indexOf(e)>=0))}const e=document.createElement("textarea");return t.forEach((t=>{e.innerHTML=t.title,t.title=e.value})),t},filteredFiles(){let t=this.files.slice();if(this.searchFilesFolders&&this.searchFilesFolders.trim().length){const e=this.searchFilesFolders.trim().toLowerCase();t=this.files.filter((t=>t.name.toLowerCase().indexOf(e)>=0))}return t.forEach((t=>{t.isSelected=this.attachedFiles.some((e=>e.id===t.id));try{t.name=decodeURI(t.name)}catch(t){}})),t},filteredDrivers(){let t=this.drivers.slice();if(this.searchFilesFolders&&this.searchFilesFolders.trim().length){const e=this.searchFilesFolders.trim().toLowerCase();t=this.drivers.filter((t=>t.title.toLowerCase().indexOf(e)>=0))}const e={"My Drives":{drives:[]},"My Spaces":{drives:[]},Others:{drives:[]}};return t.map((t=>("Personal Drives"===t.driverType?e["My Drives"].drives.push(t):t.path.includes("spaces")?e["My Spaces"].drives.push(t):t.path.includes("Trash")||e.Others.drives.push(t),t))),e},selectedFilesCount(){return this.attachedFiles.length+this.selectedFiles.length-this.removedFiles.length},filesCountLeft(){return this.maxFilesCount-this.selectedFilesCount},emptyFolder(){return 0===this.files.length&&0===this.folders.length&&0===this.drivers.length&&!this.loadingFolders},emptyFolderForSelectDestination(){return 0===this.folders.length&&0===this.drivers.length&&!this.loadingFolders},connectedMessage(){let t;for(const e in this.drivesInProgress){const i=100;t=this.drivesInProgress[e]>=i?e:""}return t},drivesInProgress(){return{...this.cloudDrivesInProgress.drives}},driveExplorerDrawerTitle(){return this.modeFolderSelection?this.$t("attachments.drawer.destination.folder"):this.$t("attachments.drawer.existingUploads")},isSelectedFromDrivesFiles(){return this.selectedFiles&&!!this.selectedFiles.length},isRemovedFromDrivesFiles(){return this.removedFiles&&!!this.removedFiles.length},selectFromDrivesEnabled(){return this.isSelectedFromDrivesFiles||this.isRemovedFromDrivesFiles||this.modeFolderSelectionForFile||this.modeFolderSelection}},watch:{filesCountLeft(){this.filesCountClass=0===this.filesCountLeft?"noFilesLeft":""},showErrorMessage:function(t){t&&setTimeout((()=>this.showErrorMessage=!1),this.MESSAGE_TIMEOUT)},connectedDrive:function(t){this.drivers.some((({title:e})=>e===t.title))||this.drivers.push(t)},entityId(){this.initDestinationFolderPath()}},created(){this.initDestinationFolderPath(),document.addEventListener("extension-AttachmentsComposer-attachments-composer-action-updated",(()=>this.attachmentsComposerActions=r())),this.attachmentsComposerActions=r(),this.$root.$on("open-drive-explorer-drawer",(t=>{this.currentDrive=t,this.initHistoryTree(),this.openAttachmentsDriveExplorerDrawer()})),this.$root.$on("open-select-from-drives-drawer",(()=>this.openSelectFromDrivesDrawer())),this.$root.$on("change-attachment-destination-path",(t=>{this.currentDrive=t.fileDrive,""!==t.pathDestinationFolderForFile&&(this.defaultFolder=t.pathDestinationFolderForFile),this.initHistoryTree(),this.openSelectDestinationFolderForFile(t)}))},methods:{initHistoryTree(){this.foldersHistory=[],this.resetExplorer(),"/"!==this.defaultFolder&&(this.folderPath="",this.currentAbsolutePath=this.defaultFolder,this.selectedFolderPath=this.defaultFolder,this.schemaFolder=this.currentDrive.title.concat("/",this.defaultFolder),this.defaultFolder.split("/").forEach((t=>{this.folderPath=`${this.folderPath}/${t}`;const e={name:t,title:t,path:this.folderPath};this.generateHistoryTree(e)}))),this.fetchChildrenContents(this.defaultFolder)},openAttachmentsDriveExplorerDrawer(){this.modeFolderSelection=!0,this.$refs.driveExplorerDrawer.open()},openSelectDestinationFolderForFile(t){this.modeFolderSelectionForFile=!0,this.movedFile=t,this.openAttachmentsDriveExplorerDrawer()},closeAttachmentsDriveExplorerDrawer(){this.resetDriveExplorer(),this.$refs.driveExplorerDrawer.close()},initDestinationFolderPath:function(){if(this.defaultDrive&&this.defaultDrive.name){const t=this;this.driveExplorerInitializing=!0;let e=this.defaultFolder.substr(0,this.defaultFolder.lastIndexOf("/")+1);e||(e="/"),e.startsWith("/")||(e="/".concat(e)),this.openDrive(this.defaultDrive,null,e).then((()=>{const e=t.folders.find((e=>e.name===t.defaultFolder.split("/").pop()));if(t.entityType&&t.entityId&&(e?this.openFolder(e).then((()=>{this.createEntityTypeAndIdFolders(e)})):this.createEntityTypeAndIdFolders(e)),e)this.openFolder(e).then((()=>{this.$root.$emit("attachments-default-folder-path-initialized",this.getRelativePath(t.selectedFolderPath),this.schemaFolder)})).finally((()=>this.driveExplorerInitializing=!1));else if(e||"Activity Stream Documents"!==t.defaultFolder)if(t.defaultFolder.includes("/")){const e=t.defaultFolder.split("/"),i=e.pop();let a=e.join("/");a||(a="/"),this.fetchChildrenContents(a).then((()=>{const e=t.folders.find((t=>t.title===i));e&&this.openFolder(e).then((()=>{this.$root.$emit("attachments-default-folder-path-initialized",this.getRelativePath(t.selectedFolderPath),this.schemaFolder),this.driveExplorerInitializing=!1}))}))}else this.$root.$emit("attachments-default-folder-path-initialized","/",this.currentDrive.title),this.driveExplorerInitializing=!1;else this.$attachmentService.createFolder(t.currentDrive.name,t.workspace,this.currentAbsolutePath,t.defaultFolder,"nt:unstructured",!0).then((()=>{this.initDestinationFolderPath()}))}))}else this.currentDrive=null,this.fetchUserDrives()},openFolder:function(t){if(this.selectedFolder.id&&this.selectedFolder.canRemove)this.$refs.rename[0].focus();else{if(!t.type||"new_folder"!==t.type)return this.currentAbsolutePath=t.path,this.generateHistoryTree(t),this.resetExplorer(),t.isSelected=!0,this.selectedFolderPath=this.driveRootPath.concat(t.path),this.schemaFolder=this.currentDrive.title.concat("/",t.path),this.folderDestinationForFile=t.name,this.fetchChildrenContents(t.path);this.$refs.newFolder[0].focus()}this.schemaFolder=this.currentDrive.title.concat("/",t.path),this.folderDestinationForFile=t.title,this.privateDestinationForFile=t.isPublic},openDrive(t,e,i){return this.currentAbsolutePath="",this.selectedFolderPath="",this.folderDestinationForFile="",this.foldersHistory=[],this.resetExplorer(),this.fromSpace="My Spaces"===e?{title:t.title,name:t.name}:{},this.currentDrive={name:t.name,title:t.title,mainTitle:t.mainTitle,isSelected:!0},this.fetchChildrenContents(i)},fetchChildrenContents:function(t){this.loadingFolders=!0;const e=this;return this.$attachmentService.fetchFoldersAndFiles(this.currentDrive.name,this.workspace,t).then((i=>{const a=i.childNodes[0];"/"===a.getAttribute("path")?e.driveRootPath=`${a.getAttribute("path")}`:""===t&&(e.driveRootPath=`${a.getAttribute("path")}/`),e.setFoldersAndFiles(a),e.loadingFolders=!1})).catch((t=>{this.loadingFolders=!1,this.errorMessage=`${this.$t("attachments.fetchFoldersAndFiles.error")}. ${t.message?t.message:""}`,this.showErrorMessage=!0}))},fetchUserDrives(){this.resetExplorer(),this.loadingFolders=!0,this.currentDrive=null,this.foldersHistory=[];const t=this;this.$attachmentService.getDrivers().then((e=>{const i=e.childNodes[0].childNodes;t.setDrivers(i),this.loadingFolders=!1})).catch((()=>{this.loadingFolders=!1,this.errorMessage=`${this.$t("attachments.getDrivers.error")}`,this.showErrorMessage=!0}))},resetExplorer(){this.drivers=[],this.folders=[],this.files=[]},getRelativePath:function(t){if(t&&t.startsWith(this.driveRootPath))return t.substr(this.driveRootPath.length)},getURLQueryParam(t){const e=new URLSearchParams(window.location.search);if(e.has(t))return e.get(t)},selectFile(t){if(t.isSelected){t.isSelected=!1,t.isSelectedFromDrives=!1;const e=this.attachedFiles.findIndex((e=>e.id===t.id)),i=this.selectedFiles.findIndex((e=>e.id===t.id));-1!==e?this.removedFiles.push(t):-1!==i&&this.selectedFiles.splice(i,1)}else if(this.filesCountLeft>0){t.isSelected=!0,t.isSelectedFromDrives=!0,this.attachedFiles.find((e=>e.id===t.id))||this.selectedFiles.push({...t,space:this.fromSpace});const e=this.removedFiles.findIndex((e=>e.id===t.id));-1!==e&&this.removedFiles.splice(e,1)}},generateHistoryTree(t){!this.foldersHistory.find((e=>e.name===t.name))&&t&&this.foldersHistory.push({name:t.name,title:t.title,path:t.driverType?"":t.path,driverType:t.driverType?t.driverType:""}),!t.driverType&&t.path&&(this.foldersHistory=this.foldersHistory.filter((e=>t.path.split("/").find((t=>t===e.name))))),this.currentDrive.isSelected=!1,this.foldersHistory.forEach((t=>t.isSelected=!1)),this.foldersHistory.find((e=>e.name===t.name)).isSelected=!0},addSelectedFiles(){this.$root.$emit("attachments-changed-from-drives",this.selectedFiles,this.removedFiles),this.resetDriveExplorer()},showSearchDocumentInput(){this.showSearchInput=!this.showSearchInput,document.getElementById("searchServerAttachments").style.display=this.showSearchInput?"block":"none",this.$refs.searchServerAttachments.focus(),this.searchFilesFolders=""},setFoldersAndFiles(t){const e=t.childNodes;for(let t=0;t<e.length;t++)if("Folders"===e[t].tagName){const i=e[t].childNodes;for(let t=0;t<i.length;t++){const e=`uiIcon24x24${i[t].getAttribute("nodeType").replace(":","_")}`,a=i[t].getAttribute("path").split("/").pop();this.folders.push({id:a,name:i[t].getAttribute("name"),title:i[t].getAttribute("title"),path:i[t].getAttribute("currentFolder"),folderTypeCSSClass:e,isSelected:!1,canRemove:"true"===i[t].getAttribute("canRemove"),isCloudDrive:"true"===i[t].getAttribute("isCloudDrive"),isPublic:"true"===i[t].getAttribute("isPublic"),cloudProvider:i[t].getAttribute("cloudProvider")})}}else if("Files"===e[t].tagName){const i=e[t].childNodes;for(let t=0;t<i.length;t++){const e=i[t].getAttribute("path").split("/").pop(),a=i[t].getAttribute("id"),s=this.attachedFiles.some((t=>t.id===a));this.files.push({id:a,name:i[t].getAttribute("name"),title:i[t].getAttribute("title"),path:this.getRelativePath(i[t].getAttribute("path")),size:i[t].getAttribute("size"),idAttribute:e,isSelected:s,mimetype:i[t].getAttribute("nodeType"),isCloudFile:"true"===i[t].getAttribute("isCloudFile"),isPublic:"true"===i[t].getAttribute("isPublic"),fileDrive:this.currentDrive})}}},setDrivers(t){for(let e=0;e<t.length;e++)if("Folders"===t[e].tagName){const i=t[e].childNodes;let a;const s=t[e].getAttribute("name");a="Personal Drives"===s?"uiIconEcms24x24DrivePrivate":`uiIconEcms24x24Drive${s.split(" ")[0]}`;for(let t=0;t<i.length;t++){const e=i[t].getAttribute("name"),n="true"===i[t].getAttribute("isCloudDrive"),r=n?`uiIconEcmsDrive-${i[t].getAttribute("cloudProvider")}`:`${e.replace(/\s/g,"")} ${a}`,o=i[t].getAttribute("label").replace(".","").replace(" ",""),l=`Drives.label.${o}`,c=l===this.$t(l)&&o||this.$t(l),d={name:e,title:c,mainTitle:c,path:i[t].getAttribute("path"),css:i[t].getAttribute("nodeTypeCssClass"),type:"drive",driveTypeCSSClass:r,driverType:s,isCloudDrive:n};if(n){const t=e.indexOf("-");d.mainTitle=e.substr(0,t),d.title=e}this.drivers.push(d)}}},selectActionDriveExplorerDrawer(){this.modeFolderSelection?(this.selectedFolderPath||(this.selectedFolderPath=this.driveRootPath,this.schemaFolder=this.currentDrive.title,this.folderDestinationForFile=this.currentDrive.title),this.modeFolderSelectionForFile?(this.$root.$emit("add-destination-path-for-file",this.movedFile,this.getRelativePath(this.selectedFolderPath),this.folderDestinationForFile,this.currentDrive),this.modeFolderSelectionForFile=!1):this.$root.$emit("select-destination-path-for-all",this.selectedFolderPath,this.getRelativePath(this.selectedFolderPath),this.schemaFolder,this.currentDrive)):this.addSelectedFiles(),this.closeAttachmentsDriveExplorerDrawer()},executeAction(t){var e,i;e=t,i=this.extensionRefs[t.key][0],e.hasOwnProperty("onExecute")&&o(e.onExecute)&&e.onExecute.apply(i,[i])},addNewFolder(){this.creatingNewFolder||(this.creatingNewFolder=!0,this.newFolderName=this.$t("Folder.label.newfolder"),this.folders.unshift({id:"new_folder",type:"new_folder",ref:"newFolder",folderTypeCSSClass:"uiIcon24x24nt_folder",isSelected:!1})),this.$nextTick((()=>this.$refs.newFolder[0].focus()))},createNewFolder(){if(this.creatingNewFolder)if(this.newFolderName){if(!this.folders.some((t=>t.title===this.newFolderName))){const t=this;return this.$attachmentService.createFolder(this.currentDrive.name,this.workspace,this.currentAbsolutePath,this.newFolderName).then((e=>{const i=e.childNodes[0];if(i){const e=`uiIcon24x24${i.getAttribute("nodeType").replace(":","_")}`,a={id:i.getAttribute("path").split("/").pop(),name:i.getAttribute("name"),title:i.getAttribute("title"),path:i.getAttribute("currentFolder"),folderTypeCSSClass:e,isSelected:!1,canRemove:!0};return t.folders.shift(),t.folders.unshift(a),t.creatingNewFolder=!1,t.newFolderName="",a}t.creatingNewFolder=!1,t.newFolderName=""})).catch((()=>{this.errorMessage=`${this.$t("attachments.createFolder.error")}`,this.showErrorMessage=!0}))}this.$refs.confirmDialog.open(),this.titleLabel=this.$t("attachments.filesFoldersSelector.popup.title"),this.okLabel=this.$t("attachments.ok"),this.popupBodyMessage=`${this.$t("attachments.filesFoldersSelector.popup.folderNameExists")}`}else this.$refs.confirmDialog.open(),this.titleLabel=this.$t("attachments.filesFoldersSelector.popup.title"),this.okLabel=this.$t("attachments.ok"),this.popupBodyMessage=`${this.$t("attachments.filesFoldersSelector.popup.emptyFolderName")}`},cancelCreatingNewFolder(){this.folders.shift(),this.creatingNewFolder=!1,this.newFolderName=""},cancelRenameNewFolder(){this.renameFolderAction=!1,this.newName=this.selectedFolder.title},openFolderActionsMenu(t,e){e.preventDefault(),this.selectedFolder=t,this.folderActionsMenuTop=e.clientY,this.folderActionsMenuLeft=e.clientX,this.$nextTick((()=>{this.$refs.folderActionsMenu.openMenu()}))},closeFolderActionsMenu:function(){this.$refs.folderActionsMenu?.closeMenu()},deleteFolder(){this.selectedFolder.canRemove&&(this.closeFolderActionsMenu(),this.$refs.confirmDialog.open(),this.titleLabel=this.$t("attachments.filesFoldersSelector.action.delete.popup.title"),this.okLabel=this.$t("attachments.filesFoldersSelector.action.delete.popup.button.ok"),this.cancelLabel=this.$t("attachments.cancel"),this.okAction=!0,this.popupBodyMessage=`${this.$t("attachments.filesFoldersSelector.action.delete.popup.bodyMessage")}`)},okConfirmDialog(){this.okAction&&this.$attachmentService.deleteFolderOrFile(this.currentDrive.name,this.workspace,this.selectedFolder.path).then((()=>{this.reloadCurrentPath()})).catch((()=>{this.errorMessage=`${this.$t("attachments.deleteFolderOrFile.error")}`,this.showErrorMessage=!0}))},reloadCurrentPath(){this.resetExplorer(),this.currentAbsolutePath?this.fetchChildrenContents(this.currentAbsolutePath):this.fetchChildrenContents("")},renameFolder(){this.selectedFolder.canRemove&&this.selectedFolder.title&&(this.newName=this.selectedFolder.title,this.renameFolderAction=!0,this.$refs.folderActionsMenu?.closeMenu(),this.$nextTick((()=>{this.$refs.rename[0].focus()})))},saveNewNameFolder(){if(this.newName!==this.selectedFolder.title&&""!==this.newName)if(this.folders.some((t=>t.title===this.newName)))this.$refs.confirmDialog.open(),this.titleLabel=this.$t("attachments.filesFoldersSelector.popup.title"),this.okLabel=this.$t("attachments.ok"),this.popupBodyMessage=`${this.$t("attachments.renameFolder.error")}`,this.cancelRenameNewFolder();else{this.selectedFolderPath=this.driveRootPath.concat(this.selectedFolder.path);const t=encodeURIComponent(this.workspace.concat(":",this.selectedFolderPath));this.$attachmentService.renameFolder(t,this.newName).then((t=>{t&&(this.renameFolderAction=!1,this.folders.find((t=>{if(t.id===this.selectedFolder.id){t.title=this.newName,t.name=this.newName,t.id=this.newName;const e=t.path.split("/");let i=e[0];for(let t=0;t<e.length-1;t++)i.concat("/",i[t]);1===e.length?i=this.newName:i.concat("/",this.newName),t.path=i}})),this.selectedFolder={})}))}else this.selectedFolder={};this.selectedFolderPath=""},getFolderIcon:t=>`uiIcon-${t.cloudProvider}`,createEntityTypeAndIdFolders(t){(t=this.folders.find((t=>t.title===this.entityType)))?this.openFolder(t).then((()=>{(t=this.folders.find((t=>parseInt(t.title)===parseInt(this.entityId))))?this.openFolder(t).then((()=>{this.$root.$emit("attachments-default-folder-path-initialized",this.getRelativePath(this.selectedFolderPath),this.schemaFolder)})).finally((()=>{this.driveExplorerInitializing=!1})):(this.newFolderName=this.entityId,this.creatingNewFolder=!0,this.createNewFolder().then((t=>{this.openFolder(t).then((()=>{this.$root.$emit("attachments-default-folder-path-initialized",this.getRelativePath(this.selectedFolderPath),this.schemaFolder)})).finally((()=>{this.driveExplorerInitializing=!1}))})))})):(this.newFolderName=this.entityType,this.creatingNewFolder=!0,this.createNewFolder().then((t=>{this.openFolder(t).then((()=>{this.newFolderName=this.entityId,this.creatingNewFolder=!0,this.createNewFolder().then((t=>{this.openFolder(t).then((()=>{this.$root.$emit("attachments-default-folder-path-initialized",this.getRelativePath(this.selectedFolderPath),this.schemaFolder)})).finally((()=>{this.driveExplorerInitializing=!1}))}))}))})))},openSelectFromDrivesDrawer(){this.modeFolderSelection=!1,this.currentDrive&&this.reloadCurrentPath(),this.$refs.driveExplorerDrawer.open()},resetDriveExplorer(){this.selectedFiles=[],this.removedFiles=[]}}},E,[],!1,null,null,null).exports;var T=function(){var t=this,e=t._self._c;return e("div",{staticClass:"select-from-drives"},[e("div",{staticClass:"d-flex align-center"},[e("v-subheader",{staticClass:"text-sub-title pl-0 d-flex"},[t._v(t._s(t.$t("attachments.platformDocuments")))]),t._v(" "),e("v-divider")],1),t._v(" "),e("div",{staticClass:"lastContent d-flex align-center justify-center"},[e("v-tooltip",{attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function({on:i,attrs:a}){return[e("v-btn",t._g(t._b({staticClass:"uploadButton d-flex align-center",attrs:{color:"primary",text:""},on:{click:function(e){return t.openSelectFromDrivesDrawer()}}},"v-btn",a,!1),i),[e("i",{staticClass:"uiIcon32x32FolderDefault uiIcon32x32LightGray"}),t._v(" "),e("span",{staticClass:"ms-1"},[t._v(t._s(t.$t("attachments.drawer.existingUploads")))])])]}}])},[t._v("\n      "+t._s(t.$t("attachments.drawer.selectFromExistingUploads"))+"\n    ")])],1)])};T._withStripped=!0;const P=l({methods:{openSelectFromDrivesDrawer(){this.$root.$emit("open-select-from-drives")}}},T,[],!1,null,null,null).exports;var N=function(){var t=this,e=t._self._c;return e("card-carousel",{attrs:{"parent-class":"activity-files-parent"}},t._l(t.attachments,(function(i,a){return e("activity-attachment",{key:i.id,staticClass:"activity-file-item",attrs:{activity:t.activity,index:a,count:t.attachmentsCount,attachment:i,"preview-width":t.previewWidth,"preview-height":t.previewHeight}})})),1)};N._withStripped=!0;const k=l({props:{activity:{type:Object,default:null},previewHeight:{type:String,default:()=>"152px"},previewWidth:{type:String,default:()=>"250px"}},computed:{attachments(){if(!this.activity.files)return[];const t=[];return this.activity.files.forEach((e=>{const i=e.mimeType,a=i&&`primary--text uiIconFileType${i.replaceAll(/[/.\\]/g,"")}`||"";let s=e.name;try{s=decodeURIComponent(s.replace(/%25/g,"%").replace(/%([^2][^5])/g,"%25$1"))}catch(t){}const n=e.repository,r=e.workspace,o=i.includes("image/")&&`${eXo.env.portal.context}/${eXo.env.portal.rest}/thumbnailImage/custom/250x250/${r}/${e.id}`||null;t.push({id:e.id,image:o,path:e.docPath,name:s,repository:n,workspace:r,mimeType:i,icon:`uiIconPLFFont ${a} uiIconFileTypeDefault`})})),t},attachmentsCount(){return this.attachments.length}}},N,[],!1,null,null,null).exports;var L=function(){var t=this,e=t._self._c;return e("v-hover",{class:t.marginClass,scopedSlots:t._u([{key:"default",fn:function({hover:i}){return[e("v-card",{staticClass:"activity-attachment overflow-hidden d-flex flex-column border-box-sizing",class:{"border-color":!i},attrs:{id:t.id,elevation:i?4:0,loading:t.loading,height:"210px","max-height":"210px",width:"252px","max-width":"100%"},on:{click:t.openPreview}},[e("v-card-text",{staticClass:"activity-attachment-thumbnail d-flex flex-grow-1 pa-0"},[t.image?e("img",{staticClass:"ma-auto",attrs:{src:t.attachment.image,loading:"lazy"},on:{error:function(e){t.image=null}}}):e("v-icon",{staticClass:"ma-auto d-flex",class:t.attachment.icon,attrs:{size:"80px"}})],1),t._v(" "),t.image?t._e():e("v-card-text",{staticClass:"activity-attachment-title d-flex font-weight-bold border-top-color py-2"},[e("div",{staticClass:"text-color text-wrap text-break mx-0 my-auto text-truncate-2",attrs:{title:t.attachment.name},domProps:{textContent:t._s(t.attachment.name)}})]),t._v(" "),e("v-expand-transition",[t.invalid?e("v-card",{staticClass:"d-flex flex-column transition-fast-in-fast-out v-card--reveal",staticStyle:{height:"100%"},attrs:{elevation:"0"}},[e("v-card-text",{staticClass:"pb-0 d-flex flex-row"},[e("v-icon",{attrs:{color:"error"}},[t._v("fa-exclamation-circle")]),t._v(" "),e("p",{staticClass:"my-auto ms-2 font-weight-bold"},[t._v("\n            "+t._s(t.$t("attachments.errorAccessingFile"))+"\n          ")])],1),t._v(" "),e("v-card-text",{staticClass:"flex-grow-1"},[e("p",[t._v(t._s(t.$t("attachments.alert.unableToAccessFile")))])]),t._v(" "),e("v-card-actions",{staticClass:"pt-0"},[e("v-btn",{attrs:{text:"",color:"primary"},on:{click:t.closeErrorBox}},[t._v("\n            "+t._s(t.$t("attachments.close"))+"\n          ")])],1)],1):t._e()],1)],1)]}}])})};L._withStripped=!0;const U=l({props:{attachment:{type:Object,default:null},activity:{type:Object,default:null},index:{type:Number,default:0},count:{type:Number,default:0},previewHeight:{type:String,default:()=>"152px"},previewWidth:{type:String,default:()=>"250px"}},data:()=>({loading:!1,invalid:!1,image:!1,dateFormat:{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}}),computed:{id(){return`PreviewAttachment_${this.previewActivity.id}_${this.index}`},nextId(){return this.index+1<this.count&&`#PreviewAttachment_${this.previewActivity.id}_${this.index+1}`||""},previousId(){return this.index&&`#PreviewAttachment_${this.previewActivity.id}_${this.index-1}`||""},marginClass(){if(1===this.count)return"mx-auto";const t=this.count-1===this.index;return this.index&&(t?"ms-2":"mx-2")||"me-2"},username(){return this.previewActivity&&this.previewActivity.identity.profile&&this.previewActivity.identity.profile.username||""},fullname(){return this.previewActivity&&this.previewActivity.identity.profile&&this.previewActivity.identity.profile.fullname||""},avatarUrl(){return this.previewActivity&&this.previewActivity.identity.profile&&this.previewActivity.identity.profile.avatar||""},profileUrl(){return`${eXo.env.portal.context}/${eXo.env.portal.portalName}/profile/${this.username}`},author(){return{username:this.username,fullname:this.fullname,avatarUrl:this.avatarUrl,profileUrl:this.profileUrl}},icon(){return this.attachment.icon},previewActivity(){return this.activity&&this.activity.parentActivity||this.activity},activityDate(){return this.previewActivity&&this.previewActivity.createDate&&new Date(this.previewActivity.createDate)},relativePostTimeLabel(){return this.activityDate&&this.$dateUtil.getRelativeTimeLabelKey(this.activityDate)||""},relativePostTimeDate(){return this.activityDate&&this.$dateUtil.getRelativeTimeValue(this.activityDate)||1},relativePostTime(){return this.activityDate&&this.$t(this.relativePostTimeLabel,{0:this.relativePostTimeDate})||""},spaceURL(){return this.previewActivity&&this.previewActivity.activityStream&&this.previewActivity.activityStream.space&&this.previewActivity.activityStream.space.groupId.replace("/spaces/","")},isCommentActivity(){return this.activity&&this.activity.activityId}},created(){this.image=this.attachment&&this.attachment.image},methods:{closeErrorBox(t){t&&(t.preventDefault(),t.stopPropagation()),window.setTimeout((()=>{this.invalid=!1}),50)},openPreview(){this.invalid||(this.loading=!0,this.$attachmentService.getAttachmentById(this.attachment.id).then((t=>{const e=t&&t.updater&&t.updater.profile&&t.updater.profile.fullname||"",i=new Date(t.updated),a=this.$dateUtil.formatDateObjectToDisplay(i,this.dateFormat),s=`${this.$t("documents.preview.updatedOn")} ${a} ${this.$t("documents.preview.updatedBy")} ${e} ${t.size}`;documentPreview.init({doc:{id:this.attachment.id,repository:this.attachment.repository,workspace:this.attachment.workspace,path:this.attachment.path,title:this.attachment.name,icon:this.icon,size:t.size,openUrl:t.openUrl,downloadUrl:t.downloadUrl,breadCrumb:t.previewBreadcrumb,fileInfo:s,isCloudDrive:t.cloudDrive},author:this.author,activity:{id:this.previewActivity.id,liked:!!this.previewActivity.likes.length,likes:this.previewActivity.likes.length,status:this.previewActivity.title,postTime:this.relativePostTime,spaceURL:this.spaceURL,next:this.nextId,previous:this.previousId},version:{number:t.version&&Number(t.version)||0},showComments:!this.isCommentActivity})})).catch((t=>{console.error(t),this.invalid=!0})).finally((()=>this.loading=!1)))}}},L,[],!1,null,null,null).exports;var M=function(){var t=this,e=t._self._c;return e("v-app",[e("div",[t.displayAttachments?e("div",{staticClass:"actionItem action clickable pb-1 pt-3",on:{click:t.openAttachmentListDrawer}},[e("v-icon",{staticClass:"pe-1",attrs:{size:"14",color:"primary"}},[t._v("\n        fa-paperclip\n      ")]),t._v(" "),e("a",{staticClass:"viewAllAttachments primary--text font-weight-bold text-decoration-underline"},[t._v("\n        "+t._s(t.$t("attachments.view.all"))+" ("+t._s(t.attachmentsLength)+")\n      ")])],1):t._e(),t._v(" "),t.isMobile?t._e():e("changes-reminder",{attrs:{reminder:t.reminder}})],1)])};M._withStripped=!0;const R=l({props:{activityId:{type:String,default:null},spaceId:{type:String,default:null},message:{type:String,default:null},maxMessageLength:{type:Number,default:0},templateParams:{type:Object,default:null},files:{type:Array,default:()=>[]}},data:()=>({attachments:null,entityType:"activity",reminder:{},attachedFiles:{type:Array,default:()=>[]}}),computed:{attachmentsLength(){return this.attachedFiles.length},displayAttachments(){return this.attachmentsLength>0},attachmentDrawerParams(){return{entityType:this.entityType,entityId:this.activityId,defaultFolder:"Activity Stream Documents",sourceApp:"activityStream",attachments:this.attachments,spaceId:this.spaceId,attachToEntity:!1}},isMobile(){return"xs"===this.$vuetify.breakpoint.name||"sm"===this.$vuetify.breakpoint.name}},created(){document.addEventListener("open-activity-attachments",(()=>this.openAttachmentDrawer())),document.addEventListener("attachment-added",(t=>this.addAttachment(t.detail))),document.addEventListener("attachment-removed",(t=>this.removeAttachment(t.detail))),document.addEventListener("message-composer-opened",(()=>this.openComposerChangesReminder()))},methods:{retrieveAttachments(){this.attachedFiles=this.files,this.attachments=JSON.parse(JSON.stringify(this.attachedFiles)),this.files.forEach(((t,e)=>{this.activityId?this.$attachmentService.getAttachmentByEntityAndId(this.entityType,this.activityId,t.id).then((t=>this.attachments.splice(e,1,t))):this.$attachmentService.getAttachmentById(t.id).then((t=>this.attachments.splice(e,1,t)))}))},openAttachmentDrawer(){this.retrieveAttachments(),this.$nextTick().then((()=>{document.dispatchEvent(new CustomEvent("open-attachments-app-drawer",{detail:this.attachmentDrawerParams}))}))},openAttachmentListDrawer(){this.retrieveAttachments(),this.$nextTick().then((()=>{document.dispatchEvent(new CustomEvent("open-attachments-list-drawer",{detail:this.attachmentDrawerParams}))}))},addAttachment(t){this.attachedFiles.push(t.attachment),document.dispatchEvent(new CustomEvent("activity-composer-edited",{detail:this.attachedFiles}))},removeAttachment(t){const e=this.attachedFiles.findIndex((e=>e.id===t.id));e>=0&&this.attachedFiles.splice(e,1),document.dispatchEvent(new CustomEvent("activity-composer-edited",{detail:this.attachedFiles}))},openComposerChangesReminder(){this.reminder={name:"activityComposerAttachFile",title:`${this.$t("activity.attach.file.reminder.title")}`,description:`${this.$t("activity.attach.file.reminder.description")}`,img:"/eXoWCMResources/skin/images/Icons/attachFileIcon.gif"},this.$nextTick().then((()=>{document.dispatchEvent(new CustomEvent("changes-reminder-open"))}))}}},M,[],!1,null,null,null).exports;var O=function(){var t=this,e=t._self._c;return e("div",{staticClass:"create-new-document"},[e("div",{staticClass:"d-flex align-center"},[e("v-subheader",{staticClass:"text-sub-title pl-0 d-flex"},[t._v("\n      "+t._s(t.$t("documents.label.new"))+"\n    ")]),t._v(" "),e("v-divider")],1),t._v(" "),e("div",{staticClass:"create-new-doc-input px-10"},[e("div",{staticClass:"d-flex justify-space-around"},t._l(t.newDocumentActions,(function(i){return e("div",{key:i.id,staticClass:"d-flex flex-column align-center clickable",on:{click:function(e){return t.showNewDocInput(i)}}},[e("v-icon",{staticClass:"uiIcon32x32",attrs:{color:i.color}},[t._v("\n          "+t._s(i.icon)+"\n        ")]),t._v(" "),e("span",{staticClass:"mt-3"},[t._v(t._s(t.$t(i.label)))])],1)})),0),t._v(" "),e("v-text-field",{directives:[{name:"show",rawName:"v-show",value:!t.NewDocInputHidden,expression:"!NewDocInputHidden"}],ref:"NewDocInputHidden",staticClass:"pt-2",attrs:{rules:t.documentTitleRules,placeholder:t.$t("documents.untitledDocument"),outlined:"",dense:"",autofocus:""},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.createNewDoc()}},model:{value:t.newDocTitleInput,callback:function(e){t.newDocTitleInput=e},expression:"newDocTitleInput"}},[e("div",{staticClass:"d-flex mt-1",attrs:{slot:"append"},slot:"append"},[e("span",{staticClass:"text-color me-2"},[t._v(t._s(t.selectedDocType.extension))]),t._v(" "),e("v-icon",{staticClass:"px-1",class:t.documentTitleMaxLengthReached?"not-allowed":"clickable",attrs:{color:t.documentTitleMaxLengthReached?"grey--text":"primary",small:""},on:{click:function(e){return t.createNewDoc()}}},[t._v("\n          fa-check\n        ")]),t._v(" "),e("v-icon",{staticClass:"clickable px-0",attrs:{color:"red",small:""},on:{click:function(e){return t.resetNewDocInput()}}},[t._v("\n          fa-times\n        ")])],1)])],1)])};O._withStripped=!0;const B=l({props:{attachments:{type:Array,default:()=>[]},currentDrive:{type:Object,default:()=>null},pathDestinationFolder:{type:Object,default:()=>null},maxFilesCount:{type:Number,default:parseInt(`${eXo.env.portal.maxToUpload}`)},maxFileSize:{type:Number,default:parseInt(`${eXo.env.portal.maxFileSize}`)}},data(){return{newDocTitleInput:"",newCreatedDocs:[],selectedDocType:{},NewDocInputHidden:!0,extensionApp:"attachment",newDocumentActionExtension:"new-document-action",newDocumentActions:{},MAX_DOCUMENT_TITLE_LENGTH:510,titleRegex:/[<\\>:"/|?*]/,documentTitleRules:[t=>!t||t&&t.trim().length<=this.MAX_DOCUMENT_TITLE_LENGTH-this.selectedDocType.extension.length||this.newDocTitleMaxLengthLabel,t=>!this.titleRegex.test(t)]}},computed:{cleanedNewDocumentTitle(){return this.newDocTitleInput&&this.newDocTitleInput.trim()},newDocumentTitle(){return this.cleanedNewDocumentTitle&&`${this.cleanedNewDocumentTitle}${this.selectedDocType.extension}`||this.untitledNewDoc},documentTitleMaxLengthReached(){return this.newDocumentTitle&&this.newDocumentTitle.length>this.MAX_DOCUMENT_TITLE_LENGTH},untitledNewDoc(){return`${this.$t("documents.untitledDocument")}${this.selectedDocType.extension}`},maxFileCountErrorLabel(){return this.$t("attachments.drawer.maxFileCount.error").replace("{0}",`<b> ${this.maxFilesCount} </b>`)},newDocCreationFailedLabel(){return this.$t("attachment.new.document.failed")},newDocTitleMaxLengthLabel(){return this.$t("attachment.new.document.title.max.length")},newDocTitleExistLabel(){return this.$t("attachment.document.title.exist")}},created(){this.$root.$on(`${this.extensionApp}-${this.newDocumentActionExtension}-updated`,this.refreshNewDocumentsActions),this.$root.$on("hide-create-new-document-input",this.resetNewDocInput),this.refreshNewDocumentsActions()},methods:{refreshNewDocumentsActions(){extensionRegistry.loadExtensions(this.extensionApp,this.newDocumentActionExtension).forEach((t=>{t.id&&(this.newDocumentActions[t.id]=t)}))},createNewDoc(){this.documentTitleMaxLengthReached||(this.titleRegex.test(this.newDocumentTitle)?this.$root.$emit("attachments-notification-alert",{message:this.$t("attachments.valid.title.error.message"),type:"warning"}):(this.$root.$emit("start-loading-attachment-drawer"),this.$attachmentService.createNewDoc(this.newDocumentTitle,this.selectedDocType.type,this.currentDrive.name,this.pathDestinationFolder).then((t=>{if(!t||!t.status||409!==t.status)return t;this.$root.$emit("attachments-notification-alert",{message:this.newDocTitleExistLabel,type:"error"}),this.$root.$emit("end-loading-attachment-drawer")})).then((t=>this.manageNewCreatedDocument(t))).catch((()=>{this.$root.$emit("attachments-notification-alert",{message:this.newDocCreationFailedLabel,type:"error"}),this.$root.$emit("end-loading-attachment-drawer")}))))},showNewDocInput(t){this.attachments.length>=this.maxFilesCount?this.$root.$emit("attachments-notification-alert",{message:this.maxFileCountErrorLabel,type:"error"}):(this.$refs.NewDocInputHidden.focus(),this.NewDocInputHidden=!1,this.selectedDocType=t)},resetNewDocInput(){this.NewDocInputHidden=!0,this.newDocTitleInput=""},manageNewCreatedDocument(t){t&&t.id&&(t.drive=this.currentDrive.title,t.date=t.created,this.$root.$emit("add-new-created-document",t),this.$root.$emit("attachments-notification-alert",{message:this.$t("attachments.upload.success"),type:"success"}),this.resetNewDocInput(),window.open(`${eXo.env.portal.context}/${eXo.env.portal.portalName}/oeditor?docId=${t.id}`,"_blank"))}}},O,[],!1,null,null,null).exports;var z=function(){var t=this,e=t._self._c;return e("div",{staticClass:"taskAttachments d-flex"},[e("attachment-app",{attrs:{"entity-id":t.taskId,"space-id":t.spaceId,"entity-type":"task"}})],1)};z._withStripped=!0;const X=l({props:{taskId:{type:String,default:null},spaceId:{type:String,default:null}}},z,[],!1,null,null,null).exports;var j=function(){var t=this,e=t._self._c;return t.loading?e("v-progress-circular",{attrs:{size:"24",color:"primary",indeterminate:""}}):t.DocumentTitle?e("div",{staticClass:"clickable float-left primary--text text-truncate",style:`max-width: ${t.cellWidth}`,attrs:{title:t.DocumentTitle},on:{click:t.openPreview}},[t._v("\n  "+t._s(t.DocumentTitle)+"\n")]):t.DocumentAccessDenied?e("div",{staticClass:"d-flex"},[e("i",{staticClass:"uiIconColorError my-auto",attrs:{title:t.$t("analytics.errorRetrievingDataForValue",{0:t.value})}}),t._v(" "),e("span",{staticClass:"text-no-wrap text-sub-title my-auto ml-1"},[t._v("\n    "+t._s(t.$t("analytics.notAccessibleFile"))+"\n  ")])]):e("div",{staticClass:"d-flex"},[e("i",{staticClass:"uiIconColorError my-auto",attrs:{title:t.$t("analytics.errorRetrievingDataForValue",{0:t.value})}}),t._v(" "),e("span",{staticClass:"text-no-wrap text-sub-title my-auto ml-1"},[t._v("\n    "+t._s(t.$t("analytics.DeletedFile"))+"\n  ")])])};j._withStripped=!0;const H=l({props:{value:{type:Object,default:()=>null},column:{type:Object,default:()=>null}},data:()=>({loading:!0,attachment:{}}),computed:{cellWidth(){return this.column&&this.column.width||"30vw"},DocumentTitle(){return this.attachment&&this.attachment.title&&unescape(this.attachment.title)},DocumentAccessDenied(){return this.attachment&&this.attachment.acl&&!this.attachment.acl.canAccess},currentLanguage:()=>eXo&&eXo.env&&eXo.env.portal&&eXo.env.portal.language.replace("_","-")||"en",absoluteDateModified(t){return new Date(this.attachment.date).toLocaleString(this.currentLanguage,t).split("/").join("-")},fileInfo(){return`${this.$t("documents.preview.updatedOn")} ${this.absoluteDateModified} ${this.$t("documents.preview.updatedBy")} ${this.attachment.lastEditor} ${this.attachment.size}`}},created(){this.value?(this.loading=!0,this.error=!1,this.$attachmentService.getAttachmentById(this.value).then((t=>{this.attachment=t})).catch((()=>this.attachment={notFound:!0,id:this.value})).finally((()=>this.loading=!1))):this.loading=!1},methods:{openPreview(){documentPreview.init({doc:{id:this.attachment.id,repository:"repository",workspace:"collaboration",path:this.attachment.nodePath||this.attachment.path,title:this.attachment.title,downloadUrl:this.attachment.downloadUrl,openUrl:this.attachment.url||this.attachment.openUrl,breadCrumb:this.attachment.previewBreadcrumb,fileInfo:this.fileInfo,size:this.attachment.size,isCloudDrive:this.attachment.cloudDrive},version:{number:this.attachment.version},showComments:!1})}}},j,[],!1,null,null,null).exports;var V=function(){var t=this;return(0,t._self._c)("div",{staticClass:"documentSize"},[t.documentSize?[t._v("\n    "+t._s(t.documentSize)+" "+t._s(t.$t(`analytics.${t.unit}`))+"\n  ")]:[t._v("\n    -\n  ")]],2)};V._withStripped=!0;const G=l({props:{value:{type:Object,default:()=>null}},data:()=>({BYTES_IN_KB:1024,BYTES_IN_MB:1048576,BYTES_IN_GB:1073741824,MIN_GB_UNIT_DISPLAY_IN_MB:500,MIN_MB_UNIT_DISPLAY_IN_KB:500,MIN_KB_UNIT_DISPLAY_IN_BYTES:500,formattedSizePrecision:2,documentSize:0,unit:"bytes"}),watch:{value:{immediate:!0,handler(t){t&&this.computeFileSize()}}},methods:{computeFileSize(){const t=this.MIN_GB_UNIT_DISPLAY_IN_MB*this.BYTES_IN_MB,e=this.MIN_MB_UNIT_DISPLAY_IN_KB*this.BYTES_IN_KB,i=this.MIN_KB_UNIT_DISPLAY_IN_BYTES;let a=this.value;a<i?this.unit="bytes":a<e?(a/=this.BYTES_IN_KB,this.unit="kilo"):a<t?(a/=this.BYTES_IN_MB,this.unit="mega"):(a/=this.BYTES_IN_GB,this.unit="giga"),this.documentSize=(+a).toFixed(this.formattedSizePrecision)}}},V,[],!1,null,null,null).exports;var Y=function(){var t=this;return(0,t._self._c)("div",{staticClass:"documentOrigin"},[t.value?[t._v("\n    "+t._s(t.$t(`analytics.origin.${t.value}`))+"\n  ")]:[t._v("\n    -\n  ")]],2)};function Q(t,e,i){return i?(i.startsWith("/")&&(i=i.substr(1)),i.endsWith("/")&&(i=i.substr(0,i.length-1))):i="",fetch(`/portal/rest/managedocument/getFoldersAndFiles/?driveName=${t}&workspaceName=${e}&currentFolder=${i}`,{}).then((t=>t.ok?t.text():t.text().then((t=>{throw Z(`Error get data: ${t}`),new Error(t)})))).then((t=>(new window.DOMParser).parseFromString(t,"text/xml"))).then((t=>{if(t)return t})).catch((t=>{throw Z(`Error get data: ${t.errorMessage?t.errorMessage:t}`),new Error(`Error getting folders and files of the current path ${t}`)}))}function W(){return fetch("/portal/rest/wcmDriver/getDrivers",{}).then((t=>t.ok?t.text():t.text().then((t=>{throw Z(`Error get data: ${t}`),new Error(t)})))).then((t=>(new window.DOMParser).parseFromString(t,"text/xml"))).then((t=>{if(t)return t})).catch((t=>{throw Z(`Error get drives data: ${t.errorMessage?t.errorMessage:t}`),new Error(`Error getting drivers ${t}`)}))}function K(t,e,i,a,s,n){const r=new FormData;t&&r.append("driveName",t),e&&r.append("workspaceName",e),i&&r.append("currentFolder",i),a&&r.append("folderName",a),s&&r.append("folderNodeType",s),n&&r.append("isSystem",n);const o=new URLSearchParams(r).toString();return fetch(`/portal/rest/managedocument/createFolder?${o}`,{}).then((t=>t.ok?t.text():t.text().then((t=>{throw Z(`Error post data: ${t}`),new Error(t)})))).then((t=>(new window.DOMParser).parseFromString(t,"text/xml"))).then((t=>{if(t)return t})).catch((t=>{throw Z(`Error creating folder: ${t.errorMessage?t.errorMessage:t}`),new Error(`Error creating a new folder ${t}`)}))}function q(t,e,i){return fetch(`/portal/rest/managedocument/deleteFolderOrFile/?driveName=${t}&workspaceName=${e}&itemPath=${i}`,{}).then((t=>t.ok?t.text():t.text().then((t=>{throw Z(`Error delete data: ${t}`),new Error(t)})))).then((t=>(new window.DOMParser).parseFromString(t,"text/xml"))).then((t=>{if(t)return t})).catch((t=>{throw Z(`Error deleting the folder: ${t.errorMessage?t.errorMessage:t}`),new Error(`Error deleting the folder or the file ${t}`)}))}function J(t,e){return fetch(`/portal/rest/contents/rename/rename?oldPath=${t}&newTitle=${e}`,{credentials:"include",method:"GET"}).then((t=>{if(t&&t.ok)return t.ok})).catch((t=>{throw Z(`Error rename folder: ${t.errorMessage?t.errorMessage:t.errorCode}`),new Error(`Error rename this folder ${t}`)}))}function Z(t,e){const i="[attachmentsSelector] ";if("undefined"!=typeof console&&void 0!==console.log){const a=`--${(new Date).toISOString()}`;let s=t;e?(s+=". Error: ",e.name||e.message?(e.name&&(s+=`[${e.name}]`),e.message&&(s+=e.message)):s+="string"==typeof e?e:JSON.stringify(e)+(e.toString&&"function"==typeof e.toString?`; ${e.toString()}`:""),console.log(i+s+a),void 0!==e.stack&&console.log(e.stack)):(null!=e&&(s+=`. Error: ${e}`),console.log(i+s+a))}}function tt(){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/clouddrive/features/status/enabled`,{credentials:"include",method:"GET"}).then((t=>{if(t&&t.ok)return t.json()}))}function et(t,e,i,a,s,n,r,o,l){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/managedocument/uploadFile/control?workspaceName=${t}&driveName=${e}&currentFolder=${i}&currentPortal=${a}&uploadId=${s}&fileName=${n}&language=${r}&existenceAction=${o}&action=${l}`,{credentials:"include",method:"GET"}).then((t=>t.ok?t.text():t.text().then((t=>{throw Z(`Error uploading attachment: ${t}`),new Error(t)})))).then((t=>(new window.DOMParser).parseFromString(t,"text/xml"))).then((t=>{if(t)return t}))}function it(t,e,i){if(!i)throw new Error("Attachment Id can't be empty");return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/${e}/${t}/${i}`,{credentials:"include",method:"POST"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error linking attachments to the entity")}))}function at(t,e,i){i.forEach((t=>{if(!t)throw new Error("Attachment Id can't be empty")}));const a=new FormData;return i&&Object.keys(i).forEach((t=>{a.append("attachmentId",i[t])})),fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/${e}/${t}`,{credentials:"include",method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(a).toString()}).then((t=>{if(!t||!t.ok)throw new Error("Error updating entity's linked attachments list")}))}function st(t,e,i){if(!i)throw new Error("Attachment Id can't be empty");return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/${e}/${t}/${i}`,{credentials:"include",method:"DELETE"}).then((t=>{if(!t||!t.ok)throw new Error("Error removing entity's linked attachment")}))}function nt(t,e){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/${e}/${t}`,{credentials:"include",method:"DELETE"}).then((t=>{if(!t||!t.ok)throw new Error("Error removing entity's linked attachment")}))}function rt(t,e){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/${t}/${e}`,{credentials:"include",method:"GET"}).then((t=>{if(t||t.ok)return t.json();throw new Error("Error getting entity's linked attachments")}))}function ot(t,e,i){if(!i)throw new Error("Attachment Id can't be empty");if(!t)throw new Error("Entity Type can't be empty");if(!e)throw new Error("Entity Id can't be empty");return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/${t}/${e}/${i}`,{credentials:"include",method:"GET"}).then((t=>{if(t||t.ok)return t.json();throw new Error("Error getting entity's linked attachment")}))}function lt(t){if(!t)throw new Error("Attachment Id can't be empty");return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/${t}`,{credentials:"include",method:"GET"}).then((t=>{if(t||t.ok)return t.json();throw new Error("Error getting entity's linked attachment")}))}function ct(t,e,i,a,s){if(!i)throw new Error("Attachment Id can't be empty");const n=new FormData;return n.append("newPath",e||""),t&&n.append("newPathDrive",t),a&&n.append("entityType",a),s&&n.append("entityId",s),fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/${i}/move`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(n).toString()}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error moving attachment to the new destination path")}))}function dt(t,e,i,a){const s=new FormData;return t&&s.append("title",t),e&&s.append("templateName",e),i&&s.append("pathDrive",i),a&&s.append("path",a),fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/newDoc`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(s).toString()}).then((t=>{if(t&&t.ok)return t.json();if(409===t.status)return t;throw new Error("Error creating new document")}))}function ht(t){let e,i,a,s,n,r,o={};if(1===t.nodeType){if(t.attributes.length>0)for(o={},i=0;i<t.attributes.length;i+=1)a=t.attributes.item(i),o[a.nodeName]=a.nodeValue}else 3===t.nodeType&&(o=t.nodeValue);if(t.hasChildNodes())for(e=0;e<t.childNodes.length;e+=1)s=t.childNodes.item(e),n=s.nodeName,void 0===o[n]?o=ht(s):(void 0===o[n].push&&(r=o[n],o[n]=[],o[n].push(r)),o[n].push(ht(s)));return o}function pt(t,e){const i=e&&window.encodeURIComponent(e)||"";return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/attachments/downloadByPath?fileName=${i}`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.blob();throw new Error(`Error downloading file '${e}' from server`)})).then((t=>{const i=window.URL.createObjectURL(t),a=document.createElement("a");a.href=i,a.download=e.replace(/\[[0-9]*\]$/g,""),document.body.appendChild(a),a.click(),a.remove()}))}function mt(t,e,i,a){const s=new FormData;e&&s.append("workspaceName",e),t&&s.append("driveName",t),i&&s.append("currentFolder",i),a&&s.append("fileName",a);const n=new URLSearchParams(s).toString();return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/managedocument/uploadFile/exist?${n}`,{credentials:"include",method:"GET",headers:{"Content-Type":"application/json"}}).then((t=>t&&t.text())).then((t=>(new DOMParser).parseFromString(t,"text/xml")))}function ut(){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/transferRules/getTransfertRulesDocumentStatus`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting transfer rules download documents status")})).then((t=>{if(t)return"true"!==t.downloadDocumentStatus}))}function vt(){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/transferRules/getTransfertRulesDocumentStatus`,{credentials:"include",method:"GET"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error")}))}Y._withStripped=!0;const ft={"attachments-drawer":c,attachment:f,"attachment-item":p,"attachments-drive-explorer-drawer":S,"attachments-select-from-drive":P,"attachments-drive-explorer-file-item":g,"attachments-folder-actions-menu":u,"attachments-notification-alert":F,"attachments-notification-alerts":D,"attachments-list-drawer":A,"attachments-uploaded-files":I,"attachments-upload-input":C,"activity-attachments":k,"activity-attachment":U,"activity-composer-attachments":R,"attachment-create-document-input":B,"task-attachment":X,"analytics-table-cell-document-title-value":H,"analytics-table-cell-document-size-value":G,"analytics-table-cell-document-origin-value":l({props:{value:{type:Object,default:()=>null}}},Y,[],!1,null,null,null).exports};for(const t in ft)Vue.component(t,ft[t]);Vue.prototype.$attachmentService||window.Object.defineProperty(Vue.prototype,"$attachmentService",{value:i}),Vue.prototype.$transferRulesService||window.Object.defineProperty(Vue.prototype,"$transferRulesService",{value:a}),Vue.use(Vuetify);const yt=new Vuetify(eXo.env.portal.vuetifyPreset),gt="undefined"!=typeof eXo?eXo.env.portal.language:"en",wt=[`/portal/rest/i18n/bundle/locale.portlet.attachments-${gt}.json`,`/portal/rest/i18n/bundle/locale.portlet.documents-${gt}.json`];if(extensionRegistry){const t=extensionRegistry.loadComponents("attachmentApp");t&&t.length>0&&t.forEach((t=>{Vue.component(t.componentName,t.componentOptions)}))}exoi18n.loadLanguageAsync(gt,wt).then((t=>{new Vue({i18n:t})}));const Ft="attachment";let $t;function Dt(t,e,i,a,s){!function(){CKEDITOR.plugins.addExternal("attachFile","/eXoWCMResources/eXoPlugins/attachFile/","plugin.js"),CKEDITOR.plugins.addExternal("uploadImage","/eXoWCMResources/eXoPlugins/uploadImage/","plugin.js"),CKEDITOR.plugins.addExternal("selectImage","/eXoWCMResources/eXoPlugins/selectImage/","plugin.js"),extensionRegistry.registerComponent("ActivityContent","activity-content-extensions",{id:"attachments",isEnabled:t=>{const e=t&&t.activity;return e&&!e.activityId&&e.templateParams&&(e.templateParams.DOCPATH||e.templateParams.nodePath)},vueComponent:Vue.options.components["activity-attachments"],rank:10}),extensionRegistry.registerComponent("CommentContent","comment-content-extensions",{id:"attachments",isEnabled:t=>{const e=t&&t.activity;return e&&e.templateParams&&(e.templateParams.DOCPATH||e.templateParams.nodePath)},vueComponent:Vue.options.components["activity-attachments"],rank:20}),extensionRegistry.registerComponent("TaskDrawer","task-drawer-action",{id:"attachments",vueComponent:Vue.options.components["task-attachment"],rank:10}),extensionRegistry.registerComponent("ActivityComposerAction","activity-composer-action",{id:"activityComposerAttachments",vueComponent:Vue.options.components["activity-composer-attachments"],rank:10}),extensionRegistry.registerExtension("ActivityComposer","ckeditor-extensions",{id:"attachFile",extraPlugin:"attachFile",extraToolbarItem:"attachFile",rank:10}),extensionRegistry.registerExtension("WYSIWYGPlugins","image",{id:"selectImage",extraPlugin:"selectImage",extraToolbarItem:"selectImage",rank:20});const t={click:t=>{const e=t.templateParams.REPOSITORY&&t.templateParams.REPOSITORY.split("|@|")||t.templateParams.repository&&[t.templateParams.repository],i=t.templateParams.WORKSPACE&&t.templateParams.WORKSPACE.split("|@|")||t.templateParams.workspace&&[t.templateParams.workspace],a=(t.templateParams.DOCPATH&&t.templateParams.DOCPATH.split("|@|")||t.templateParams.nodePath&&[t.templateParams.nodePath]).map(((t,a)=>({docPath:t,repository:e[a],workspace:i[a]}))),s=1===a.length?a[0].docPath.replaceAll(/(.*)\//g,""):`Activity_${t.id}_${t.createDate.substring(0,10)}.zip`;return Vue.prototype.$attachmentService.downloadFiles(a,s)}};Vue.prototype.$transferRulesService.getTransfertRulesDownloadDocumentStatus().then((e=>{e&&(extensionRegistry.registerExtension("activity","action",Object.assign({id:"download",icon:"fa-download",labelKey:"documents.label.download",isEnabled:t=>{if(t.templateParams){const e=t.templateParams.DOCPATH&&t.templateParams.DOCPATH.split("|@|")||t.templateParams.nodePath&&[t.templateParams.nodePath];return e&&1===e.length}},rank:0},t)),extensionRegistry.registerExtension("activity","action",Object.assign({id:"downloadAll",labelKey:"documents.label.downloadAll",icon:"fa-download",isEnabled:t=>{if(t.templateParams){const e=t.templateParams.DOCPATH&&t.templateParams.DOCPATH.split("|@|")||t.templateParams.nodePath&&[t.templateParams.nodePath];return e&&e.length>1}},rank:0},t)))})),extensionRegistry.registerExtension("AnalyticsTable","CellValue",{type:"document-title",options:{rank:10,vueComponent:Vue.options.components["analytics-table-cell-document-title-value"],match:t=>"documentId.keyword"===t}}),extensionRegistry.registerExtension("AnalyticsTable","CellValue",{type:"document-size",options:{rank:20,vueComponent:Vue.options.components["analytics-table-cell-document-size-value"],match:t=>"documentSize"===t}}),extensionRegistry.registerExtension("AnalyticsTable","CellValue",{type:"document-origin",options:{rank:30,vueComponent:Vue.options.components["analytics-table-cell-document-origin-value"],match:t=>"origin.keyword"===t}})}(),exoi18n.loadLanguageAsync(gt,wt).then((n=>{$t=Vue.createApp({data:{entityId:t||"",entityType:e||"",defaultDrive:i||null,defaultFolder:a||"",spaceId:s||""},template:`<attachment\n                  :entity-id=entityId\n                  :entity-type=entityType\n                  :default-drive=defaultDrive\n                  :default-folder=defaultFolder\n                  :space-id=spaceId\n                  id="${Ft}" />`,vuetify:yt,i18n:n},`#${Ft}`,"Attachment Drawer")}))}function xt(){$t&&$t.$root.$emit("open-attachments-app-drawer")}function At(){$t&&$t.$destroy()}return e})()));