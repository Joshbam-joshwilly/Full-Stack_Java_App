define((()=>(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:()=>l});var n=function(){var e=this,t=e._self._c;return t("v-app",{staticClass:"agenda-application border-box-sizing transparent",attrs:{flat:""}},[e.settingsLoaded?[e.isMobile?t("v-main",{staticClass:"pt-2 px-1"},[t("agenda-mobile-header",{staticClass:"mt-2",attrs:{"current-space":e.currentSpace,"current-calendar":e.currentCalendar,"owner-ids":e.ownerIds,period:e.period}}),e._v(" "),t("agenda-timeline",{staticClass:"mt-2",attrs:{events:e.events,"period-start-date":e.period.start,loading:e.loading,limit:e.limit}}),e._v(" "),e.hasMore?t("v-flex",{staticClass:"d-flex py-4 border-box-sizing"},[t("v-btn",{staticClass:"btn mx-auto",attrs:{loading:e.loading,disabled:e.loading},on:{click:function(t){e.limit+=e.pageSize}}},[e._v("\n          "+e._s(e.$t("agenda.button.loadMore"))+"\n        ")])],1):e._e()],1):t("v-main",{staticClass:"pa-5"},[t("agenda-header",{staticClass:"mb-5",attrs:{"calendar-type":e.calendarType,"event-type":e.eventType,"current-space":e.currentSpace,"current-calendar":e.currentCalendar,"owner-ids":e.ownerIds}}),e._v(" "),t("agenda-body",{attrs:{events:e.events,"current-calendar":e.currentCalendar,"period-title":e.periodTitle,"calendar-type":e.calendarType,weekdays:e.weekdays,"working-time":e.workingTime}})],1)]:e._e(),e._v(" "),t("agenda-event-dialog",{ref:"eventFormDialog",attrs:{"current-space":e.currentSpace,"current-calendar":e.currentCalendar,settings:e.settings,connectors:e.enabledConnectors,"conference-provider":e.conferenceProvider,weekdays:e.weekdays,"working-time":e.workingTime}}),e._v(" "),t("agenda-event-preview-dialog"),e._v(" "),t("agenda-filter-calendar-drawer",{attrs:{"owner-ids":e.ownerIds},on:{changed:e.changeDisplayedOwnerIds}}),e._v(" "),t("agenda-user-setting-drawer",{attrs:{settings:e.settings}}),e._v(" "),t("agenda-event-quick-form-drawer",{attrs:{"current-space":e.currentSpace,"current-calendar":e.currentCalendar,settings:e.settings,"conference-provider":e.conferenceProvider}}),e._v(" "),t("agenda-event-save"),e._v(" "),t("agenda-connector",{attrs:{settings:e.settings,connectors:e.connectors},on:{"connectors-loaded":function(t){e.connectors=t}}}),e._v(" "),t("agenda-notification-alerts"),e._v(" "),e.settingsLoaded?t("agenda-events-updater",{attrs:{settings:e.settings,"current-calendar":e.currentCalendar,"calendar-type":e.eventType,"owner-ids":e.ownerIds,events:e.events,period:e.period,limit:e.limit}}):e._e(),e._v(" "),t("agenda-pending-invitation-drawer",{attrs:{"current-space":e.currentSpace}})],2)};n._withStripped=!0;var i=function(e,t,n,i,r,s,a,o){var d,l="function"==typeof e?e.options:e;if(t&&(l.render=t,l.staticRenderFns=[],l._compiled=!0),d)if(l.functional){l._injectStyles=d;var c=l.render;l.render=function(e,t){return d.call(t),c(e,t)}}else{var g=l.beforeCreate;l.beforeCreate=g?[].concat(g,d):[d]}return{exports:e,options:l}}({props:{eventType:{type:String,default:()=>"myEvents"}},data:()=>({initialized:!1,currentCalendar:null,currentSpace:null,filterCanceledEvents:!0,loading:!1,conferenceProviders:null,connectors:[],ownerIds:[],searchTerm:null,periodTitle:"",calendarType:"week",pageSize:10,limit:0,period:{start:new Date,end:null},events:[],settings:{agendaDefaultView:"week",agendaWeekStartOn:"MO",showWorkingTime:!1,workingTimeStart:"08:00",workingTimeEnd:"18:00"},hasMore:!1,settingsLoaded:!1}),computed:{enabledConferenceProviderName(){return this.settings&&this.settings.webConferenceProviders&&this.settings.webConferenceProviders.length&&this.settings.webConferenceProviders[0]},conferenceProvider(){return this.conferenceProviders&&this.enabledConferenceProviderName&&this.conferenceProviders.find((e=>e.isInitialized&&e.linkSupported&&e.groupSupported&&this.enabledConferenceProviderName===e.getType()))},isMobile(){return"xs"===this.$vuetify.breakpoint.name||"sm"===this.$vuetify.breakpoint.name},enabledConnectors(){return this.connectors&&this.connectors.filter((e=>e.initialized&&e.enabled))||[]},weekdays(){return this.settings&&this.$agendaUtils.getWeekSequenceFromDay(this.settings.agendaWeekStartOn)},workingTime(){return this.settings&&{showWorkingTime:this.settings.showWorkingTime,workingTimeStart:this.settings.workingTimeStart,workingTimeEnd:this.settings.workingTimeEnd}}},watch:{limit(){this.retrieveEvents()},eventType(){this.retrieveEvents()},initialized(){this.initialized&&this.$root.$emit("agenda-application-loaded")},period(){this.retrieveEvents()},searchTerm(){this.retrieveEvents()},loading(){this.loading?document.dispatchEvent(new CustomEvent("displayTopBarLoading")):(this.$root.$applicationLoaded(),document.dispatchEvent(new CustomEvent("hideTopBarLoading")))}},created(){window.setTimeout((()=>{localStorage.removeItem("agendaDeletedEvents")}),1e4),this.$root.$on("agenda-change-period",(e=>{this.period=e,this.periodTitle=this.generateCalendarTitle(e)})),this.$root.$on("agenda-event-limit-increment",(()=>this.limit+=this.pageSize)),this.$root.$on("agenda-change-period-type",(e=>this.calendarType=e)),this.$root.$on("agenda-search",(e=>this.searchTerm=e)),this.$root.$on("agenda-event-saved",this.retrieveEvents),this.$root.$on("agenda-refresh",this.retrieveEvents),this.$root.$on("agenda-event-type-changed",(e=>this.eventType=e)),this.$root.$on("agenda-event-deleted",this.retrieveEvents),this.$root.$on("agenda-event-response-sent",this.retrieveEvents),this.spaceId=eXo.env.portal.spaceId,this.$root.$on("agenda-settings-refresh",this.initSettings),this.initSettings()},methods:{initSettings(e){if(!e)return this.$settingsService.getUserSettings().then((e=>(e&&(this.settings=e,this.calendarType=this.settings&&this.settings.agendaDefaultView),this.$webConferencingService.getAllProviders()))).then((e=>(this.conferenceProviders=e,this.$nextTick()))).finally((()=>{this.settingsLoaded=!0}));this.settings=e},retrieveEvents(){if(!this.initialized&&eXo.env.portal.spaceId){const e=eXo.env.portal.spaceId;this.$spaceService.getSpaceById(e,"identity").then((e=>{if(this.currentSpace=e,e&&e.identity&&e.identity.id&&(this.ownerIds=[e.identity.id]),this.ownerIds&&this.ownerIds.length)return this.$calendarService.getCalendars(0,1,!1,this.ownerIds)})).then((e=>{this.currentCalendar=e&&e.calendars&&e.calendars.length&&e.calendars[0]||null})).finally((()=>{this.retrieveEventsFromStore()}))}else this.retrieveEventsFromStore()},retrieveEventsFromStore(){this.loading=!0;const e="allEvents"!==this.eventType&&eXo.env.portal.userIdentityId||null;if(!1===this.ownerIds)return this.events=[],this.hasMore=!1,this.loading=!1,void(this.initialized=!0);const t=e?"declinedEvent"===this.eventType?["DECLINED"]:["ACCEPTED","NEEDS_ACTION","TENTATIVE"]:null;return this.$eventService.getEvents(this.searchTerm,this.ownerIds,e,this.$agendaUtils.toRFC3339(this.period.start,!0),this.$agendaUtils.toRFC3339(this.period.end),this.limit,t,"attendees").then((e=>{let t=e&&e.events||[];this.filterCanceledEvents&&(t=t.filter((e=>!e.status||"CANCELLED"!==e.status))),t.forEach((e=>{e.name=e.summary,e.startDate=e.start&&this.$agendaUtils.toDate(e.start)||null,e.endDate=e.end&&this.$agendaUtils.toDate(e.end)||null})),this.hasMore=this.limit>this.pageSize&&(this.events&&this.events.length||0)<t.length||t.length>=this.limit,this.events=t})).catch((e=>{console.error("Error retrieving events",e)})).finally((()=>{this.initialized=!0,this.loading=!1}))},generateCalendarTitle(e){return this.$agendaUtils.generateCalendarTitle(this.calendarType,this.$agendaUtils.toDate(e.start),e.title,this.$t("agenda.week"))},changeDisplayedOwnerIds(e){this.ownerIds=e,this.retrieveEvents()},updateSettings(e){this.settings=e}}},n);const r={agenda:i.exports};for(const e in r)Vue.component(e,r[e]);if(extensionRegistry){const e=extensionRegistry.loadComponents("Agenda");e&&e.length>0&&e.forEach((e=>{Vue.component(e.componentName,e.componentOptions)}))}Vue.use(Vuetify);const s=new Vuetify(eXo.env.portal.vuetifyPreset);document.dispatchEvent(new CustomEvent("displayTopBarLoading"));const a="AgendaApplication",o=eXo&&eXo.env.portal.language||"en",d=`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.portlet.Agenda-${o}.json`;function l(){exoi18n.loadLanguageAsync(o,d).then((e=>{const t=eXo.env.portal.spaceId?"allEvents":"myEvents";Vue.createApp({template:`<agenda id="${a}" event-type="${t}" />`,vuetify:s,i18n:e},`#${a}`,"Agenda")}))}return t})()));