define((()=>(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:()=>p});var n=function(){var e=this,t=e._self._c;return t("v-app",{staticClass:"agenda-application border-box-sizing",attrs:{flat:""}},[t("v-main",{staticClass:"white"},[t("agenda-timeline-header",{attrs:{"current-space":e.currentSpace,"current-calendar":e.currentCalendar,"agenda-base-link":e.agendaBaseLink}}),e._v(" "),t("agenda-timeline",{attrs:{events:e.events,"period-start-date":e.periodStart,"agenda-base-link":e.agendaBaseLink,loading:e.loading||!e.initialized,limit:e.limit}})],1),e._v(" "),t("agenda-event-dialog",{ref:"eventFormDialog",attrs:{"current-space":e.currentSpace,"current-calendar":e.currentCalendar,settings:e.settings,connectors:e.enabledConnectors,"conference-provider":e.conferenceProvider,weekdays:e.weekdays,"working-time":e.workingTime}}),e._v(" "),t("agenda-event-quick-form-drawer",{attrs:{"current-space":e.currentSpace,"current-calendar":e.currentCalendar,settings:e.settings,"conference-provider":e.conferenceProvider}}),e._v(" "),t("agenda-event-save"),e._v(" "),t("agenda-connector",{attrs:{settings:e.settings,connectors:e.connectors},on:{"connectors-loaded":function(t){e.connectors=t}}}),e._v(" "),t("agenda-pending-invitation-drawer",{attrs:{"current-space":e.currentSpace}})],1)};function i(e,t,n,i,a,r,s,o){var d,l="function"==typeof e?e.options:e;if(t&&(l.render=t,l.staticRenderFns=n,l._compiled=!0),i&&(l.functional=!0),r&&(l._scopeId="data-v-"+r),s?(d=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),a&&a.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},l._ssrRegister=d):a&&(d=o?function(){a.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:a),d)if(l.functional){l._injectStyles=d;var c=l.render;l.render=function(e,t){return d.call(t),c(e,t)}}else{var p=l.beforeCreate;l.beforeCreate=p?[].concat(p,d):[d]}return{exports:e,options:l}}n._withStripped=!0;const a=i({props:{eventType:{type:String,default:()=>"myEvents"}},data:()=>({initialized:!1,currentSpace:null,currentCalendar:null,loading:!1,ownerIds:[],connectors:[],periodStart:new Date,limit:10,period:{start:new Date,end:null},settings:{agendaDefaultView:"week",agendaWeekStartOn:"MO",showWorkingTime:!1,workingTimeStart:"08:00",workingTimeEnd:"18:00"},events:[],agendaBaseLink:null,conferenceProviders:null,selectedProviderType:null}),computed:{enabledConferenceProviderName(){return this.settings&&this.settings.webConferenceProviders&&this.settings.webConferenceProviders.length&&this.settings.webConferenceProviders[0]},conferenceProvider(){return this.conferenceProviders&&this.enabledConferenceProviderName&&this.conferenceProviders.find((e=>e.isInitialized&&e.linkSupported&&e.groupSupported&&this.enabledConferenceProviderName===e.getType()))},weekdays(){return this.settings&&this.$agendaUtils.getWeekSequenceFromDay(this.settings.agendaWeekStartOn)},workingTime(){return this.settings&&{showWorkingTime:this.settings.showWorkingTime,workingTimeStart:this.settings.workingTimeStart,workingTimeEnd:this.settings.workingTimeEnd}},enabledConnectors(){return this.connectors&&this.connectors.filter((e=>e.initialized&&e.enabled))||[]}},watch:{limit(){this.retrieveEvents()},eventType(){this.retrieveEvents()},initialized(){this.initialized&&this.$root.$emit("agenda-application-loaded")},period(){this.retrieveEvents()},loading(){this.loading?document.dispatchEvent(new CustomEvent("displayTopBarLoading")):(document.dispatchEvent(new CustomEvent("hideTopBarLoading")),this.$root.$applicationLoaded())}},created(){eXo.env.portal.spaceId&&(this.limit=5),this.retrieveEvents().finally((()=>document.dispatchEvent(new CustomEvent("hideTopBarLoading")))),this.$root.$on("agenda-settings-refresh",this.initSettings),this.$root.$on("agenda-refresh",this.retrieveEvents),this.$root.$on("agenda-event-saved",this.retrieveEvents),this.$root.$on("agenda-event-deleted",this.retrieveEvents),this.spaceId=eXo.env.portal.spaceId,document.addEventListener("drawerOpened",(()=>this.$el.closest("#stickyBlockDesktop").style.position="static")),document.addEventListener("drawerClosed",(()=>this.$el.closest("#stickyBlockDesktop").style.position="sticky")),this.initSettings()},beforeDestroy(){document.removeEventListener("drawerOpened",(()=>this.$el.closest("#stickyBlockDesktop").style.position="static")),document.removeEventListener("drawerClosed",(()=>this.$el.closest("#stickyBlockDesktop").style.position="sticky"))},methods:{initSettings(e){if(!e)return this.$settingsService.getUserSettings().then((e=>(e&&(this.settings=e,this.calendarType=this.settings&&this.settings.agendaDefaultView),this.$webConferencingService.getAllProviders()))).then((e=>(this.conferenceProviders=e,this.$nextTick()))).finally((()=>{this.settingsLoaded=!0}));this.settings=e},retrieveEvents(){if(!this.initialized&&eXo.env.portal.spaceId){const e=eXo.env.portal.spaceId;return this.$spaceService.getSpaceById(e,"identity").then((e=>{if(this.currentSpace=e,e&&e.identity&&e.identity.id){this.ownerIds=[e.identity.id];const t=this.currentSpace.groupId.replace(/\//g,":");return this.agendaBaseLink=`${eXo.env.portal.context}/g/${t}/${this.currentSpace.prettyName}/agenda`,this.$calendarService.getCalendars(0,1,!1,this.ownerIds)}this.agendaBaseLink=`${eXo.env.portal.context}/${eXo.env.portal.portalName}/agenda`})).then((e=>{this.currentCalendar=e&&e.calendars&&e.calendars.length&&e.calendars[0]||null})).finally((()=>{this.initialized=!0,this.loading=!1,this.retrieveEventsFromStore()}))}return eXo.env.portal.spaceId||(this.agendaBaseLink=`${eXo.env.portal.context}/${eXo.env.portal.portalName}/agenda`),this.retrieveEventsFromStore()},retrieveEventsFromStore(){this.loading=!0;const e="myEvents"===this.eventType&&eXo.env.portal.userIdentityId||null;return this.$eventService.getEvents(this.searchTerm,this.ownerIds,e,this.$agendaUtils.toRFC3339(this.period.start,!1),this.$agendaUtils.toRFC3339(this.period.end),this.limit,["ACCEPTED","TENTATIVE"]).then((e=>{const t=e&&e.events||[];t.forEach((e=>{e.name=e.summary,e.startDate=e.start&&this.$agendaUtils.toDate(e.start)||null,e.endDate=e.end&&this.$agendaUtils.toDate(e.end)||null})),this.events=t})).catch((e=>{console.error("Error retrieving events",e)})).finally((()=>{this.initialized=!0,this.loading=!1}))}}},n,[],!1,null,null,null).exports;var r=function(){var e=this,t=e._self._c;return t("v-flex",{staticClass:"agenda-timeline-header d-flex mx-3 my-2"},[t("div",{staticClass:"d-flex align-center"},[t("a",{staticClass:"body-1 text-uppercase text-sub-title",attrs:{href:e.agendaBaseLink}},[e._v("\n      "+e._s(e.$t("agenda"))+"\n    ")]),e._v(" "),t("agenda-pending-invitation-badge",{attrs:{"current-space":e.currentSpace,"offset-y":18,"offset-x":12}})],1),e._v(" "),t("v-spacer"),e._v(" "),e.displayButton?t("div",{staticClass:"d-inline-block",attrs:{title:e.addEventButtonTooltip}},[t("v-btn",{attrs:{disabled:!e.canCreateEvent,title:e.$t("agenda.button.addEvent"),icon:"",text:""},on:{click:e.openEventForm}},[t("v-icon",[e._v("mdi-plus")])],1)],1):e._e()],1)};r._withStripped=!0;const s={"agenda-timeline-widget":a,"agenda-timeline-header":i({props:{currentSpace:{type:Object,default:null},currentCalendar:{type:Object,default:null},agendaBaseLink:{type:String,default:null}},data:()=>({initialized:!1}),computed:{isMobile(){return"xs"===this.$vuetify.breakpoint.name||"sm"===this.$vuetify.breakpoint.name},displayButton(){return(!this.isMobile||this.canCreateEvent)&&(this.initialized||!eXo.env.portal.spaceId)},canCreateEvent(){return!this.currentCalendar||!this.currentCalendar.acl||this.currentCalendar.acl.canCreate},addEventButtonTooltip(){return this.canCreateEvent?"":this.$t("agenda.onlySpaceRedactorCanCreateEvent")}},created(){this.$root.$on("agenda-application-loaded",(()=>this.initialized=!0))},methods:{openEventForm(){this.$root.$emit("agenda-event-quick-form",{summary:"",startDate:new Date,endDate:new Date,allDay:!1,calendar:{owner:{}},reminders:[],attachments:[],attendees:[]})}}},r,[],!1,null,null,null).exports};for(const e in s)Vue.component(e,s[e]);if(extensionRegistry){const e=extensionRegistry.loadComponents("Agenda");e&&e.length>0&&e.forEach((e=>{Vue.component(e.componentName,e.componentOptions)}))}Vue.use(Vuetify);const o=new Vuetify(eXo.env.portal.vuetifyPreset);document.dispatchEvent(new CustomEvent("displayTopBarLoading"));const d="AgendaTimelineApplication",l=eXo&&eXo.env.portal.language||"en",c=`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.portlet.Agenda-${l}.json`;function p(){exoi18n.loadLanguageAsync(l,c).then((e=>{const t=eXo.env.portal.spaceId?"allEvents":"myEvents";Vue.createApp({template:`<agenda-timeline-widget id="${d}" event-type="${t}" />`,vuetify:o,i18n:e},`#${d}`,"Agenda Timeline")}))}return t})()));