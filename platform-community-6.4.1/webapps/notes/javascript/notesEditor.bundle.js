define((()=>(()=>{"use strict";var t={d:(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{init:()=>F});var s={};t.r(s),t.d(s,{cancelExportNotes:()=>R,createNote:()=>C,deleteDraftNote:()=>P,deleteNotes:()=>k,exportNotes:()=>E,getDraftNoteById:()=>v,getExportStatus:()=>A,getExportedZip:()=>O,getFullNoteTree:()=>_,getLatestDraftOfPage:()=>g,getNote:()=>m,getNoteById:()=>f,getNoteTree:()=>w,getNoteVersionsByNoteId:()=>B,getPathByNoteOwner:()=>T,getSeparator:()=>b,importZipNotes:()=>D,moveNotes:()=>S,restoreNoteVersion:()=>N,saveDraftNote:()=>x,updateNote:()=>y,updateNoteById:()=>I});var n=function(){var t=this,e=t._self._c;return e("v-app",{staticClass:"notesEditor"},[e("v-alert",{class:t.alertMessageClass,attrs:{type:t.alertType,icon:"warning"===t.alertType?"mdi-alert-circle":"",dismissible:""},model:{value:t.alert,callback:function(e){t.alert=e},expression:"alert"}},[t._v("\n    "+t._s(t.message)+"\n    "),"warning"===t.alertType&&t.note.draftPage?e("a",{staticClass:"dropDraftLink",on:{click:t.dropDraft}},[t._v(t._s(t.$t("notes.label.drop.draft")))]):t._e()]),t._v(" "),e("div",{staticClass:"notesEditor width-full",attrs:{id:"notesEditor"}},[e("div",{staticClass:"notes-topbar"},[e("div",{staticClass:"notesActions white"},[e("div",{staticClass:"notesFormButtons d-inline-flex flex-wrap width-full pa-3 ma-0"},[e("div",{staticClass:"notesFormLeftActions d-inline-flex align-center me-10"},[e("img",{attrs:{src:t.srcImageNote}}),t._v(" "),e("span",{staticClass:"notesFormTitle ps-2"},[t._v(t._s(t.noteFormTitle))])]),t._v(" "),e("div",{staticClass:"notesFormRightActions pr-7"},[e("p",{staticClass:"draftSavingStatus mr-7"},[t._v(t._s(t.draftSavingStatus))]),t._v(" "),e("button",{key:t.postKey,staticClass:"btn btn-primary primary px-2 py-0",attrs:{id:"notesUpdateAndPost","aria-label":t.publishButtonText},on:{"~click":function(e){return t.postNote(!1)}}},[t._v("\n              "+t._s(t.publishButtonText)+"\n              "),e("v-icon",{attrs:{id:"notesPublichAndPost",dark:""},on:{click:t.openPublishAndPost}},[t._v("\n                mdi-menu-down\n              ")])],1),t._v(" "),e("v-menu",{attrs:{attach:"#notesUpdateAndPost",transition:"scroll-y-transition","content-class":"publish-and-post-btn width-full","offset-y":"",left:""},model:{value:t.publishAndPost,callback:function(e){t.publishAndPost=e},expression:"publishAndPost"}},[e("v-list-item",{staticClass:"px-2",on:{click:function(e){return e.stopPropagation(),t.postNote(!0)}}},[e("v-icon",{staticClass:"primary--text clickable pr-2",attrs:{size:"19"}},[t._v("\n                  mdi-arrow-collapse-up\n                ")]),t._v(" "),e("span",{staticClass:"body-2 text-color"},[t._v(t._s(t.publishAndPostButtonText))])],1)],1)],1)])]),t._v(" "),e("div",{staticClass:"width-full darkComposerEffect",attrs:{id:"notesTop"}})]),t._v(" "),e("form",{staticClass:"notes-content"},[e("div",{staticClass:"notes-content-form px-4"},[e("div",{staticClass:"formInputGroup notesTitle mx-3"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.note.title,expression:"note.title"}],ref:"noteTitle",staticClass:"py-0 px-1 mt-5 mb-0",attrs:{id:"notesTitle",placeholder:t.notesTitlePlaceholder,type:"text"},domProps:{value:t.note.title},on:{input:function(e){e.target.composing||t.$set(t.note,"title",e.target.value)}}})]),t._v(" "),e("div",{staticClass:"formInputGroup white overflow-auto flex notes-content-wrapper"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.note.content,expression:"note.content"}],staticClass:"notesFormInput",attrs:{id:"notesContent",placeholder:t.notesBodyPlaceholder,name:"notesContent"},domProps:{value:t.note.content},on:{input:function(e){e.target.composing||t.$set(t.note,"content",e.target.value)}}})])])])]),t._v(" "),e("note-custom-plugins",{ref:"noteCustomPlugins",attrs:{instance:t.instance}}),t._v(" "),e("note-table-plugins-drawer",{ref:"noteTablePlugins",attrs:{instance:t.instance},on:{closed:function(e){return t.closePluginsDrawer()}}}),t._v(" "),e("note-treeview-drawer",{ref:"noteTreeview",on:{closed:function(e){return t.closePluginsDrawer()}}})],1)};n._withStripped=!0;function i(t,e,s,n,i,o,a,r){var l,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=s,c._compiled=!0),n&&(c.functional=!0),o&&(c._scopeId="data-v-"+o),a?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(a)},c._ssrRegister=l):i&&(l=r?function(){i.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:i),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(t,e){return l.call(e),d(t,e)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,l):[l]}return{exports:t,options:c}}const o=i({props:{instance:{type:Object,default:()=>null}},data(){return{lang:eXo.env.portal.language,dateTimeFormat:{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"},note:{id:"",title:"",content:"",parentPageId:""},actualNote:{id:"",title:"",content:"",parentPageId:""},alert:!1,alertType:"",message:"",noteId:"",parentPageId:"",appName:"notes",srcImageNote:"/notes/images/wiki.png",titleMaxLength:1e3,notesTitlePlaceholder:`${this.$t("notes.title.placeholderContentInput")}*`,notesBodyPlaceholder:`${this.$t("notes.body.placeholderContentInput")}`,publishAndPost:!1,spaceId:"",noteFormTitle:"",postingNote:!1,savingDraft:!1,initDone:!1,initActualNoteDone:!1,draftSavingStatus:"",autoSaveDelay:1e3,saveDraft:"",postKey:1,navigationLabel:`${this.$t("notes.label.Navigation")}`,noteNavigationDisplayed:!1,spaceGroupId:null}},computed:{publishAndPostButtonText(){return!this.note.id||!this.note.targetPageId&&this.note.draftPage?this.$t("notes.button.publishAndPost"):this.$t("notes.button.updateAndPost")},publishButtonText(){return!this.note.id||!this.note.targetPageId&&this.note.draftPage?this.$t("notes.button.publish"):this.$t("notes.button.update")},initCompleted(){return this.initDone&&(this.initActualNoteDone||this.noteId||this.initActualNoteDone||!this.noteId)},alertMessageClass(){return this.message.replace(/<[^>]*>/g,"").replace(/&nbsp;/g,"").trim().length>45?"lengthyAlertMessage":""}},watch:{"note.title"(){this.note.title!==this.actualNote.title&&this.autoSave()},"note.content"(){this.note.content!==this.actualNote.content&&this.autoSave()}},created(){window.addEventListener("beforeunload",(()=>{if(!this.postingNote&&this.note.draftPage&&this.note.id){const t=localStorage.getItem(`draftNoteId-${this.note.id}`);if(t){this.removeLocalStorageCurrentDraft();const e=JSON.parse(t);this.persistDraftNote(e)}}}));const t=window.location.search,e=new URLSearchParams(t);if(e.has("appName")&&(this.appName=e.get("appName")),e.has("noteId")){this.noteId=e.get("noteId");e.has("isDraft")&&"true"===e.get("isDraft")?this.getDraftNote(this.noteId):this.getNote(this.noteId)}e.has("parentNoteId")&&(this.parentPageId=e.get("parentNoteId"),this.spaceId=e.get("spaceId"),this.spaceGroupId=e.get("spaceGroupId"),this.note.parentPageId=this.parentPageId),this.displayFormTitle(),$(document).on("mousedown",(()=>{this.publishAndPost&&window.setTimeout((()=>{this.publishAndPost=!1}),this.waitTimeUntilCloseMenu)})),document.addEventListener("note-custom-plugins",(()=>{this.$refs.noteCustomPlugins.open()})),this.$root.$on("note-table-plugins",(()=>{this.$refs.noteTablePlugins.open()})),this.$root.$on("updateData",(t=>{this.note.content=t})),this.$root.$on("show-alert",(t=>{this.displayMessage(t)})),this.$root.$on("display-treeview-items",(t=>{e.has("noteId")?this.$refs.noteTreeview.open(this.note,"includePages",null,t):e.has("parentNoteId")&&this.$notesService.getNoteById(this.parentPageId).then((e=>{const s=e;this.$refs.noteTreeview.open(s,"includePages",null,t)}))})),this.$root.$on("include-page",(t=>{const e=$("textarea#notesContent").ckeditor().editor,s=e.getSelection().getStartElement();if(e.getSelection().getSelectedText())if(s.is("a")){if("noteLink"===s.getAttribute("class")&&(e.getSelection().getStartElement().remove(),e.insertHtml(`<a href='${t.noteId}' class='noteLink'>${t.name}</a>`)),"labelLink"===s.getAttribute("class")){const n=s.getHtml();e.getSelection().getStartElement().remove(),e.insertHtml(`<a href='${t.noteId}' class='noteLink'>${n}</a>`)}}else e.insertHtml(`<a href='${t.noteId}' class='labelLink'>${e.getSelection().getSelectedText()}</a>`);else e.insertHtml(`<a href='${t.noteId}' class='noteLink'>${t.name}</a>`)})),document.addEventListener("note-navigation-plugin",(()=>{this.$root.$emit("show-alert",{type:"error",message:this.$t("notes.message.manualChild")})}))},mounted(){this.spaceId&&(this.init(),this.$root.$on("initCkeditor",(()=>this.initCKEditor())))},methods:{init(){this.initCKEditor(),this.setToolBarEffect(),this.initDone=!0},autoSave(){this.initCompleted&&(this.postingNote||("warning"===this.alertType&&this.note.draftPage&&this.alert&&(this.alert=!1),clearTimeout(this.saveDraft),this.saveDraft=setTimeout((()=>{this.savingDraft=!0,this.draftSavingStatus=this.$t("notes.draft.savingDraftStatus"),this.$nextTick((()=>{this.saveNoteDraft()}))}),this.autoSaveDelay)))},getNote(t){return this.$notesService.getLatestDraftOfPage(t).then((e=>{if("group"===e.wikiType&&(this.spaceGroupId=e.wikiOwner),this.init(),e=0!==Object.keys(e).length?e:null){this.fillNote(e);const t={type:"warning",message:`${this.$t("notes.alert.warning.label.draft.drop")} ${this.$dateUtil.formatDateObjectToDisplay(new Date(this.note.updatedDate.time),this.dateTimeFormat,this.lang)},`};this.displayMessage(t,!0),this.initActualNoteDone=!0}else this.$notesService.getNoteById(t).then((t=>{this.$nextTick((()=>this.fillNote(t))),this.initActualNoteDone=!0}))}))},getDraftNote(t){return this.$notesService.getDraftNoteById(t).then((t=>{"group"===t.wikiType&&(this.spaceGroupId=t.wikiOwner),this.init(),this.fillNote(t)})).finally((()=>{const t={type:"warning",message:`${this.$t("notes.alert.warning.label.draft.drop")} ${this.$dateUtil.formatDateObjectToDisplay(new Date(this.note.updatedDate.time),this.dateTimeFormat,this.lang)},  `};this.displayMessage(t,!0),this.initActualNoteDone=!0}))},fillNote(t){if(this.initActualNoteDone=!1,t){this.note=t,this.actualNote={id:this.note.id,name:this.note.name,title:this.note.title,content:this.note.content,author:this.note.author,owner:this.note.owner,breadcrumb:this.note.breadcrumb,toBePublished:this.note.toBePublished};const e='<div id="note-children-container" class="navigation-img-wrapper" contenteditable="false"><figure class="image-navigation" contenteditable="false"><img src="/notes/images/children.png" role="presentation"/><img src="/notes/images/trash.png" id="remove-treeview" alt="remove treeview"/><figcaption class="note-navigation-label">Navigation</figcaption></figure></div><p></p>';CKEDITOR.instances.notesContent.setData(t.content),0===this.note.content.trim().length&&this.$notesService.getNoteById(this.noteId,"","","",!0).then((t=>{t&&t.children&&t.children.length&&(CKEDITOR.instances.notesContent.setData(e),this.setFocus())}))}},postNote(t){if(this.postingNote=!0,clearTimeout(this.saveDraft),this.validateForm()){let e;e=this.note.draftPage?{id:this.note.targetPageId?this.note.targetPageId:null,title:this.note.title,name:this.note.name,wikiType:this.note.wikiType,wikiOwner:this.note.wikiOwner,content:this.getBody()||this.note.content,parentPageId:this.note.targetPageId===this.parentPageId?null:this.parentPageId,toBePublished:t,appName:this.appName}:{id:this.note.id,title:this.note.title,name:this.note.name,wikiType:this.note.wikiType,wikiOwner:this.note.wikiOwner,content:this.getBody()||this.note.content,parentPageId:this.parentPageId,toBePublished:t,appName:this.appName};let s="";e.id?this.$notesService.updateNoteById(e).then((t=>{this.removeLocalStorageCurrentDraft(),s=this.$notesService.getPathByNoteOwner(t,this.appName).replace(/ /g,"_"),this.draftSavingStatus="",window.location.href=s})).catch((t=>{console.error("Error when update note page",t),this.enableClickOnce(),this.$root.$emit("show-alert",{type:"error",message:this.$t(`notes.message.${t.message}`)})})):this.$notesService.createNote(e).then((t=>{s=this.$notesService.getPathByNoteOwner(t,this.appName).replace(/ /g,"_");const e=JSON.parse(localStorage.getItem(`draftNoteId-${this.note.id}`));this.deleteDraftNote(e,s)})).catch((t=>{console.error("Error when creating note page",t),this.enableClickOnce(),this.$root.$emit("show-alert",{type:"error",message:this.$t(`notes.message.${t.message}`)})}))}},openPublishAndPost(t){this.publishAndPost=!this.publishAndPost,t&&(t.preventDefault(),t.stopPropagation())},saveNoteDraft(){const t={id:this.note.draftPage?this.note.id:"",title:this.note.title,content:this.getBody()||this.note.content,name:this.note.name,appName:this.appName,wikiType:this.note.wikiType,wikiOwner:this.note.wikiOwner,parentPageId:this.parentPageId};this.note.draftPage&&this.note.id?t.targetPageId=this.note.targetPageId:t.targetPageId=this.note.id?this.note.id:"",this.note.title||this.note.content?this.note.draftPage&&this.note.id?(this.note.parentPageId=this.parentPageId,localStorage.setItem(`draftNoteId-${this.note.id}`,JSON.stringify(t)),this.actualNote={name:t.name,title:t.title,content:t.content},setTimeout((()=>{this.draftSavingStatus=this.$t("notes.draft.savedDraftStatus")}),this.autoSaveDelay/2)):this.isDefaultContent(this.note.content)||this.persistDraftNote(t):this.deleteDraftNote()},persistDraftNote(t){(this.note.title||this.note.content)&&this.$notesService.saveDraftNote(t,this.parentPageId).then((t=>{this.actualNote={id:t.id,name:t.name,title:t.title,content:t.content,author:t.author,owner:t.owner},t.parentPageId=this.parentPageId,this.note=t,localStorage.setItem(`draftNoteId-${this.note.id}`,JSON.stringify(t))})).then((()=>{this.savingDraft=!1,setTimeout((()=>{this.draftSavingStatus=this.$t("notes.draft.savedDraftStatus")}),this.autoSaveDelay/2)})).catch((t=>{console.error("Error when creating draft note: ",t),this.$root.$emit("show-alert",{type:"error",message:this.$t(`notes.message.${t.message}`)})}))},closePluginsDrawer(){this.$refs.noteCustomPlugins.close()},initCKEditor:function(){CKEDITOR.instances.notesContent&&CKEDITOR.instances.notesContent.destroy&&CKEDITOR.instances.notesContent.destroy(!0),CKEDITOR.plugins.addExternal("video","/notes/javascript/eXo/wiki/ckeditor/plugins/video/","plugin.js"),CKEDITOR.plugins.addExternal("insertOptions","/notes/javascript/eXo/wiki/ckeditor/plugins/insertOptions/","plugin.js"),CKEDITOR.plugins.addExternal("toc","/notes/javascript/eXo/wiki/ckeditor/plugins/toc/","plugin.js"),CKEDITOR.dtd.$removeEmpty.i=!1;let t="sharedspace,simpleLink,font,justify,widget,video,insertOptions,contextmenu,tabletools,tableresize,toc",e="image,confirmBeforeReload,maximize,resize";const s=$(window).width();s>$(window).height()&&s<this.SMARTPHONE_LANDSCAPE_WIDTH&&(t="simpleLink");const n=extensionRegistry.loadExtensions("WYSIWYGPlugins","image");if(n&&n.length){const s=n.map((t=>t.extraPlugin)).join(","),i=n.map((t=>t.removePlugin)).join(",");s&&(t=`${t},${s}`),i&&(e=`${e},${i}`)}CKEDITOR.addCss("h1 { font-size: 34px;font-weight: 400;}"),CKEDITOR.addCss("h2 { font-size: 28px;font-weight: 400;}"),CKEDITOR.addCss("h3 { font-size: 21.84px;font-weight: 400;}"),CKEDITOR.addCss("p,li { font-size: 18.6667px;}"),CKEDITOR.addCss("blockquote p { font-size: 17.5px;font-weight: 300;}"),CKEDITOR.addCss(".cke_editable { font-size: 14px; line-height: 1.4 !important;}"),CKEDITOR.addCss(".placeholder { color: #5f708a!important;}"),CKEDITOR.basePath="/commons-extension/ckeditor/";const i=this;$("textarea#notesContent").ckeditor({customConfig:"/commons-extension/ckeditorCustom/config.js",extraPlugins:t,removePlugins:e,allowedContent:!0,spaceURL:i.spaceURL,spaceGroupId:`/spaces/${this.spaceGroupId}`,imagesDownloadFolder:"notes/images",toolbarLocation:"top",extraAllowedContent:"table[!summary]; img[style,class,src,referrerpolicy,alt,width,height]; span(*)[*]{*}; span[data-atwho-at-query,data-atwho-at-value,contenteditable]; a[*];i[*];",removeButtons:"",enterMode:CKEDITOR.ENTER_BR,shiftEnterMode:CKEDITOR.ENTER_BR,toolbar:[{name:"format",items:["Format"]},{name:"basicstyles",items:["Bold","Italic","Underline","Strike","-","RemoveFormat"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Blockquote"]},{name:"fontsize",items:["FontSize"]},{name:"colors",items:["TextColor"]},{name:"align",items:["JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"insert"},{name:"links",items:["simpleLink","InsertOptions"]}],format_tags:"p;h1;h2;h3",autoGrow_minHeight:i.noteFormContentHeight,height:i.noteFormContentHeight,bodyClass:"notesContent",dialog_noConfirmCancel:!0,sharedSpaces:{top:"notesTop"},on:{instanceReady:function(t){i.actualNote.content=t.editor.getData(),CKEDITOR.instances.notesContent.removeMenuItem("linkItem"),CKEDITOR.instances.notesContent.removeMenuItem("selectImageItem"),CKEDITOR.instances.notesContent.contextMenu.addListener((function(t){if(t.getAscendant("table",!0))return{tableProperties:CKEDITOR.TRISTATE_ON}})),CKEDITOR.instances.notesContent.addCommand("tableProperties",{exec:function(){if(CKEDITOR.instances.notesContent.elementPath()&&CKEDITOR.instances.notesContent.elementPath().contains("table",1)){const t=CKEDITOR.instances.notesContent.elementPath().contains("div",1).$.firstChild.innerText,e=CKEDITOR.instances.notesContent.elementPath().contains("table",1).getAttributes();i.$refs.noteTablePlugins.open(e,t)}}}),$(CKEDITOR.instances.notesContent.document.$).find(".atwho-inserted").each((function(){$(this).on("click",".remove",(function(){$(this).closest("[data-atwho-at-query]").remove()}))}));const e=CKEDITOR.instances.notesContent.window.$.document.getElementById("note-children-container");e&&(e.contentEditable="false");const s=t.editor.document.getById("remove-treeview");s&&t.editor.editable().attachListener(s,"click",(function(){const e=t.editor.document.getById("note-children-container");e&&(e.remove(),i.note.content=t.editor.getData()),i.setFocus()})),window.setTimeout((()=>i.setFocus()),50),i.$root.$applicationLoaded()},change:function(t){i.note.content=t.editor.getData(),i.autoSave();const e=t.editor.document.getById("remove-treeview");e&&t.editor.editable().attachListener(e,"click",(function(){const e=t.editor.document.getById("note-children-container");if(e){const s=e.getNext();e.remove(),0===s.$.innerText.trim().length&&s.remove(),i.note.content=t.editor.getData()}}))},fileUploadResponse:function(){CKEDITOR.instances.notesContent.once("afterInsertHtml",(()=>{window.setTimeout((()=>{CKEDITOR.instances.notesContent.fire("mode")}),2e3)}))},doubleclick:function(t){const e=t.data.element;if(e&&e.is("a")){const t=e.getAttribute("href");i.$notesService.getNoteById(t).then((t=>{const e=t;i.$refs.noteTreeview.open(e,"includePages","no-arrow")}))}}}}),this.instance=CKEDITOR.instances.notesContent},setToolBarEffect(){const t=CKEDITOR.instances.notesContent,e=document.getElementById("notesTop");t.on("contentDom",(function(){this.document.on("click",(function(){e.classList.add("darkComposerEffect")}))})),t.on("contentDom",(function(){this.document.on("keyup",(function(){e.classList.add("darkComposerEffect")}))})),$("#notesEditor").parent().click((()=>{e.classList.remove("darkComposerEffect"),e.classList.add("greyComposerEffect")})),$("#notesEditor").parent().keyup((()=>{e.classList.remove("darkComposerEffect"),e.classList.add("greyComposerEffect")}))},setFocus(){this.noteId?CKEDITOR.instances.notesContent&&(CKEDITOR.instances.notesContent.status="ready",window.setTimeout((()=>{this.$nextTick().then((()=>CKEDITOR.instances.notesContent.focus()))}),200)):this.$refs.noteTitle.focus()},validateForm(){return this.note.title?isNaN(this.note.title)?!(this.note.title.replace(/<[^>]*>/g,"").replace(/&nbsp;/g,"").trim().length<3||this.note.title.replace(/<[^>]*>/g,"").replace(/&nbsp;/g,"").trim().length>this.titleMaxLength)||(this.enableClickOnce(),this.$root.$emit("show-alert",{type:"error",message:this.$t("notes.message.missingLengthTitle")}),!1):(this.enableClickOnce(),this.$root.$emit("show-alert",{type:"error",message:this.$t("notes.message.numericTitle")}),!1):(this.enableClickOnce(),this.$root.$emit("show-alert",{type:"error",message:this.$t("notes.message.missingTitle")}),!1)},displayMessage(t,e){this.message=t.message,this.alertType=t.type,this.alert=!0,e||window.setTimeout((()=>this.alert=!1),5e3)},displayFormTitle(){if(!this.noteId)return this.$spaceService.getSpaceById(this.spaceId).then((t=>{this.noteFormTitle=this.$t("notes.composer.createNotes").replace("{0}",t.displayName)}));this.noteFormTitle=this.$t("notes.edit.editNotes")},dropDraft(){if(this.note.draftPage&&this.note.id){const t=this.note.targetPageId;this.removeLocalStorageCurrentDraft(),this.$notesService.deleteDraftNote(this.note).then((()=>{if(this.draftSavingStatus="",t)"warning"===this.alertType&&(this.alert=!1),this.getNote(t);else{const t={id:this.note.parentPageId,wikiId:this.note.wikiId,wikiOwner:this.note.wikiOwner,wikiType:this.note.wikiType};window.location.href=this.$notesService.getPathByNoteOwner(t,this.appName).replace(/ /g,"_")}})).catch((t=>{console.error("Error when deleting draft note",t)}))}},deleteDraftNote(t,e){t||(t=this.note),this.note.draftPage&&this.note.id&&(this.removeLocalStorageCurrentDraft(),this.$notesService.deleteDraftNote(t).then((()=>{this.draftSavingStatus="",e||(this.note={id:"",title:"",content:"",parentPageId:this.parentPageId,draftPage:!0},this.actualNote={id:"",title:"",content:"",parentPageId:this.parentPageId,draftPage:!0})})).then((()=>{this.draftSavingStatus="",e&&(window.location.href=e)})).catch((t=>{console.error("Error when deleting draft note",t)})))},removeLocalStorageCurrentDraft(){localStorage.getItem(`draftNoteId-${this.note.id}`)&&localStorage.removeItem(`draftNoteId-${this.note.id}`)},enableClickOnce(){this.postingNote=!1,this.postKey++},isDefaultContent(t){const e=document.createElement("div");if(e.innerHTML=t,2===e.childElementCount){const t=CKEDITOR.instances.notesContent.window.$.document.getElementById("note-children-container");return!!t&&0===t.nextElementSibling.innerText.trim().length}return!1},getBody:function(){const t=CKEDITOR.instances.notesContent.getData();return t||null}}},n,[],!1,null,null,null).exports;var a=function(){var t=this,e=t._self._c;return e("div",[e("v-overlay",{attrs:{"z-index":"1031",value:t.drawer},nativeOn:{click:function(e){t.drawer=!1}}}),t._v(" "),e("exo-drawer",{ref:"customPluginsDrawer",staticClass:"customPluginsDrawer",attrs:{"show-overlay":"",right:""},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[e("template",{slot:"title"},[t._v("\n      "+t._s(t.$t("notes.label.customPlugins"))+"\n    ")]),t._v(" "),e("template",{slot:"content"},[e("div",{staticClass:"content",attrs:{slot:"content"},slot:"content"},[e("v-row",{staticClass:"mandatory pluginsContainer d-flex flex-wrap width-full ml-0"},[e("v-col",{staticClass:"pluginsList d-flex flex-wrap width-full",model:{value:t.plugins,callback:function(e){t.plugins=e},expression:"plugins"}},t._l(t.plugins,(function(s,n){return e("div",{key:n,staticClass:"pluginsItemContainer",attrs:{id:"plugin-"+n}},[e("div",{staticClass:"pluginItem pa-4",attrs:{id:"pluginItem-"+n}},[e("a",{attrs:{id:s.id,target:s.title},on:{click:function(e){return t.openPlugin(s.id)}}},[s.src&&s.src.length?e("img",{staticClass:"pluginImage bloc",attrs:{src:s.src}}):e("img",{staticClass:"pluginImage block",attrs:{src:t.defaultImagePlugin}}),t._v(" "),e("span",{directives:[{name:"exo-tooltip",rawName:"v-exo-tooltip.bottom.body",value:s.tooltip,expression:"plugin.tooltip",modifiers:{bottom:!0,body:!0}}],staticClass:"pluginTitle text-truncate"},[t._v("\n                    "+t._s(t.$t(`notes.label.${s.title}`))+"\n                  ")])])])])})),0)],1)],1)])],2)],1)};a._withStripped=!0;const r=i({data:()=>({defaultImagePlugin:"/notes/images/defaultPlugin.png",drawer:!1,noteChildren:[],treeviewInserted:!1}),computed:{plugins(){const t=[{id:"video",title:"Video",src:"/notes/images/video.png",tooltip:this.$t("notes.label.insertVideo")},{id:"table",title:"Table",src:"/notes/images/table.png",tooltip:this.$t("notes.label.insertTable")},{id:"note",title:"Note",src:"/notes/images/notes.png",tooltip:this.$t("notes.label.insertNote")},{id:"Navigation",title:"Navigation",src:"/notes/images/children.png",tooltip:this.$t("notes.label.Navigation")}];return eXo.ecm&&t.unshift({id:"selectImage",title:"Image",src:"/notes/images/photo.png",tooltip:this.$t("notes.label.insertImage")}),this.hideNavigation||!this.noteChildren.length?t.filter((t=>"Navigation"!==t.id)):t}},props:{instance:{type:Object,default:()=>null}},created(){const t=window.location.search,e=new URLSearchParams(t);e.has("noteId")&&(this.noteId=e.get("noteId"),this.hideNavigation=!1,this.retrieveNoteChildren(this.noteId))},methods:{open(){this.$refs.customPluginsDrawer.open(),this.$root.$emit("initCkeditor")},close(){this.$refs.customPluginsDrawer.close()},retrieveNoteChildren(t){this.$notesService.getNoteById(t,"","","",!0).then((t=>{this.noteChildren=t&&t.children||[]}))},openPlugin(t){"table"===t?this.$root.$emit("note-table-plugins"):"note"===t?this.$root.$emit("display-treeview-items","published"):"Navigation"===t?(this.instance.execCommand("ToC"),this.treeviewInserted=!0,this.close()):(this.instance.execCommand(t),this.close())}}},a,[],!1,null,null,null).exports;var l=function(){var t=this,e=t._self._c;return e("div",[e("v-overlay",{attrs:{"z-index":"1031",value:t.drawer},nativeOn:{click:function(e){t.drawer=!1}}}),t._v(" "),e("exo-drawer",{ref:"customTableDrawer",staticClass:"customTableDrawer",attrs:{"show-overlay":"",right:""},on:{closed:function(e){return t.closeAllDrawer()}},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[e("template",{slot:"title"},[e("div",{staticClass:"d-flex"},[e("i",{staticClass:"uiIcon uiArrowBAckIcon",on:{click:function(e){t.backToPlugins(),t.close()}}}),t._v(" "),e("span",{staticClass:"ps-2 pt-1"},[t._v(t._s(t.$t("notes.plugin.table")))])])]),t._v(" "),e("template",{slot:"content"},[e("v-container",{attrs:{fluid:""}},[e("div",{staticClass:"d-flex"},[e("v-subheader",{staticClass:"px-0"},[t._v("\n            "+t._s(t.$t("notes.plugin.table.size"))+"\n          ")]),t._v(" "),e("v-divider",{staticClass:"spacesOverviewHorizontalSeparator mx-2 ma-auto"})],1),t._v(" "),e("v-row",{attrs:{align:"center"}},[e("v-col",{attrs:{cols:"3"}},[e("v-subheader",[t._v("\n              "+t._s(t.$t("notes.plugin.table.lines"))+"\n            ")])],1),t._v(" "),e("v-col",{attrs:{cols:"3"}},[e("v-text-field",{staticClass:"pa-0",attrs:{type:"number",rules:t.maxRules,dense:"","min-height":"",outlined:"",disabled:!!t.table},model:{value:t.lines,callback:function(e){t.lines=e},expression:"lines"}})],1),t._v(" "),e("v-col",{attrs:{cols:"3"}},[e("v-subheader",[t._v("\n              "+t._s(t.$t("notes.plugin.table.columns"))+"\n            ")])],1),t._v(" "),e("v-col",{attrs:{cols:"3"}},[e("v-text-field",{staticClass:"pa-0",attrs:{type:"number",rules:t.maxRules,dense:"","min-height":"",outlined:"",disabled:!!t.table},model:{value:t.columns,callback:function(e){t.columns=e},expression:"columns"}})],1),t._v(" "),e("v-col",{attrs:{cols:"3"}},[e("v-subheader",[t._v("\n              "+t._s(t.$t("notes.plugin.table.width"))+"\n            ")])],1),t._v(" "),e("v-col",{attrs:{cols:"3"}},[e("v-text-field",{staticClass:"pa-0",attrs:{rules:t.maxRules,dense:"","min-height":"",outlined:""},model:{value:t.width,callback:function(e){t.width=e},expression:"width"}})],1),t._v(" "),e("v-col",{attrs:{cols:"3"}},[e("v-subheader",[t._v("\n              "+t._s(t.$t("notes.plugin.table.height"))+"\n            ")])],1),t._v(" "),e("v-col",{attrs:{cols:"3"}},[e("v-text-field",{staticClass:"pa-0",attrs:{rules:t.maxRules,dense:"","min-height":"",outlined:""},model:{value:t.height,callback:function(e){t.height=e},expression:"height"}})],1)],1)],1),t._v(" "),e("v-container",{attrs:{fluid:""}},[e("div",{staticClass:"d-flex"},[e("v-subheader",{staticClass:"px-0"},[t._v("\n            "+t._s(t.$t("notes.plugin.table.adjustment"))+"\n          ")]),t._v(" "),e("v-divider",{staticClass:"spacesOverviewHorizontalSeparator mx-2 ma-auto"})],1),t._v(" "),e("v-row",{attrs:{align:"center"}},[e("v-col",{attrs:{cols:"3"}},[e("v-subheader",[t._v("\n              "+t._s(t.$t("notes.plugin.table.header"))+"\n            ")])],1),t._v(" "),e("v-col",{attrs:{cols:"3"}},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.headerSelected,expression:"headerSelected"}],staticClass:"input-block-level ignore-vuetify-classes my-3",attrs:{name:"priority"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.headerSelected=e.target.multiple?s:s[0]}}},t._l(t.header,(function(s){return e("option",{key:s.name,domProps:{value:s.name}},[t._v("\n                "+t._s(t.$t("label.header."+s.name.toLowerCase()))+"\n              ")])})),0)]),t._v(" "),e("v-col",{attrs:{cols:"3"}},[e("v-subheader",[t._v("\n              "+t._s(t.$t("notes.plugin.table.border"))+"\n            ")])],1),t._v(" "),e("v-col",{attrs:{cols:"3"}},[e("v-text-field",{staticClass:"pa-0",attrs:{type:"number",rules:t.maxRules,dense:"","min-height":"",outlined:""},model:{value:t.border,callback:function(e){t.border=e},expression:"border"}})],1),t._v(" "),e("v-col",{attrs:{cols:"9"}},[e("v-subheader",[t._v("\n              "+t._s(t.$t("notes.plugin.table.spacing"))+"\n            ")])],1),t._v(" "),e("v-col",{attrs:{cols:"3"}},[e("v-text-field",{staticClass:"pa-0",attrs:{type:"number",rules:t.maxRules,dense:"","min-height":"",outlined:""},model:{value:t.spacing,callback:function(e){t.spacing=e},expression:"spacing"}})],1),t._v(" "),e("v-col",{attrs:{cols:"9"}},[e("v-subheader",[t._v("\n              "+t._s(t.$t("notes.plugin.table.internal"))+"\n            ")])],1),t._v(" "),e("v-col",{attrs:{cols:"3"}},[e("v-text-field",{staticClass:"pa-0",attrs:{type:"number",rules:t.maxRules,dense:"","min-height":"",outlined:""},model:{value:t.internal,callback:function(e){t.internal=e},expression:"internal"}})],1)],1)],1),t._v(" "),e("v-container",{attrs:{fluid:""}},[e("div",{staticClass:"d-flex"},[e("v-subheader",{staticClass:"px-0"},[t._v("\n            "+t._s(t.$t("notes.plugin.table.alignment"))+"\n          ")]),t._v(" "),e("v-divider",{staticClass:"spacesOverviewHorizontalSeparator mx-2 ma-auto"})],1),t._v(" "),e("v-row",{attrs:{align:"center"}},[e("v-col",{attrs:{cols:"3"}},[e("v-subheader",[t._v("\n              "+t._s(t.$t("notes.plugin.table.alignment"))+"\n            ")])],1),t._v(" "),e("v-col",{attrs:{cols:"3"}},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.alignmentSelected,expression:"alignmentSelected"}],staticClass:"input-block-level ignore-vuetify-classes my-3",attrs:{name:"priority"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.alignmentSelected=e.target.multiple?s:s[0]}}},t._l(t.alignment,(function(s){return e("option",{key:s.name,domProps:{value:s.name}},[t._v("\n                "+t._s(t.$t("label.alignment."+s.name.toLowerCase()))+"\n              ")])})),0)])],1)],1),t._v(" "),e("v-container",{attrs:{fluid:""}},[e("div",{staticClass:"d-flex"},[e("v-subheader",{staticClass:"px-0"},[t._v("\n            "+t._s(t.$t("notes.plugin.table.summary"))+"\n          ")]),t._v(" "),e("v-divider",{staticClass:"spacesOverviewHorizontalSeparator mx-2 ma-auto"})],1),t._v(" "),e("v-row",{attrs:{align:"center"}},[e("v-col",[e("v-text-field",{staticClass:"pa-0",attrs:{placeholder:t.$t("notes.plugin.table.summaryPlaceholder"),dense:"","min-height":"",outlined:""},model:{value:t.summary,callback:function(e){t.summary=e},expression:"summary"}})],1)],1),t._v(" "),e("div",{staticClass:"accessibility-text d-flex"},[e("div",{staticClass:"btn-accessibility me-2"},[e("v-icon",{staticClass:"primary v-btn--round",attrs:{size:"18"}},[t._v("mdi-human")])],1),t._v(" "),e("span",{staticClass:"caption text-light-color font-italic"},[t._v(t._s(t.$t("notes.plugin.table.summaryText")))])])],1)],1),t._v(" "),e("template",{slot:"footer"},[e("div",{staticClass:"d-flex"},[e("v-spacer"),t._v(" "),e("div",{staticClass:"VuetifyApp d-flex"},[e("div",{staticClass:"d-btn"},[e("v-btn",{staticClass:"btn mr-2",on:{click:t.close}},[[t._v("\n                "+t._s(t.$t("notes.button.cancel"))+"\n              ")]],2),t._v(" "),e("v-btn",{staticClass:"btn btn-primary",on:{click:t.insertTable}},[[t._v("\n                "+t._s(t.$t("notes.button.ok"))+"\n              ")]],2)],1)])],1)])],2)],1)};l._withStripped=!0;const c=i({data:()=>({limit:0,maxRules:[],lines:1,columns:1,width:500,height:25,border:1,spacing:1,internal:0,alignmentSelected:"",table:"",countIdTable:1,summary:"",alignment:[{name:""},{name:"left"},{name:"center"},{name:"right"}],headerSelected:"",header:[{name:""},{name:"FIRST.ROW"},{name:"FIRST.COLUMN"},{name:"BOTH"}],closeAll:!0,drawer:!1}),props:{instance:{type:Object,default:()=>null}},created(){this.maxRules=[t=>t>=0],this.$root.$on("note-table-plugins",(()=>{this.closeAll=!0}))},methods:{open(t,e){this.table=t,t&&(this.width=t.width,this.height=t.height,this.border=t.border,this.internal=t.cellpadding,this.spacing=t.cellspacing,this.alignmentSelected=t.align,this.headerSelected=t.tHead,e&&(this.summary=e)),this.$refs.customTableDrawer.open()},close(){this.$refs.customTableDrawer.close()},closeAllDrawer(){this.closeAll&&this.$emit("closed")},backToPlugins(){this.closeAll=!1},insertTable(){this.close(),this.addTable()},addTable(){if(this.table){this.instance.elementPath().contains("table",1).setAttribute("width",this.width),this.instance.elementPath().contains("table",1).setAttribute("height",this.height),this.instance.elementPath().contains("table",1).setAttribute("border",this.border),this.instance.elementPath().contains("table",1).setAttribute("cellPadding",this.internal),this.instance.elementPath().contains("table",1).setAttribute("cellSpacing",this.spacing),this.instance.elementPath().contains("table",1).setAttribute("align",this.alignmentSelected),this.instance.elementPath().contains("table",1).setAttribute("tHead",this.headerSelected),this.instance.elementPath().contains("table",1).setAttribute("summary",this.summary);this.instance.elementPath().contains("div",1).$.firstChild.innerText=this.summary,this.$root.$emit("updateData",this.instance.getData())}else{const t=document.createElement("DIV"),e=document.createElement("DIV"),s=Math.random().toString(16).slice(2);e.setAttribute("id",`table-${s}`);const n=document.createElement("TABLE"),i=document.createElement("p");i.setAttribute("id",`summary-${s}`),i.appendChild(document.createTextNode(this.summary)),i.style.display="none";const o=`table${this.countIdTable}`;n.setAttribute("id",o),e.appendChild(i),e.appendChild(n),t.appendChild(e),n.setAttribute("width",this.width),n.setAttribute("border",this.border),n.setAttribute("cellPadding",this.internal),n.setAttribute("height",this.height),n.setAttribute("cellSpacing",this.spacing),n.setAttribute("align",this.alignmentSelected),n.setAttribute("tHead",this.headerSelected);const a=document.createElement("TBODY");n.appendChild(a);for(let t=0;t<this.lines;t++){const t=document.createElement("TR");a.appendChild(t);for(let e=0;e<this.columns;e++){const e=document.createElement("TD"),s=0!==this.columns?this.width/Math.abs(this.columns):this.width,n=0!==this.lines?this.height/Math.abs(this.lines):this.height;e.width=s.toString(),e.height=n.toString(),t.appendChild(e)}}this.instance.insertHtml(t.innerHTML);const r=`#${o} br`,l=CKEDITOR.instances.notesContent.document.find(r);for(let t=0;t<l.$.length;t++)l.$[t].remove();this.countIdTable+=1}}}},l,[],!1,null,null,null).exports;var d=function(){var t=this,e=t._self._c;return e("div",[e("v-overlay",{attrs:{"z-index":"1031",value:t.drawer},nativeOn:{click:function(e){t.drawer=!1}}}),t._v(" "),e("exo-drawer",{ref:"breadcrumbDrawer",staticClass:"breadcrumbDrawer",attrs:{"confirm-close":t.exporting,"confirm-close-labels":t.confirmCloseLabels,"show-overlay":"",right:""},on:{closed:function(e){return t.closeAllDrawer()}},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[t.isIncludePage&&t.displayArrow?e("template",{slot:"title"},[e("div",{staticClass:"d-flex"},[e("v-icon",{attrs:{size:"19"},on:{click:function(e){t.backToPlugins(),t.close()}}},[t._v("mdi-arrow-left")]),t._v(" "),e("span",{staticClass:"ps-2"},[t._v(t._s(t.$t("notes.label.includePageTitle")))])],1)]):t.movePage?e("template",{slot:"title"},[t._v("\n      "+t._s(t.$t("notes.label.movePageTitle"))+"\n    ")]):t.exportNotes?e("template",{slot:"title"},[t._v("\n      "+t._s(t.$t("notes.label.exportNotesTitle"))+"\n    ")]):e("template",{slot:"title"},[t._v("\n      "+t._s(t.$t("notes.label.breadcrumbTitle"))+"\n    ")]),t._v(" "),t.exporting?e("template",{slot:"content"},[e("v-card",{staticClass:"pa-2 mt-10",attrs:{flat:""}},[e("v-list",[e("v-list-item",[[e("v-list-item-action",{staticClass:"mr-3"},[t.exportStatus.action.started?e("v-icon",{attrs:{color:"success",size:"18"}},[t._v("\n                  fa-check\n                ")]):t._e(),t._v(" "),t.exportStatus.action.started?t._e():e("v-progress-circular",{attrs:{color:"primary",indeterminate:"",size:"18"}})],1),t._v(" "),e("v-list-item-content",[e("v-list-item-title",[t._v(t._s(t.$t("notes.export.status.label.started")))])],1)]],2),t._v(" "),e("v-list-item",[[e("v-list-item-action",{staticClass:"mr-3"},[t.exportStatus.action.notesGetted?e("v-icon",{attrs:{color:"success",size:"18"}},[t._v("\n                  fa-check\n                ")]):t._e(),t._v(" "),t.exportStatus.action.notesGetted?t._e():e("v-progress-circular",{attrs:{color:"primary",indeterminate:"",size:"18"}})],1),t._v(" "),e("v-list-item-content",[t.exportStatus.exportedNotesCount>0?e("v-list-item-title",[t._v(" "+t._s(t.$t("notes.export.status.label.preparingNotes"))+" ("+t._s(t.exportStatus.exportedNotesCount)+" notes)")]):e("v-list-item-title",[t._v(" "+t._s(t.$t("notes.export.status.label.preparingNotes")))])],1)]],2),t._v(" "),e("v-list-item",[[e("v-list-item-action",{staticClass:"mr-3"},[t.exportStatus.action.notesPrepared?e("v-icon",{attrs:{color:"success",size:"18"}},[t._v("\n                  fa-check\n                ")]):t._e(),t._v(" "),t.exportStatus.action.notesPrepared?t._e():e("v-progress-circular",{attrs:{color:"primary",indeterminate:"",size:"18"}})],1),t._v(" "),e("v-list-item-content",[e("v-list-item-title",[t._v(t._s(t.$t("notes.export.status.label.updatingNoteParents")))])],1)]],2),t._v(" "),e("v-list-item",[[e("v-list-item-action",{staticClass:"mr-3"},[t.exportStatus.action.jsonCreated?e("v-icon",{attrs:{color:"success",size:"18"}},[t._v("\n                  fa-check\n                ")]):t._e(),t._v(" "),t.exportStatus.action.jsonCreated?t._e():e("v-progress-circular",{attrs:{color:"primary",indeterminate:"",size:"18"}})],1),t._v(" "),e("v-list-item-content",[e("v-list-item-title",[t._v(t._s(t.$t("notes.export.status.label.creatingJson")))])],1)]],2),t._v(" "),e("v-list-item",[[e("v-list-item-action",{staticClass:"mr-3"},[t.exportStatus.action.imageUrlsUpdated?e("v-icon",{attrs:{color:"success",size:"18"}},[t._v("\n                  fa-check\n                ")]):t._e(),t._v(" "),t.exportStatus.action.imageUrlsUpdated?t._e():e("v-progress-circular",{attrs:{color:"primary",indeterminate:"",size:"18"}})],1),t._v(" "),e("v-list-item-content",[e("v-list-item-title",[t._v(t._s(t.$t("notes.export.status.label.updatingImages")))])],1)]],2),t._v(" "),e("v-list-item",[[e("v-list-item-action",{staticClass:"mr-3"},[t.exportStatus.action.zipCreated?e("v-icon",{attrs:{color:"success",size:"18"}},[t._v("\n                  fa-check\n                ")]):t._e(),t._v(" "),t.exportStatus.action.zipCreated?t._e():e("v-progress-circular",{attrs:{color:"primary",indeterminate:"",size:"18"}})],1),t._v(" "),e("v-list-item-content",[e("v-list-item-title",[t._v(t._s(t.$t("notes.export.status.label.creatingZip")))])],1)]],2),t._v(" "),e("v-list-item",[[e("v-list-item-action",{staticClass:"mr-3"},[t.exportStatus.action.tempCleaned?e("v-icon",{attrs:{color:"success",size:"18"}},[t._v("\n                  fa-check\n                ")]):t._e(),t._v(" "),t.exportStatus.action.tempCleaned?t._e():e("v-progress-circular",{attrs:{color:"primary",indeterminate:"",size:"18"}})],1),t._v(" "),e("v-list-item-content",[e("v-list-item-title",[t._v(t._s(t.$t("notes.export.status.label.cleaningTemps")))])],1)]],2),t._v(" "),e("v-list-item",[[e("v-list-item-action",{staticClass:"mr-3"},[t.exportStatus.action.dataCreated?e("v-icon",{attrs:{color:"success",size:"18"}},[t._v("\n                  fa-check\n                ")]):t._e(),t._v(" "),t.exportStatus.action.dataCreated?t._e():e("v-progress-circular",{attrs:{color:"primary",indeterminate:"",size:"18"}})],1),t._v(" "),e("v-list-item-content",[e("v-list-item-title",[t._v(t._s(t.$t("notes.export.status.label.done")))])],1)]],2)],1)],1)],1):t._e(),t._v(" "),t.exporting?t._e():e("template",{slot:"content"},[t.movePage?e("v-layout",{attrs:{column:""}},[e("v-list-item",[e("v-list-item-content",[e("v-list-item-title",{staticClass:"font-weight-bold text-color"},[t._v(t._s(t.note.name))])],1)],1),t._v(" "),e("v-list-item",[e("div",{staticClass:"d-flex align-center"},[e("div",{staticClass:"pr-4"},[e("span",{staticClass:"font-weight-bold text-color"},[t._v(t._s(t.$t("notes.label.movePageSpace")))])]),t._v(" "),e("div",{staticClass:"identitySuggester no-border mt-0"},[e("v-chip",{staticClass:"identitySuggesterItem me-2 mt-2"},[e("span",{staticClass:"text-truncate"},[t._v("\n                  "+t._s(t.spaceDisplayName)+"\n                ")])])],1)])]),t._v(" "),e("v-list-item",[e("div",{staticClass:"py-2 width-full"},[e("span",{staticClass:"font-weight-bold text-color pb-2"},[t._v(t._s(t.$t("notes.label.movePageCurrentPosition")))]),t._v(" "),e("note-breadcrumb",{attrs:{"note-breadcrumb":t.note?t.note.breadcrumb:[]}})],1)]),t._v(" "),e("v-list-item",[e("div",{staticClass:"py-2 width-full"},[e("span",{staticClass:"font-weight-bold text-color pb-2"},[t._v(t._s(t.$t("notes.label.movePageDestination")))]),t._v(" "),e("note-breadcrumb",{attrs:{"note-breadcrumb":t.currentBreadcrumb}})],1)]),t._v(" "),e("v-list-item",{staticClass:"position-title"},[e("div",{staticClass:"py-2"},[e("span",{staticClass:"font-weight-bold text-color"},[t._v(t._s(t.$t("notes.label.movePagePosition")))])])])],1):t._e(),t._v(" "),e("v-col",{attrs:{column:""}},[t.exportNotes||t.movePage?t._e():e("v-row",[e("v-col",{staticClass:"my-auto"},[e("v-text-field",{staticClass:"search",attrs:{placeholder:t.$t("notes.label.filter"),clearable:"","font-size":"18","prepend-inner-icon":"fa-filter"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),t._v(" "),e("v-col",{staticClass:"filter",attrs:{cols:"4"}},[e("div",{staticClass:"btn-group"},[e("button",{staticClass:"btn dropdown-toggle",attrs:{"data-toggle":"dropdown"}},[t._v("\n                "+t._s(t.filter)+"\n                "),e("i",{staticClass:"uiIconMiniArrowDown uiIconLightGray"}),e("span")]),t._v(" "),e("ul",{staticClass:"dropdown-menu"},[e("li",[e("a",{attrs:{href:"#"},on:{click:function(e){t.filter=t.filterOptions[0]}}},[t._v(" "+t._s(t.filterOptions[0])+" ")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#"},on:{click:function(e){t.filter=t.filterOptions[1]}}},[t._v(" "+t._s(t.filterOptions[1])+" ")])])])])])],1),t._v(" "),t.home&&!t.exportNotes&&t.resultSearch&&!t.search?[e("v-list-item",{staticClass:"ma-0 border-box-sizing",on:{click:function(e){return e.preventDefault(),t.openNote(t.event,t.home)}}},[e("v-list-item-content",[e("v-list-item-title",{staticClass:"body-2 treeview-home-link"},[t.filter===t.$t("notes.filter.label.drafts")?e("span",{style:{color:"rgba(0, 0, 0, 0.38)!important",cursor:"default"}},[t._v(t._s(t.home.name))]):e("a",{attrs:{href:t.home.noteId}},[t._v(t._s(t.home.name))])])],1)],1)]:t._e(),t._v(" "),t.items&&t.items.length&&t.exportNotes?[e("v-checkbox",{staticClass:"checkbox mt-0 pl-3",attrs:{label:t.selectExportLabel},model:{value:t.checkbox,callback:function(e){t.checkbox=e},expression:"checkbox"}}),t._v(" "),t.reload?e("v-treeview",{ref:"treeSearch",staticClass:"treeview-item",attrs:{items:t.allItemsHome,open:t.openLevel,"item-key":"noteId",hoverable:"",selectable:"",activatable:"","open-on-click":"","selection-type":t.selectionType,transition:""},on:{"update:open":function(e){t.openLevel=e}},model:{value:t.selectionNotes,callback:function(e){t.selectionNotes=e},expression:"selectionNotes"}}):t._e()]:t._e(),t._v(" "),t.items&&t.items.length&&!t.exportNotes?[t.reload?e("v-treeview",{staticClass:"treeview-item",attrs:{items:t.items,open:t.openedItems,active:t.active,search:t.search,"item-key":"noteId",hoverable:"",activatable:"","open-on-click":"",transition:""},scopedSlots:t._u([{key:"label",fn:function({item:s}){return[e("v-list-item-title",{staticClass:"body-2"},[t.filter!==t.$t("notes.filter.label.drafts")||s.draftPage?e("a",{style:{color:t.filter===t.$t("notes.filter.label.drafts")&&s.draftPage||!s.draftPage?"var(--allPagesBaseTextColor, #333333)":""},attrs:{href:s.draftPage?`${s.noteId}/draft`:s.noteId},on:{click:function(e){return e.preventDefault(),t.openNote(t.event,s)}}},[t._v("\n                  "+t._s(s.name)+"\n                ")]):e("div",{style:{cursor:"default"}},[t._v("\n                  "+t._s(s.name)+"\n                ")])])]}}],null,!1,3588449811)}):t._e()]:t._e(),t._v(" "),t.resultSearch?t._e():[e("div",{staticClass:"note-not-found-wrapper text-center mt-6"},[e("v-img",{staticClass:"mx-auto",attrs:{src:t.noteNotFountImage,"max-height":"85","max-width":"90",contain:"",eager:""}}),t._v(" "),e("p",{staticClass:"mt-3 text-light-color"},[t._v(t._s(t.$t("notes.label.noteSearchNotFound")+t.search))])],1)]],2)],1),t._v(" "),t.movePage?e("template",{slot:"footer"},[e("div",{staticClass:"d-flex"},[e("v-spacer"),t._v(" "),e("v-btn",{staticClass:"btn ml-2",on:{click:t.close}},[t._v("\n          "+t._s(t.$t("notes.button.cancel"))+"\n        ")]),t._v(" "),e("v-btn",{staticClass:"btn btn-primary ml-2",on:{click:function(e){return t.moveNote()}}},[t._v("\n          "+t._s(t.$t("notes.button.ok"))+"\n        ")])],1)]):t._e(),t._v(" "),t.exportNotes?e("template",{slot:"footer"},[e("div",{staticClass:"d-flex"},[e("v-spacer"),t._v(" "),e("v-btn",{staticClass:"btn ml-2",on:{click:t.close}},[t._v("\n          "+t._s(t.$t("notes.button.cancel"))+"\n        ")]),t._v(" "),e("v-btn",{staticClass:"btn btn-primary ml-2",attrs:{disabled:t.exporting},on:{click:function(e){return t.exportNotesToZip()}}},[t._v("\n          "+t._s(t.$t("notes.button.export"))+"\n        ")])],1)]):t._e()],2)],1)};d._withStripped=!0;const h={"notes-editor-dashboard":o,"note-custom-plugins":r,"note-treeview-drawer":i({data:()=>({note:{},items:[],allItems:[],allItemsHome:[],home:{},noteBookType:"",noteBookOwnerTree:"",openNotes:[],activeItem:[],isIncludePage:!1,movePage:!1,exportNotes:!1,selectionNotes:[],spaceDisplayName:eXo.env.portal.spaceDisplayName,breadcrumb:[],destinationNote:{},displayArrow:!0,render:!0,closeAll:!0,drawer:!1,filter:"",filterOptions:[],checkbox:!1,showTree:!0,search:"",noteNotFountImage:"/notes/skin/images/notes_not_found.png",exportStatus:{status:"",action:{}},exporting:!1,started:!1,notesGetted:!1,parentUpdated:!1,jsonCreated:!1,imageUrlsUpdated:!1,zipCreated:!1,tempCleaned:!1,dataCreated:!1}),computed:{confirmCloseLabels(){return{title:this.$t("notes.confirmCancelExport.title"),message:this.$t("notes.confirmCancelExport"),ok:this.$t("notes.button.yes"),cancel:this.$t("notes.button.no")}},openedItems(){return this.openNotes},active(){return this.search&&this.allItems&&this.allItems.filter((t=>t.name.toLowerCase().match(this.search.toLowerCase())))||this.activeItem},includePage(){return this.isIncludePage},currentBreadcrumb(){return this.breadcrumb},reload(){return this.render},resultSearch(){return this.showTree},selectExportLabel(){return!0===this.checkbox?this.$t("notes.label.export.deselectAll"):this.$t("notes.label.export.selectAll")},openLevel(){return[this.home.noteId]},selectionType(){return this.exportNotes?"independent":"leaf"}},watch:{search(){this.showTree=!0,this.search?(this.items=this.active,this.items.forEach((t=>{t.children=null})),this.showTree=!!this.active.length):this.retrieveNoteTree(this.note.wikiType,this.note.wikiOwner,this.note.name)},checkbox(){if(this.checkbox){const t=this.allItems.map((t=>t.noteId));this.selectionNotes=t,this.$refs.treeSearch.updateAll(!0)}else this.selectionNotes=[],this.$refs.treeSearch.updateAll(!1),this.open(this.home.noteId,"exportNotes")},filter(){this.note&&this.note.id&&(this.note.draftPage?this.getDraftNote(this.note.id):this.getNoteById(this.note.id))}},created(){this.$root.$on("refresh-treeView-items",(t=>{t.draftPage?this.getDraftNote(t.id):this.getNoteById(t.id)})),this.$root.$on("close-note-tree-drawer",(()=>{this.close()})),this.$root.$on("display-treeview-items",(()=>{this.closeAll=!0}))},mounted(){this.filterOptions=[this.$t("notes.filter.label.published.notes"),this.$t("notes.filter.label.drafts")],this.filter=this.filterOptions[0]},methods:{open(t,e,s,n){this.render=!1,t.draftPage?(this.filter="published"===n&&this.filterOptions[0]||this.filterOptions[1],this.getDraftNote(t.id)):(this.filter="draft"===n&&this.filterOptions[1]||this.filterOptions[0],this.getNoteById(t.id)),this.isIncludePage="includePages"===e,this.displayArrow=!s,"movePage"===e?(this.movePage=!0,this.exportNotes=!1):"exportNotes"===e?(this.exportNotes=!0,this.movePage=!1):(this.movePage=!1,this.exportNotes=!1),this.$nextTick().then((()=>{this.$forceUpdate(),this.render=!0,this.$refs.breadcrumbDrawer.open()}))},backToPlugins(){this.closeAll=!1},openNote(t,e){if((this.filter!==this.$t("notes.filter.label.drafts")||this.filter===this.$t("notes.filter.label.drafts")&&e.draftPage)&&e.noteId!==this.note.id)if(this.filter=this.filterOptions[0],this.activeItem=[e.noteId],this.includePage)this.$root.$emit("include-page",e),this.$refs.breadcrumbDrawer.close();else if(this.movePage)e.noteId!==this.note.id?this.$notesService.getNoteById(e.noteId,"","","",!0).then((t=>{this.breadcrumb=t&&t.breadcrumb||[],this.breadcrumb[0].name=this.$t("notes.label.noteHome"),this.destinationNote=t})):Object.assign(this.destinationNote,this.note);else{const t=e.draftPage?e.noteId:e.path.split("%2F").pop();this.$root.$emit("open-note-by-name",t,e.draftPage),this.$refs.breadcrumbDrawer.close()}else this.$refs.breadcrumbDrawer.close()},getNoteById(t){if(t)return this.$notesService.getNoteById(t).then((t=>{this.note=t||[],this.note.breadcrumb[0].title=this.$t("notes.label.noteHome"),this.breadcrumb=this.note.breadcrumb})).then((()=>{"group"===this.note.wikiType&&(this.note.wikiOwner=this.note.wikiOwner.substring(1)),this.retrieveNoteTree(this.note.wikiType,this.note.wikiOwner,this.note.name)}))},getDraftNote(t){if(t)return this.$notesService.getDraftNoteById(t).then((t=>{this.note=t||[],this.note.breadcrumb[0].title=this.$t("notes.label.noteHome"),this.breadcrumb=this.note.breadcrumb})).then((()=>{"group"===this.note.wikiType&&(this.note.wikiOwner=this.note.wikiOwner.substring(1)),this.retrieveNoteTree(this.note.wikiType,this.note.wikiOwner,this.note.parentPageName)}))},retrieveNoteTree(t,e,s){const n=this.filter===this.$t("notes.filter.label.drafts");this.$notesService.getFullNoteTree(t,e,s,n).then((s=>{s&&s.jsonList.length&&(this.home=[],this.items=[],this.allItems=[],this.allItemsHome=[],this.home=s.treeNodeData.length?s.treeNodeData[0]:s.jsonList[0],this.items=s.treeNodeData&&s.treeNodeData[0]&&s.treeNodeData[0].children||[],this.allItems=s.jsonList,this.allItemsHome=s.treeNodeData);const n=this.getOpenedTreeViewItems(this.note.breadcrumb);this.openNotes=[],this.openNotes=n,this.activeItem=[],this.activeItem=[n[n.length-1]],this.noteBookType=t,this.noteBookOwnerTree=e}))},getOpenedTreeViewItems(t){const e=[];if(this.filter===this.$t("notes.filter.label.drafts")){const t=this.allItems.filter((t=>!t.draftPage)).map((t=>t.noteId));e.push(...t)}else for(let s=1;s<t.length;s++)e.push(t[s].noteId);return e},moveNote(){this.note.id!==this.destinationNote.id&&this.note.parentPageId!==this.destinationNote.id&&this.$root.$emit("move-page",this.note,this.destinationNote)},exportNotesToZip(){this.$root.$emit("export-notes",this.selectionNotes,this.checkbox,this.home.noteId),this.exporting=!0},resetImport(){this.checkbox=!1,this.selectionNotes=[]},close(){this.render=!1,this.$refs.breadcrumbDrawer.close(),this.exporting&&(this.$root.$emit("cancel-export-notes"),this.exportStatus={},this.exporting=!1,this.resetImport())},closeAllDrawer(){$(".spaceButtomNavigation").removeClass("hidden"),this.search="",this.exporting&&(this.$root.$emit("cancel-export-notes"),this.exportStatus={},this.exporting=!1,this.resetImport()),this.closeAll&&this.$emit("closed")},setExportStaus(t){this.exportStatus=t,this.exportStatus.status&&"ZIP_CREATED"!==this.exportStatus.status||(this.exporting=!1,this.$nextTick().then((()=>this.close())))}}},d,[],!1,null,null,null).exports,"note-table-plugins-drawer":c};for(const t in h)Vue.component(t,h[t]);eXo.env.portal;const p=eXo.env.portal.context||"",u=(eXo.env.portal.portalName,eXo.env.portal.context,eXo.env.server.portalBaseURL,eXo.env.portal.rest);eXo.env.portal.containerName,eXo.env.portal.language;function m(t,e,s,n){let i=`${p}/${u}/notes/note/${t}/${e}/${s}`;return n&&(i=`${i}?source=${n}`),fetch(i,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function v(t){return fetch(`${p}/${u}/notes/draftNote/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function g(t){return fetch(`${p}/${u}/notes/latestDraftNote/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function f(t,e,s,n,i){let o=`${p}/${u}/notes/note/${t}`;return e&&(o=`${o}${b(o)}source=${e}`),s&&(o=`${o}${b(o)}noteBookType=${s}`),n&&(o=`${o}${b(o)}noteBookOwner=${n}`),i&&(o=`${o}${b(o)}withChildren=${i}`),fetch(o,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function b(t){return-1!==t.indexOf("?")?"&":"?"}function w(t,e,s,n){return fetch(`${p}/${u}/notes/tree/${n}?path=${t}/${e}/${s}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function _(t,e,s,n){return fetch(`${p}/${u}/notes/tree/full?path=${t}/${e}/${s}&withDrafts=${n}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}function C(t){return fetch(`${p}/${u}/notes/note`,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",credentials:"include",body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.json();throw 409===t.status?new Error("error.duplicate.title",t):new Error("error",t)}))}function x(t,e){return e&&(t.parentPageId=e),fetch(`${p}/${u}/notes/saveDraft`,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",credentials:"include",body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.json();throw 409===t.status?new Error("error.duplicate.title",t):new Error("error",t)}))}function y(t){return fetch(`${p}/${u}/notes/note/${t.wikiType}/${t.wikiOwner}/${t.name}`,{headers:{"Content-Type":"application/json"},credentials:"include",method:"PUT",body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.json();throw 409===t.status?new Error("error.duplicate.title",t):new Error("error",t)}))}function I(t){return fetch(`${p}/${u}/notes/note/${t.id}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.json();throw 409===t.status?new Error("error.duplicate.title",t):new Error("error",t)}))}function N(t,e){return fetch(`${p}/${u}/notes/restore/${e}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((t=>{if(t&&t.ok)return t.json();throw 409===t.status?new Error("error.duplicate.title",t):new Error("error",t)}))}function T(t,e){if(e||(e="notes"),"group"===t.wikiType){const s=t.wikiOwner.split("/spaces/")[1],n=t.url.split(`/portal/g/:spaces:${s}/`)[1].split("/")[0];return`${eXo.env.portal.context}/g/:spaces:${s}/${n}/${e}/${t.id}`}return`${eXo.env.portal.context}/${eXo.env.portal.portalName}/notes/${t.id}`}function k(t){return fetch(`${p}/${u}/notes/note/${t.id}`,{credentials:"include",method:"DELETE"}).then((t=>{if(t&&t.ok)return t;throw new Error("Error when deleting notes")}))}function P(t){return fetch(`${p}/${u}/notes/draftNote/${t.id}`,{credentials:"include",method:"DELETE"}).then((t=>{if(t&&t.ok)return t;throw new Error("Error when deleting draft")}))}function S(t,e){return fetch(`${p}/${u}/notes/note/move/${t.id}/${e.id}`,{credentials:"include",method:"PATCH"}).then((t=>{if(t&&t.ok)return t;throw new Error("Error when moving notes")}))}function D(t,e,s){return fetch(`${p}/${u}/notes/note/import/${t}/${e}?conflict=${s}`,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",credentials:"include"}).then((t=>{if(t&&t.ok)return t;throw new Error("error",t)}))}function E(t,e,s){fetch(`${p}/${u}/notes/note/export/${s}/${t}?exportAll=${e}`,{credentials:"include",method:"GET"}).then((t=>{if(!t||!t.ok)throw new Error("error",t)}))}function O(t){return fetch(`${p}/${u}/notes/note/export/zip/${t}`,{credentials:"include",method:"GET"}).then((t=>{if(t&&t.ok)return t;throw new Error("Error when getting exported notes")}))}function A(t){return fetch(`${p}/${u}/notes/note/export/status/${t}`,{credentials:"include",method:"GET"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error when getting export status")}))}function R(t){return fetch(`${p}/${u}/notes/note/export/cancel/${t}`,{credentials:"include",method:"GET"}).then((t=>{if(!t||!t.ok)throw new Error("error",t)}))}function B(t){return fetch(`${p}/${u}/notes/versions/${t}`,{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Response code indicates a server error",t)}))}if(extensionRegistry){const t=extensionRegistry.loadComponents("notesEditor");t&&t.length>0&&t.forEach((t=>{Vue.component(t.componentName,t.componentOptions)}))}Vue.use(Vuetify);const L=new Vuetify(eXo.env.portal.vuetifyPreset),j="notesEditorApplication",K=eXo&&eXo.env.portal.language||"en",z=`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.portlet.notes.notesPortlet-${K}.json`;function F(){exoi18n.loadLanguageAsync(K,z).then((t=>{Vue.createApp({template:`<notes-editor-dashboard id="${j}" />`,vuetify:L,i18n:t},`#${j}`,"Notes Editor Dashboard")}))}return Vue.prototype.$notesService||window.Object.defineProperty(Vue.prototype,"$notesService",{value:s}),e})()));