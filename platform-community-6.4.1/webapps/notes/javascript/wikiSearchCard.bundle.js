define((()=>(()=>{"use strict";var t={d:(e,r)=>{for(var i in r)t.o(r,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:r[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{formatSearchResult:()=>o});var r=function(){var t=this,e=t._self._c;return e("v-card",{staticClass:"wikiSearchCard d-flex flex-column border-radius box-shadow",attrs:{flat:"","min-height":"227"}},[e("exo-notes-favorite-action",{attrs:{note:t.result,absolute:"",top:"0",right:"0"},on:{removed:function(e){return t.$emit("refresh-favorite")}}}),t._v(" "),t.poster?e("v-card-text",{staticClass:"px-2 pt-2 pb-0"},[e("exo-user-avatar",{attrs:{"profile-id":t.posterUsername,popover:""}},[e("template",{slot:"subTitle"},[e("date-format",{attrs:{value:t.createdDate}})],1)],2)],1):t._e(),t._v(" "),e("div",{staticClass:"mx-auto d-flex flex-grow-1 px-3 py-0 overflow-hidden"},[e("div",{ref:"excerptNode",staticClass:"text-wrap text-break caption flex-grow-1",attrs:{title:t.excerptText}})]),t._v(" "),e("v-list",{staticClass:"light-grey-background flex-grow-0 border-top-color no-border-radius pa-0"},[e("v-list-item",{staticClass:"px-0 pt-1 pb-2",attrs:{href:t.wikiUrl}},[e("v-list-item-icon",{staticClass:"mx-0 my-auto"},[e("span",{staticClass:"uiIconWiki tertiary--text ps-1 pe-2 display-1"})]),t._v(" "),e("v-list-item-content",[e("v-list-item-title",{attrs:{title:t.wikiTitle}},[e("a",{staticClass:"wikiTitle px-3 pt-2 pb-1 ps-0 text-start text-truncate",attrs:{title:t.wikiTitleText},domProps:{innerHTML:t._s(t.wikiTitle)}})]),t._v(" "),e("v-list-item-subtitle",[t.spaceDisplayName?[t._v("\n            "+t._s(t.spaceDisplayName)+"\n          ")]:t._e()],2)],1)],1)],1)],1)};r._withStripped=!0;function i(t,e,r,i,s,a,n,o){var l,p="function"==typeof t?t.options:t;if(e&&(p.render=e,p.staticRenderFns=r,p._compiled=!0),i&&(p.functional=!0),a&&(p._scopeId="data-v-"+a),n?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(n)},p._ssrRegister=l):s&&(l=o?function(){s.call(this,(p.functional?this.parent:this).$root.$options.shadowRoot)}:s),l)if(p.functional){p._injectStyles=l;var c=p.render;p.render=function(t,e){return l.call(e),c(t,e)}}else{var d=p.beforeCreate;p.beforeCreate=d?[].concat(d,l):[l]}return{exports:t,options:p}}const s=i({props:{term:{type:String,default:null},result:{type:Object,default:null}},data:()=>({lineHeight:22}),computed:{wikiUrl(){return this.result&&this.result.url},excerpts(){return this.result&&this.result.excerpt},excerptHtml(){return this.excerpts&&this.excerpts.concat("\r\n...")},excerptText(){return $("<div />").html(this.excerptHtml).text()},createdDate(){return this.result&&this.result.createdDate},wikiTitle(){return this.result&&this.result.title||""},wikiTitleText(){return $("<div />").html(this.wikiTitle).text()},poster(){return this.result&&this.result.poster.profile},posterUsername(){return this.poster&&this.poster.username},wikiOwner(){return this.result&&this.result.wikiOwner&&this.result.wikiOwner.space||this.result.wikiOwner&&this.result.wikiOwner.profile},spaceDisplayName(){return this.wikiOwner&&this.wikiOwner.displayName}},mounted(){this.computeEllipsis()},methods:{computeEllipsis(){if(!this.excerptHtml||0===this.excerptHtml.length)return;const t=this.$refs.excerptNode;if(!t)return;t.innerHTML=this.excerptHtml;let e=20,r=t.getBoundingClientRect().height||this.lineHeight;if(r>this.maxEllipsisHeight){for(;r>this.maxEllipsisHeight;){const i=this.deleteLastChars(t.innerHTML.replace(/&[a-z]*;/,""),e),s=t.innerHTML.length;t.innerHTML=i,t.innerHTML.length===s&&(e*=2),r=t.getBoundingClientRect().height||this.lineHeight}t.innerHTML=this.deleteLastChars(t.innerHTML,4),t.innerHTML=`${t.innerHTML}...`}},deleteLastChars(t,e){">"===t.slice(-1)&&(t=t.replace(/<[a-zA-Z 0-9 "'=]*><\/[a-zA-Z 0-9]*>$/g,"")),e=e||1;let r="";return">"===(t=t.replace(/<br>(\.*)$/g,"")).slice(-1)?(r=(t=t.replace(/(<br>)*$/g,"")).replace(new RegExp(`([^>]{${e}})(</)([a-zA-Z 0-9]*)(>)$`),"$2$3"),r=$("<div />").html(r).html().replace(/&[a-z]*;/,""),r.length===t.length&&(r=t.replace(new RegExp("([^>]*)(</)([a-zA-Z 0-9]*)(>)$"),"$2$3"))):r=t.substring(0,t.trimRight().length-e),r}}},r,[],!1,null,null,null).exports;var a=function(){var t=this;return(0,t._self._c)("favorite-button",{key:t.note.id,attrs:{id:t.note.id,favorite:t.isFavorite,absolute:t.absolute,top:t.top,right:t.right,"space-id":t.spaceId,"template-params":t.templateParams,small:!1,type:"notes","type-label":"notes"},on:{removed:t.removed,"remove-error":t.removeError,added:t.added,"add-error":t.addError}})};a._withStripped=!0;const n={"wiki-search-card":s,"exo-notes-favorite-action":i({props:{note:{type:Object,default:null},absolute:{type:Boolean,default:!1},top:{type:Number,default:()=>0},right:{type:Number,default:()=>0}},data:()=>({spaceId:eXo.env.portal.spaceId,templateParams:{}}),computed:{isFavorite(){return this.note.metadatas&&this.note.metadatas.favorites&&this.note.metadatas.favorites.length}},watch:{note(){this.note&&(this.templateParams.page_id=this.note.id)}},methods:{removed(){this.displayAlert(this.$t("Favorite.tooltip.SuccessfullyDeletedFavorite")),this.$emit("removed")},removeError(){this.displayAlert(this.$t("Favorite.tooltip.ErrorDeletingFavorite","note"),"error")},added(){this.displayAlert(this.$t("Favorite.tooltip.SuccessfullyAddedAsFavorite")),this.$emit("added")},addError(){this.displayAlert(this.$t("Favorite.tooltip.ErrorAddingAsFavorite","note"),"error")},displayAlert(t,e){document.dispatchEvent(new CustomEvent("notification-alert",{detail:{message:t,type:e||"success"}}))}}},a,[],!1,null,null,null).exports};for(const t in n)Vue.component(t,n[t]);if(extensionRegistry){const t=extensionRegistry.loadComponents("WikiSearchCard");t&&t.length>0&&t.forEach((t=>{Vue.component(t.componentName,t.componentOptions)}))}function o(t,e){return t&&t.jsonList&&t.jsonList.length&&(t=t.jsonList.map((t=>(t.title=t.title.replace(new RegExp(`(${e})`,"ig"),'<span class="searchMatchExcerpt">$1</span>'),t.excerpt=$("<div />").html(t.excerpt).text().replace(new RegExp(`(${e})`,"ig"),'<span class="searchMatchExcerpt">$1</span>'),t)))),t}return e})()));