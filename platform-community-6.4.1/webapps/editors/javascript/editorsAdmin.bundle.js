define((()=>(()=>{"use strict";var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:()=>m});var s=function(){var e=this,t=e._self._c;return t("v-app",{attrs:{id:"editors-admin"}},[t("v-container",{staticStyle:{width:"95%"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.error,expression:"error"}],staticClass:"alert alert-error"},[e._v("\n      "+e._s(e.i18n.te(`${e.errorResourceBase}.${e.error}`)?e.$t(`${e.errorResourceBase}.${e.error}`):e.error)+"\n    ")]),e._v(" "),t("v-row",[t("v-col",{staticClass:"pb-0",attrs:{xs12:"","px-3":""}},[t("h3",{staticClass:"editorsTitle"},[t("span",{staticClass:"me-3"},[e._v("\n            "+e._s(e.$t("editors.admin.title"))+"\n          ")])])])],1),e._v(" "),t("v-row",[t("v-col",{attrs:{xs12:""}},[t("v-simple-table",{staticClass:"uiGrid table table-hover table-striped providersTable",attrs:{dense:!0},scopedSlots:e._u([{key:"default",fn:function(){return[t("thead",[t("tr",{staticClass:"providersTableRow"},[t("th",{staticClass:"text-start"},[e._v(e._s(e.$t("editors.admin.table.Provider")))]),e._v(" "),t("th",{staticClass:"text-start"},[e._v(e._s(e.$t("editors.admin.table.Description")))]),e._v(" "),t("th",{staticClass:"text-start",staticStyle:{width:"5%"}},[e._v(e._s(e.$t("editors.admin.table.Active")))]),e._v(" "),t("th",{staticClass:"text-start",staticStyle:{width:"5%"}},[e._v(e._s(e.$t("editors.admin.table.Permissions")))])])]),e._v(" "),e.providers.length>0?t("tbody",e._l(e.providers,(function(s){return t("tr",{key:s.provider,staticClass:"providersTableRow"},[t("td",[t("div",[e._v("\n                    "+e._s(e.i18n.te(`editors.admin.${s.provider}.name`)?e.$t(`editors.admin.${s.provider}.name`):s.provider)+"\n                  ")])]),e._v(" "),t("td",[t("div",[e._v("\n                    "+e._s(e.i18n.te(`editors.admin.${s.provider}.description`)?e.$t(`editors.admin.${s.provider}.description`):"")+"\n                  ")])]),e._v(" "),t("td",{staticClass:"center actionContainer"},[t("div",[t("v-switch",{staticClass:"providersSwitcher",attrs:{"input-value":s.active,ripple:!1,color:"#568dc9"},on:{change:function(t){return e.changeActive(s)}}})],1)]),e._v(" "),t("td",{staticClass:"center actionContainer"},[t("edit-dialog",{attrs:{"provider-name":s.provider,"provider-link":s.links.self.href,"search-url":e.services.identities,i18n:e.i18n}})],1)])})),0):e._e()]},proxy:!0}])})],1)],1)],1)],1)};async function i(e){try{const t=await fetch(e,{headers:{"Content-Type":"application/json"},method:"GET"});return t.ok?t.json():t.json().then((e=>{throw a(`Error writing data: ${e.errorMessage?e.errorMessage:e.errorCode}`),new Error(e.errorCode)}))}catch(e){throw a(`Unable to get data: ${e.message}`),new Error("UnableGetData")}}async function r(e,t){try{const s=await fetch(e,{headers:{"Content-Type":"application/json"},method:"PUT",body:JSON.stringify(t)});return s.ok?s.text():s.json().then((e=>{throw a(`Error writing data: ${e.errorMessage?e.errorMessage:e.errorCode}`),new Error(e.errorCode)}))}catch(e){throw a(`Unable to post data: ${e.message}`),new Error("UnablePostData")}}function a(e,t){const s="[editorsAdmin] ",i=`--${(new Date).toISOString()}`;t?console.error(s+e+i,t):console.error(s+e+i)}s._withStripped=!0;var o=function(){var e=this,t=e._self._c;return t("v-dialog",{staticStyle:{"overflow-x":"hidden"},attrs:{"content-class":"edit-dialog",width:"500"},on:{"click:outside":function(t){e.showDialog=!1}},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t("a",e._g({staticClass:"actionIcon",attrs:{"data-placement":"bottom",rel:"tooltip","data-original-title":"Edit"}},s),[t("i",{staticClass:"uiIconEdit uiIconLightGray"})])]}}]),model:{value:e.showDialog,callback:function(t){e.showDialog=t},expression:"showDialog"}},[e._v(" "),t("v-card",{staticClass:"provider uiPopup"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.error,expression:"error"}],staticClass:"alert alert-error"},[e._v(e._s(e.$t(e.error)))]),e._v(" "),t("v-card-title",{staticClass:"headline popupHeader justify-space-between providerHeader mb-0"},[t("span",{staticClass:"PopupTitle popupTitle providerHeaderTitle"},[e._v(e._s(e.$t("editors.admin.modal.title")))]),e._v(" "),t("i",{staticClass:"uiIconClose providerHeaderClose",on:{click:e.closeDialog}})]),e._v(" "),t("v-card-text",{staticClass:"popupContent providerContent pa-4"},[t("v-container",{staticClass:"permissions px-0"},[t("v-row",{staticClass:"providerName ms-0"},[e._v("\n          "+e._s(e.i18n.te(`editors.admin.${e.providerName}.name`)?e.$t(`editors.admin.${e.providerName}.name`):e.providerName)+"\n        ")]),e._v(" "),t("v-row",{staticClass:"search"},[t("v-col",[t("label",{staticClass:"searchLabel"},[e._v(e._s(e.$t("editors.admin.modal.SearchLabel")))]),e._v(" "),t("v-autocomplete",{staticClass:"searchPermissions pt-0",attrs:{loading:e.searchLoading,items:e.searchResults,"search-input":e.search,"menu-props":{maxHeight:140},"return-object":"",color:"#333",flat:"","hide-no-data":"","hide-details":"","solo-inverted":"","hide-selected":"",chips:"",multiple:"",attach:"",dense:"",dark:"","item-text":"displayName","item-value":"id","append-icon":""},on:{"update:searchInput":function(t){e.search=t},"update:search-input":function(t){e.search=t},input:e.selectionChange},scopedSlots:e._u([{key:"selection",fn:function(s){return[t("v-chip",{staticClass:"chip--select-multi searchChip",attrs:{"input-value":s,close:"",light:"",small:""},on:{"click:close":function(t){return e.removeSelection(s.item)}}},[e._v("\n                  "+e._s(s.item.displayName)+"\n                ")])]}},{key:"item",fn:function({item:s,parent:i}){return[t("v-list-tile-avatar",[t("img",{staticClass:"permissionsItemAvatar",attrs:{src:s.avatarUrl}})]),e._v(" "),t("v-list-tile-content",{staticClass:"permissionsItemName"},[t("v-list-tile-title",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:i.genFilteredText(s.displayName),expression:"parent.genFilteredText(item.displayName)"}]})],1)]}}]),model:{value:e.selectedItems,callback:function(t){e.selectedItems=t},expression:"selectedItems"}})],1)],1),e._v(" "),t("v-row",[t("v-col",{staticClass:"permissionsContainer"},[t("div",{staticClass:"d-flex justify-space-between"},[t("label",{staticClass:"searchLabel ma-0"},[e._v(e._s(e.$t("editors.admin.modal.WithPermissions")))]),e._v(" "),t("div",{staticClass:"d-flex align-center"},[t("v-checkbox",{staticClass:"ma-0",attrs:{ripple:!1,color:"#476A9C",dense:"","data-test":"everybodyCheckbox"},model:{value:e.accessibleToAll,callback:function(t){e.accessibleToAll=t},expression:"accessibleToAll"}}),e._v(" "),t("label",{staticStyle:{color:"#333"}},[e._v(e._s(e.$t("editors.admin.modal.Everybody")))])],1)]),e._v(" "),e.accessibleToAll?e._e():t("v-row",[e.existingPermissions.length>0?t("v-col",[t("ul",{staticClass:"permissionsList ps-0"},e._l(e.existingPermissions,(function(s){return t("li",{key:s.id,class:["permissionsItem","permissionsItem--large","removed"===s.className?"permissionsItem--removed":""]},[t("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:i}){return[t("div",e._g({},i),[t("img",{staticClass:"permissionsItemAvatar permissionsItemAvatar--large",attrs:{src:s.avatarUrl}}),e._v(" "),t("span",{staticClass:"permissionsItemName"},[e._v(e._s(s.displayName))])])]}}],null,!0)},[e._v(" "),t("span",[e._v(e._s(s.id))])]),e._v(" "),t("i",{directives:[{name:"show",rawName:"v-show",value:e.existingPermissions.length>0&&s.displayName,expression:"existingPermissions.length > 0 && permission.displayName"}],staticClass:"uiIconDelete permissionsItemDelete",on:{click:function(t){return e.removePermission(s)}}})],1)})),0)]):t("v-col",{attrs:{cols:"12",md:"8"}},[t("label",[e._v(e._s(e.$t("editors.admin.modal.None")))])])],1)],1)],1)],1)],1),e._v(" "),t("v-card-actions",{staticClass:"dialogFooter footer justify-center pb-5"},[t("v-btn",{staticClass:"btn btn-primary dialogFooterBtn me-2",attrs:{text:"","data-test":"saveButton"},nativeOn:{click:function(t){return e.saveChanges.apply(null,arguments)}}},[e._v("\n        "+e._s(e.$t("editors.admin.buttons.Save"))+"\n      ")]),e._v(" "),t("v-btn",{staticClass:"btn dialogFooterBtn",attrs:{text:"","data-test":"cancelButton"},nativeOn:{click:function(t){return e.closeDialog.apply(null,arguments)}}},[e._v("\n        "+e._s(e.$t("editors.admin.buttons.Cancel"))+"\n      ")])],1)],1)],1)};function n(e,t,s,i,r,a,o,n){var l,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=s,c._compiled=!0),i&&(c.functional=!0),a&&(c._scopeId="data-v-"+a),o?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},c._ssrRegister=l):r&&(l=n?function(){r.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:r),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(e,t){return l.call(t),d(e,t)}}else{var v=c.beforeCreate;c.beforeCreate=v?[].concat(v,l):[l]}return{exports:e,options:c}}o._withStripped=!0;var l=n({props:{providerLink:{type:String,required:!0},providerName:{type:String,required:!0},searchUrl:{type:String,required:!0},i18n:{type:Object,required:!0}},data:()=>({searchLoading:!1,searchResults:[],search:null,selectedItems:[],existingPermissions:[],error:null,showDialog:!1,permissionChanges:[],accessibleToAll:!1}),watch:{search(e){return e&&e!==this.selectedItems&&this.querySelections(e)},async showDialog(e){if(e)try{const e=await i(this.providerLink);this.accessibleToAll=e.permissions.some((({id:e})=>"*"===e)),this.existingPermissions=e.permissions.filter((({displayName:e})=>null!==e)).map((e=>({...e,className:""})))}catch(e){this.error=e.message}}},methods:{async querySelections(e){this.searchLoading=!0;try{const t=await i(`${this.searchUrl}/${e}`);this.searchResults=t.identities.filter((({displayName:t})=>(t||"").toLowerCase().indexOf((e||"").toLowerCase())>-1)).filter((e=>!this.existingPermissions.map((e=>e.id)).includes(e.id))),this.searchLoading=!1}catch(e){this.error=e.message}},removeSelection(e){this.selectedItems=this.selectedItems.filter((({id:t})=>t!==e.id))},async saveChanges(){let e=this.existingPermissions.filter((e=>!this.permissionChanges.map((e=>e.id)).includes(e.id)));this.selectedItems&&(e=e.concat(this.selectedItems));const t=this.accessibleToAll?[{id:"*"}]:e.filter((({id:e})=>e.length>0)).map((({id:e})=>({id:e})));try{await r(this.providerLink,{permissions:t}),this.error=null,this.closeDialog()}catch(e){this.error=e.message}},closeDialog(){this.error=null,this.selectedItems=null,this.showDialog=!1},removePermission(e){this.permissionChanges.push(e),e.className="removed",this.selectedItems&&(this.selectedItems=this.selectedItems.filter((({id:t})=>t!==e.id)))},selectionChange(e){this.search="",e.length>0&&this.accessibleToAll&&(this.accessibleToAll=!1)}}},o,[],!1,null,null,null);const c=n({components:{EditDialog:l.exports},props:{services:{type:Object,required:!0},i18n:{type:Object,required:!0},language:{type:String,required:!0},resourceBundleName:{type:String,required:!0}},data:()=>({providers:[],switcher:!1,error:null}),created(){this.getProviders()},methods:{async getProviders(){try{const e=await i(this.services.providers);this.error=null,this.providers=e.editors;const t=this.providers.map((({provider:e})=>this.getProviderResources(e)));Promise.all(t).then((e=>{e.map((e=>{this.i18n.mergeLocaleMessage(this.language,e.getLocaleMessage(this.language))}))}))}catch(e){this.error=e.message}},getProviderResources(e){const t=`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.${e}.${this.resourceBundleName}-${this.language}.json`;return exoi18n.loadLanguageAsync(this.language,t)},async changeActive(e){try{await r(e.links.self.href,{active:!e.active}),this.error=null,this.providers.map((t=>{t.provider===e.provider&&(t.active=!e.active)}))}catch(e){this.error=e.message}}}},s,[],!1,null,null,null).exports;Vue.use(Vuetify);const d=new Vuetify(eXo.env.portal.vuetifyPreset),v=eXo&&eXo.env&&eXo.env.portal&&eXo.env.portal.language||"en",p=`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.portlet.EditorsAdmin-${v}.json`;function m(e){exoi18n.loadLanguageAsync(v,p).then((t=>{new Vue({render:s=>s(c,{props:{...e,i18n:t,language:v,resourceBundleName:"EditorsAdmin"}}),i18n:t,vuetify:d}).$mount("#editors-admin")}))}return t})()));