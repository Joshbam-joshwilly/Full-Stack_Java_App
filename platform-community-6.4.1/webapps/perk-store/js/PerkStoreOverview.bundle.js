define((()=>(()=>{"use strict";var t={d:(e,r)=>{for(var s in r)t.o(r,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:r[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{init:()=>f});var r=function(){var t=this,e=t._self._c;return t.hasProducts?e("div",{staticClass:"mx-0 d-flex flex-row mt-2"},[t._l(t.productsToDisplay,(function(r,s){return[s>0&&t.justifyBorders?e("v-spacer",{key:s}):t._e(),t._v(" "),e("v-hover",{key:r.id,scopedSlots:t._u([{key:"default",fn:function({hover:s}){return[e("v-card",{key:r.id,staticClass:"mx-auto",attrs:{elevation:s?3:0,"max-width":"33%",flat:""},on:{click:function(e){return t.openBuyModal(r)}}},[e("perk-store-product-detail",{staticClass:"width-fit-content",attrs:{product:r,"overview-display":!0,"wallet-deleted":t.walletDeleted,"hide-elevation":"","wallet-enabled":""},on:{buy:t.openBuyModal}})],1)]}}],null,!0)})]})),t._v(" "),t.selectedProduct?e("perk-store-buy-modal",{ref:"buyModal",attrs:{product:t.selectedProduct,symbol:t.symbol,"need-password":t.walletNeedPassword,"wallet-enabled":""}}):t._e(),t._v(" "),e("perk-store-alert"),t._v(" "),e("wallet-notification-alert")],2):t._e()};function s(t,e,r,s,a,i,o,n){var l,d="function"==typeof t?t.options:t;if(e&&(d.render=e,d.staticRenderFns=r,d._compiled=!0),s&&(d.functional=!0),i&&(d._scopeId="data-v-"+i),o?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),a&&a.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},d._ssrRegister=l):a&&(l=n?function(){a.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:a),l)if(d.functional){d._injectStyles=l;var u=d.render;d.render=function(t,e){return l.call(e),u(t,e)}}else{var c=d.beforeCreate;d.beforeCreate=c?[].concat(c,l):[l]}return{exports:t,options:d}}r._withStripped=!0;const a=s({data:()=>({loading:!0,wallet:null,symbol:null,selectedProduct:null,walletNeedPassword:!1,products:[]}),computed:{hasProducts(){return this.productsToDisplay?.length},justifyBorders(){return this.productsToDisplay.length>2},enabledProducts(){return this.products?.filter((t=>t.enabled&&!t.deleted&&(t.unlimited||t.totalSupply>t.purchased)))||[]},productsToDisplay(){return this.enabledProducts?.slice(0,3)||[]},walletDeleted(){return"DELETED"===this.wallet?.initializationState}},watch:{hasProducts(){this.hasProducts&&document.dispatchEvent(new CustomEvent("perk-store-products-loaded"))}},created(){this.init()},methods:{init(){this.getProductsList(),this.wallet=window?.walletSettings?.wallet,this.symbol=window?.walletSettings?.contractDetail?.symbol,this.walletNeedPassword=window?.walletSettings?.browserWalletExists&&!window?.walletSettings?.storedPassword},openBuyModal(t){this.selectedProduct=t,this.$nextTick().then((()=>this.$refs.buyModal.open()))},getProductsList(){return this.loading=!0,fetch("/portal/rest/perkstore/api/product",{method:"GET",credentials:"include"}).then((t=>{if(t&&t.ok)return t.json();throw new Error("Error getting products list")})).then((t=>this.products=t)).finally((()=>this.loading=!1))}}},r,[],!1,null,null,null).exports;var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"perkStoreDetailContent"},[e("v-card",{staticClass:"productDetailContentCard",attrs:{"max-width":t.overviewDisplay?"100":t.cardHeight,"max-height":t.overviewDisplay?"100":"",elevation:"0",outlined:""}},[e("v-carousel",{staticClass:"carousselParent",attrs:{"show-arrows":!1,interval:3e3,continuous:!t.showMenu,height:t.overviewDisplay?"40":t.carousselHeight,width:t.overviewDisplay?"70":"","hide-delimiters":"",cycle:""}},[t.product.imageFiles?t._l(t.product.imageFiles,(function(r,s){return e("v-carousel-item",{key:s,staticClass:"carousselImage",attrs:{src:r.src,max:"300"}},[t.overviewDisplay?t._e():e("v-toolbar",{staticClass:"toolbarCard",attrs:{color:"transparent",flat:""}},[e("v-spacer"),t._v(" "),t.isProductOwner?e("v-menu",{attrs:{"offset-x":"","offset-y":"",left:t.rtlDisplay,attach:""},scopedSlots:t._u([{key:"activator",fn:function({on:r}){return[e("v-btn",t._g({staticClass:"productCardAction mr-0",attrs:{dark:"",icon:""},on:{blur:t.closeMenu}},r),[e("v-icon",[t._v("mdi-dots-vertical")])],1)]}}],null,!0),model:{value:t.showMenu,callback:function(e){t.showMenu=e},expression:"showMenu"}},[t._v(" "),e("v-list",{staticClass:"pa-0 ma-0"},[t.userData.canEdit?e("v-list-item",{staticClass:"editLabelProduct",on:{mousedown:function(t){return t.preventDefault()}}},[e("v-list-item-title",{staticClass:"editProductMenu ml-n2",on:{click:function(e){return t.$emit("edit",t.product)}}},[e("i",{staticClass:"uiIconEdit",class:t.iconClass}),t._v(t._s(t.$t("exoplatform.perkstore.button.menuEditProduct"))+"\n                  ")])],1):t._e(),t._v(" "),e("v-list-item",{staticClass:"editLabelProduct",on:{mousedown:function(t){return t.preventDefault()}}},[e("v-list-item-title",{staticClass:"editProductMenu ml-n2",on:{click:function(e){return t.$emit("orders-list",t.product,null)}}},[e("i",{staticClass:"fas fa-list primary--text",class:t.iconClass}),t._v(t._s(t.$t("exoplatform.perkstore.button.menuProductOrders"))+"\n                  ")])],1),t._v(" "),e("v-list-item",{staticClass:"editLabelProduct",on:{mousedown:function(t){return t.preventDefault()}}},[e("v-list-item-title",{staticClass:"editProductMenu ml-n2",on:{click:function(e){return t.confirmDelete()}}},[e("i",{staticClass:"uiIconTrash primary--text",class:t.iconClass}),t._v(t._s(t.$t("exoplatform.perkstore.button.menuProductDelete"))+"\n                  ")])],1)],1)],1):t._e()],1)],1)})):t._e()],2),t._v(" "),t.hideButtons?t._e():e("v-card-text",t._g({staticClass:"pendingCard pb-0",class:t.cardTextClass||t.overviewDisplay?"pt-0":"pt-2"},t.cantBuyProduct||t.userData.notProcessedOrders?{}:{click:t.displayBuyModal}),[t.hidePending||t.overviewDisplay?t._e():e("div",{staticClass:"productCardPending py-0"},[t.userData.notProcessedOrders?e("v-hover",{scopedSlots:t._u([{key:"default",fn:function({hover:r}){return e("v-chip",{class:`${r&&"elevation-3"} userPendingOrders clickable`,on:{click:function(e){return t.$emit("orders-list",t.product,null)}}},[e("v-icon",{staticClass:"userPendingOrdersIcon",attrs:{left:!t.$vuetify.rtl,size:"16"}},[t._v("\n              far fa-clock\n            ")]),t._v("\n            "+t._s(t.userData.notProcessedOrders)+" "+t._s(t.$t("exoplatform.perkstore.label.pending"))+"\n          ")],1)}}],null,!1,4287478648)}):t._e()],1),t._v(" "),e("v-btn",{staticClass:"white--text buyButton pa-0",class:t.buyButtonClass,attrs:{disabled:t.disabledBuy||!t.walletEnabled||t.walletLoading||t.walletDeleted||!t.displayBuyButton,loading:!t.disabledBuy&&t.walletLoading,title:t.buyButtonTitle,right:!t.$vuetify.rtl,"max-height":t.overviewDisplay?"20px":"","max-width":t.overviewDisplay?"20px":"",absolute:"",fab:"",top:"",icon:""},on:{click:t.displayBuyModal}},[e("v-icon",{class:t.overviewDisplay&&"icon-mini-size"},[t._v("fa-shopping-cart")])],1)],1),t._v(" "),e("div",t._g({class:t.displayPendingChipClass},t.cantBuyProduct?{}:{click:t.displayBuyModal}),[e("v-card-text",{staticClass:"productCardTitleParent text-truncate",class:t.overviewDisplay?"pa-1 mb-1 caption":"pb-0",attrs:{title:t.product.unlimited?t.$t("exoplatform.perkstore.label.unlimitedSupply"):t.$t("exoplatform.perkstore.label.articlesSold",{0:t.purchasedPercentageLabel})}},[e("span",{attrs:{title:t.product.title}},[t._v(t._s(t.product.title))])]),t._v(" "),t.overviewDisplay?t._e():e("v-card-text",{staticClass:"productCardSubtitle"},[e("span",{staticClass:"priceSymbol"},[t._v(t._s(t.symbol))]),t._v(" "+t._s(t.product.price)+"\n      ")])],1)],1),t._v(" "),e("exo-confirm-dialog",{ref:"deleteProductConfirmDialog",attrs:{title:t.$t("exoplatform.perkstore.label.delete"),message:t.$t("exoplatform.perkstore.label.deleteConfirmMessage"),"ok-label":t.$t("exoplatform.perkstore.label.ok"),"cancel-label":t.$t("exoplatform.perkstore.label.cancel")},on:{ok:t.removeProduct}})],1)};i._withStripped=!0;const o=s({props:{product:{type:Object,default:function(){return{}}},symbol:{type:String,default:function(){return""}},walletLoading:{type:Boolean,default:function(){return!1}},walletEnabled:{type:Boolean,default:function(){return!1}},walletDeleted:{type:Boolean,default:function(){return!1}},hideButtons:{type:Boolean,default:function(){return!1}},hidePending:{type:Boolean,default:function(){return!1}},hideElevation:{type:Boolean,default:function(){return!1}},cardHeight:{type:Number,default:function(){return 600}},carousselHeight:{type:Number,default:function(){return 500}},overviewDisplay:{type:Boolean,default:function(){return!1}}},data:()=>({showMenu:!1}),computed:{isProductOwner(){return this.product.userData.canEdit||this.product.userData.username===this.product.creator.id||this.product.userData.username===this.product.receiverMarchand.id},cardTextClass(){return this.cantBuyProduct?"":"clickable "},displayPendingChipClass(){return`${this.overviewDisplay?"":"pt-4"} ${this.cardTextClass}`},cantBuyProduct(){return this.disabledBuy||!this.walletEnabled||this.walletLoading||this.walletDeleted||!this.displayBuyButton},buyButtonClass(){return`${this.cantBuyProduct?"disabledBuyButton":"btn btn-primary"} ${this.overviewDisplay?"mt-14 me-n2":""}`},buyButtonTitle(){return!this.walletEnabled||this.walletDeleted?this.$t("exoplatform.perkstore.label.disabledOrDeletedWallet"):this.product.receiverMarchand.id===eXo.env.portal.userName?this.$t("exoplatform.perkstore.button.disabledBuyButton"):this.product.enabled?this.maxOrdersReached?this.$t("exoplatform.perkstore.label.maxOrdersIsReached",{0:this.product.maxOrdersPerUser}):this.product.unlimited||this.available?this.$t("exoplatform.perkstore.button.buy"):this.$t("exoplatform.perkstore.label.SoldOut"):this.$t("exoplatform.perkstore.label.disabledProduct")},productCreatedDate(){return this.product&&this.product.createdDate&&this.formatDate(new Date(this.product.createdDate))||""},productLink(){return this.product&&`${eXo.env.portal.context}/${eXo.env.portal.portalName}/perkstore/catalog?productId=${this.product.id}`||"#"},userData(){return this.product&&this.product.userData||{}},ordersListBtnClass(){if(!this.product)return"";let t=0;return this.userData.canEdit&&t++,this.displayBuyButton&&t++,`left-pa${t}`},editBtnClass(){return this.displayBuyButton?"left-pa1":""},displayBuyButton(){return!this.hideButtons&&this.product&&this.product.enabled&&this.userData.canOrder&&this.product.receiverMarchand&&this.product.receiverMarchand.type&&this.product.receiverMarchand.id&&("user"!==this.product.receiverMarchand.type||this.product.receiverMarchand.id!==eXo.env.portal.userName)&&this.product.creator&&this.product.creator.type&&this.product.creator.id},disabledBuy(){return!this.product.unlimited&&this.available<=0||this.maxOrdersReached},purchasedPercentageLabel(){return`${Number(this.purchasedPercentage).toFixed(0)}%`},purchasedPercentage(){return this.product.unlimited?0:this.product.totalSupply?100*this.product.purchased/this.product.totalSupply:100},maxOrdersCurrentPeriodReached(){return this.userData&&this.product.orderPeriodicity&&this.userData.purchasedInCurrentPeriod&&this.userData.purchasedInCurrentPeriod>=this.product.maxOrdersPerUser},maxOrdersAllTimeReached(){return this.userData&&!this.product.orderPeriodicity&&this.userData.totalPurchased&&this.userData.totalPurchased>=this.product.maxOrdersPerUser},maxOrdersReached(){return this.product.maxOrdersPerUser&&this.userData&&(this.maxOrdersCurrentPeriodReached||this.maxOrdersAllTimeReached)},available(){if(this.product.unlimited)return 1e4;{const t=this.product.totalSupply-this.product.purchased;return t>0?t:0}},iconClass(){return this.$vuetify.rtl?"ml-2":"mr-2 "},rtlDisplay(){return!this.$vuetify.rtl}},methods:{closeMenu(){this.showMenu=!1},openProductDetail(t){t.stopPropagation(),t.preventDefault(),this.$emit("product-details",this.product)},displayBuyModal(){!this.disabledBuy&&this.walletEnabled&&this.$emit("buy",this.product)},formatDate:t=>t?t.toLocaleString(eXo.env.portal.language,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}):"",confirmDelete(){this.$refs.deleteProductConfirmDialog.open()},removeProduct(){var t;(t=this.product.id,fetch(`/portal/rest/perkstore/api/product/delete/${t}`,{method:"PUT",credentials:"include"}).then((t=>{if(!t||!t.ok)throw new Error(t.status)}))).then((()=>{this.$root.$emit("show-alert",{type:"success",message:this.$t("exoplatform.perkstore.label.deleteSuccess")}),this.$emit("product-deleted")})).catch((t=>{let e="";e="403"===t.message?this.$t("exoplatform.perkstore.label.deletePermissionDenied"):"404"===t.message?this.$t("exoplatform.perkstore.label.notFound"):this.$t("exoplatform.perkstore.label.deleteError"),this.$root.$emit("show-alert",{type:"error",message:e})}))}}},i,[],!1,null,null,null).exports;var n=function(){var t=this,e=t._self._c;return e("exo-drawer",{ref:"BuyModalDrawer",attrs:{right:""},on:{closed:t.onCloseDrawer}},[e("template",{slot:"title"},[e("div",{staticClass:"titleBuyProductDrawer"},[t._v(t._s(t.product&&t.product.title))])]),t._v(" "),e("template",{slot:"content"},[e("perk-store-buy-form",{ref:"buyForm",attrs:{product:t.product,symbol:t.symbol,"need-password":t.needPassword,"wallet-loading":t.walletLoading,"wallet-enabled":t.walletEnabled},on:{loading:function(e){t.loading=e},"opened-transaction":t.openTransaction,ordered:function(e){return t.$emit("ordered",e)},close:t.close}})],1),t._v(" "),e("template",{slot:"footer"},[t.displayMetamaskWarnings?e("div",[e("wallet-metamask-warnings",{attrs:{"not-installed":!t.metamaskInstalled,"not-connected":!t.metamaskConnected,"invalid-network":t.invalidMetamaskNetwork,"invalid-account":t.invalidMetamaskAccount}})],1):e("div",{staticClass:"d-flex mr-2"},[e("v-spacer"),t._v(" "),e("button",{staticClass:"ignore-vuetify-classes btn me-1",attrs:{disabled:t.openedTransaction,loading:t.loading},on:{click:t.close}},[t._v("\n        "+t._s(t.$t("exoplatform.perkstore.button.cancel"))+"\n      ")]),t._v(" "),e("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function({on:r,attrs:s}){return[e("div",t._g(t._b({},"div",s,!1),r),[e("v-btn",{staticClass:"btn btn-primary me-1",attrs:{disabled:t.disabledButton,loading:t.loading,large:""},on:{click:t.buyProduct}},[t._v("\n              "+t._s(t.$t("exoplatform.perkstore.button.buy"))+"\n            ")])],1)]}}])},[t._v(" "),e("span",[t._v(t._s(t.buyButtonTitle))])])],1)])],2)};n._withStripped=!0;const l=s({props:{product:{type:Object,default:function(){return{}}},symbol:{type:String,default:function(){return null}},needPassword:{type:Boolean,default:function(){return!1}},walletEnabled:{type:Boolean,default:function(){return!1}},walletLoading:{type:Boolean,default:function(){return!1}}},data:()=>({dialog:!1,loading:!1,isSameNetworkVersion:!0,isSameAddress:!0,openedTransaction:!1,metamaskAddress:null,metamaskNetworkId:null,metamaskConnected:!1}),computed:{walletAddress:()=>window.walletSettings?.wallet?.address||!1,invalidMetamaskAccount(){return!this.metamaskAddress||(this.metamaskAddress||"").toLowerCase()!==(this.walletAddress||"").toLowerCase()},invalidMetamaskNetwork(){return this.metamaskNetworkId!==window.walletSettings?.network?.id},displayMetamaskWarnings(){return this.isMetamaskWallet&&(this.invalidMetamaskNetwork||this.invalidMetamaskAccount||!this.metamaskConnected)},isMetamaskWallet:()=>"METAMASK"===window.walletSettings.wallet?.provider,canBuyProduct(){return this.product?.receiverMarchand?.id&&this.product?.userData?.username!==this.product.receiverMarchand.id},buyButtonTitle(){return!this.walletEnabled||this.walletDeleted?this.$t("exoplatform.perkstore.label.disabledOrDeletedWallet"):this.product?.receiverMarchand?.id===this.product?.userData?.username?this.$t("exoplatform.perkstore.button.disabledBuyButton"):this.product.enabled?this.product.unlimited||this.available?this.$t("exoplatform.perkstore.button.buy"):this.$t("exoplatform.perkstore.label.SoldOut"):this.$t("exoplatform.perkstore.label.disabledProduct")},disabledButton(){return this.disableButton&&(!this.isSameNetworkVersion||!this.isSameAddress)||this.openedTransaction||!this.canBuyProduct}},created(){document.addEventListener("wallet-metamask-accountsChanged",this.updateSelectedMetamaskAddress),document.addEventListener("wallet-metamask-chainChanged",this.updateSelectedMetamaskNetworkId),document.addEventListener("wallet-metamask-connected",this.updateSelectedMetamaskInformation),document.addEventListener("wallet-metamask-disconnected",this.updateSelectedMetamaskInformation)},beforeDestroy(){document.removeEventListener("wallet-metamask-accountsChanged",this.updateSelectedMetamaskAddress),document.removeEventListener("wallet-metamask-chainChanged",this.updateSelectedMetamaskNetworkId),document.removeEventListener("wallet-metamask-chainChanged",this.updateSelectedMetamaskInformation),document.removeEventListener("wallet-metamask-chainChanged",this.updateSelectedMetamaskInformation)},methods:{updateSelectedMetamaskNetworkId(){this.metamaskNetworkId=window.walletSettings.metamask?.networkId},updateSelectedMetamaskAddress(){this.metamaskAddress=window.walletSettings.metamask?.address},updateSelectedMetamaskInformation(){this.metamaskInstalled=window.walletSettings.metamask?.installed,this.metamaskConnected=window.walletSettings.metamask?.connected,this.updateSelectedMetamaskNetworkId(),this.updateSelectedMetamaskAddress()},disableButton(){return this.$refs.buyForm&&this.$refs.buyForm.disablePayButton},buyProduct(t){this.$refs.buyForm.payProduct(t)},async open(){this.isMetamaskWallet&&this.updateSelectedMetamaskInformation(),await this.$refs.BuyModalDrawer.open(),this.$refs.buyForm.init()},onCloseDrawer(){this.$emit("closeProductDetails")},close(){this.$emit("closeProductDetails"),this.$refs.BuyModalDrawer.close()},openTransaction(t){this.openedTransaction=t}}},n,[],!1,null,null,null).exports;var d=function(){var t=this,e=t._self._c;return e("v-form",{ref:"form",attrs:{id:"buyFormProduct"}},[e("v-container",[t.errors&&t.errors.length>0&&!t.loading?e("v-flex",{staticClass:"errorContainer"},t._l(t.errors,(function(r){return e("div",{key:r,staticClass:"alert alert-error v-content"},[e("i",{staticClass:"uiIconError"}),t._v("\n        "+t._s(r)+"\n      ")])})),0):t._e(),t._v(" "),t.product&&t.product.description?e("v-row",[e("div",{staticClass:"d-flex flex-column pl-4 pb-2"},[e("label",{staticClass:"mb-1 font-weight-bold"},[t._v(t._s(t.$t("exoplatform.perkstore.label.productDescription"))+":")]),t._v(" "),e("div",{staticClass:"font-weight-regular"},[t._v(t._s(t.product.description))])])]):t._e(),t._v(" "),t.productImage?e("v-row",[e("label",{staticClass:"pl-4 pb-2 font-weight-bold"},[t._v(t._s(t.$t("exoplatform.perkstore.label.Gallery")))])]):t._e(),t._v(" "),t.productImage?e("v-row",t._l(t.product.imageFiles.slice(0,3),(function(t){return e("v-col",{key:t.src,staticClass:"pl-4",attrs:{cols:"12",sm:"4"}},[e("a",{attrs:{href:t.src,target:"_blank"}},[e("v-img",{staticClass:"productImageBuyPage",attrs:{src:t.src,"aspect-ratio":"1","max-width":"200px","max-height":"100%"}})],1)])})),1):t._e(),t._v(" "),e("v-row",{staticClass:"pl-5"},[e("v-col",{attrs:{cols:"12",sm:"6"}},[e("v-row",{staticClass:"pb-3"},[e("label",{staticClass:"font-weight-bold"},[t._v(t._s(t.$t("exoplatform.perkstore.label.Marchant"))+":")])]),t._v(" "),t.product&&t.product.receiverMarchand?e("v-row",{staticClass:"pb-3"},["user"===t.product.receiverMarchand.type?e("exo-user-avatar",{key:t.product.receiverMarchand.id,attrs:{"profile-id":t.product.receiverMarchand.id,size:25,"extra-class":"buyFormMarchant",popover:""}}):t._e(),t._v(" "),"space"===t.product.receiverMarchand.type?e("exo-space-avatar",{key:t.product.receiverMarchand.id,attrs:{"space-id":t.product.receiverMarchand.spaceId,size:25,"extra-class":"buyFormMarchant",popover:""}}):t._e()],1):t._e(),t._v(" "),e("v-row",[e("label",{staticClass:"font-weight-bold"},[t._v(t._s(t.$t("exoplatform.perkstore.label.QuantityToBuy"))+":")])]),t._v(" "),e("v-row",[e("v-text-field",{staticClass:"text-center pt-1 quantity perkStoreTextField",attrs:{disabled:t.loading,rules:t.quantityRules,"append-icon":"fa-plus","prepend-inner-icon":"fa-minus",name:"quantity",required:""},on:{"click:prepend-inner":t.decrementQuantity,"click:append":t.incrementQuantity},model:{value:t.quantity,callback:function(e){t.quantity=t._n(e)},expression:"quantity"}})],1)],1),t._v(" "),e("v-col",{attrs:{cols:"12",sm:"6"}},[e("v-row",{staticClass:"pb-3"},[e("label",{staticClass:"font-weight-bold"},[t._v("\n            "+t._s(t.$t("exoplatform.perkstore.label.unitPrice"))+":\n          ")])]),t._v(" "),e("v-row",{staticClass:"pb-3"},[e("label",{staticClass:"font-weight-bold"},[e("span",{staticClass:"priceSymbol"},[t._v(t._s(t.symbol))]),t._v(" "+t._s(t.productPrice)+"\n          ")])]),t._v(" "),e("v-row",{staticClass:"pb-4 mt-1"},[e("label",{staticClass:"font-weight-bold"},[t._v("\n            "+t._s(t.$t("exoplatform.perkstore.label.AmountToBuy"))+":\n          ")])]),t._v(" "),e("v-row",[e("label",{staticClass:"font-weight-bold"},[e("span",{staticClass:"priceSymbol"},[t._v(t._s(t.symbol))]),t._v("  "+t._s(t.amountLabel)+"\n          ")])])],1)],1),t._v(" "),e("v-row",{staticClass:"pl-5"},[t.needPassword&&t.isInternalWallet?e("label",{staticClass:"font-weight-bold"},[t._v(t._s(t.$t("exoplatform.perkstore.label.walletPassword")))]):t.isInternalWallet?t._e():e("label",{staticClass:"font-weight-bold"},[t._v(t._s(t.$t("exoplatform.perkstore.label.wallet")))])]),t._v(" "),e("v-row",{staticClass:"pl-5"},[t.isInternalWallet?t._e():e("v-col",{staticClass:"d-flex align-center ml-n3",attrs:{cols:"12",sm:"6"}},[e("img",{staticClass:"mt-n1",attrs:{src:"/wallet-common/images/metamask.svg",alt:"Metamask",width:"18"}}),t._v(" "),e("span",{staticClass:"pl-2"},[t._v("Metamask :")])]),t._v(" "),t.isInternalWallet?t._e():e("v-col",{attrs:{cols:"12",sm:"6",align:"right"}},[e("v-chip",{staticClass:"grey-background"},[e("span",{staticClass:"mr-3 dark-grey-color walletTitle"},[t._v("\n            "+t._s(t.metamaskAddressPreview)+"\n          ")]),t._v(" "),e("wallet-settings-jdenticon",{attrs:{address:t.senderAddress}})],1)],1),t._v(" "),t.needPassword&&t.isInternalWallet?e("v-text-field",{staticClass:"passwordWallet pt-0",attrs:{"append-icon":t.walletPasswordShow?"mdi-eye":"mdi-eye-off",type:t.walletPasswordShow?"text":"password",disabled:t.loading,rules:t.requiredRule,placeholder:t.$t("exoplatform.perkstore.label.walletPasswordPlaceholder"),name:"walletPassword",autocomplete:"current-passord",required:"",autofocus:"",color:"grey darken-4","validate-on-blur":""},on:{"click:append":function(e){t.walletPasswordShow=!t.walletPasswordShow}},model:{value:t.walletPassword,callback:function(e){t.walletPassword=e},expression:"walletPassword"}}):t._e()],1)],1)],1)};function u(t,e){return fetch("/portal/rest/perkstore/api/order/save"+(e?"Simulate":""),{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}).then((t=>{if(!t||!t.ok)return function(t,e){if(!t||!t.ok){const e=t&&t.headers&&t.headers.get("content-type");if(e&&-1!==e.indexOf("application/json"))return t.json().then((t=>{const e=function(t,e){return t&&t.code&&t.suffix&&t.message?t.message:"Error saving order"}(t);throw new Error(e)}))}throw new Error(e)}(t,"Error saving order")}))}d._withStripped=!0;const c=s({props:{product:{type:Object,default:function(){return{}}},symbol:{type:String,default:function(){return null}},opened:{type:Boolean,default:function(){return!1}},integrated:{type:Boolean,default:function(){return!1}},needPassword:{type:Boolean,default:function(){return!1}},walletEnabled:{type:Boolean,default:function(){return!1}},walletLoading:{type:Boolean,default:function(){return!1}}},data(){return{loading:!1,quantity:1,walletPassword:"",walletPasswordShow:!1,errors:[],requiredRule:[t=>!!t||this.$t("exoplatform.perkstore.warning.requiredField")],quantityRules:[t=>!!t||this.$t("exoplatform.perkstore.warning.requiredField"),t=>this.isPositiveNumber(t)||this.$t("exoplatform.perkstore.warning.invalidPositiveNumber"),t=>!this.product||this.product.unlimited||this.quantity<=this.available||this.$t("exoplatform.perkstore.warning.quantityExceedsTotalSupply",{0:this.available}),t=>!this.product||!this.product.maxOrdersPerUser||this.quantity<=this.remainingOrdersForUser||this.$t("exoplatform.perkstore.warning.quantityExceedsAllowedOrders",{0:this.remainingOrdersForUser})]}},computed:{getUrl(){if("user"===this.product.creator.type)return`${eXo.env.portal.context}/${eXo.env.portal.portalName}/profile/${this.product.creator.id}`;if(this.product.creator.spaceId&&0!==this.product.creator.spaceId){let t=this.product.creator.spaceURLId;if(t)return t=t.replace(/\//g,":"),`${eXo.env.portal.context}/g/${t}/`}return""},productImage(){return this.product&&this.product.imageFiles&&this.product.imageFiles[0]&&this.product.imageFiles[0].src},disablePayButton(){return!this.product||!this.walletEnabled||this.walletLoading||!this.quantity||this.needPassword&&!this.walletPassword||this.maxOrdersReached&&!this.product.unlimited||!this.isPositiveNumber(this.quantity)||!this.product.unlimited&&this.quantity>this.maxQuantity},amount(){return this.quantity&&this.product&&this.product.price&&function(t,e){e||(e=3);try{return Number.parseFloat(t).toFixed(e).replace(/(\..*[1-9])0+$/,"$1").replace(/\.0*$/,"")}catch(e){return console.error("Error parsing value ",t," same value will be retruned",e),t}}(this.product.price*this.quantity)||0},available(){if(this.product&&!this.product.unlimited){const t=this.product.totalSupply-this.product.purchased;return t>0?t:0}return 0},maxOrdersPerUser(){return this.product&&this.product.maxOrdersPerUser},purchasedOrders(){return this.product&&this.product.userData&&(this.product.orderPeriodicity?this.product.userData.purchasedInCurrentPeriod||0:this.product.userData.totalPurchased||0)},remainingOrdersForUser(){return this.maxOrdersPerUser&&this.product.userData?this.maxOrdersPerUser-this.purchasedOrders:0},productPrice(){return this.product&&this.product.price},maxOrdersRemaining(){if(this.product&&this.product.maxOrdersPerUser&&this.product.userData){const t=this.product.orderPeriodicity?this.product.userData.purchasedInCurrentPeriod||0:this.product.userData.totalPurchased||0,e=this.product.maxOrdersPerUser-t;return e>0?e:0}return this.product&&this.product.unlimited?0:this.available},maxQuantity(){return this.product&&this.product.unlimited?this.maxOrdersRemaining:Math.min(this.available,this.maxOrdersRemaining)},maxOrdersReached(){return this.product&&!this.maxQuantity},amountLabel(){return`${this.amount||0}`},limitedQuantity(){return this.product&&(this.product.maxOrdersPerUser||!this.product.unlimited)},quantityInputLabel(){return this.limitedQuantity?this.$t("exoplatform.perkstore.label.quantityWithMax",{0:this.maxQuantity}):this.$t("exoplatform.perkstore.label.quantity")},productTitle(){return this.product&&this.product.title?this.product.title:""},provider:()=>window.walletSettings.wallet.provider,isInternalWallet(){return"INTERNAL_WALLET"===this.provider},senderAddress:()=>window.walletSettings.wallet.address,contractDetails(){return this.tokenUtils.getContractDetails(this.senderAddress)},DecimalsAmount(){return this.walletUtils.convertTokenAmountToSend(this.amount,this.contractDetails.decimals)},metamaskAddressPreview(){return this.senderAddress&&`${this.senderAddress.substring(0,5)}...${this.senderAddress.substring(this.senderAddress.length-4,this.senderAddress.length)}`}},watch:{errors(){this.errors&&this.errors.length>0&&(this.loading=!1)},loading(){this.$emit("loading",this.loading)}},created(){document.addEventListener("exo-wallet-send-tokens-pending",this.pendingTransaction),document.addEventListener("exo-wallet-send-tokens-error",this.errorTransaction)},methods:{init(){this.quantity=1,this.warning=null,this.errors=[],this.loading=!1,this.walletPassword="",this.walletPasswordShow=!1},isPositiveNumber(t){return this.product&&t&&!isNaN(t)&&t>0&&Number.isFinite(t)&&(this.product.allowFraction||Number.isSafeInteger(t))},incrementQuantity(){this.quantity=this.quantity&&this.quantity+1>0?this.quantity+1:1,this.quantity=Math.floor(this.quantity)},decrementQuantity(){this.quantity=this.quantity&&this.quantity-1>0?this.quantity-1:0,this.quantity=Math.floor(this.quantity)},pendingTransaction(t){if(this.loading){const e=t.detail;return u({productId:this.product.id,transactionHash:e.hash,amount:this.amount,quantity:this.quantity,receiver:this.product.receiverMarchand}).then((t=>{this.loading=!1,this.$emit("ordered",t),this.showAlert("success",this.$t("exoplatform.wallet.metamask.message.transactionSent"),e.hash),this.$emit("close")})).catch((t=>{console.error("Error saving order",t),this.loading=!1,this.errors.push(t&&t.message?t.message:String(t))}))}},errorTransaction(){this.loading=!1,this.showAlert("error",this.$t("exoplatform.wallet.metamask.error.transactionFailed"))},payProduct(t){if(t.preventDefault(),t.stopPropagation(),this.errors=[],!this.$refs.form.validate())return;this.loading=!0;let e=this.quantity;try{e=this.product.allowFraction?parseFloat(e):parseInt(e)}catch(t){}if(!e||isNaN(e)||e<=0||!Number.isFinite(e)||!this.product.allowFraction&&!Number.isSafeInteger(this.quantity))return void this.errors.push(this.$t("exoplatform.perkstore.warning.invalidQuantity"));if(this.quantity=e,!this.product.unlimited&&this.quantity>this.maxQuantity)return void this.errors.push(this.$t("exoplatform.perkstore.warning.invalidQuantityWithMax",{0:this.maxQuantity}));if(!this.product.receiverMarchand)return void this.errors.push(this.$t("exoplatform.perkstore.warning.noProductMarchand"));if(!this.product.price)return void this.errors.push(this.$t("exoplatform.perkstore.warning.noProductPrice"));if(!this.amount)return void this.errors.push(this.$t("exoplatform.perkstore.warning.noAmountToSend"));const r=`${this.product.title}: ${this.quantity} x ${this.product.price}${this.symbol?this.symbol:""}`;return this.isInternalWallet?u({productId:this.product.id,quantity:this.quantity,receiver:this.product.receiverMarchand},!0).then((()=>{document.dispatchEvent(new CustomEvent("exo-wallet-send-tokens",{detail:{amount:this.amount,receiver:this.product.receiverMarchand,sender:{type:"user",id:eXo.env.portal.userName},password:this.walletPassword,label:r,message:r}}))})).catch((t=>{console.error("Checking order availability error",t),this.loading=!1,this.showAlert("error",this.$t("exoplatform.wallet.metamask.error.transactionFailed"))})):window.ethereum?.isMetaMask?(s=this.product.receiverMarchand.id,a=this.product.receiverMarchand.type,fetch(`/portal/rest/wallet/api/account/detailsById?id=${s}&type=${a}`,{credentials:"include"}).then((t=>t&&t.ok?t.json():null))).then((t=>{this.$emit("opened-transaction",!0);const e={to:this.contractDetails.address,from:this.senderAddress,data:this.contractDetails.contract.methods.transfer(t.address,this.DecimalsAmount).encodeABI()};window.ethereum.request({method:"eth_sendTransaction",params:[e]}).then((t=>(this.$emit("opened-transaction",!1),u({productId:this.product.id,quantity:this.quantity,receiver:this.product.receiverMarchand},!0).then((()=>t))))).then((e=>this.transactionUtils.saveTransactionDetails({contractAddress:this.contractDetails.address,contractAmount:this.amount,contractMethodName:"transfer",from:this.senderAddress,label:r,message:r,pending:!0,hash:e,timestamp:Date.now(),to:t.address}))).then((t=>{document.dispatchEvent(new CustomEvent("exo-wallet-send-tokens-pending",{detail:t})),this.showAlert("success",this.$t("exoplatform.wallet.metamask.message.transactionSent"),t.hash),this.$emit("close")})).catch((t=>{this.$emit("opened-transaction",!1),t&&4001===t.code||(console.error("Checking order availability error",t),this.showAlert("error",this.$t("exoplatform.wallet.metamask.error.transactionFailed")))})).finally((()=>this.loading=!1))})):void 0;var s,a},showAlert(t,e,r){this.$root.$emit("wallet-notification-alert",{type:t,message:e,transactionHash:r})}}},d,[],!1,null,null,null).exports;var p=function(){var t=this,e=t._self._c;return e("v-alert",{attrs:{type:t.alertType,dismissible:"",icon:"warning"===t.alertType?"mdi-alert-circle":""},model:{value:t.displayAlert,callback:function(e){t.displayAlert=e},expression:"displayAlert"}},[e("span",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:t.alertMessage,expression:"alertMessage"}]})])};p._withStripped=!0;const h={"perk-store-overview":a,"perk-store-product-detail":o,"perk-store-buy-modal":l,"perk-store-buy-form":c,"perk-store-alert":s({data:()=>({displayAlert:!1,alertMessage:null,alertType:null}),created(){this.$root.$on("show-alert",(t=>{this.alertMessage=t.message,this.alertType=t.type,this.displayAlert=!0,window.setTimeout((()=>this.displayAlert=!1),5e3)}))}},p,[],!1,null,null,null).exports};for(const t in h)Vue.component(t,h[t]);const m=new Vuetify(eXo.env.portal.vuetifyPreset),v=eXo&&eXo.env&&eXo.env.portal&&eXo.env.portal.language||"en",w=`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.addon.PerkStore-${v}.json`,y="PerkStoreOverviewApp";function f(){exoi18n.loadLanguageAsync(v,w).then((t=>{if(new Vue({template:`<perk-store-overview id="${y}" />`,i18n:t,vuetify:m}).$mount(`#${y}`),extensionRegistry.registerComponent("my-rewards-perkstore-overview","my-rewards-perkstore-item",{id:"perkstore-rewards-overview",vueComponent:Vue.options.components["perk-store-overview"],rank:10}),extensionRegistry){const t=extensionRegistry.loadComponents("PerkStoreOverview");t&&t.length>0&&t.forEach((t=>{Vue.component(t.componentName,t.componentOptions)}))}}))}return e})()));