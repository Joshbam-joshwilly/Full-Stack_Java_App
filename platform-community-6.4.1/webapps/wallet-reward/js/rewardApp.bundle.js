define((()=>(()=>{"use strict";var e={d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:()=>B});var a={};e.r(a),e.d(a,{TIMEZONES:()=>b,computeRewards:()=>E,computeRewardsByUser:()=>P,getRewardDates:()=>C,getRewardSettings:()=>A,getRewardTeams:()=>x,getTimeZones:()=>_,removeRewardTeam:()=>T,saveRewardSettings:()=>y,saveRewardTeam:()=>S,sendRewards:()=>k});var r=function(){var e=this,t=e._self._c;return t("v-app",{staticClass:"VuetifyApp",attrs:{id:"RewardApp",color:"transaprent",flat:""}},[t("main",[t("v-layout",{attrs:{column:""}},[t("v-layout",{staticClass:"application-toolbar",attrs:{column:""}},[e.error&&!e.loading?t("v-flex",{staticClass:"text-center"},[t("div",{staticClass:"alert alert-error text-start"},[t("i",{staticClass:"uiIconError"}),e._v(e._s(e.error)+"\n          ")])]):e._e(),e._v(" "),e.settingWarnings&&e.settingWarnings.length&&!e.loading?t("v-flex",{staticClass:"text-center"},[t("div",{staticClass:"alert alert-warning text-start"},[t("i",{staticClass:"uiIconWarning"}),e._v(" "),t("span",[t("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){e.selectedTab=2}}},[e._v(e._s(e.$t("exoplatform.wallet.label.pleaseCheckRewardConfiguration")))])]),e._v(" "),t("ul",e._l(e.settingWarnings,(function(a){return t("li",{key:a,staticClass:"ps-2"},[e._v("\n                - "+e._s(a)+"\n              ")])})),0)])]):e._e(),e._v(" "),e.duplicatedWallets&&e.duplicatedWallets.length?t("v-flex",{staticClass:"text-center"},[t("div",{staticClass:"alert alert-warning"},[t("i",{staticClass:"uiIconWarning"}),e._v(" "+e._s(e.$t("exoplatform.wallet.warning.poolMemberDuplicated"))+":\n            "),t("ul",e._l(e.duplicatedWallets,(function(a){return t("li",{key:a.id},[t("code",[e._v(e._s(a.wallet.name))])])})),0)])]):e._e(),e._v(" "),t("v-dialog",{attrs:{persistent:"","hide-overlay":"",width:"300"},model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},[t("v-card",{attrs:{color:"primary",dark:""}},[t("v-card-text",[e._v("\n              "+e._s(e.$t("exoplatform.wallet.label.loading"))+" ...\n              "),t("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1)],1)],1),e._v(" "),t("v-tabs",{attrs:{"slider-size":"4"},model:{value:e.selectedTab,callback:function(t){e.selectedTab=t},expression:"selectedTab"}},[t("v-tab",{key:"SendRewards",attrs:{href:"#SendRewards"}},[e._v("\n            "+e._s(e.$t("exoplatform.wallet.title.sendRewardsTab"))+"\n          ")]),e._v(" "),t("v-tab",{key:"RewardPools",attrs:{href:"#RewardPools"}},[e._v("\n            "+e._s(e.$t("exoplatform.wallet.title.rewardPoolsTab"))+"\n          ")]),e._v(" "),t("v-tab",{key:"Configuration",attrs:{href:"#Configuration"}},[e._v("\n            "+e._s(e.$t("exoplatform.wallet.title.rewardConfigurationTab"))+"\n          ")])],1),e._v(" "),t("v-tabs-items",{staticClass:"tabs-content",model:{value:e.selectedTab,callback:function(t){e.selectedTab=t},expression:"selectedTab"}},[t("v-tab-item",{attrs:{id:"SendRewards",value:"SendRewards",eager:""}},[t("wallet-reward-send-rewards-tab",{ref:"sendRewards",attrs:{"reward-report":e.rewardReport,"admin-wallet":e.adminWallet,"total-rewards":e.totalRewards,"contract-details":e.contractDetails,"period-dates-display":e.periodDatesDisplay,"transaction-etherscan-link":e.transactionEtherscanLink,"time-zone":e.timeZone},on:{"dates-changed":function(t){return e.refreshRewards(t)},refresh:e.refreshRewards,error:function(t){e.error=t}}})],1),e._v(" "),t("v-tab-item",{attrs:{id:"RewardPools",value:"RewardPools",eager:""}},[t("wallet-reward-teams-list-tab",{ref:"rewardTeams",attrs:{teams:e.teams,"wallet-rewards":e.walletRewards,period:e.period,"period-dates-display":e.periodDatesDisplay,"contract-details":e.contractDetails},on:{"refresh-teams":e.refreshRewardSettings,refresh:e.refreshRewardSettings,error:function(t){e.error=t}}})],1),e._v(" "),t("v-tab-item",{attrs:{id:"Configuration",value:"Configuration",eager:""}},[t("wallet-reward-configuration-tab",{ref:"configurationTab",on:{saved:e.refreshRewardSettings,error:function(t){e.error=t}}})],1)],1)],1)],1),e._v(" "),t("div",{attrs:{id:"walletDialogsParent"}})],1)])};function i(e,t,a,r,i,s,l,n){var o,d="function"==typeof e?e.options:e;if(t&&(d.render=t,d.staticRenderFns=a,d._compiled=!0),r&&(d.functional=!0),s&&(d._scopeId="data-v-"+s),l?(o=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(l)},d._ssrRegister=o):i&&(o=n?function(){i.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:i),o)if(d.functional){d._injectStyles=o;var c=d.render;d.render=function(e,t){return o.call(t),c(e,t)}}else{var m=d.beforeCreate;d.beforeCreate=m?[].concat(m,o):[o]}return{exports:e,options:d}}r._withStripped=!0;const s=i({data:()=>({loading:!1,error:null,rewardReport:null,adminWallet:null,settingWarnings:[],selectedTab:"SendRewards",transactionEtherscanLink:null,addressEtherscanLink:null,contractDetails:null,rewardSettings:{},totalRewards:[],teams:[],period:null}),computed:{duplicatedWallets(){return this.walletRewards&&this.walletRewards.filter((e=>e.teams&&e.teams.length>1))||[]},walletRewards(){return this.rewardReport&&this.rewardReport.rewards||[]},periodType(){return this.rewardSettings&&this.rewardSettings.periodType},timeZone(){return this.period?.timeZone||this.rewardSettings?.timeZone},selectedDate(){return this.period?.startDate.substring(0,10)||(new Date).toISOString().substring(0,10)},dateformat(){return this.timeZone&&{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",timeZoneName:"short",timeZone:this.timeZone}||{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}},periodDatesDisplay(){if(!this.period)return"";const e=this.$dateUtil.formatDateObjectToDisplay(new Date(1e3*this.period.startDateInSeconds),this.dateformat,eXo.env.portal.language),t=this.$dateUtil.formatDateObjectToDisplay(new Date(1e3*this.period.endDateInSeconds-1),this.dateformat,eXo.env.portal.language);return`${e} ${this.$t("exoplatform.wallet.label.to")} ${t}`}},watch:{rewardReport(){this.period=this.rewardReport?.period}},created(){this.init().then((()=>{this.transactionEtherscanLink=this.walletUtils.getTransactionEtherscanlink(),this.addressEtherscanLink=this.walletUtils.getAddressEtherscanlink()}))},methods:{init(){return this.loading=!0,this.error=null,this.walletUtils.initSettings(!1,!0).then((()=>{if(!window.walletSettings)throw new Error(this.$t("exoplatform.wallet.error.emptySettings"));return this.contractDetails=window.walletSettings.contractDetail,this.addressRegistry.searchWalletByTypeAndId("admin","admin")})).then((e=>this.adminWallet=e)).then((()=>this.refreshRewardSettings())).catch((e=>{console.error("init method - error",e),this.error=e?String(e):this.$t("exoplatform.wallet.error.unknownError")})).finally((()=>{this.loading=!1}))},refreshRewardSettings(){return this.loading=!0,this.$rewardService.getRewardSettings().then((e=>this.rewardSettings=e||{})).then((()=>this.$nextTick())).then((()=>this.$refs.configurationTab.init())).then((()=>this.refreshTeams())).then((()=>this.$nextTick())).then((()=>this.refreshRewards())).finally((()=>this.loading=!1))},refreshRewards(e){if(this.checkConfigurationConsistency())return e&&(this.period=e),this.loading=!0,this.$rewardService.computeRewards(this.selectedDate).then((e=>{if(!e.error)return this.rewardReport=e,this.$nextTick();this.error="object"==typeof e.error?e.error[0]:e.error})).then((()=>{this.computeTotalRewardsByPlugin(),this.walletRewards.forEach((e=>{"pending"===e.status&&this.walletUtils.watchTransactionStatus(e.transaction.hash,(t=>{e.status=t.succeeded?"success":"error"}))})),this.teams.forEach((e=>{e.validMembersWallets=[],e.computedBudget=0,e.id&&e.members&&e.members.forEach((t=>{const a=this.walletRewards.find((e=>e.wallet&&e.wallet.id&&e.wallet.technicalId===t.identityId));a&&a.enabled&&a.poolTokensToSend&&e.validMembersWallets.push(a)}))}));const e=this.walletRewards.filter((e=>!e.team));if(e&&e.length){let t=this.teams.find((e=>!e.id));t||(t={id:0,name:this.$t("exoplatform.wallet.label.noPoolUsers"),description:this.$t("exoplatform.wallet.label.noPoolUsersDescription"),rewardType:"COMPUTED",computedBudget:0,noTeam:!0},this.teams.push(t)),t.members=e.map((e=>e.wallet)),t.validMembersWallets=e.filter((e=>e.enabled&&e.poolTokensToSend))}this.teams&&this.teams.length&&this.teams.sort(((e,t)=>Number(e.id)-Number(t.id))),this.teams.filter((e=>e.validMembersWallets&&e.validMembersWallets.length)).forEach((e=>{e.computedBudget=e.validMembersWallets.reduce(((e,t)=>e+(t.poolTokensToSend||0)),0)}))})).finally((()=>this.loading=!1))},refreshTeams(){return this.$rewardService.getRewardTeams().then((e=>this.teams=e||[])).catch((e=>{console.error("Error getting teams list",e),this.error=this.$t("exoplatform.wallet.error.errorRetrievingPool")}))},computeTotalRewardsByPlugin(){const e={};this.rewardSettings&&this.rewardSettings.pluginSettings&&this.rewardSettings.pluginSettings.length&&this.rewardSettings.pluginSettings.forEach((t=>e[t.pluginId]={pluginId:t.pluginId,total:0})),this.walletRewards.forEach((t=>{t&&t.rewards&&t.rewards.forEach((t=>e[t.pluginId]&&(e[t.pluginId].total+=t.points)))})),this.totalRewards=Object.values(e)},checkConfigurationConsistency(){return this.settingWarnings=[],this.contractDetails?this.periodType||(this.settingWarnings.push(this.$t("exoplatform.wallet.warning.noConfiguredToken")),this.settingWarnings.push(this.$t("exoplatform.wallet.warning.missingRewardPeriodicity"))):this.settingWarnings.push(this.$t("exoplatform.wallet.warning.noConfiguredToken")),this.rewardSettings?this.rewardSettings.pluginSettings&&this.rewardSettings.pluginSettings.length?this.rewardSettings.pluginSettings.forEach((e=>{e&&!e.budgetType&&this.settingWarnings.push(this.$t("exoplatform.wallet.warning.noRewardBudgetConfiguredForPlugin",{0:e.pluginId}))})):this.settingWarnings.push(this.$t("exoplatform.wallet.warning.noPluginConfiguration")):this.settingWarnings.push(this.$t("exoplatform.wallet.error.emptySettings")),!this.settingWarnings.length},formatDate:e=>e?e.toLocaleDateString(eXo.env.portal.language):null}},r,[],!1,null,null,null).exports;var l=function(){var e=this,t=e._self._c;return t("v-dialog",{attrs:{"content-class":"uiPopup walletDialog",width:"400px","max-width":"100vw"},on:{keydown:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"]))return null;e.dialog=!1}},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[e.wallet?t("v-card",{staticClass:"elevation-12"},[t("div",{staticClass:"ignore-vuetify-classes popupHeader ClearFix"},[t("a",{staticClass:"uiIconClose pull-right",attrs:{"aria-hidden":"true"},on:{click:function(t){e.dialog=!1}}}),e._v(" "),t("span",{staticClass:"ignore-vuetify-classes PopupTitle popupTitle"},[e._v("\n        "+e._s(e.$t("exoplatform.wallet.title.rewardDetailsOfWallet",{0:e.wallet.wallet.name}))+"\n      ")])]),e._v(" "),t("v-list",{attrs:{dense:""}},[t("v-list-item",[t("v-list-item-content",[e._v(e._s(e.$t("exoplatform.wallet.label.period"))+":")]),e._v(" "),t("v-list-item-content",{staticClass:"align-end"},[e._v(e._s(e.period))])],1),e._v(" "),e.wallet.tokensSent?t("v-list-item",[t("v-list-item-content",[e._v(e._s(e.$t("exoplatform.wallet.label.rewardsSent"))+":")]),e._v(" "),t("v-list-item-content",{staticClass:"align-end"},[e._v(e._s(e.walletUtils.toFixed(e.wallet.tokensSent))+" "+e._s(e.symbol))])],1):e.wallet.tokensToSend?t("v-list-item",[t("v-list-item-content",[e._v(e._s(e.$t("exoplatform.wallet.label.computedRewardsToSend"))+":")]),e._v(" "),t("v-list-item-content",{staticClass:"align-end"},[e._v(e._s(e.walletUtils.toFixed(e.wallet.tokensToSend))+" "+e._s(e.symbol))])],1):e._e(),e._v(" "),e.rewards.length?[t("v-divider"),e._v(" "),e._l(e.rewards,(function(a){return t("v-list-item",{key:a.pluginId},[t("v-list-item-content",[e._v(e._s(e.$t("exoplatform.wallet.label.rewardPluginPointDetails",{0:a.points,1:a.pluginId}))+":")]),e._v(" "),t("v-list-item-content",{staticClass:"align-end"},[e._v(e._s(e.walletUtils.toFixed(a.amount))+" "+e._s(e.symbol))])],1)}))]:t("div",[t("div",{staticClass:"alert alert-info"},[t("i",{staticClass:"uiIconInfo"}),e._v(e._s(e.$t("exoplatform.wallet.label.noRewards"))+"\n        ")])])],2)],1):e._e()],1)};l._withStripped=!0;const n=i({props:{wallet:{type:Object,default:function(){return{}}},symbol:{type:String,default:function(){return null}},period:{type:String,default:function(){return null}}},data:()=>({dialog:!1}),computed:{rewards(){return this.wallet.rewards&&this.wallet.rewards.length?this.wallet.rewards.filter((e=>e.amount||e.points)):[]}},watch:{dialog(){this.dialog||this.$emit("closed")}},methods:{open(){this.dialog=!0}}},l,[],!1,null,null,null).exports;var o=function(){var e=this;return(0,e._self._c)("v-autocomplete",{ref:"selectAutoComplete",staticClass:"subtitle-1 pa-0",attrs:{id:"rewardSettingTimeZone",items:e.timeZones,disabled:e.disabled,attach:"","hide-no-data":"",dense:"",filled:""},on:{blur:function(t){e.$refs.selectAutoComplete.isFocused=!1}},model:{value:e.timeZone,callback:function(t){e.timeZone=t},expression:"timeZone"}})};o._withStripped=!0;const d=i({props:{value:{type:String,default:null},disabled:{type:Boolean,default:!1}},data:()=>({timeZone:null,timeZones:[]}),watch:{timeZone(){this.$emit("input",this.timeZone)},value(){this.timeZone=this.value}},created(){this.timeZone=this.value,this.timeZones=this.$rewardService.getTimeZones()}},o,[],!1,null,null,null).exports;var c=function(){var e=this,t=e._self._c;return t("v-card",{attrs:{flat:""}},[t("v-card-text",[t("div",{staticClass:"text-start rewardWalletConfiguration"},[t("span",[e._v("\n        "+e._s(e.$t("exoplatform.wallet.label.periodicity"))+":\n      ")]),e._v(" "),t("div",{staticClass:"selectBoxVuetifyParent v-input",attrs:{id:"selectedPeriodType"}},[t("v-combobox",{staticClass:"selectBoxVuetify",attrs:{disabled:!e.configurationEditable,items:e.periods,attach:"#selectedPeriodType","hide-no-data":"","hide-selected":"","return-masked-value":"","small-chips":""},model:{value:e.settingsToSave.periodType,callback:function(t){e.$set(e.settingsToSave,"periodType",t)},expression:"settingsToSave.periodType"}})],1),e._v(" "),t("span",[e._v("\n        "+e._s(e.$t("exoplatform.wallet.label.timezone"))+":\n      ")]),e._v(" "),t("div",{staticClass:"ms-2",attrs:{id:"selectedRewardSettingTimeZone"}},[t("wallet-reward-timezone-selectbox",{attrs:{disabled:!e.configurationEditable},model:{value:e.settingsToSave.timeZone,callback:function(t){e.$set(e.settingsToSave,"timeZone",t)},expression:"settingsToSave.timeZone"}})],1)]),e._v(" "),e.settingsToSave&&e.settingsToSave.pluginSettings?t("v-card",{attrs:{flat:""}},[t("v-container",{staticClass:"pt-0 pb-0",attrs:{fluid:"","grid-list-lg":""}},[t("v-layout",{attrs:{row:"",wrap:""}},e._l(e.settingsToSave.pluginSettings,(function(a){return t("v-flex",{key:a.pluginId,attrs:{md6:"",xs12:""}},[t("v-card",{attrs:{flat:""}},[t("v-card-title",{attrs:{"primary-title":""}},[t("h4",[e._v("\n                  "+e._s(a.pluginId.toUpperCase())+"\n                ")])]),e._v(" "),t("v-card-text",{staticClass:"pt-0 pb-0"},[t("div",{staticClass:"text-start rewardWalletConfiguration"},[t("span",[e._v("\n                    "+e._s(e.$t("exoplatform.wallet.label.rewardThreshold"))+":\n                  ")]),e._v(" "),t("v-text-field",{staticClass:"input-text-center",attrs:{disabled:!e.configurationEditable,name:"threshold"},model:{value:a.threshold,callback:function(t){e.$set(a,"threshold",e._n(t))},expression:"pluginSetting.threshold"}})],1),e._v(" "),"FIXED_PER_POINT"!==a.budgetType?t("div",{staticClass:"text-start rewardWalletConfiguration"},[t("v-checkbox",{attrs:{disabled:!e.configurationEditable,label:e.$t("exoplatform.wallet.label.usePools")},model:{value:a.usePools,callback:function(t){e.$set(a,"usePools",t)},expression:"pluginSetting.usePools"}})],1):e._e(),e._v(" "),t("div",{staticClass:"text-start mt-4"},[t("div",[e._v("\n                    "+e._s(e.$t("exoplatform.wallet.label.rewardBudgetBy"))+":\n                  ")]),e._v(" "),t("v-flex",{staticClass:"ms-4"},[t("v-radio-group",{model:{value:a.budgetType,callback:function(t){e.$set(a,"budgetType",t)},expression:"pluginSetting.budgetType"}},[t("v-radio",{attrs:{disabled:!e.configurationEditable,label:e.$t("exoplatform.wallet.label.rewardFixedBudget"),value:"FIXED"}}),e._v(" "),"FIXED"===a.budgetType?t("v-flex",{staticClass:"rewardWalletConfiguration mb-2"},[t("v-text-field",{staticClass:"pt-0 pb-0",attrs:{disabled:!e.configurationEditable,placeholder:e.$t("exoplatform.wallet.label.rewardFixedBudgetPlaceholder"),type:"number",name:"totalBudget"},model:{value:a.amount,callback:function(t){e.$set(a,"amount",e._n(t))},expression:"pluginSetting.amount"}})],1):e._e(),e._v(" "),t("v-radio",{attrs:{disabled:!e.configurationEditable,label:e.$t("exoplatform.wallet.label.rewardFixedBudgetPerMember"),value:"FIXED_PER_MEMBER"}}),e._v(" "),"FIXED_PER_MEMBER"===a.budgetType?t("v-flex",{staticClass:"rewardWalletConfiguration mb-2"},[t("v-text-field",{staticClass:"pt-0 pb-0",attrs:{disabled:!e.configurationEditable,placeholder:e.$t("exoplatform.wallet.label.rewardFixedBudgetPerMemberPlaceholder"),type:"number",name:"budgetPerMember"},model:{value:a.amount,callback:function(t){e.$set(a,"amount",e._n(t))},expression:"pluginSetting.amount"}})],1):e._e(),e._v(" "),t("v-radio",{attrs:{disabled:!e.configurationEditable,label:e.$t("exoplatform.wallet.label.rewardFixedBudgetPerPoint"),value:"FIXED_PER_POINT"}}),e._v(" "),"FIXED_PER_POINT"===a.budgetType?t("v-flex",{staticClass:"rewardWalletConfiguration mb-2"},[t("v-text-field",{staticClass:"pt-0 pb-0",attrs:{disabled:!e.configurationEditable,placeholder:e.$t("exoplatform.wallet.label.rewardFixedBudgetPerPointPlaceholder"),type:"number",name:"budgetPerPoint"},model:{value:a.amount,callback:function(t){e.$set(a,"amount",e._n(t))},expression:"pluginSetting.amount"}})],1):e._e()],1)],1)],1)])],1)],1)})),1)],1)],1):e._e()],1),e._v(" "),t("v-card-actions",[t("v-spacer"),e._v(" "),e.configurationEditable?[t("v-btn",{staticClass:"btn btn-primary px-2",attrs:{loading:e.loadingSettings,dark:""},on:{click:e.save}},[e._v("\n        "+e._s(e.$t("exoplatform.wallet.button.save"))+"\n      ")]),e._v(" "),t("v-btn",{staticClass:"btn mx-2 px-3",on:{click:e.init}},[e._v("\n        "+e._s(e.$t("exoplatform.wallet.button.cancel"))+"\n      ")])]:t("v-btn",{staticClass:"btn btn-primary ms-2",attrs:{dark:""},on:{click:function(t){e.configurationEditable=!0}}},[e._v("\n      "+e._s(e.$t("exoplatform.wallet.button.edit"))+"\n    ")]),e._v(" "),t("v-spacer")],2)],1)};c._withStripped=!0;const m=i({data:()=>({loadingSettings:!1,configurationEditable:!1,settingsToSave:{},periods:[{text:"Week",value:"WEEK"},{text:"Month",value:"MONTH"},{text:"Quarter",value:"QUARTER"},{text:"Semester",value:"SEMESTER"},{text:"Year",value:"YEAR"}]}),computed:{selectedPeriodType(){return this.settingsToSave&&this.settingsToSave.periodType?this.periods.find((e=>e.value===this.settingsToSave.periodType)):this.periods[0]}},methods:{init(){this.configurationEditable=!1,window.walletRewardSettings?(this.settingsToSave=JSON.parse(JSON.stringify(window.walletRewardSettings)),this.$nextTick().then((()=>{this.settingsToSave.periodType=this.selectedPeriodType}))):this.settingsToSave={}},save(){const e=this;this.settingsToSave.periodType&&(this.settingsToSave.periodType=this.settingsToSave.periodType.value),this.loadingSettings=!0,window.setTimeout((()=>{this.$rewardService.saveRewardSettings(this.settingsToSave).then((e=>{if(e)return this.configurationEditable=!1,this.$emit("saved");throw new Error("Error saving settings")})).catch((t=>{console.error("Error while saving 'reward settings'",t),e.$emit("error",this.$t("exoplatform.wallet.error.errorSavingRewardSettings"))})).finally((()=>{e.loadingSettings=!1}))}),200)}}},c,[],!1,null,null,null).exports;var u=function(){var e=this,t=e._self._c;return t("v-card",{attrs:{flat:""}},[e.error&&"{}"!=String(e.error).trim()?t("v-card-text",{staticClass:"text-center"},[t("div",{staticClass:"alert alert-error"},[t("i",{staticClass:"uiIconError"}),e._v(" "+e._s(e.error)+"\n    ")])]):e._e(),e._v(" "),t("v-flex",{staticClass:"text-center",attrs:{id:e.id}},[t("v-menu",{ref:"selectedDateMenu",staticClass:"dateSelector",attrs:{"content-class":e.menuId,"close-on-content-click":!1,"min-width":"auto",transition:"scale-transition","offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:a}){return[t("v-text-field",e._g({staticClass:"dateSelectorInput clickable mt-8",attrs:{value:e.periodDatesDisplay,label:e.$t("exoplatform.wallet.label.selectPeriodDate"),title:e.periodDatesDisplay,readonly:""}},a))]}}]),model:{value:e.selectedDateMenu,callback:function(t){e.selectedDateMenu=t},expression:"selectedDateMenu"}},[e._v(" "),t("v-date-picker",{staticClass:"border-box-sizing",attrs:{"first-day-of-week":1,type:e.periodType&&"WEEK"!==e.periodType?"month":"date",locale:e.lang},on:{input:function(t){e.selectedDateMenu=!1}},model:{value:e.selectedDate,callback:function(t){e.selectedDate=t},expression:"selectedDate"}})],1)],1),e._v(" "),t("v-container",{staticClass:"border-box-sizing",attrs:{fluid:"","grid-list-md":""}},[t("v-layout",{staticClass:"text-center",attrs:{row:"",wrap:""}},[t("v-flex",{attrs:{md4:"",xs12:""}},[t("h4",[e._v(e._s(e.$t("exoplatform.wallet.label.eligibleUsers"))+": "),t("strong",[e._v(e._s(e.validRewardCount))])])]),e._v(" "),t("v-flex",{attrs:{md4:"",xs12:""}},[t("h4",[e._v(e._s(e.$t("exoplatform.wallet.label.totalBudget"))+": "),t("strong",[e._v(e._s(e.totalBudget)+" "+e._s(e.symbol))])])]),e._v(" "),t("v-flex",{attrs:{md4:"",xs12:""}},[t("h4",[e._v(e._s(e.$t("exoplatform.wallet.label.sent"))+" "+e._s(e.contractDetails&&e.contractDetails.name)+": "),t("strong",[e._v(e._s(e.walletUtils.toFixed(e.sentBudget))+" "+e._s(e.symbol))])])]),e._v(" "),t("v-flex",{attrs:{md4:"",xs12:""}},[t("h4",[e._v("\n          "+e._s(e.$t("exoplatform.wallet.title.adminWalletFunds"))+":\n          "),t("strong",[e._v(e._s(e.adminBalance)+" "+e._s(e.symbol))]),e._v(" "),e.adminBalanceTooLow?t("v-icon",{attrs:{color:"orange",title:e.$t("exoplatform.wallet.label.adminBalanceTooLow")}},[e._v("\n            warning\n          ")]):e._e()],1)]),e._v(" "),e._l(e.totalRewards,(function(a){return t("v-flex",{key:a.pluginId,attrs:{md4:"",xs12:""}},[t("h4",[e._v(e._s(e.$t("exoplatform.wallet.label.total"))+" "+e._s(a.pluginId)+": "),t("strong",[e._v(e._s(a.total))])])])}))],2)],1),e._v(" "),t("v-container",{staticClass:"border-box-sizing"},[t("v-layout",[t("v-flex",{attrs:{md4:"",xs12:""}},[t("v-switch",{attrs:{label:e.$t("exoplatform.wallet.label.displayDisabledUsers")},model:{value:e.displayDisabledUsers,callback:function(t){e.displayDisabledUsers=t},expression:"displayDisabledUsers"}})],1)],1),e._v(" "),t("v-flex",[t("v-text-field",{attrs:{label:e.$t("exoplatform.wallet.label.searchRewardWalletsPlaceholder"),"append-icon":"search","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)],1),e._v(" "),t("v-data-table",{staticClass:"elevation-1 me-3 mb-2",attrs:{headers:e.identitiesHeaders,items:e.filteredIdentitiesList,"items-per-page":1e3,loading:e.loading,"item-key":"identityId","hide-default-footer":"",sortable:""},scopedSlots:e._u([{key:"item",fn:function(a){return[t("tr",{attrs:{active:a.selected}},[t("td",[t("v-avatar",{attrs:{size:"36px"}},[t("img",{attrs:{src:a.item.wallet.avatar,onerror:"this.src = '/eXoSkin/skin/images/system/SpaceAvtDefault.png'"}})])],1),e._v(" "),t("td",{staticClass:"text-start"},[t("wallet-reward-profile-chip",{attrs:{address:a.item.wallet.address,"profile-id":a.item.wallet.id,"profile-technical-id":a.item.wallet.technicalId,"space-id":a.item.wallet.spaceId,"profile-type":a.item.wallet.type,"display-name":a.item.wallet.name,enabled:a.item.wallet.enabled,"disabled-in-reward-pool":a.item.disabledPool,"deleted-user":a.item.wallet.deletedUser,"disabled-user":a.item.wallet.disabledUser,avatar:a.item.wallet.avatar,"initialization-state":a.item.wallet.initializationState,"display-no-address":""}})],1),e._v(" "),t("td",{staticClass:"text-start"},[a.item.teams?t("ul",e._l(a.item.teams,(function(a){return t("li",{key:a.id},[a.disabled?[t("del",{staticClass:"red--text"},[e._v(e._s(a.name))]),e._v(" ("+e._s(e.$t("exoplatform.wallet.label.disabledPool"))+")\n              ")]:[e._v("\n                "+e._s(a.name)+"\n              ")]],2)})),0):t("div",[e._v("\n            -\n          ")])]),e._v(" "),t("td",{staticClass:"text-center"},[a.item.transaction&&a.item.transaction.hash?t("a",{attrs:{href:`${e.transactionEtherscanLink}${a.item.transaction.hash}`,title:e.$t("exoplatform.wallet.label.openOnEtherscan"),target:"_blank"}},[e._v("\n            "+e._s(e.$t("exoplatform.wallet.label.openOnEtherscan"))+"\n          ")]):t("span",[e._v("\n            -\n          ")])]),e._v(" "),t("td",{staticClass:"text-center"},[a.item.status?"pending"===a.item.status?t("v-progress-circular",{attrs:{color:"primary",indeterminate:"",size:"20"}}):t("v-icon",{attrs:{color:"success"===a.item.status?"success":"error",title:"success"===a.item.status?"Successfully proceeded":"pending"===a.item.status?"Transaction in progress":"Transaction error"},domProps:{textContent:e._s("success"===a.item.status?"fa-check-circle":"fa-exclamation-circle")}}):[a.item.wallet.address?a.item.tokensToSend?t("div",[e._v("\n              -\n            ")]):t("v-icon",{attrs:{title:e.$t("exoplatform.wallet.label.noEnoughEarnedPoints"),color:"warning"}},[e._v("\n              warning\n            ")]):t("v-icon",{attrs:{title:e.$t("exoplatform.wallet.label.noAddress"),color:"warning"}},[e._v("\n              warning\n            ")])]],2),e._v(" "),t("td",{staticClass:"text-center"},[a.item.tokensSent?t("span",{staticClass:"grey--text text--darken-1",attrs:{title:e.$t("exoplatform.wallet.label.amountSent")}},[e._v("\n            "+e._s(e.walletUtils.toFixed(a.item.tokensSent))+" "+e._s(e.symbol)+"\n          ")]):a.item.tokensToSend?t("span",{attrs:{title:e.$t("exoplatform.wallet.label.amountToSend")}},[e._v("\n            "+e._s(e.walletUtils.toFixed(a.item.tokensToSend))+" "+e._s(e.symbol)+"\n          ")]):t("span",{staticClass:"grey--text text--darken-1",attrs:{title:e.$t("exoplatform.wallet.label.noRewardsForPeriod")}},[e._v("\n            0 "+e._s(e.symbol)+"\n          ")])]),e._v(" "),t("td",[t("v-btn",{attrs:{disabled:!a.item.rewards||!a.item.rewards.length,title:e.$t("exoplatform.wallet.label.displayRewardDetails"),icon:"",small:""},on:{click:function(t){e.selectedWallet=a.item}}},[t("v-icon",{attrs:{color:a.item.rewards&&a.item.rewards.length&&"primary",size:"16"}},[e._v("fa-info-circle")])],1)],1)])]}}])},[e._v(" "),t("template",{slot:"body.append"},[t("tr",[t("td",{attrs:{colspan:e.identitiesHeaders.length-2}},[t("strong",[e._v("\n            "+e._s(e.$t("exoplatform.wallet.label.total"))+"\n          ")])]),e._v(" "),t("td",{attrs:{colspan:"2"}},[t("strong",{staticClass:"ms-7"},[e._v("\n            "+e._s(e.totalTokens)+" "+e._s(e.symbol)+"\n          ")])])])])],2),e._v(" "),t("v-card-actions",[t("v-spacer"),e._v(" "),t("v-btn",{staticClass:"btn btn-primary ps-2 pe-2",attrs:{loading:e.sendingRewards,disabled:e.sendingRewardsDisabled},on:{click:e.sendRewards}},[e._v("\n      "+e._s(e.$t("exoplatform.wallet.button.sendRewards"))+"\n    ")]),e._v(" "),t("v-spacer")],1),e._v(" "),t("wallet-reward-reward-detail-modal",{ref:"rewardDetails",attrs:{wallet:e.selectedWallet,period:e.periodDatesDisplay,symbol:e.symbol},on:{closed:function(t){e.selectedWallet=null}}})],1)};u._withStripped=!0;const p=i({props:{rewardReport:{type:Object,default:function(){return null}},adminWallet:{type:Object,default:function(){return null}},periodDatesDisplay:{type:String,default:function(){return null}},totalRewards:{type:Array,default:function(){return[]}},contractDetails:{type:Object,default:function(){return null}},transactionEtherscanLink:{type:String,default:function(){return null}}},data:()=>({search:"",id:`DatePicker${Date.now()}`,menuId:`DatePickerMenu${Date.now()}`,currentTimeInSeconds:Date.now()/1e3,displayDisabledUsers:!1,selectedDate:`${(new Date).getFullYear()}-${(new Date).getMonth()+1}-${(new Date).getDate()}`,selectedDateMenu:!1,loading:!1,sendingRewards:!1,selectedWallet:null,lang:"en"}),computed:{identitiesHeaders(){return[{text:"",align:"end",sortable:!1,value:"avatar",width:"36px"},{text:this.$t("exoplatform.wallet.label.name"),align:"start",sortable:!0,value:"wallet.name"},{text:this.$t("exoplatform.wallet.label.pools"),align:"center",sortable:!0,value:"poolName"},{text:this.$t("exoplatform.wallet.label.transaction"),align:"center",sortable:!0,value:"transaction.timestamp"},{text:this.$t("exoplatform.wallet.label.status"),align:"center",sortable:!0,value:"status"},{text:this.contractDetails&&this.contractDetails.name,align:"center",sortable:!0,value:"tokensToSend",width:"80px"},{text:"",align:"center",sortable:!1,value:"rewards",width:"80px"}]},adminBalance(){return this.adminWallet&&this.walletUtils.toFixed(this.adminWallet.tokenBalance)||0},adminBalanceTooLow(){return this.rewardReport&&this.adminWallet&&this.rewardReport.remainingTokensToSend&&this.adminWallet.tokenBalance<this.rewardReport.remainingTokensToSend},walletRewards(){return this.rewardReport&&this.rewardReport.rewards||[]},period(){return this.rewardReport&&this.rewardReport.period},periodType(){return this.period&&this.period.rewardPeriodType},sentBudget(){return this.rewardReport&&this.walletUtils.toFixed(this.rewardReport.tokensSent)||0},totalBudget(){return this.rewardReport&&this.walletUtils.toFixed(this.rewardReport.tokensToSend)||0},validRewardCount(){return this.rewardReport&&this.rewardReport.validRewardCount||0},sendingRewardsDisabled(){if(this.isNotPastPeriod)return!0;if(!this.walletRewards||!this.walletRewards.length)return!0;let e=!0;for(const t in this.walletRewards){const a=this.walletRewards[t];if("pending"===a.status)return!0;!a.enabled||!a.tokensToSend||a.status&&"error"!==a.status||(e=!1)}return e},symbol(){return this.contractDetails&&this.contractDetails.symbol?this.contractDetails.symbol:""},filteredIdentitiesList(){return this.walletRewards&&this.walletRewards.filter((e=>(this.displayDisabledUsers||e.enabled||e.tokensSent||e.tokensToSend)&&this.filterItemFromList(e,this.search)))||[]},isNotPastPeriod(){return!this.period||this.period.endDateInSeconds>this.currentTimeInSeconds},totalTokens(){if(this.filteredIdentitiesList){let e=0;return this.filteredIdentitiesList.forEach((t=>{e+=t.tokensSent?t.tokensSent?Number(t.tokensSent):0:t.tokensToSend&&t.tokensToSend>0?Number(t.tokensToSend):0})),this.walletUtils.toFixed(e)}return 0},selectedCompleteDateDate(){return 4===this.selectedDate.length?`${this.selectedDate}-01-01`:7===this.selectedDate.length?`${this.selectedDate}-01`:this.selectedDate.length>10?this.selectedDate.substring(0,10):this.selectedDate}},mounted(){$(".datePickerComponent input").on("click",(e=>{e.target&&!$(e.target).parents(`#${this.id}`).length&&(this.selectedDateMenu=!1)})),$(document).on("click",(e=>{e.target&&!$(e.target).parents(`.${this.menuId}`).length&&(this.selectedDateMenu=!1)}))},watch:{selectedWallet(){this.selectedWallet&&this.$refs.rewardDetails.open()},selectedCompleteDateDate(){if(this.selectedCompleteDateDate)return this.loading=!0,this.lang=eXo.env.portal.language,this.$rewardService.getRewardDates(this.selectedCompleteDateDate).then((e=>{this.$emit("dates-changed",e)})).finally((()=>this.loading=!1))}},methods:{filterItemFromList(e,t){if(!t||!t.length)return!0;if(t=t.trim().toLowerCase(),(e&&e.wallet&&e.wallet.name&&e.wallet.name.toLowerCase()).indexOf(t)>-1)return!0;if((e&&e.wallet&&e.wallet.address&&e.wallet.address.toLowerCase()).indexOf(t)>-1)return!0;const a=e&&e.poolName&&e.poolName.toLowerCase();return"-"===t||a.indexOf(t)>-1},sendRewards(){this.error=null,this.sendingRewards=!0,this.$rewardService.sendRewards(this.selectedCompleteDateDate).catch((e=>{this.error=String(e)})).finally((()=>{this.$emit("refresh"),this.sendingRewards=!1}))}}},u,[],!1,null,null,null).exports;var h=function(){var e=this,t=e._self._c;return t("v-card",{staticClass:"pt-4",attrs:{flat:""}},[e.error&&"{}"!=String(e.error).trim()?t("v-card-title",{staticClass:"text-center"},[t("div",{staticClass:"alert alert-error v-content"},[t("i",{staticClass:"uiIconError"}),e._v(" "+e._s(e.error)+"\n    ")])]):e._e(),e._v(" "),t("v-container",{staticClass:"pt-2",attrs:{"grid-list-md":"",flat:""}},[t("v-layout",{staticClass:"rewardPoolForm",attrs:{wrap:"",flat:""}},[e.viewOnly?e._e():t("v-flex",{attrs:{xs12:"",sm6:""}},[t("v-text-field",{attrs:{label:e.$t("exoplatform.wallet.label.poolName"),placeholder:e.$t("exoplatform.wallet.label.poolNamePlaceholder"),name:"name",required:"",autofocus:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),e.viewOnly?e._e():t("v-flex",{attrs:{xs12:"",sm6:""}},[t("v-text-field",{attrs:{label:e.$t("exoplatform.wallet.label.poolDescription"),placeholder:e.$t("exoplatform.wallet.label.poolDescriptionPlaceholder"),name:"description"},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}})],1),e._v(" "),e.viewOnly?e._e():t("v-flex",{staticClass:"contactAutoComplete",attrs:{id:"rewardTeamSpaceAutoComplete",xs12:"",sm6:""}},[t("v-autocomplete",{ref:"rewardTeamSpaceAutoComplete",staticClass:"contactAutoComplete",attrs:{items:e.rewardTeamSpaceOptions,"items-per-page":1e3,loading:e.isLoadingSpaceSuggestions,"search-input":e.rewardTeamSpaceSearchTerm,label:e.$t("exoplatform.wallet.label.poolSpace"),placeholder:e.$t("exoplatform.wallet.label.poolSpacePlaceholder"),attach:"#rewardTeamSpaceAutoComplete","content-class":"contactAutoCompleteContent bigContactAutoComplete","max-width":"100%","item-text":"name","item-value":"id","hide-details":"","hide-selected":"",chips:"","cache-items":"",dense:"",flat:""},on:{"update:searchInput":function(t){e.rewardTeamSpaceSearchTerm=t},"update:search-input":function(t){e.rewardTeamSpaceSearchTerm=t}},scopedSlots:e._u([{key:"selection",fn:function({item:a,selected:r}){return[a.error?t("v-chip",{staticClass:"autocompleteSelectedItem",attrs:{"input-value":r}},[t("del",[t("span",[e._v("\n                  "+e._s(a.name)+"\n                ")])])]):t("v-chip",{staticClass:"autocompleteSelectedItem",attrs:{"input-value":r}},[t("span",[e._v("\n                "+e._s(a.name)+"\n              ")])])]}},{key:"item",fn:function({item:a}){return[a.avatar?t("v-list-item-avatar",{attrs:{size:"20"}},[t("img",{attrs:{src:a.avatar}})]):e._e(),e._v(" "),t("v-list-item-title",{domProps:{textContent:e._s(a.name)}})]}}],null,!1,1787041010),model:{value:e.rewardTeamSpace,callback:function(t){e.rewardTeamSpace=t},expression:"rewardTeamSpace"}},[t("template",{slot:"no-data"},[t("v-list-item",[t("v-list-item-title",[e._v("\n                "+e._s(e.$t("exoplatform.wallet.label.poolSpaceSearchPlaceholder"))+"\n              ")])],1)],1)],2)],1),e._v(" "),e.viewOnly?e._e():t("wallet-reward-address-auto-complete",{ref:"managerAutocomplete",staticClass:"xs12 sm6",attrs:{"input-label":e.$t("exoplatform.wallet.label.poolManager"),"input-placeholder":e.$t("exoplatform.wallet.label.poolManagerPlaceholder"),"no-data-label":e.$t("exoplatform.wallet.label.poolManagerSearchPlaceholder"),"no-address":"","big-field":""},on:{"item-selected":function(t){e.manager=t&&t.id}}}),e._v(" "),e.viewOnly?e._e():t("v-flex",{attrs:{xs12:""}},[t("v-radio-group",{attrs:{label:e.$t("exoplatform.wallet.label.poolMembers")},model:{value:e.rewardType,callback:function(t){e.rewardType=t},expression:"rewardType"}},[t("v-radio",{attrs:{value:"COMPUTED",label:e.$t("exoplatform.wallet.label.rewardPoolComputedBudget")}}),e._v(" "),t("v-radio",{attrs:{value:"FIXED",label:e.$t("exoplatform.wallet.label.rewardPoolFixedBudget")}}),e._v(" "),t("v-flex",{attrs:{xs12:"",sm6:""}},["FIXED"===e.rewardType?t("v-text-field",{staticClass:"pt-0 pb-0",attrs:{placeholder:e.$t("exoplatform.wallet.label.rewardFixedBudgetPlaceholder"),type:"number",name:"budget"},model:{value:e.budget,callback:function(t){e.budget=t},expression:"budget"}}):e._e()],1),e._v(" "),t("v-radio",{attrs:{value:"FIXED_PER_MEMBER",label:"By a fixed budget per eligible member (not retained from global budget)"}}),e._v(" "),"FIXED_PER_MEMBER"===e.rewardType?t("v-flex",{attrs:{xs12:"",sm6:""}},[t("v-text-field",{staticClass:"pt-0 pb-0",attrs:{placeholder:e.$t("exoplatform.wallet.label.rewardFixedBudgetPerMemberPlaceholder"),type:"number",name:"budget"},model:{value:e.budget,callback:function(t){e.budget=t},expression:"budget"}})],1):e._e()],1)],1),e._v(" "),t("v-flex",{attrs:{xs12:""}},[e.viewOnly?e._e():t("wallet-reward-address-auto-complete",{ref:"memberAutocomplete",attrs:{"ignore-items":e.members,"input-label":e.$t("exoplatform.wallet.label.poolMembers"),"input-placeholder":e.$t("exoplatform.wallet.label.poolMemberPlaceholder"),"no-data-label":e.$t("exoplatform.wallet.label.poolMemberSearchPlaceholder"),"no-address":"","big-field":""},on:{"item-selected":function(t){return e.addMember(t)}}}),e._v(" "),t("v-data-table",{staticClass:"elevation-1 mt-2",attrs:{items:e.membersObjects,"items-per-page":1e3,"item-key":"id",sortable:"","hide-default-footer":""},scopedSlots:e._u([{key:"headers",fn:function(a){return[t("tr",[t("th",{staticClass:"text-center",attrs:{colspan:"2"}},[e._v("\n                "+e._s(e.$t("exoplatform.wallet.label.name"))+"\n              ")]),e._v(" "),t("th",{staticClass:"text-end"},[e.viewOnly?e._e():t("v-btn",{attrs:{title:e.$t("exoplatform.wallet.button.deleteAll"),icon:""},on:{click:function(t){e.members=[]}}},[t("v-icon",[e._v("\n                    delete\n                  ")])],1)],1)])]}},{key:"item",fn:function(a){return[t("tr",[t("td",{staticClass:"text-start"},[t("v-avatar",{attrs:{size:"36px"}},[t("img",{attrs:{src:a.item.avatar,onerror:"this.src = '/eXoSkin/skin/images/system/SpaceAvtDefault.png'"}})])],1),e._v(" "),t("td",{staticClass:"text-center"},[t("wallet-reward-profile-chip",{attrs:{address:a.item.address,"profile-id":a.item.id,"profile-technical-id":a.item.technicalId,"space-id":a.item.spaceId,"profile-type":a.item.type,"display-name":a.item.name,enabled:a.item.enabled,"deleted-user":a.item.deletedUser,"disabled-user":a.item.disabledUser,avatar:a.item.avatar,"display-no-address":""}})],1),e._v(" "),t("td",{staticClass:"text-end"},[e.viewOnly?e._e():t("v-btn",{attrs:{title:e.$t("exoplatform.wallet.button.delete"),icon:""},on:{click:function(t){return e.deleteMember(a.item)}}},[t("v-icon",[e._v("\n                    delete\n                  ")])],1)],1)])]}}])},[t("template",{slot:"no-data"},[t("tr",[t("td",{staticClass:"text-center",attrs:{colspan:"3"}},[e._v("\n                "+e._s(e.$t("exoplatform.wallet.label.noMembersInPool"))+"\n              ")])])])],2)],1)],1)],1),e._v(" "),t("v-card-actions",[t("v-spacer"),e._v(" "),e.viewOnly?e._e():t("v-btn",{staticClass:"btn btn-primary me-1",attrs:{loading:e.loading,dark:""},on:{click:e.save}},[e._v("\n      "+e._s(e.$t("exoplatform.wallet.button.save"))+"\n    ")]),e._v(" "),t("v-btn",{staticClass:"btn",attrs:{color:"white"},on:{click:function(t){return e.$emit("close")}}},[e._v("\n      "+e._s(e.$t("exoplatform.wallet.button.close"))+"\n    ")]),e._v(" "),t("v-spacer")],1)],1)};h._withStripped=!0;const v=i({props:{team:{type:Object,default:function(){return null}},teams:{type:Array,default:function(){return[]}},walletRewards:{type:Array,default:function(){return[]}}},data:()=>({loading:!1,error:null,id:null,name:"",description:"",rewardType:"COMPUTED",budget:"",computedBudget:0,memberSelection:null,manager:null,managerObject:null,members:[],membersObjects:[],rewardTeamSpace:null,rewardTeamSpaceId:null,rewardTeamSpaceOptions:[],rewardTeamSpaceSearchTerm:null,isLoadingSpaceSuggestions:!1}),computed:{viewOnly(){return this.team&&this.team.noTeam}},watch:{team(){this.team&&this.init()},rewardTeamSpace(e,t){if(t&&(this.rewardTeamSpaceSearchTerm=null,this.$refs.rewardTeamSpaceAutoComplete.isFocused=!1),this.rewardTeamSpaceId=null,this.rewardTeamSpaceOptions&&this.rewardTeamSpaceOptions.length){const e=this.rewardTeamSpaceOptions.find((e=>e.name===this.rewardTeamSpace||e.id===this.rewardTeamSpace));this.rewardTeamSpaceId=e&&e.technicalId,e&&e.members&&e.members.length&&(this.members=e.members&&e.members.slice())}},rewardTeamSpaceSearchTerm(){this.rewardTeamSpaceSearchTerm&&(this.isLoadingSuggestions=!0,this.addressRegistry.searchSpaces(this.rewardTeamSpaceSearchTerm,!0).then((e=>{this.rewardTeamSpaceOptions=e||[],this.isLoadingSpaceSuggestions=!1})).catch((e=>{console.error("searchSpaces method - error",e),this.isLoadingSpaceSuggestions=!1})))},manager(){if(!this.manager||!this.manager.length)return void(this.managerObject=null);const e=this.membersObjects&&this.membersObjects.find((e=>e.id===this.manager&&"user"===e.type));if(e)this.managerObject=e;else{const e=this.walletRewards.find((e=>e.wallet&&e.wallet.id===this.manager&&"user"===e.wallet.type));e?this.managerObject=Object.assign({identityId:e.wallet.technicalId},e.wallet):this.addressRegistry.searchWalletByTypeAndId(this.manager,"user").then((e=>{e&&(this.managerObject=Object.assign({identityId:e.technicalId},e))}))}},members(){const e=this.membersObjects;this.membersObjects=[],this.members&&this.members.length&&this.members.forEach((t=>{const a=e&&e.find((e=>e.id===t&&"user"===e.type));if(a)this.membersObjects.push(a);else{const e=this.walletRewards.find((e=>e.wallet&&e.wallet.id===t&&"user"===e.wallet.type));e?this.membersObjects.push(Object.assign({identityId:e.wallet.technicalId},e.wallet)):this.addressRegistry.searchWalletByTypeAndId(t,"user").then((e=>{e&&this.membersObjects.push(Object.assign({identityId:e.technicalId},e))}))}}))}},methods:{init(){this.$refs&&this.$refs.managerAutocomplete&&this.$refs.managerAutocomplete.clear(),this.$refs&&this.$refs.memberAutocomplete&&this.$refs.memberAutocomplete.clear(),this.error=null,this.loading=!1,this.id=this.team&&this.team.id,this.name=this.team&&this.team.name||"",this.description=this.team&&this.team.description||"",this.rewardType=this.team&&this.team.rewardType||"COMPUTED",this.budget=this.team&&this.team.budget||"",this.computedBudget=this.team&&this.team.computedBudget||"0",this.manager=null,this.members=[],this.rewardTeamSpace=null,this.rewardTeamSpaceId=null,this.rewardTeamSpaceSearchTerm=null,this.isLoadingSpaceSuggestions=!1,this.team&&(this.team.spacePrettyName&&this.team.spaceId&&this.addressRegistry.searchSpaces(this.team.spacePrettyName).then((e=>{this.rewardTeamSpaceOptions=e||[],this.rewardTeamSpaceOptions.find((e=>e.id===this.team.spaceId))||this.rewardTeamSpaceOptions.push({id:this.team.spacePrettyName,technicalId:this.team.spaceId,name:this.team.spacePrettyName}),this.rewardTeamSpace=this.team.spacePrettyName,this.rewardTeamSpaceId=this.team.spaceId})),this.manager=this.team.manager&&this.team.manager.id,this.$refs&&this.$refs.managerAutocomplete&&this.$refs.managerAutocomplete.selectItem(this.manager,this.manager&&"user"),this.team.members&&this.team.members.length?this.members=this.team.members.map((e=>e.id)):this.members=[])},deleteMember(e){if(e){const t=this.members.indexOf(e.id);t>=0&&this.members.splice(t,1)}},addMember(e){if(!e||!e.id)return;this.error="";let t=this.teams||[];t=t.filter((t=>t.id&&t.id!==this.team.id&&t.members&&t.members.filter((t=>t.id===e.id)).length)),t&&t.length?this.error=this.$t("exoplatform.wallet.warning.memberDuplicatedInOtherPool",{0:e.name,1:t[0].name}):this.members?this.members.indexOf(e.id)<0&&this.members.push(e.id):this.members=[e.id],this.$refs.memberAutocomplete.selectItem(null)},save(){if(this.error=null,this.name){if(this.teams&&this.teams.length&&(!this.id||this.name!==this.team.name)){let e=!1;if(this.teams.forEach((t=>{e=e||t.name.toLowerCase()===this.name.toLowerCase()&&this.id!==t.id})),e)return void(this.error=this.$t("exoplatform.wallet.warning.poolNameAlreadyExists"))}this.loading=!0;try{const e=this.membersObjects&&this.membersObjects.map((e=>Object({id:e.id,identityId:e.identityId})));this.team&&this.team.members&&this.team.members.length&&e.forEach((e=>{const t=this.team.members.find((t=>String(t.identityId)===String(e.identityId)));t&&(e.technicalId=t.technicalId)}));const t={id:this.id,name:this.name,description:this.description,rewardType:this.rewardType,budget:this.budget&&Number(this.budget)||0,spacePrettyName:this.rewardTeamSpace,spaceId:this.rewardTeamSpaceId,members:e,manager:{id:this.manager,identityId:this.managerObject&&this.managerObject.identityId}};return this.$rewardService.saveRewardTeam(t).then((e=>{e?this.$emit("saved",e):(console.error("Error saving pool, response code is NOK"),this.error=this.$t("exoplatform.wallet.error.errorSavingPool"))})).catch((e=>{console.error("Error saving pool",e),this.error=this.$t("exoplatform.wallet.error.errorSavingPool")})).finally((()=>{this.loading=!1}))}catch(e){console.error("Error saving pool",e),this.error=this.$t("exoplatform.wallet.error.errorSavingPool"),this.loading=!1}}else this.error=this.$t("exoplatform.wallet.warning.poolNameIsMandatory")}}},h,[],!1,null,null,null).exports;var g=function(){var e=this,t=e._self._c;return t("v-flex",{attrs:{flat:"",transparent:""}},[t("wallet-reward-confirm-dialog",{ref:"deleteTeamConfirm",attrs:{loading:e.loading,message:e.deletePoolMessage,title:e.$t("exoplatform.wallet.label.deletePoolConfirmation"),"ok-label":e.$t("exoplatform.wallet.button.delete"),"cancel-label":"Cancel"},on:{ok:function(t){return e.removeTeam(e.teamToDelete.id)}}}),e._v(" "),t("wallet-reward-add-team-form",{directives:[{name:"show",rawName:"v-show",value:e.selectedTeam,expression:"selectedTeam"}],ref:"teamModal",attrs:{team:e.selectedTeam,teams:e.teams,"wallet-rewards":e.walletRewards},on:{saved:e.teamSaved,close:function(t){e.selectedTeam=null}}}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.selectedTeam,expression:"!selectedTeam"}],staticClass:"text-start ms-3",attrs:{id:"addTeamButton"}},[t("v-btn",{staticClass:"btn btn-primary pa-0",attrs:{title:e.$t("exoplatform.wallet.button.addNewPool"),color:"primary",icon:"",large:"",dark:""},on:{click:function(t){e.selectedTeam={}}}},[t("v-icon",{attrs:{dark:"",color:"white"}},[e._v("\n        add\n      ")])],1)],1),e._v(" "),t("h4",{directives:[{name:"show",rawName:"v-show",value:!e.selectedTeam,expression:"!selectedTeam"}],staticClass:"text-center"},[t("span",[e._v(e._s(e.$t("exoplatform.wallet.label.eligiblePoolsUsers"))+": "),t("strong",[e._v(e._s(e.eligiblePoolsUsersCount))])])]),e._v(" "),t("h4",{directives:[{name:"show",rawName:"v-show",value:!e.selectedTeam,expression:"!selectedTeam"}],staticClass:"text-center"},[t("span",[e._v(e._s(e.$t("exoplatform.wallet.label.totalPoolsBudget"))+": "),t("strong",[e._v(e._s(e.walletUtils.toFixed(e.poolsBudget))+" "+e._s(e.symbol))])])]),e._v(" "),t("v-container",{directives:[{name:"show",rawName:"v-show",value:!e.selectedTeam,expression:"!selectedTeam"}],attrs:{fluid:"","grid-list-md":""}},[t("v-data-iterator",{attrs:{items:e.teams,"items-per-page":1e3,"no-data-text":"","hide-default-footer":""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("v-row",e._l(a.items,(function(a){return t("v-col",{key:a.name,attrs:{cols:"12",sm:"12",md:"6",lg:"4"}},[t("v-card",{staticClass:"elevation-3",style:a.spacePrettyName&&`background: url(/portal/rest/v1/social/spaces/${a.spacePrettyName}/banner)  0 0/100% auto no-repeat`},[t("v-card",{staticClass:"transparent",attrs:{flat:""}},[t("v-card-title",{staticClass:"pb-0"},[t("v-chip",{attrs:{color:"transparent"}},[a.spacePrettyName?t("v-avatar",[t("img",{attrs:{src:`/portal/rest/v1/social/spaces/${a.spacePrettyName}/avatar`}})]):e._e(),e._v(" "),a.disabled?t("h3",{staticClass:"headline"},[t("del",{staticClass:"red--text"},[e._v(e._s(a.name))])]):t("h3",{staticClass:"headline"},[e._v("\n                      "+e._s(a.name)+"\n                    ")])],1)],1),e._v(" "),t("v-card-title",{staticClass:"pt-0"},[t("v-chip",{attrs:{color:"transparent"}},[a.description?t("h4",[e._v("\n                      "+e._s(a.description)+"\n                    ")]):t("h4",[t("i",[e._v(e._s(e.$t("exoplatform.wallet.label.noDescription")))])])])],1),e._v(" "),t("v-divider"),e._v(" "),t("v-list",{staticClass:"pb-0",attrs:{dense:""}},[t("v-list-item",[t("v-list-item-content",[e._v("\n                      "+e._s(e.$t("exoplatform.wallet.label.poolMembers"))+":\n                    ")]),e._v(" "),t("v-list-item-content",{staticClass:"align-end"},[e._v("\n                      "+e._s(a.members?a.members.length:0)+"\n                    ")])],1),e._v(" "),"FIXED"===a.rewardType?t("v-list-item",[t("v-list-item-content",[e._v("\n                      "+e._s(e.$t("exoplatform.wallet.label.fixedTotalbudget"))+":\n                    ")]),e._v(" "),t("v-list-item-content",{staticClass:"align-end"},[e._v("\n                      "+e._s(a.budget)+" "+e._s(e.symbol)+"\n                    ")])],1):e._e(),e._v(" "),"FIXED_PER_MEMBER"===a.rewardType?t("v-list-item",[t("v-list-item-content",[e._v("\n                      "+e._s(e.$t("exoplatform.wallet.label.fixedTotalbudget"))+":\n                    ")]),e._v(" "),t("v-list-item-content",{staticClass:"align-end"},[e._v("\n                      "+e._s(Number(e.walletUtils.toFixed(a.budget)))+" "+e._s(e.symbol)+"\n                    ")])],1):e._e(),e._v(" "),"COMPUTED"===a.rewardType?t("v-list-item",[t("v-list-item-content",[e._v("\n                      "+e._s(e.$t("exoplatform.wallet.label.budget"))+":\n                    ")]),e._v(" "),t("v-list-item-content",{staticClass:"align-end"},[e._v("\n                      "+e._s(e.$t("exoplatform.wallet.label.computed"))+"\n                    ")])],1):e._e(),e._v(" "),t("v-list-item",[t("v-flex",{staticClass:"align-start pe-1"},[t("v-divider")],1),e._v(" "),t("v-flex",{staticClass:"align-center"},[t("strong",[e._v("\n                        "+e._s(e.periodDatesDisplay)+"\n                      ")])]),e._v(" "),t("v-flex",{staticClass:"align-end ps-1"},[t("v-divider")],1)],1),e._v(" "),t("v-list-item",[t("v-list-item-content",[e._v("\n                      "+e._s(e.$t("exoplatform.wallet.label.eligiblePoolMembers"))+":\n                    ")]),e._v(" "),t("v-list-item-content",{staticClass:"align-end"},[e._v("\n                      "+e._s(a.validMembersWallets?a.validMembersWallets.length:0)+" / "+e._s(a.members?a.members.length:0)+"\n                    ")])],1),e._v(" "),t("v-list-item",[t("v-list-item-content",[e._v("\n                      "+e._s(e.$t("exoplatform.wallet.label.budget"))+":\n                    ")]),e._v(" "),Number(a.computedBudget)&&a.validMembersWallets&&a.validMembersWallets.length?t("v-list-item-content",{staticClass:"align-end"},[e._v("\n                      "+e._s(Number(e.walletUtils.toFixed(a.computedBudget)))+" "+e._s(e.symbol)+"\n                    ")]):t("v-list-item-content",{staticClass:"align-end red--text"},[t("strong",[e._v("\n                        0 "+e._s(e.symbol)+"\n                      ")])])],1),e._v(" "),t("v-list-item",[t("v-list-item-content",[e._v("\n                      "+e._s(e.$t("exoplatform.wallet.label.budgetPerMember"))+":\n                    ")]),e._v(" "),Number(a.computedBudget)&&a.validMembersWallets&&a.validMembersWallets.length?t("v-list-item-content",{staticClass:"align-end"},[e._v("\n                      "+e._s(e.walletUtils.toFixed(Number(a.computedBudget)/a.validMembersWallets.length))+" "+e._s(e.symbol)+"\n                    ")]):t("v-list-item-content",{staticClass:"align-end red--text"},[t("strong",[e._v("\n                        0 "+e._s(e.symbol)+"\n                      ")])])],1)],1)],1),e._v(" "),t("v-card-actions",[t("v-spacer"),e._v(" "),a.id?t("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){e.selectedTeam=a}}},[e._v("\n                  "+e._s(e.$t("exoplatform.wallet.button.edit"))+"\n                ")]):t("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){e.selectedTeam=a}}},[e._v("\n                  "+e._s(e.$t("exoplatform.wallet.button.view"))+"\n                ")]),e._v(" "),a.id&&a.disabled?t("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){return e.disableTeam(a,!1)}}},[e._v("\n                  "+e._s(e.$t("exoplatform.wallet.button.enable"))+"\n                ")]):a.id?t("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){return e.disableTeam(a,!0)}}},[e._v("\n                  "+e._s(e.$t("exoplatform.wallet.button.disable"))+"\n                ")]):e._e(),e._v(" "),a.id?t("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){e.teamToDelete=a,e.$refs.deleteTeamConfirm.open()}}},[e._v("\n                  "+e._s(e.$t("exoplatform.wallet.button.delete"))+"\n                ")]):e._e(),e._v(" "),t("v-spacer")],1)],1)],1)})),1)]}}])})],1)],1)};g._withStripped=!0;const w={"wallet-reward-app":s,"wallet-reward-reward-detail-modal":n,"wallet-reward-timezone-selectbox":d,"wallet-reward-configuration-tab":m,"wallet-reward-send-rewards-tab":p,"wallet-reward-add-team-form":v,"wallet-reward-teams-list-tab":i({props:{teams:{type:Array,default:function(){return[]}},walletRewards:{type:Array,default:function(){return[]}},contractDetails:{type:Object,default:function(){return null}},periodDatesDisplay:{type:String,default:function(){return null}}},data:()=>({teamToDelete:null,selectedTeam:null}),computed:{poolsBudget(){return this.walletRewards.reduce(((e,t)=>e+t.poolTokensToSend),0)},deletePoolMessage(){return this.teamToDelete&&`Would you like to delete pool <strong>${this.teamToDelete.name}</strong>`},symbol(){return this.contractDetails&&this.contractDetails.symbol?this.contractDetails.symbol:""},eligiblePoolsUsersCount(){return this.walletRewards.filter((e=>e.poolTokensToSend>0)).length}},watch:{selectedTeam(){this.selectedTeam?this.$emit("form-opened"):this.$emit("form-closed")}},methods:{teamSaved(){this.$emit("refresh-teams"),this.selectedTeam=null},disableTeam(e,t){if(0===e.id)return;const a=Object.assign({},e);return a.disabled=t,this.loading=!0,delete a.validMembersWallets,this.$rewardService.saveRewardTeam(a).then((()=>{this.$emit("refresh-teams")})).catch((e=>{console.error("Error saving pool",e),this.error=this.$t("exoplatform.wallet.error.errorSavingPool")})).finally((()=>{this.loading=!1}))},removeTeam(e){e<1&&console.error("Can't delete team with id",e),this.$rewardService.removeRewardTeam(e).then((e=>{e?(this.teamToDelete=null,this.$emit("refresh-teams")):this.error=this.$t("exoplatform.wallet.error.errorRemovingPool")})).catch((t=>{console.error("Error getting team with id",e,t),this.error=this.$t("exoplatform.wallet.error.errorRemovingPool")}))}}},g,[],!1,null,null,null).exports};for(const e in w)Vue.component(e,w[e]);const f=JSON.parse('["Africa/Abidjan","Africa/Accra","Africa/Addis_Ababa","Africa/Algiers","Africa/Asmara","Africa/Bamako","Africa/Bangui","Africa/Banjul","Africa/Bissau","Africa/Blantyre","Africa/Brazzaville","Africa/Bujumbura","Asia/Oral","Africa/Cairo","Africa/Casablanca","Africa/Ceuta","Africa/Conakry","Africa/Dakar","Africa/Dar_es_Salaam","Asia/Yekaterinburg","Africa/Djibouti","Africa/Douala","Africa/Freetown","Africa/Gaborone","Africa/Harare","Africa/El_Aaiun","Africa/Johannesburg","Africa/Juba","Africa/Kampala","Africa/Khartoum","Africa/Kinshasa","Africa/Lagos","Africa/Libreville","Africa/Lome","Africa/Kigali","Africa/Luanda","Africa/Lubumbashi","Africa/Lusaka","Africa/Malabo","Africa/Maputo","Africa/Mbabane","Africa/Mogadishu","Africa/Monrovia","Africa/Nairobi","Africa/Maseru","Africa/Ndjamena","Africa/Niamey","Africa/Nouakchott","Africa/Ouagadougou","Africa/Porto-Novo","Africa/Tunis","Africa/Sao_Tome","Africa/Tripoli","Africa/Windhoek","America/Adak","America/Argentina/Salta","America/Anchorage","America/Anguilla","America/Antigua","America/Araguaina","America/Argentina/Buenos_Aires","America/Argentina/Catamarca","America/Argentina/Cordoba","America/Argentina/Jujuy","America/Argentina/La_Rioja","America/Argentina/Mendoza","America/Argentina/Rio_Gallegos","America/Argentina/San_Juan","America/Argentina/San_Luis","America/Argentina/Tucuman","America/Aruba","America/Argentina/Ushuaia","America/Asuncion","America/Bahia_Banderas","America/Atikokan","America/Bahia","America/Barbados","America/Belem","America/Belize","America/Blanc-Sablon","America/Boa_Vista","America/Bogota","America/Boise","America/Cambridge_Bay","America/Campo_Grande","America/Cancun","America/Caracas","America/Cayenne","America/Cayman","America/Chicago","America/Chihuahua","America/Coral_Harbour","America/Costa_Rica","America/Creston","America/Cuiaba","America/Curacao","America/Danmarkshavn","America/Dawson","America/Dawson_Creek","America/Denver","America/Detroit","America/Dominica","America/Edmonton","America/Eirunepe","America/El_Salvador","America/Fortaleza","America/Glace_Bay","America/Godthab","America/Goose_Bay","America/Grand_Turk","America/Grenada","America/Guadeloupe","America/Guatemala","America/Guayaquil","America/Guyana","America/Halifax","America/Havana","America/Hermosillo","America/Indiana/Petersburg","America/Indiana/Tell_City","America/Indiana/Vevay","America/Indiana/Indianapolis","America/Indiana/Knox","America/Indiana/Marengo","America/Indiana/Vincennes","America/Indiana/Winamac","America/Inuvik","America/Iqaluit","America/La_Paz","America/Jamaica","America/Juneau","America/Kentucky/Louisville","America/Kentucky/Monticello","America/Kralendijk","America/Lima","America/Managua","America/Manaus","America/Los_Angeles","America/Lower_Princes","America/Maceio","America/Marigot","America/Martinique","America/Matamoros","America/Mazatlan","America/Menominee","America/Mexico_City","America/Merida","America/Metlakatla","America/Miquelon","America/Moncton","America/Monterrey","America/Montevideo","America/Montreal","America/Montserrat","America/Nassau","America/New_York","America/Nipigon","America/Nome","America/Noronha","America/North_Dakota/Beulah","America/North_Dakota/Center","America/North_Dakota/New_Salem","America/Ojinaga","America/Panama","America/Pangnirtung","America/Paramaribo","America/Phoenix","America/Port-au-Prince","America/Port_of_Spain","America/Porto_Velho","America/Puerto_Rico","America/Rainy_River","America/Rankin_Inlet","America/Recife","America/Regina","America/Resolute","America/Rio_Branco","America/Santa_Isabel","America/Santarem","America/Santiago","America/Santo_Domingo","America/Scoresbysund","America/Sao_Paulo","America/Sitka","America/St_Barthelemy","America/St_Johns","America/Thule","America/St_Kitts","America/St_Lucia","America/St_Thomas","America/St_Vincent","America/Swift_Current","America/Tegucigalpa","America/Thunder_Bay","America/Tijuana","America/Toronto","America/Tortola","America/Vancouver","America/Whitehorse","America/Winnipeg","America/Yakutat","America/Yellowknife","Antarctica/Macquarie","Arctic/Longyearbyen","Asia/Aden","Asia/Almaty","Asia/Amman","Asia/Anadyr","Asia/Aqtau","Asia/Aqtobe","Asia/Ashgabat","Asia/Baghdad","Asia/Bahrain","Asia/Bangkok","Asia/Baku","Asia/Chongqing","Asia/Beirut","Asia/Bishkek","Asia/Brunei","Asia/Choibalsan","Asia/Colombo","Asia/Damascus","Asia/Dhaka","Asia/Dili","Asia/Dubai","Asia/Dushanbe","Asia/Gaza","Asia/Harbin","Asia/Hebron","Asia/Ho_Chi_Minh","Asia/Hong_Kong","Asia/Hovd","Asia/Irkutsk","Asia/Jakarta","Asia/Jayapura","Asia/Kabul","Asia/Jerusalem","Asia/Kamchatka","Asia/Karachi","Asia/Kashgar","Asia/Kathmandu","Asia/Calcutta","Asia/Krasnoyarsk","Asia/Kuala_Lumpur","Asia/Kuching","Asia/Kuwait","Asia/Macau","Asia/Magadan","Asia/Makassar","Asia/Manila","Asia/Muscat","Asia/Nicosia","Asia/Novokuznetsk","Asia/Novosibirsk","Asia/Omsk","Asia/Phnom_Penh","Asia/Pontianak","Asia/Pyongyang","Asia/Qatar","Asia/Qyzylorda","Asia/Rangoon","Asia/Riyadh","Asia/Sakhalin","Asia/Samarkand","Asia/Seoul","Asia/Shanghai","Asia/Singapore","Asia/Taipei","Asia/Tashkent","Asia/Tbilisi","Asia/Tehran","Asia/Thimphu","Asia/Tokyo","Asia/Ulaanbaatar","Asia/Urumqi","Asia/Vientiane","Asia/Vladivostok","Asia/Yakutsk","Asia/Yerevan","Atlantic/Azores","Atlantic/Bermuda","Atlantic/Canary","Atlantic/Cape_Verde","Atlantic/Faroe","Atlantic/Madeira","Atlantic/Reykjavik","Atlantic/South_Georgia","Atlantic/St_Helena","Atlantic/Stanley","Australia/Adelaide","Australia/Brisbane","Australia/Broken_Hill","Australia/Currie","Australia/Darwin","Australia/Eucla","Australia/Hobart","Australia/Lindeman","Australia/Lord_Howe","Australia/Melbourne","Australia/Perth","Australia/Sydney","Europe/Amsterdam","Europe/Andorra","Europe/Athens","Europe/Belgrade","Europe/Bucharest","Europe/Berlin","Europe/Budapest","Europe/Chisinau","Europe/Bratislava","Europe/Brussels","Europe/Copenhagen","Europe/Dublin","Europe/Gibraltar","Europe/Guernsey","Europe/Helsinki","Europe/Isle_of_Man","Europe/Istanbul","Europe/Jersey","Europe/Kaliningrad","Europe/Kiev","Europe/Lisbon","Europe/Ljubljana","Europe/London","Europe/Luxembourg","Europe/Madrid","Europe/Malta","Europe/Mariehamn","Europe/Minsk","Europe/Monaco","Europe/Moscow","Europe/Oslo","Europe/Paris","Europe/Podgorica","Europe/Prague","Europe/Riga","Europe/Rome","Europe/Samara","Europe/San_Marino","Europe/Sarajevo","Europe/Simferopol","Europe/Skopje","Europe/Sofia","Europe/Stockholm","Europe/Tallinn","Europe/Tirane","Europe/Uzhgorod","Europe/Vaduz","Europe/Vatican","Europe/Vienna","Europe/Vilnius","Europe/Volgograd","Europe/Warsaw","Europe/Zagreb","Europe/Zaporozhye","Europe/Zurich","Indian/Antananarivo","Indian/Chagos","Indian/Christmas","Indian/Cocos","Indian/Comoro","Indian/Kerguelen","Indian/Mahe","Indian/Maldives","Indian/Mauritius","Indian/Mayotte","Indian/Reunion","Pacific/Apia","Pacific/Auckland","Pacific/Chatham","Pacific/Chuuk","Pacific/Easter","Pacific/Enderbury","Pacific/Fakaofo","Pacific/Efate","Pacific/Fiji","Pacific/Funafuti","Pacific/Galapagos","Pacific/Gambier","Pacific/Kwajalein","Pacific/Guadalcanal","Pacific/Guam","Pacific/Honolulu","Pacific/Johnston","Pacific/Kiritimati","Pacific/Kosrae","Pacific/Majuro","Pacific/Midway","Pacific/Marquesas","Pacific/Nauru","Pacific/Niue","Pacific/Norfolk","Pacific/Noumea","Pacific/Pago_Pago","Pacific/Palau","Pacific/Pitcairn","Pacific/Pohnpei","Pacific/Port_Moresby","Pacific/Rarotonga","Pacific/Saipan","Pacific/Tahiti","Pacific/Tarawa","Pacific/Tongatapu","Pacific/Wake","Pacific/Wallis"]'),b=[];function _(){if(b.length)return b;const e=new Date(0);return f.forEach((t=>{const a=new Intl.DateTimeFormat(eXo.env.portal.language,{timeZoneName:"long",second:"numeric",timeZone:t}).format(e);b.push({value:t,text:`${a.charAt(2).toUpperCase()+a.substring(3,a.length)} (${t})`})})),b}function A(){return fetch("/portal/rest/wallet/api/reward/settings",{method:"GET",credentials:"include"}).then((e=>e&&e.ok&&e.json())).then((e=>window.walletRewardSettings=e))}function y(e){return fetch("/portal/rest/wallet/api/reward/settings/save",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e&&e.ok))}function x(){return fetch("/portal/rest/wallet/api/reward/team/list",{method:"GET",credentials:"include"}).then((e=>e&&e.ok&&e.json()))}function S(e){return fetch("/portal/rest/wallet/api/reward/team/save",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e&&e.ok&&e.json()))}function T(e){return fetch(`/portal/rest/wallet/api/reward/team/remove?id=${e}`,{method:"GET",credentials:"include"}).then((e=>e&&e.ok))}function C(e){return fetch(`/portal/rest/wallet/api/reward/settings/getDates?date=${e}`,{credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>e&&e.ok&&e.json()))}function k(e){return fetch(`/portal/rest/wallet/api/reward/send?date=${e}`,{method:"GET",credentials:"include"}).then((e=>{if(!e||!e.ok){try{if(500===e.status)return e.json().then((e=>{throw e&&e.error&&e.error.length?new Error(e.error[0]):new Error("Error sending rewards")}))}catch(e){}throw new Error("Error sending rewards")}}))}function E(e){return fetch(`/portal/rest/wallet/api/reward/compute?date=${e}`,{method:"GET",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>{if(!e)throw new Error("Error computing rewards");try{return e.json().catch((()=>{throw new Error("Error computing rewards")}))}catch(e){throw new Error("Error computing rewards")}}))}function P(e){return fetch(`/portal/rest/wallet/api/reward/compute/user?date=${e}`,{method:"GET",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Error computing rewards")}))}Vue.prototype.$rewardService||window.Object.defineProperty(Vue.prototype,"$rewardService",{value:a}),Vue.use(Vuetify),Vue.use(WalletCommon);const D=new Vuetify(eXo.env.portal.vuetifyPreset),R=eXo&&eXo.env&&eXo.env.portal&&eXo.env.portal.language||"en",I=`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.addon.Wallet-${R}.json`,M="RewardApp";function B(){exoi18n.loadLanguageAsync(R,I).then((e=>{new Vue({template:`<wallet-reward-app id="${M}"></wallet-reward-app>`,i18n:e,vuetify:D}).$mount(`#${M}`)}))}return t})()));