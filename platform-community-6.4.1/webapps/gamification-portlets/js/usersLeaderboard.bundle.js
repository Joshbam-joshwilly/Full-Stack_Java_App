define((()=>(()=>{"use strict";var e={d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:()=>g});var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",[a("v-card",{staticClass:"pa-3",attrs:{flat:""}},[a("div",{staticClass:"UserGamificationHeader text-color d-flex"},[a("div",{staticClass:"align-start d-flex"},[a("div",{staticClass:"d-inline-block"},[e._v("\n          "+e._s(e.$t("exoplatform.gamification.userLeaderboard.title"))+"\n        ")]),e._v(" "),a("a",{staticClass:"d-inline-block mx-3",attrs:{href:e.infoUrl,title:e.$t("exoplatform.gamification.leaderboard.Howearnpoints")}},[a("i",{staticClass:"uiIconInformation uiIconLightBlue"})])]),e._v(" "),a("div",{staticClass:"flex-grow-1"}),e._v(" "),a("div",{staticClass:"align-end selectDomainFilterParent"},[a("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedDomain,expression:"selectedDomain"}],staticClass:"selectDomainFilter ignore-vuetify-classes mb-0",on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.selectedDomain=t.target.multiple?a:a[0]}}},e._l(e.domains,(function(e){return a("users-leaderboard-domain-option",{key:e.title,attrs:{domain:e}})})),1)])]),e._v(" "),a("v-tabs",{model:{value:e.selectedPeriod,callback:function(t){e.selectedPeriod=t},expression:"selectedPeriod"}},[a("v-tabs-slider",{attrs:{color:"tertiary"}}),e._v(" "),e._l(e.periods,(function(t){return a("v-tab",{key:t.value,attrs:{href:"#"+t.value}},[e._v("\n        "+e._s(t.text)+"\n      ")])}))],2),e._v(" "),a("v-tabs-items",{model:{value:e.selectedPeriod,callback:function(t){e.selectedPeriod=t},expression:"selectedPeriod"}},e._l(e.periods,(function(t){return a("v-tab-item",{key:t.value,attrs:{id:t.value,value:t.value}},[a("v-list",[e._l(e.users,(function(t){return a("users-leaderboard-profile",{key:t.username,attrs:{user:t,domains:e.domains}})})),e._v(" "),e.currentRank?[a("v-divider",{staticClass:"ma-0"}),e._v(" "),a("v-list-item",{staticClass:"disabled-background"},[a("div",{staticClass:"me-4"},[e._v("\n                "+e._s(e.$t("exoplatform.gamification.leaderboard.rank"))+"\n              ")]),e._v(" "),a("div",[a("v-avatar",{attrs:{color:"tertiary",size:"32"}},[e._v("\n                  "+e._s(e.currentRank)+"\n                ")])],1)])]:e._e()],2)],1)})),1),e._v(" "),e.canLoadMore?a("v-card-actions",[a("v-spacer"),e._v(" "),a("v-btn",{staticClass:"primary--text",attrs:{outlined:"",link:""},on:{click:e.loadNextPage}},[e._v("\n        "+e._s(e.$t("exoplatform.gamification.leaderboard.showMore"))+"\n      ")]),e._v(" "),a("v-spacer")],1):e._e()],1)],1)};function r(e,t,a,r,i,s,n,o){var l,d="function"==typeof e?e.options:e;if(t&&(d.render=t,d.staticRenderFns=a,d._compiled=!0),r&&(d.functional=!0),s&&(d._scopeId="data-v-"+s),n?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(n)},d._ssrRegister=l):i&&(l=o?function(){i.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:i),l)if(d.functional){d._injectStyles=l;var c=d.render;d.render=function(e,t){return l.call(t),c(e,t)}}else{var u=d.beforeCreate;d.beforeCreate=u?[].concat(u,l):[l]}return{exports:e,options:d}}a._withStripped=!0;var i=r({data:()=>({domains:[],users:[],periods:[{value:"WEEK",text:"WEEK"},{value:"MONTH",text:"MONTH"},{value:"ALL",text:"ALL"}],pageSize:10,limit:10,currentRank:null,selectedDomain:null,loading:null,selectedPeriod:"WEEK"}),computed:{infoUrl:()=>`${eXo.env.portal.context}/${eXo.env.portal.portalName}/contributions/programs`,canLoadMore(){return this.users&&this.limit<=this.users.length}},watch:{selectedPeriod(e,t){t&&this.refreshBoard()},selectedDomain(e,t){t&&this.refreshBoard()},limit(e,t){t&&this.refreshBoard()}},created(){this.retrieveDomains().then(this.refreshBoard).then((()=>(this.periods=[{value:"WEEK",text:this.$t("exoplatform.gamification.leaderboard.selectedPeriod.WEEK")},{value:"MONTH",text:this.$t("exoplatform.gamification.leaderboard.selectedPeriod.MONTH")},{value:"ALL",text:this.$t("exoplatform.gamification.leaderboard.selectedPeriod.ALL")}],this.$nextTick()))).finally((()=>this.$root.$applicationLoaded()))},methods:{refreshBoard(){const e=`domain=${this.selectedDomain&&this.selectedDomain.title||this.selectedDomain||""}&period=${this.selectedPeriod||"WEEK"}&capacity=${this.limit}`;return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/gamification/leaderboard/filter?${e}`,{credentials:"include"}).then((e=>e&&e.ok&&e.json())).then((e=>{const t=e&&e.find((e=>!e.socialId));t&&(this.currentRank=t.rank),this.users=e&&e.filter((e=>e.socialId)),this.users.sort(((e,t)=>t.score-e.score)),this.users.forEach(((e,t)=>{e.rank=t+1}))}))},retrieveDomains(){return fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/gamification/domains?type=ALL&sortByBudget=true`,{credentials:"include"}).then((e=>e&&e.ok&&e.json())).then((e=>{const t=e?.domains||[];t.forEach((e=>{if(!e||e.label||!e.title)return;const t=`exoplatform.gamification.gamificationinformation.domain.${e.title}`,a=this.$t(t);e.label=a===t&&this.$t(e.title)||a}));const a={title:"All",label:this.$t("exoplatform.gamification.leaderboard.domain.all")};this.domains=[a,...t],this.selectedDomain=a.title}))},loadNextPage(){this.limit+=this.pageSize}}},a,[],!1,null,null,null);i.options.__file="src/main/webapp/vue-app/usersLeaderboard/components/UsersLeaderboard.vue";const s=i.exports;var n=function(){var e=this,t=e.$createElement;return(e._self._c||t)("option",{domProps:{value:e.domain.title}},[e._v("\n  "+e._s(e.domain.label)+"\n")])};n._withStripped=!0;var o=r({props:{domain:{type:Object,default:()=>null}}},n,[],!1,null,null,null);o.options.__file="src/main/webapp/vue-app/usersLeaderboard/components/UsersLeaderboardDomainOption.vue";const l=o.exports;var d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-menu",{attrs:{"open-on-content-click":!1,"content-class":"userLeaderboardMenu","max-width":"250","open-on-hover":"","offset-x":"",left:""},scopedSlots:e._u([{key:"activator",fn:function(t){var r=t.on;return[a("v-list-item",e._g({attrs:{id:e.id},on:{hover:function(t){return e.$refs.chart.init()}}},r),[a("div",{staticClass:"me-3"},[a("v-avatar",{attrs:{color:e.currentUser?"tertiary":"",size:"32"}},[e._v("\n          "+e._s(e.user.rank)+"\n        ")])],1),e._v(" "),a("v-list-item-avatar",{staticClass:"me-4"},[a("v-img",{attrs:{"lazy-src":e.userAvatar,src:e.userAvatar,transition:"none",eager:""}})],1),e._v(" "),a("v-list-item-content",[a("v-list-item-title",[a("a",{staticClass:"text-color",attrs:{href:e.profileUrl}},[e._v("\n            "+e._s(e.user.fullname)+"\n          ")])])],1),e._v(" "),a("v-list-item-action",{staticClass:"me-4"},[e._v("\n        "+e._s(e.user.score)+"\n      ")])],1)]}}]),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[e._v(" "),a("users-leaderboard-chart",{ref:"chart",attrs:{open:e.menu,username:e.username,domains:e.domains}})],1)};d._withStripped=!0;var c=r({props:{user:{type:Object,default:()=>null},domains:{type:Array,default:()=>[]}},data:()=>({chartData:null,menu:!1}),computed:{id(){return this.user&&`users-leaderboarditem-${this.user.socialId}`||""},userAvatar(){return this.user&&this.user.avatarUrl||`${eXo.env.portal.context}/${eXo.env.portal.rest}/v1/social/users/${this.user.username}/avatar`},profileUrl(){return this.username&&`${eXo.env.portal.context}/${eXo.env.portal.portalName}/profile/${this.username}`},username(){return this.user&&this.user.remoteId},currentUser(){return this.username===eXo.env.portal.userName}}},d,[],!1,null,null,null);c.options.__file="src/main/webapp/vue-app/usersLeaderboard/components/UsersLeaderboardProfile.vue";const u=c.exports;var p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-card",{staticClass:"pa-0",attrs:{loading:e.loading,flat:""}},[a("v-flex",{staticClass:"usersLeaderboardChartParent",attrs:{id:e.id}})],1)};p._withStripped=!0;var h=r({props:{username:{type:String,default:function(){return null}},chartType:{type:String,default:function(){return"pie"}},domains:{type:Array,default:function(){return[]}},open:{type:Boolean,default:!1}},data:()=>({id:`Chart${parseInt(1e5*Math.random())}`,loading:!1,chartData:null,chart:null,echarts:null,colors:["#4ad66d","#ffe169","#ff8fa3","#20a8ea","#C155F4","#F7A35B","#A0C7FF","#FD6A6A","#059d98","#b7efc5","#dbb42c","#c9184a","#1273d4","#E65ABC","#00FF56","#B1F6FF","#FFFF46","#26a855","#f10000","#208b3a","#c9a227","#ffccd5","#134d9b","#E66CDC","#58D68B","#5CE6D3","#f16a27","#ac1c1e","#eda3ff","#1a7431","#a47e1b","#ff4d6d","#62b0de","#FF97D0","#92e03a","#f44336","#3d6d8a","#E0A5FF","#FF9DB8","#808080"]}),watch:{open(){this.open&&this.refresh()}},mounted(){this.refresh()},methods:{refresh(){this.loadChartData().then((()=>this.init()))},loadChartData(){return this.chartData?this.$nextTick().then((()=>this.chartData)):(this.loading=!0,new Promise(((e,t)=>{fetch(`${eXo.env.portal.context}/${eXo.env.portal.rest}/gamification/leaderboard/stats?username=${this.username}`,{credentials:"include"}).then((e=>e?.ok&&e.json())).then((t=>{this.chartData=t,t.forEach((e=>{const t=this.domains.find((t=>t.title===e.label));e.name=t?.label||this.$t("exoplatform.gamification.gamificationinformation.domain.others")})),this.$nextTick().then((()=>e(this.chartData)))})).catch((e=>t(e))).finally((()=>this.loading=!1))})))},init(){return new Promise(((e,t)=>{if(this.echarts)e(this.echarts);else try{window.require(["SHARED/eCharts"],(t=>{this.echarts=t,e(t)}))}catch(e){t(e)}})).then((e=>{const t=document.querySelector(`#${this.id}`);window.setTimeout((()=>{this.open&&(this.chart=e.init(t,null,{width:250,height:250}),this.chart.setOption({tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},color:this.colors,series:[{type:"pie",radius:["50%","70%"],label:{show:!1},data:this.chartData}]},!0))}),50)}))}}},p,[],!1,null,null,null);h.options.__file="src/main/webapp/vue-app/usersLeaderboard/components/UsersLeaderboardChart.vue";const m={"users-leaderboard":s,"users-leaderboard-domain-option":l,"users-leaderboard-profile":u,"users-leaderboard-chart":h.exports};for(const e in m)Vue.component(e,m[e]);Vue.use(Vuetify);const f=new Vuetify(eXo.env.portal.vuetifyPreset),v=eXo&&eXo.env&&eXo.env.portal&&eXo.env.portal.language||"en",_=`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.addon.Gamification-${v}.json`,b="usersLeaderboard";function g(){exoi18n.loadLanguageAsync(v,_).then((e=>{Vue.createApp({template:`<users-leaderboard id='${b}' />`,i18n:e,vuetify:f},`#${b}`,"Users Leaderboard")}))}return t})()));