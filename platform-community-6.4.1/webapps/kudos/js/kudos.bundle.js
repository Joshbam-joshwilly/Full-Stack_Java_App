define((()=>(()=>{"use strict";var e={d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:()=>Q});var i={};e.r(i),e.d(i,{computeActivityKudosList:()=>c,computeCommentKudosList:()=>p,countUserKudosSentByEntity:()=>k,getEntityKudos:()=>f,getKudosByPeriod:()=>I,getKudosByPeriodOfDate:()=>g,getKudosListByActivity:()=>y,getKudosReceived:()=>m,getKudosSent:()=>h,getPeriodDates:()=>w,registerActivityActionExtension:()=>S,registerActivityReactionTabs:()=>C,registerExternalExtensions:()=>x,registerFavoriteExtensions:()=>_,registerOverviewExtension:()=>b,resetActivityKudosList:()=>u,sendKudos:()=>v});var s=function(){var e=this,t=e._self._c;return e.id?t("a",{attrs:{id:e.componentId,title:e.id,href:e.url,rel:"nofollow",target:"_blank"}},[t("span",{domProps:{textContent:e._s(e.name)}})]):e._e()};function o(e,t,i,s,o,n,r,a){var d,l="function"==typeof e?e.options:e;if(t&&(l.render=t,l.staticRenderFns=i,l._compiled=!0),s&&(l.functional=!0),n&&(l._scopeId="data-v-"+n),r?(d=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),o&&o.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(r)},l._ssrRegister=d):o&&(d=a?function(){o.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:o),d)if(l.functional){l._injectStyles=d;var u=l.render;l.render=function(e,t){return d.call(t),u(e,t)}}else{var c=l.beforeCreate;l.beforeCreate=c?[].concat(c,d):[d]}return{exports:e,options:l}}s._withStripped=!0;const n=o({props:{technicalId:{type:String,default:function(){return null}},name:{type:String,default:function(){return null}},id:{type:String,default:function(){return null}},type:{type:String,default:function(){return null}}},data:()=>({componentId:`ReceiverLink${parseInt(1e4*Math.random()).toString().toString()}`}),computed:{url(){return"user"===this.type||"organization"===this.type?`${eXo.env.portal.context}/${eXo.env.portal.portalName}/profile/${this.id}`:`${eXo.env.portal.context}/g/:spaces:${this.id}/`}}},s,[],!1,null,null,null).exports,r=o({created(){document.addEventListener("exo-kudos-get-period",this.getPeriodDates),document.addEventListener("exo-kudos-get-kudos-list",this.getKudosList),this.$kudosService.registerExternalExtensions(this.$t("exoplatform.kudos.title.sendAKudos")),this.$kudosService.registerFavoriteExtensions(this.$t("exoplatform.kudos.label.to")),this.$kudosService.registerOverviewExtension(),this.$kudosService.registerActivityActionExtension(),this.$kudosService.registerActivityReactionTabs(),document.addEventListener("display-activity-details",this.getActivityInformations)},methods:{init(){this.initTiptip()},getActivityInformations(e){const t=e&&e.detail&&e.detail.type,i=e&&e.detail&&e.detail.id;return this.$kudosService.getEntityKudos(t,i).then((e=>{const s=e?e.length:0;this.$kudosService.registerActivityReactionTabs(t,i,s,e)}))},getPeriodDates(e){e&&e.detail&&e.detail.date&&e.detail.periodType&&this.$kudosService.getPeriodDates(e.detail.date,e.detail.periodType).then((e=>document.dispatchEvent(new CustomEvent("exo-kudos-get-period-result",{detail:{period:e}}))))},getKudosList(e){if(e&&e.detail&&(e.detail.date||e.detail.startDate&&e.detail.endDate)){document.dispatchEvent(new CustomEvent("exo-kudos-get-kudos-list-loading"));const t={};this.getKudosByDate(e.detail).then((e=>{e.forEach((e=>{t[e.senderId]?t[e.senderId].sent++:t[e.senderId]={name:e.senderFullName,identityId:e.senderIdentityId,id:e.senderId,url:e.senderURL,type:"user",avatar:e.senderAvatar,sent:1,received:0},t[e.receiverId]?t[e.receiverId].received++:t[e.receiverId]={name:e.receiverFullName,identityId:e.receiverIdentityId,id:e.receiverId,url:e.receiverURL,type:e.receiverType,avatar:e.receiverAvatar,sent:0,received:1}})),document.dispatchEvent(new CustomEvent("exo-kudos-get-kudos-list-result",{detail:{list:Object.values(t)}}))})).catch((e=>{document.dispatchEvent(new CustomEvent("exo-kudos-get-kudos-list-result",{detail:{error:e}}))}))}else console.error("Event seems to be empty, please verify the API usage")},getKudosByDate(e){return e.date?this.$kudosService.getKudosByPeriodOfDate(e.date):this.$kudosService.getKudosByPeriod(e.startDate,e.endDate)},initTiptip(){window.eXo=window.eXo?window.eXo:{},eXo.social=eXo.social?eXo.social:{},eXo.social.tiptip=eXo.social.tiptip?eXo.social.tiptip:{},eXo.social.tiptip.extraActions=eXo.social.tiptip.extraActions?eXo.social.tiptip.extraActions:[];const e=this.$t("exoplatform.kudos.button.sendKudos");eXo.social.tiptip.extraActions.find((e=>"profile-kudos"===e.id))||(eXo.social.tiptip.extraActions.push({id:"profile-kudos",appendContentTo(t,i,s){"USER"==(s=s&&"username"!==s&&"user"!==s&&"organization"!==s?"SPACE":"USER")&&t.append(`<a title="${e}"\n                class="sendKudosTipTipButton"\n                href="javascript:void(0);"\n                onclick="document.dispatchEvent(new CustomEvent('exo-kudos-open-send-modal',\n                    {'detail' : {'id' : '${i}', 'type': '${s}_TIPTIP', ignoreRefresh: true}}))">\n                  <i class="uiIcon fa fa-award uiIconKudosTipTip"></i>\n              </a>`)}}),$(".SendKudosButtonBanner").length||$(".profileMenuNav .profileMenuNavHeader .profileMenuApps").length&&eXo&&eXo.env&&eXo.env.portal&&eXo.env.portal.profileOwner&&eXo.env.portal.profileOwner!==eXo.env.portal.userName&&$(".profileMenuNav .profileMenuNavHeader .profileMenuApps").append(`<li class="SendKudosButtonBanner">\n              <a onclick="document.dispatchEvent(new CustomEvent('exo-kudos-open-send-modal',\n               {'detail' : {'id' : '${eXo.env.portal.profileOwner}', 'type': 'USER_PROFILE', ignoreRefresh: true}}));"\n               class="btn" href="javascript:void(0);">\n                <i class="uiIcon fa fa-award uiIconKudos"></i>\n                <span> ${e}</span>\n              </a>\n            </li>`))}}},void 0,void 0,!1,null,null,null).exports;var a=function(){var e=this,t=e._self._c;return e.disabled?e._e():t("v-app",{staticClass:"VuetifyApp",attrs:{id:"KudosApp",color:"transaprent",flat:""}},[t("kudos-api",{ref:"kudosAPI"}),e._v(" "),t("exo-drawer",{ref:"activityKudosDrawer",attrs:{width:"500px","hide-actions":"",id:"activityKudosDrawer",right:"","disable-pull-to-refresh":""},on:{closed:e.resetEditor}},[t("template",{slot:"title"},[t("span",{staticClass:"text-header-title"},[e._v("\n        "+e._s(e.$t("exoplatform.kudos.title.sendAKudos"))+"\n      ")])]),e._v(" "),t("template",{slot:"content"},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}],ref:"activityKudosForm",staticClass:"flex mx-4"},[t("div",{staticClass:"d-flex flex-column flex-grow-1"},[t("div",{staticClass:"d-flex flex-row pt-5 align-center"},[t("span",{staticClass:"text-header-title text-no-wrap"},[e._v(e._s(e.$t("exoplatform.kudos.content.to")))]),e._v(" "),e.isLinkedKudos?t("div",{staticClass:"d-flex flex-row pl-4 mb-2 kudosReceiverAttendeeItem"},[t("exo-identity-suggester",{ref:"kudosReceiverAutoComplete",staticClass:"user-suggester",attrs:{id:"kudosReceiverAutoComplete",labels:e.receiverSuggesterLabels,"search-options":e.searchOptions,"type-of-relations":e.typeOfRelation,"include-users":"",name:"kudosReceiver",width:"220"},model:{value:e.selectedReceiver,callback:function(t){e.selectedReceiver=t},expression:"selectedReceiver"}})],1):t("exo-user-avatar",{staticClass:"d-flex flex-row pl-4",attrs:{identity:e.identity,size:32,popover:!1}})],1),e._v(" "),e.isLinkedKudos?e._e():t("div",[t("div",{staticClass:"d-flex flex-row pt-5"},[t("span",{staticClass:"text-header-title"},[e._v(e._s(e.$t("exoplatform.kudos.choose.audience"))+" ")])]),e._v(" "),t("div",{staticClass:"d-flex flex-row"},[t("exo-identity-suggester",{ref:"audienceSuggester",staticClass:"user-suggester",attrs:{labels:e.spaceSuggesterLabels,"include-users":!1,width:220,name:"audienceAutocomplete","include-spaces":"","only-redactor":"",required:""},model:{value:e.audience,callback:function(t){e.audience=t},expression:"audience"}})],1)]),e._v(" "),t("div",{staticClass:"d-flex flex-row pt-5"},[t("span",{staticClass:"text-header-title"},[e._v(e._s(e.$t("exoplatform.kudos.title.message"))+" ")])]),e._v(" "),t("div",{staticClass:"d-flex flex-row pt-3"},[t("exo-activity-rich-editor",{key:e.spaceURL,ref:e.ckEditorId,staticClass:"flex",attrs:{"max-length":e.MESSAGE_MAX_LENGTH,"ck-editor-type":e.ckEditorId,placeholder:e.$t("exoplatform.kudos.label.kudosMessagePlaceholder"),"suggestor-type-of-relation":e.typeOfRelation,"suggester-space-u-r-l":e.spaceURL,autofocus:""},model:{value:e.kudosMessage,callback:function(t){e.kudosMessage=t},expression:"kudosMessage"}})],1),e._v(" "),e.kudosMessageValidityLabel?t("div",{staticClass:"d-flex flex-row pt-3"},[t("span",{staticClass:"text-sm-caption error--text"},[e._v("\n              "+e._s(e.kudosMessageValidityLabel)+"\n            ")])]):e._e(),e._v(" "),t("div",{staticClass:"d-flex flex-row pt-3"},[t("span",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:e.$t("exooplatform.kudos.label.numberOfKudosAllowed",e.$t(e.KudosAllowedInfo)),expression:"$t('exooplatform.kudos.label.numberOfKudosAllowed', $t(KudosAllowedInfo))"}]})]),e._v(" "),e.kudosSent?t("div",{staticClass:"d-flex flex-row pt-3"},[t("span",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:e.$t("exooplatform.kudos.label.numberOfKudosSent",e.$t(e.KudosSentInfo)),expression:"$t('exooplatform.kudos.label.numberOfKudosSent', $t(KudosSentInfo))"}],on:{click:function(t){return e.handler(t)}}})]):e._e()])])]),e._v(" "),t("template",{slot:"footer"},[t("div",{staticClass:"d-flex justify-end"},[t("v-btn",{staticClass:"btn me-2",attrs:{"aria-label":e.$t("Confirmation.label.Cancel")},on:{click:function(t){return e.$refs.activityKudosDrawer.close()}}},[e._v("\n          "+e._s(e.$t("Confirmation.label.Cancel"))+"\n        ")]),e._v(" "),t("v-btn",{staticClass:"btn btn-primary me-2",attrs:{disabled:e.sendButtonDisabled,"aria-label":e.$t("exoplatform.kudos.button.send")},on:{click:e.send}},[e._v("\n          "+e._s(e.$t("exoplatform.kudos.button.send"))+"\n        ")])],1)])],2),e._v(" "),t("kudos-overview-drawer",{ref:"kudosOverviewDrawer"})],1)};function d(e,t,i){const s={type:t,id:i};return(window.kudosSettings.accessPermission&&"user"===t?fetch(`/portal/rest/kudos/api/account/isAuthorized?username=${e}`,{credentials:"include"}):Promise.resolve({ok:!0})).then((i=>{if(!i||!i.ok)throw s.notAuthorized=!0,new Error;return"user"===t?fetch(`/portal/rest/v1/social/users/${e}`,{credentials:"include"}).then((e=>e&&e.ok&&e.json())).then((e=>(e?(s.id=e.username,s.identityId=e.id,s.fullname=e.fullname,s.avatar=e.avatar,s.username=e.username,s.position=e.position,s.external=e.external):s.notAuthorized=!0,s))):fetch(`/portal/rest/v1/social/spaces/${e}`,{credentials:"include"}).then((e=>e&&e.ok&&e.json())).then((e=>(e?(s.identityId=e.id,s.fullname=e.displayName,s.avatar=e.avatar):s.notAuthorized=!0,s)))})).catch((e=>(console.error("Error identity details with remoteId",i,e),s)))}a._withStripped=!0;const l={};function u(e){delete e.kudosList,delete l[e.id]}function c(e){return(l[e.id]=e&&e.kudosList&&Promise.resolve(e.kudosList)||y(e.id)).then((t=>{l[e.id]=t;const i=Number(e.id);return e.kudos=t.find((e=>e.activityId===i)),e.linkedKudosList=t.filter((t=>t.entityId===e.id)),t}))}function p(e,t){const i=l[e.id];return i?(i.then?i:Promise.resolve(i)).then((e=>(t.kudos=e.find((e=>e.activityId===t.id||`comment${e.activityId}`===t.id)),t.linkedKudosList=e.filter((e=>e.entityId===t.id||`comment${e.entityId}`===t.id)),e))):c(e).then((()=>p(e,t)))}function v(e){return e?fetch("/portal/rest/kudos/api/kudos",{credentials:"include",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Response code indicates a server error",e)})):Promise.resolve(null)}function h(e,t,i,s,o){return fetch(`/portal/rest/kudos/api/kudos/${e}/sent?limit=${t||0}&returnSize=${i||!0}&periodType=${s||""}&dateInSeconds=${o||"0"}`,{method:"GET",credentials:"include"}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Response code indicates a server error",e)}))}function m(e,t,i,s,o){return fetch(`/portal/rest/kudos/api/kudos/${e}/received?limit=${t||0}&returnSize=${i||!0}&periodType=${s||""}&dateInSeconds=${o||"0"}`,{method:"GET",credentials:"include"}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Response code indicates a server error",e)}))}function y(e){return fetch(`/portal/rest/kudos/api/kudos/byActivity/${e}/all`,{method:"GET",credentials:"include"}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Response code indicates a server error",e)}))}function f(e,t,i){return e&&t?fetch(`/portal/rest/kudos/api/kudos/byEntity?entityId=${t}&entityType=${e}&limit=${i||0}`,{method:"GET",credentials:"include"}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Response code indicates a server error",e)})):Promise.resolve([])}function k(e,t){return fetch(`/portal/rest/kudos/api/kudos/byEntity/sent/count?entityId=${t}&entityType=${e}`,{method:"GET",credentials:"include"}).then((e=>{if(e&&e.ok)return e.text();throw new Error("Response code indicates a server error",e)}))}function g(e,t){return e=parseInt(e.getTime()/1e3),fetch(`/portal/rest/kudos/api/kudos?dateInSeconds=${e}&limit=${t||0}`,{method:"GET",credentials:"include"}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Response code indicates a server error",e)}))}function I(e,t,i){return e=parseInt(e.getTime()/1e3),t=parseInt(t.getTime()/1e3),fetch(`/portal/rest/kudos/api/kudos/byDates?startDateInSeconds=${e}&endDateInSeconds=${t}&limit=${i||0}`,{method:"GET",credentials:"include"}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Response code indicates a server error",e)}))}function w(e,t){return e=parseInt(e.getTime()/1e3),fetch(`/portal/rest/kudos/api/kudos/period?dateInSeconds=${e}&periodType=${t}`,{method:"GET",credentials:"include"}).then((e=>{if(e&&e.ok)return e.json();throw new Error("Response code indicates a server error",e)}))}function x(e){const t={id:"profile-kudos",title:e,icon:"fa fa-award uiIconKudos uiIconLightBlue",class:"fas fa-award",additionalClass:"mt-1",order:20,enabled:e=>e.enabled&&!e.deleted,click:e=>{const t=e.prettyName?"SPACE_PROFILE":"USER_PROFILE",i=e.prettyName?e.id:e.username;i&&document.dispatchEvent(new CustomEvent("exo-kudos-open-send-modal",{detail:{id:i,type:t}}))}};extensionRegistry.registerExtension("profile-extension","action",t),document.dispatchEvent(new CustomEvent("profile-extension-updated",{detail:t}))}function b(){extensionRegistry.registerComponent("my-reputation-overview-kudos","my-reputation-item",{id:"kudos-reputation-overview",vueComponent:Vue.options.components["kudos-overview"],rank:10})}function _(e){extensionRegistry.registerExtension("ActivityFavoriteIcon","activity-favorite-icon-extensions",{id:"favorite-kudos",type:"exokudos:activity",icon:"fas fa-award",class:"primary--text",title:t=>`Kudos ${e} ${t.kudosList[0].receiverFullName}`})}function C(){extensionRegistry.registerComponent("ActivityReactions","activity-reaction-action",{id:"kudos",reactionLabel:"exoplatform.kudos.label.kudos",numberOfReactions:0,vueComponent:Vue.options.components["activity-kudos-reaction-list"],rank:2}),extensionRegistry.registerComponent("ActivityReactionsCount","activity-reaction-count",{id:"kudos",vueComponent:Vue.options.components["activity-kudos-reaction-count"],rank:1})}function S(){extensionRegistry.registerComponent("ActivityFooter","activity-footer-action",{id:"kudos",vueComponent:Vue.options.components["kudos-button"],rank:50}),extensionRegistry.registerComponent("ActivityCommentFooter","activity-footer-comment-action",{id:"kudos",vueComponent:Vue.options.components["kudos-button"],rank:50}),extensionRegistry.registerComponent("UserPopover","user-popover-action",{id:"kudos",vueComponent:Vue.options.components["popover-kudos-button"],rank:30}),extensionRegistry.registerExtension("activity","type",{type:"exokudos:activity",options:{init:(e,t,i)=>{const s=i||e,o=i&&e;return o?p(s,o):c(s)},refresh:e=>{const t=e&&e.activityId||e.id;l[t]=null},getSourceLink:()=>"#",getActivityType:()=>"kudos",getTitle:e=>{const t=e&&e.kudos;if(t){const e={id:t.receiverIdentityId,username:t.receiverId,fullName:t.receiverFullName,avatar:t.receiverAvatar,position:t.receiverPosition,external:String(t.externalReceiver)};return{key:"NewKudosSentActivityComment.activity_kudos_title",params:{0:`<a class="primary--text" href="${eXo.env.portal.context}/${eXo.env.portal.portalName}/profile/${t.receiverId}" v-identity-popover="${JSON.stringify(e).replace(/'/g,"\\'").replace(/"/g,"'")}">${t.receiverFullName}</a>`}}}const i=e.templateParams&&e.templateParams.kudosMessage||e.title||e.body;return i&&i.includes("</i>")?i.split("</i>")[1].split(":")[0]||"":e.body},getSummary:e=>{const t=e.templateParams&&e.templateParams.kudosMessage||e.kudos&&e.kudos.message||"";return t.includes("<oembed>")&&t.split("<oembed>")[0]||t},noTitleEllipsis:!0,noSummaryEllipsis:!0,supportsIcon:!0,useSameViewForMobile:!0,getDefaultIcon:e=>({icon:"fa fa-award primary--text",size:e.activityId?37:72,height:"auto",width:e.activityId?"30px":"60px",noBorder:!0}),getBodyToEdit:e=>e.templateParams&&e.templateParams.kudosMessage?e.templateParams.kudosMessage:e.kudos&&e.kudos.message||"",canEdit:e=>e.identity.id===eXo.env.portal.userIdentityId,forceCanEditOverwrite:!0}}),extensionRegistry.registerExtension("AnalyticsSamples","SampleItem",{type:"kudos",options:{rank:20,vueComponent:Vue.options.components["analytics-profile-sample-item-attribute"],match:e=>"senderId"===e||"receiverId"===e,options:{isUser:!0}}}),document.addEventListener("exo-kudos-sent",(e=>{const t=e&&e.detail;if(t){const e=t.parentEntityId||t.entityId;l[e]=null,"ACTIVITY"!==t.entityType&&"COMMENT"!==t.entityType||document.dispatchEvent(new CustomEvent("activity-comment-created",{detail:{id:t.activityId,activityId:e}}))}}))}const T=o({data:()=>({numberOfKudosAllowed:0,numberOfKudosToDisplay:3,listDialog:!1,ignoreRefresh:!1,kudosList:!1,disabled:!1,noKudosLeft:!1,remainingKudos:0,remainingDaysToReset:0,entityIds:[],parentEntityId:null,entityId:null,entityType:null,entityOwner:"",receiverType:null,receiverId:null,error:null,drawer:!1,MESSAGE_MAX_LENGTH:1300,ckEditorId:"kudosContent",allKudosSent:[],allKudos:[],kudosToSend:null,kudosMessage:"",kudosPeriodType:"",loading:!1,requiredField:!1,identity:null,currentUserId:eXo.env.portal.userIdentityId,selectedReceiver:null,spaceURL:null,audience:""}),watch:{listDialog(){if(!this.listDialog||!this.entityId||!this.entityType)return;const e=$(window.parentToWatch).find(`#SendKudosButton${this.entityType}${this.entityId}`).data("kudosList");e&&e.length&&(this.kudosList=e)},kudosMessageText(e,t){this.requiredField=t&&""!==t&&""===e},selectedReceiver(e){e&&this.receiverId!==e.remoteId&&(this.receiverId=e.remoteId,this.displayAlert(this.$t("exoplatform.kudos.success.receiverChanged")))},audience(){this.spaceURL=this.audience?.remoteId||null}},created(){this.init().then((()=>{this.disabled||(this.$refs.kudosAPI.init(),document.addEventListener("exo-kudos-open-send-modal",this.openDrawer))}))},computed:{searchOptions(){return{currentUser:eXo.env.portal.userName,spaceURL:this.spaceURL,activityId:this.entityId}},spaceSuggesterLabels(){return{searchPlaceholder:this.$t("exoplatform.kudos.audience.searchPlaceholder"),placeholder:this.$t("exoplatform.kudos.audience.placeholder"),noDataLabel:this.$t("exoplatform.kudos.audience.noDataLabel")}},receiverSuggesterLabels(){return{searchPlaceholder:this.$t("exoplatform.kudos.receiver.searchPlaceholder"),placeholder:this.$t("exoplatform.kudos.receiver.placeholder"),noDataLabel:this.spaceURL?this.$t("exoplatform.kudos.receiver.noDataLabelInSpace"):this.$t("exoplatform.kudos.receiver.noDataLabel")}},KudosAllowedInfo(){return{0:`<span class="font-weight-bold">${this.numberOfKudosAllowed} ${this.$t("exoplatform.kudos.label.kudos")}</span>`,1:`<span class="font-weight-bold">${this.kudosPeriodLabel}</span>`}},KudosSentInfo(){return{0:`<a class="font-weight-bold primary--text">${this.kudosSent} ${this.$t("exoplatform.kudos.label.kudos")}</a>`,1:`<span class="font-weight-bold">${this.kudosPeriodLabel}</span>`}},kudosSent(){return this.numberOfKudosAllowed-this.remainingKudos},sendButtonDisabled(){return!this.kudosMessageText||this.kudosMessageTextLength>this.MESSAGE_MAX_LENGTH||this.kudosMessageValidityLabel},remainingPeriodLabel(){return 1===this.remainingDaysToReset?this.$t("exoplatform.kudos.label.day"):this.$t("exoplatform.kudos.label.days")},kudosPeriodLabel(){return this.$t(`exoplatform.kudos.label.${this.kudosPeriodType}`)},kudosMessageText(){return this.kudosMessage&&this.$utils.htmlToText(this.kudosMessage)},kudosMessageHasThreeWords(){return this.kudosMessageText&&this.kudosMessageText.split(" ").length>2},isEmptyKudosMessage(){return""===this.kudosMessageText},kudosMessageTextLength(){return this.kudosMessageText&&this.kudosMessageText.length},atLeastThreeWordsLabel(){return!this.isEmptyKudosMessage&&!this.kudosMessageHasThreeWords&&this.$t("exoplatform.kudos.warning.atLeastThreeWords")},requiredFieldLabel(){return this.requiredField&&this.$t("exoplatform.kudos.warning.requiredField")},kudosMessageValidityLabel(){return this.requiredFieldLabel||this.atLeastThreeWordsLabel},isLinkedKudos(){return"ACTIVITY"===this.entityType||"COMMENT"===this.entityType},typeOfRelation(){return this.isLinkedKudos?"mention_comment":"mention_activity_stream"}},methods:{init(){return fetch("/portal/rest/kudos/api/account/settings",{credentials:"include"}).then((e=>e&&e.ok&&e.json())).then((e=>window.kudosSettings=e||{})).then((()=>fetch("/portal/rest/kudos/api/settings",{credentials:"include"}).then((e=>e&&e.ok&&e.json())))).then((e=>{e&&(window.kudosSettings={...window.kudosSettings,...e})})).then((()=>{this.disabled=window.kudosSettings&&window.kudosSettings.disabled,this.numberOfKudosAllowed=Number(window.kudosSettings&&window.kudosSettings.kudosPerPeriod),this.remainingKudos=Number(window.kudosSettings&&window.kudosSettings.remainingKudos),this.kudosPeriodType=window.kudosSettings&&window.kudosSettings.kudosPeriodType.toLowerCase()})).then((()=>{const e=Number(this.getRemainingDays());this.remainingDaysToReset=e||0;const t=Math.max(20,window.kudosSettings.kudosPerPeriod);h(this.currentUserId,t).then((e=>{this.allKudosSent=e&&e.kudos||[]}))})).catch((e=>{this.error=e}))},resetEditor(){this.$refs[this.ckEditorId].destroyCKEditor()},initDrawer(){this.kudosMessage="",this.kudosToSend=null,this.error=null,this.requiredField=!1;let e=null;if(this.entityId&&this.entityType&&(this.allKudos=this.allKudosSent.slice(0),this.remainingKudos>0))return function(e,t){if("USER_PROFILE"===e||"USER_TIPTIP"===e)return d(t,"user",t).then((e=>(e&&(e.entityId=e.identityId),e)));if("SPACE_PROFILE"===e||"SPACE_TIPTIP"===e)return d(t,"space",t).then((e=>(e&&(e.entityId=e.identityId),e)));if("ACTIVITY"===e||"COMMENT"===e){let s,o,n=!1;return"COMMENT"===e&&(t=`comment${t}`),(i=t,i?fetch(`/portal/rest/v1/social/activities/${i}`,{credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}}).then((e=>e&&e.ok&&e.json())):Promise.resolve(null)).then((e=>{if(e&&e.owner&&e.owner.href){n=e.owner.href.indexOf("/spaces/")>=0,o=n?"space":"user";const t=e.owner.href.substring(e.owner.href.lastIndexOf("/")+1);return s=t,d(s,o,t)}throw new Error("Uknown activity details",e)})).catch((e=>{console.error("Error retrieving activity details with id",t,e)}))}var i;console.error("Unkown entity type",e,t)}(this.entityType,this.entityId).then((t=>{if(!(t&&t.id&&t.type))throw console.error("Receiver not found for entity type/id",this.entityType,this.entityId,t),new Error(this.$t("exoplatform.kudos.error.errorGettingReceiverInformation"));if(t.isUserType="organization"===t.type||"user"===t.type,t.isUserType&&t.id===eXo.env.portal.userName)throw new Error(this.$t("exoplatform.kudos.warning.cantSendKudosToYourSelf"));{this.isLinkedKudos?this.selectedReceiver={receiverId:t.id,id:`organization:${t.id}`,identityId:t.identityId,profile:{fullName:t.fullname,avatarUrl:t.avatar,external:"true"===t.external},providerId:"organization",remoteId:t.id}:this.identity=t,this.receiverId=t.id,this.receiverType=t.type;const i=t.id;e={receiverId:i,receiverType:t.type,avatar:t.avatar,profileUrl:`${eXo.env.portal.context}/${eXo.env.portal.portalName}/profile/${i}`,receiverIdentityId:t.identityId,receiverURL:t.isUserType?`/portal/intranet/profile/${t.id}`:`/portal/g/:spaces:${t.id}`,receiverFullName:t.fullname,isCurrent:!0},t.entityId&&(this.entityId=t.entityId),t.notAuthorized?this.error=this.$t("exoplatform.kudos.warning.userNotAuthorizedToReceiveKudos"):this.kudosToSend=e,this.allKudos.push(e),this.remainingKudos>1&&this.allKudos.push({}),this.$nextTick((()=>{$(".kudosIconContainerTop.kudosIconContainerCurrent").length&&$(".kudosIconContainerTop.kudosIconContainerCurrent")[0].scrollIntoView()}))}})).catch((e=>{this.error=String(e),console.error("Error retrieving entity details with type and id",this.entityType,this.entityId,e)}))},refreshLink(e,t,i){return this.ignoreRefresh?Promise.resolve(null):(this.$refs.activityKudosDrawer.startLoading(),f(t,i).then((e=>{$(window.parentToWatch).find(`#SendKudosButton${t}${i}`).data("kudosList",e),this.kudosList=e})).finally((()=>this.$refs.activityKudosDrawer.endLoading())))},openDrawer(e){this.disabled||(this.remainingKudos>0?(this.loading=!0,this.$nextTick((()=>{this.entityType=e&&e.detail&&e.detail.type,this.entityId=e&&e.detail&&e.detail.id,this.entityOwner=e&&e.detail&&e.detail.owner,this.parentEntityId=e&&e.detail&&e.detail.parentId,this.ignoreRefresh=e&&e.detail&&e.detail.ignoreRefresh,this.spaceURL=e&&e.detail&&e.detail.spaceURL||null,this.$refs.activityKudosDrawer.open(),this.$refs.activityKudosDrawer.startLoading(),this.initDrawer().then((()=>{this.$refs[this.ckEditorId].initCKEditor()})).finally((()=>{this.loading=!1,this.$refs.activityKudosDrawer.endLoading()}))}))):this.displayAlert(this.$t("exoplatform.kudos.info.noKudosLeft",{0:this.remainingDaysToReset,1:this.remainingPeriodLabel}),"warning"))},send(){this.error=null,this.$refs.activityKudosDrawer.startLoading(),v({entityType:this.entityType,entityId:this.entityId,parentEntityId:this.parentEntityId,receiverType:this.receiverType,receiverId:this.receiverId,message:this.kudosMessage,spacePrettyName:this.audience?.remoteId}).then((e=>{if(!e)throw new Error(this.$t("exoplatform.kudos.error.errorSendingKudos"));return document.dispatchEvent(new CustomEvent("exo-kudos-sent",{detail:e})),this.init().catch((e=>{console.error("Error refreshing allowed number of kudos for current user",e)}))})).then((()=>this.refreshLink(null,this.entityType,this.entityId,this.parentEntityId).catch((e=>{console.error("Error refreshing number of kudos",e)})))).then((()=>{this.$refs.activityKudosDrawer.close(),this.displayAlert(this.$t("exoplatform.kudos.success.kudosSent"))})).catch((e=>{console.error("Error refreshing UI",e),this.error=String(e)})).finally((()=>{this.$refs.activityKudosDrawer.endLoading()}))},getRemainingDays(){const e=1e3*window.kudosSettings.endPeriodDateInSeconds-Date.now();return e<0?0:parseInt(e/864e5)+1},openSentKudos(){this.currentUserId&&this.$refs.kudosOverviewDrawer.open(this.$t("exoplatform.kudos.button.sentKudos"),"sent",this.currentUserId,this.kudosPeriodType)},handler(e){e.target&&e.target.closest("a")&&this.openSentKudos()},displayAlert(e,t){document.dispatchEvent(new CustomEvent("notification-alert",{detail:{message:e,type:t||"success"}}))}}},a,[],!1,null,null,null).exports;var K=function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-inline-flex",class:!e.isComment&&"ms-lg-4"},[t("v-tooltip",{attrs:{disabled:e.isMobile,bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:s}){return[t("div",e._g(e._b({staticClass:"d-flex"},"div",s,!1),i),[t("v-btn",{staticClass:"pa-0 mt-0",class:e.textColorClass,attrs:{id:`KudosActivity${e.entityId}`,disabled:e.buttonDisabled,small:!e.isComment,"x-small":e.isComment,text:"",link:""},on:{click:e.openKudosForm}},[e.isComment?[e._v("\n            "+e._s(e.$t("exoplatform.kudos.label.kudos"))+"\n          ")]:[t("div",{staticClass:"d-flex flex-lg-row flex-column"},[t("v-icon",{staticClass:"baseline-vertical-align",class:e.kudosColorClass,attrs:{size:"14"}},[e._v("\n                fa-award\n              ")]),e._v(" "),t("span",{staticClass:"mx-auto mt-1 mt-lg-0 ms-lg-2"},[e._v("\n                "+e._s(e.$t("exoplatform.kudos.label.kudos"))+"\n              ")])],1)]],2)],1)]}}])},[e._v(" "),t("span",[e._v("\n      "+e._s(e.buttonDisabled&&e.$t("exoplatform.kudos.info.onlyOtherCanSendYouKudos")||e.$t("exoplatform.kudos.title.sendAKudos"))+"\n    ")])]),e._v(" "),t("v-tooltip",{attrs:{disabled:e.isMobile,bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:s}){return[t("v-btn",e._g(e._b({directives:[{name:"show",rawName:"v-show",value:e.kudosCount&&!e.isMobile,expression:"kudosCount && !isMobile"}],staticClass:"primary--text font-weight-bold baseline-vertical-align mt-0",attrs:{id:`KudusCountLink${e.commentId}`,small:!e.isComment,"x-small":e.isComment,icon:""},on:{click:e.openKudosList}},"v-btn",s,!1),i),[e._v("\n        ("+e._s(e.kudosCount)+")\n      ")])]}}])},[e._v(" "),t("span",[e._v("\n      "+e._s(e.$t("exoplatform.kudos.button.displayKudosList"))+"\n    ")])])],1)};K._withStripped=!0;const E=o({props:{activity:{type:Object,default:null},comment:{type:Object,default:null}},data:()=>({linkedKudosList:[],limit:100}),computed:{entityType(){return this.comment?"COMMENT":"ACTIVITY"},entityId(){return this.comment&&this.comment.id&&this.comment.id.replace("comment","")||this.activity&&this.activity.id||""},entityOwner(){return this.comment&&this.comment.identity&&this.comment.identity.remoteId||this.activity&&this.activity.identity&&this.activity.identity.remoteId||""},parentId(){return this.comment&&this.comment.activityId||""},activityId(){return this.comment&&this.comment.activityId||this.activity&&this.activity.id||""},commentId(){return this.comment&&this.comment.id||""},isComment(){return!!this.comment},spaceURL(){return this.activity&&this.activity.activityStream&&this.activity.activityStream.space&&this.activity.activityStream.space.prettyName},kudosCount(){return this.linkedKudosList.length},hasSentKudos(){return this.linkedKudosList.find((e=>e.senderIdentityId===eXo.env.portal.userIdentityId))},kudosColorClass(){return this.hasSentKudos?"primary--text":"disabled--text"},textColorClass(){return this.hasSentKudos?"primary--text":""},inactiveCommentOwner(){return!this.comment.identity.profile.dataEntity.enabled||this.comment.identity.deleted},inactiveActivityOwner(){return!this.activity.identity.profile.dataEntity.enabled||this.activity.identity.deleted},userIdentityId:()=>eXo.env.portal.userIdentityId,sharedInSpace(){return"space"===this.activity?.activityStream?.type},buttonDisabled(){return this.comment?(this.comment.identity&&this.comment.identity.id)===this.userIdentityId||this.inactiveCommentOwner||this.sharedInSpace&&!this.comment.owner.isMember:!!this.activity&&((this.activity.identity&&this.activity.identity.id)===this.userIdentityId||this.inactiveActivityOwner||this.sharedInSpace&&!this.activity.owner.isMember)},isMobile(){return"sm"===this.$vuetify.breakpoint.name||"xs"===this.$vuetify.breakpoint.name}},created(){this.$root.$on("activity-comment-created",this.resetActivity),this.$root.$on("kudos-refresh-comment",this.resetActivityComments),this.init()},beforeDestroy(){this.$root.$off("activity-comment-created",this.resetActivity),this.$root.$off("kudos-refresh-comment",this.resetActivityComments)},methods:{resetActivity(e){!this.comment&&e&&e.activityId===this.activityId&&(this.$kudosService.resetActivityKudosList(this.activity),this.init(),this.$root.$emit("kudos-refresh-comment",this.activity.id))},resetActivityComments(e){e&&this.comment&&e===this.activityId&&this.init()},init(){return this.comment?this.$kudosService.computeCommentKudosList(this.activity,this.comment).then((()=>this.linkedKudosList=this.comment.linkedKudosList||[])):this.$kudosService.computeActivityKudosList(this.activity).then((()=>this.linkedKudosList=this.activity.linkedKudosList||[]))},openKudosForm(e){e&&(e.preventDefault(),e.stopPropagation()),document.dispatchEvent(new CustomEvent("exo-kudos-open-send-modal",{detail:{id:this.entityId,parentId:this.parentId,type:this.entityType,owner:this.entityOwner,spaceURL:this.spaceURL}}))},openKudosList(e){e&&(e.preventDefault(),e.stopPropagation()),document.dispatchEvent(new CustomEvent("open-reaction-drawer-selected-tab",{detail:{activityId:this.isComment?this.commentId:this.activityId,tab:"kudos",activityType:this.entityType}}))}}},K,[],!1,null,null,null).exports;var L=function(){var e=this,t=e._self._c;return t("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:i,attrs:s}){return[t("div",e._g(e._b({},"div",s,!1),i),[e.identityEnabled&&!e.identityDeleted?t("div",[t("v-btn",{attrs:{ripple:!1,icon:"",color:"primary"},on:{click:function(t){return e.sendKudos(t)}}},[t("v-icon",{attrs:{size:"18"}},[e._v("fas fa-award")])],1)],1):e._e()])]}}])},[e._v(" "),t("span",[e._v("\n    "+e._s(e.$t("exoplatform.kudos.title.sendAKudos"))+"\n  ")])])};L._withStripped=!0;const A=o({props:{identityType:{type:String,default:""},identityId:{type:String,default:""},identityEnabled:{type:String,default:""},identityDeleted:{type:String,default:""}},methods:{sendKudos(e){e.preventDefault(),e.stopPropagation(),document.dispatchEvent(new CustomEvent("exo-kudos-open-send-modal",{detail:{id:this.identityId,type:this.identityType}}))}}},L,[],!1,null,null,null).exports;var R=function(){var e=this,t=e._self._c;return e.kudos?t("div",{staticClass:"activityKudosItem"},[t("div",{staticClass:"flex-nowrap d-flex flex-shrink-0 align-center"},[t("exo-user-avatar",{attrs:{"profile-id":e.KudosSenderUsername,size:42,avatar:"",popover:""}}),e._v(" "),t("div",{staticClass:"pull-left ms-2 d-flex flex-column align-start text-truncate"},[e.KudosSenderFullName?t("div",{staticClass:"d-flex"},[t("exo-user-avatar",{attrs:{"profile-id":e.KudosSenderUsername,fullname:"","bold-title":"",popover:""}}),e._v(" "),t("v-icon",{staticClass:"px-2",attrs:{size:"15"}},[e._v("fa-angle-right")]),e._v(" "),t("exo-user-avatar",{attrs:{"profile-id":e.kudosReceiverUsername,fullname:"","bold-title":"",popover:""}})],1):e._e(),e._v(" "),t("relative-date-format",{staticClass:"text-sm-caption text-sub-title text-light-color",attrs:{value:e.kudosElapsedTime}})],1)],1)]):e._e()};R._withStripped=!0;const O=o({props:{kudos:{type:Object,default:null}},data:()=>({senderId:`userAvatar${parseInt(1e4*Math.random()).toString().toString()}`,receiverId:`userAvatar${parseInt(1e4*Math.random()).toString().toString()}`}),computed:{KudosSenderFullName(){return this.kudos&&this.kudos.senderFullName},kudosElapsedTime(){return this.$dateUtil.getDateObjectFromString(this.kudosTimeInMilliseconds)},kudosTimeInMilliseconds(){return 1e3*Number(this.kudos.timeInSeconds)},KudosSenderUsername(){return this.kudos&&this.kudos.senderId},kudosReceiverUsername(){return this.kudos&&this.kudos.receiverId}}},R,[],!1,null,null,null).exports;var M=function(){var e=this,t=e._self._c;return e.sortedKudosList.length?t("div",{staticClass:"kudos-list"},e._l(e.sortedKudosList,(function(e,i){return t("activity-kudos-reaction-item",{key:i,staticClass:"pl-3 pt-2 pb-1",attrs:{kudos:e}})})),1):t("activity-kudos-reaction-empty-list",{attrs:{"activity-poster-id":e.activityPosterId,"activity-type":e.activityType,"parent-id":e.parentId,"activity-id":e.activityId}})};M._withStripped=!0;const P=o({props:{activityId:{type:String,default:()=>""},activityType:{type:String,default:()=>""},parentId:{type:String,default:()=>""},activityPosterId:{type:String,default:()=>""}},data:()=>({kudosList:[],limit:10}),created(){this.retrieveKudos(),document.addEventListener("exo-kudos-sent",(e=>{this.updateKudosList(e)})),document.addEventListener("check-reactions",(e=>{this.updateKudos(e)}))},watch:{activityId(){this.retrieveKudos()}},computed:{sortedKudosList(){return this.kudosList.slice().sort(((e,t)=>t.timeInSeconds-t.timeInSeconds))}},methods:{retrieveKudos(){return"COMMENT"===this.activityType&&(this.activityId=this.activityId.replace("comment","")),this.$kudosService.getEntityKudos(this.activityType,this.activityId).then((e=>{this.kudosList=e,this.updateKudosReactionNumber()})).catch((e=>{console.error("error retrieving activity kudos",e)}))},updateKudosList(e){if(e&&e.detail&&this.activityId===e.detail.entityId){const t=e.detail;this.kudosList.push(t),this.updateKudosReactionNumber()}},updateKudos(e){e&&e.detail&&e.detail.replace("comment","")===this.activityId&&this.updateKudosReactionNumber()},updateKudosReactionNumber(){document.dispatchEvent(new CustomEvent("update-reaction-extension",{detail:{numberOfReactions:this.kudosList.length,type:"kudos"}}))}}},M,[],!1,null,null,null).exports;var D=function(){var e=this,t=e._self._c;return t("div",{staticClass:"no-kudos-block flex d-flex flex-column align-center text-sub-title pt-12"},[t("v-icon",{staticClass:"text-sub-title",attrs:{size:"64"}},[e._v("\n    fa-award\n  ")]),e._v(" "),t("span",{staticClass:"no-kudos-yet-label pt-5"},[e._v("\n    "+e._s(e.$t("exoplatform.kudos.info.noKudosYet"))+"\n    "),e.sameUser?e._e():t("a",{staticClass:"text-decoration-underline pl-1",on:{click:e.openKudosDrawer}},[e._v(" "+e._s(e.$t("exoplatform.kudos.info.sendAKudos"))+" ")])]),e._v(" "),e.sameUser?e._e():t("span",{staticClass:"kudos-message-purpose-label"},[e._v(" "+e._s(e.$t("exoplatform.kudos.label.kudosMessagePurpose")))])],1)};D._withStripped=!0;const N=o({props:{activityPosterId:{type:String,default:()=>""},activityId:{type:String,default:()=>""},parentId:{type:String,default:()=>""},activityType:{type:String,default:()=>""}},computed:{sameUser(){return this.activityPosterId&&this.activityPosterId===eXo.env.portal.userName},isComment(){return"COMMENT"===this.activityType}},methods:{openKudosDrawer(){document.dispatchEvent(new CustomEvent("exo-kudos-open-send-modal",{detail:{id:this.isComment?this.activityId.replace("comment",""):this.activityId,parentId:this.parentId,type:this.activityType}}))}}},D,[],!1,null,null,null).exports;var U=function(){var e=this,t=e._self._c;return t("exo-drawer",{ref:"kudosOverviewDrawer",staticClass:"kudosOverviewDrawer",attrs:{right:""}},[t("template",{slot:"title"},[e._v("\n    "+e._s(e.title)+"\n  ")]),e._v(" "),t("template",{slot:"content"},[e.kudosList?t("v-list",e._l(e.kudosList,(function(e){return t("kudos-overview-item",{key:e.technicalId,staticClass:"border-color border-radius",attrs:{"kudos-item":e}})})),1):e._e()],1),e._v(" "),e.hasMore?t("template",{slot:"footer"},[t("v-spacer"),e._v(" "),t("v-btn",{staticClass:"loadMoreButton ma-auto btn",attrs:{loading:e.loading,disabled:e.loading,block:""},on:{click:e.loadMore}},[e._v("\n      "+e._s(e.$t("exoplatform.kudos.button.showMore"))+"\n    ")]),e._v(" "),t("v-spacer")],1):e._e()],2)};U._withStripped=!0;const X=o({data:()=>({title:"",kudosType:null,identityId:null,kudosRetrievalMethod:null,pageSize:20,limit:20,size:0,kudosList:[]}),computed:{hasMore(){return this.size>this.limit}},methods:{reset(){this.limit=20,this.size=0,this.kudosList=[]},open(e,t,i,s){this.title=e,this.identityId=i,this.periodType=s,this.kudosType=t,this.kudosRetrievalMethod="sent"===t&&h||m,this.reset(),this.retrieveList(),this.$refs.kudosOverviewDrawer.open()},loadMore(){this.limit+=this.pageSize,this.retrieveList()},retrieveList(){const e=parseInt(Date.now()/1e3);return this.$refs.kudosOverviewDrawer.startLoading(),this.kudosRetrievalMethod(this.identityId,this.limit,!0,this.periodType,e).then((e=>{this.size=e&&e.size||0,this.kudosList=e&&e.kudos||[]})).finally((()=>{this.$refs.kudosOverviewDrawer.endLoading()}))}}},U,[],!1,null,null,null).exports;var z=function(){var e=this,t=e._self._c;return t("v-list-item",{staticClass:"ma-4",attrs:{href:e.activityUrl,"two-line":""}},[t("v-list-item-avatar",{class:e.isSpace&&"spaceAvatar",attrs:{tile:e.isSpace}},[t("v-img",{attrs:{src:e.avatar}})],1),e._v(" "),t("v-list-item-content",{staticClass:"py-0"},[t("v-list-item-title",{attrs:{id:e.id,href:e.url}},[e._v("\n      "+e._s(e.fullName)+"\n    ")]),e._v(" "),t("v-list-item-subtitle",[e._v("\n      "+e._s(e.dateTime)+"\n    ")])],1),e._v(" "),t("v-list-item-icon",{staticClass:"my-auto"},[t("v-icon",[e._v("mdi-chevron-right")])],1)],1)};z._withStripped=!0;const F=o({props:{kudosItem:{type:Object,default:()=>({})},type:{type:String,default:"sent"}},data:()=>({id:`avatar${parseInt(1e4*Math.random()).toString().toString()}`,lang:eXo.env.portal.language,dateFormat:{dateStyle:"long",timeStyle:"short"}}),computed:{isSender(){return this.kudosItem&&Number(this.kudosItem.senderIdentityId)===Number(eXo.env.portal.profileOwnerIdentityId)},isSpace(){return this.isSender&&"space"===this.kudosItem.receiverType},avatar(){return this.isSender&&this.kudosItem.receiverAvatar||this.kudosItem.senderAvatar},fullName(){return this.isSender&&this.kudosItem.receiverFullName||this.kudosItem.senderFullName},remoteId(){return this.isSender&&this.kudosItem.receiverId||this.kudosItem.senderId},identityId(){return this.isSender&&this.kudosItem.receiverIdentityId||this.kudosItem.senderIdentityId},url(){return this.isSender&&this.kudosItem.receiverURL||this.kudosItem.senderURL},dateTime(){if(!this.kudosItem||!this.kudosItem.timeInSeconds)return"";const e=new Date(1e3*this.kudosItem.timeInSeconds);return new window.Intl.DateTimeFormat(this.lang,this.dateFormat).format(e)},activityUrl(){if(!this.kudosItem)return null;const e="COMMENT"===this.kudosItem.entityType&&this.kudosItem.parentEntityId||"ACTIVITY"===this.kudosItem.entityType&&this.kudosItem.entityId||this.kudosItem.activityId;let t=null;return"COMMENT"!==this.kudosItem.entityType&&"ACTIVITY"!==this.kudosItem.entityType||(t=this.kudosItem.activityId),this.kudosItem&&`${eXo.env.portal.context}/${eXo.env.portal.portalName}/activity?id=${e}${t?"#comment-comment":""}${t||""}`}}},z,[],!1,null,null,null).exports;var j=function(){var e=this,t=e._self._c;return e.kudosNumber>0?t("a",{staticClass:"my-1 me-2 KudosNumber",on:{click:e.openKudosList}},[e._v("\n  "+e._s(e.kudosNumber)+" "+e._s(e.$t("exoplatform.kudos.label.kudos")))]):e._e()};j._withStripped=!0;const V=o({props:{activity:{type:Object,default:null}},data:()=>({kudosNumber:0}),created(){this.$root.$on("kudos-refresh-comment",this.getKudosCount),this.getKudosCount()},methods:{getKudosCount(){return this.$kudosService.computeActivityKudosList(this.activity).then((()=>this.kudosNumber=this.activity.linkedKudosList.length||0))},openKudosList(e){e&&(e.preventDefault(),e.stopPropagation()),document.dispatchEvent(new CustomEvent("open-reaction-drawer-selected-tab",{detail:{activityId:this.activity.id,tab:"kudos",activityType:"ACTIVITY"}}))}}},j,[],!1,null,null,null).exports;var B=function(){var e=this,t=e._self._c;return t("v-app",{staticClass:"white",class:e.owner?"kudosOverviewApplication":"kudosOverviewApplicationOther"},[e.isOverviewDisplay?e._e():t("v-toolbar",{staticClass:"border-box-sizing",attrs:{id:"kudosOverviewHeader",color:"white",height:"64",flat:""}},[t("div",{staticClass:"d-flex flex py-3"},[t("div",{staticClass:"text-header-title text-sub-title text-no-wrap d-flex align-center"},[e._v("\n        "+e._s(e.$t("exoplatform.kudos.button.rewardedKudos"))+"\n      ")]),e._v(" "),t("v-spacer"),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.periodType,expression:"periodType"}],staticClass:"kudosOverviewPeriodSelect fill-height col-auto my-auto py-0 subtitle-1 ignore-vuetify-classes",on:{change:function(t){var i=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.periodType=t.target.multiple?i:i[0]}}},e._l(e.periods,(function(i){return t("option",{key:i.value,domProps:{value:i.value}},[e._v("\n          "+e._s(i.text)+"\n        ")])})),0)],1)]),e._v(" "),t("v-row",{staticClass:"white border-box-sizing px-4 py-0 ma-0 align-center",attrs:{id:"kudosOverviewCardsParent"}},[t("v-col",{staticClass:"kudosOverviewCard"},[t("kudos-overview-card",{staticClass:"kudosReceivedOverviewPeriod mx-n4",attrs:{clickable:e.owner&&e.receivedKudosCount>0},on:{"open-drawer":function(t){return e.openDrawer("received")}}},[t("template",{slot:"count"},[e._v("\n          "+e._s(e.receivedKudosCount||"0")+"\n        ")]),e._v(" "),t("template",{slot:"label"},[e._v("\n          "+e._s(e.$t("exoplatform.kudos.label.received"))+"\n        ")])],2)],1),e._v(" "),t("v-divider",{staticClass:"my-9 mx-8 me-md-1 ms-md-5",attrs:{vertical:""}}),e._v(" "),t("v-col",{staticClass:"kudosOverviewCard"},[t("kudos-overview-card",{staticClass:"kudosSentOverviewPeriod mx-n4",attrs:{clickable:e.owner&&e.sentKudosCount>0},on:{"open-drawer":function(t){return e.openDrawer("sent")}}},[t("template",{slot:"count"},[e._v("\n          "+e._s(e.sentKudosCount||"0")+"\n        ")]),e._v(" "),t("template",{slot:"label"},[e._v("\n          "+e._s(e.$t("exoplatform.kudos.label.sent"))+"\n        ")])],2)],1)],1),e._v(" "),e.owner?t("kudos-overview-drawer",{ref:"kudosOverviewDrawer"}):e._e()],1)};B._withStripped=!0;const G=o({props:{isOverviewDisplay:{type:Boolean,default:()=>!1}},data:()=>({owner:eXo.env.portal.profileOwner===eXo.env.portal.userName,identityId:eXo.env.portal.profileOwnerIdentityId,periodType:"WEEK",sentKudosCount:0,receivedKudosCount:0,sentKudos:[],receivedKudos:[]}),computed:{periods(){return[{text:this.$t("exoplatform.kudos.label.week"),value:"WEEK"},{text:this.$t("exoplatform.kudos.label.month"),value:"MONTH"},{text:this.$t("exoplatform.kudos.label.quarter"),value:"QUARTER"},{text:this.$t("exoplatform.kudos.label.semester"),value:"SEMESTER"},{text:this.$t("exoplatform.kudos.label.year"),value:"YEAR"}]}},watch:{periodType(){this.refresh()}},created(){this.refresh()},methods:{openDrawer(e){if(this.owner){const t="sent"===e?this.$t("exoplatform.kudos.button.sentKudos"):this.$t("exoplatform.kudos.button.receivedKudos");this.$refs.kudosOverviewDrawer.open(t,e,this.identityId,this.periodType)}},refresh(){const e=parseInt(Date.now()/1e3);document.dispatchEvent(new CustomEvent("displayTopBarLoading")),h(this.identityId,0,!0,this.periodType,e).then((e=>{this.sentKudosCount=e&&e.size||0,this.sentKudos=e&&e.kudos||[]})).then((()=>m(this.identityId,0,!0,this.periodType,e))).then((e=>(this.receivedKudosCount=e&&e.size||0,this.receivedKudos=e&&e.kudos||[],this.$nextTick()))).finally((()=>{this.$root.$emit("application-loaded"),document.dispatchEvent(new CustomEvent("hideTopBarLoading")),document.dispatchEvent(new CustomEvent("kudosCount",{detail:this.sentKudosCount+this.receivedKudosCount}))}))}}},B,[],!1,null,null,null).exports;var Y=function(){var e=this,t=e._self._c;return t("div",{staticClass:"border-box-sizing text-center justify-center align-center d-flex flex-wrap",class:e.clickable?"clickable":"",on:{click:function(t){e.clickable&&e.$emit("open-drawer")}}},[t("div",{staticClass:"px-0 kudosOverviewIcon pa-0"},[t("v-icon",{staticClass:"uiIconKudos tertiary-color",attrs:{size:"40"}},[e._v("fa fa-award")])],1),e._v(" "),t("div",{staticClass:"kudosOverviewCount text-color mx-2 display-1 font-weight-bold pa-0 d-flex align-center"},[e._t("count")],2),e._v(" "),t("div",{staticClass:"px-0 mx-0"},[t("v-card",{staticClass:"d-flex align-center flex-no-wrap",attrs:{"min-width":55,flat:""}},[e._t("label")],2)],1)])};Y._withStripped=!0;const W={"kudos-api":r,"kudos-app":T,"kudos-identity-link":n,"kudos-button":E,"popover-kudos-button":A,"activity-kudos-reaction-item":O,"activity-kudos-reaction-list":P,"activity-kudos-reaction-empty-list":N,"kudos-overview-drawer":X,"kudos-overview-item":F,"activity-kudos-reaction-count":V,"kudos-overview":G,"kudos-overview-card":o({props:{clickable:{type:Boolean,default:null}}},Y,[],!1,null,null,null).exports};for(const e in W)Vue.component(e,W[e]);if(extensionRegistry){const e=extensionRegistry.loadComponents("KudosAdmin");e&&e.length>0&&e.forEach((e=>{Vue.component(e.componentName,e.componentOptions)}))}Vue.prototype.$kudosService||window.Object.defineProperty(Vue.prototype,"$kudosService",{value:i}),window.parentToWatch="#UISpaceActivityStreamPortlet, #UIUserActivityStreamPortlet",Vue.use(Vuetify);const q=new Vuetify(eXo.env.portal.vuetifyPreset),H=eXo&&eXo.env&&eXo.env.portal&&eXo.env.portal.language||"en",J=`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.addon.Kudos-${H}.json`;function Q(){exoi18n.loadLanguageAsync(H,J).then((e=>{new Vue({template:'<kudos-app id="KudosApp" />',i18n:e,vuetify:q}).$mount("#KudosApp")}))}return t})()));