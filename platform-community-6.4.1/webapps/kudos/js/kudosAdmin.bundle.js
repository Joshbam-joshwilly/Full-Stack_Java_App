define((()=>(()=>{"use strict";var e={d:(t,s)=>{for(var o in s)e.o(s,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:s[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:()=>p});var s=function(){var e=this,t=e._self._c;return t("v-app",{attrs:{id:"KudosAdminApp",color:"transaprent"}},[t("main",[t("v-layout",[t("v-flex",{staticClass:"text-center",attrs:{flat:""}},[e.error&&!e.loading?t("div",{staticClass:"alert alert-error v-content"},[t("i",{staticClass:"uiIconError"}),e._v(e._s(e.error)+"\n        ")]):e._e(),e._v(" "),t("v-tabs",{attrs:{"slider-size":"4"},model:{value:e.selectedTab,callback:function(t){e.selectedTab=t},expression:"selectedTab"}},[t("v-tabs-slider",{attrs:{color:"primary"}}),e._v(" "),t("v-tab",{key:"general",attrs:{href:"#general"}},[e._v(e._s(e.$t("exoplatform.kudos.label.settings")))]),e._v(" "),t("v-tab",{key:"kudosList",attrs:{href:"#kudosList"}},[e._v(e._s(e.$t("exoplatform.kudos.label.kudosList")))])],1),e._v(" "),t("v-tabs-items",{staticClass:"mt-2",model:{value:e.selectedTab,callback:function(t){e.selectedTab=t},expression:"selectedTab"}},[t("v-tab-item",{attrs:{id:"general",value:"general",eager:""}},[e.loading?t("v-progress-circular",{staticClass:"me-2",attrs:{indeterminate:"",color:"white"}}):t("v-card",{attrs:{flat:""}},[t("v-card-text",[t("div",{staticClass:"text-start kudosPeriodConfiguration"},[t("div",{staticClass:"ma-auto"},[t("v-text-field",{attrs:{label:e.$t("exoplatform.kudos.label.numberOfKudos"),type:"number",name:"kudosPerPeriod",required:""},model:{value:e.kudosPerPeriod,callback:function(t){e.kudosPerPeriod=t},expression:"kudosPerPeriod"}})],1),e._v(" "),t("div",{staticClass:"ma-auto"},[t("span",{staticClass:"mx-2"},[e._v(" "+e._s(e.$t("exoplatform.kudos.label.kudosPer"))+" ")])]),e._v(" "),t("div",{staticClass:"ma-auto"},[t("v-combobox",{attrs:{items:e.periods,"return-object":!1,label:e.$t("exoplatform.kudos.label.periodType"),"hide-no-data":"","hide-selected":"","small-chips":""},scopedSlots:e._u([{key:"selection",fn:function(t){return[e._v("\n                        "+e._s(e.selectedPeriodTypeText)+"\n                      ")]}}]),model:{value:e.kudosPeriodType,callback:function(t){e.kudosPeriodType=t},expression:"kudosPeriodType"}})],1)]),e._v(" "),t("v-flex",{staticClass:"contactAutoComplete mt-4",attrs:{id:"accessPermissionAutoComplete"}},[t("v-autocomplete",{ref:"accessPermissionAutoComplete",staticClass:"contactAutoComplete",attrs:{items:e.accessPermissionOptions,loading:e.isLoadingSuggestions,label:e.$t("exoplatform.kudos.label.kudosAccessPermission"),placeholder:e.$t("exoplatform.kudos.label.kudosAccessPermissionPlaceholder"),attach:"#accessPermissionAutoComplete","content-class":"contactAutoCompleteContent","max-width":"100%","item-text":"name","item-value":"id","hide-details":"","hide-selected":"",chips:"","cache-items":"",dense:"",flat:""},on:{"update:search-input":e.search},scopedSlots:e._u([{key:"selection",fn:function({item:s,selected:o}){return[s.error?t("v-chip",{staticClass:"autocompleteSelectedItem",attrs:{"input-value":o}},[t("del",[t("span",[e._v(e._s(s.name))])])]):t("v-chip",{staticClass:"autocompleteSelectedItem",attrs:{"input-value":o}},[t("span",[e._v(e._s(s.name))])])]}},{key:"item",fn:function({item:s}){return[s.avatar?t("v-list-item-avatar",{attrs:{size:"20"}},[t("img",{attrs:{src:s.avatar}})]):e._e(),e._v(" "),t("v-list-item-title",{staticClass:"text-start",domProps:{textContent:e._s(s.name)}})]}}]),model:{value:e.accessPermission,callback:function(t){e.accessPermission=t},expression:"accessPermission"}})],1)],1),e._v(" "),t("v-card-actions",[t("v-spacer"),e._v(" "),t("div",{staticClass:"ignore-vuetify-classes"},[t("button",{staticClass:"btn btn-primary ignore-vuetify-classes mb-3",on:{click:e.saveGlobalSettings}},[e._v("\n                    "+e._s(e.$t("exoplatform.kudos.button.save"))+"\n                  ")])]),e._v(" "),t("v-spacer")],1)],1)],1),e._v(" "),t("v-tab-item",{staticClass:"text-center",attrs:{id:"kudosList",value:"kudosList",eager:""}},[t("kudos-list",{attrs:{"default-kudos-period-type":e.kudosPeriodType}})],1)],1)],1)],1)],1)])};function o(e){const t=$.param({fields:["id","prettyName","displayName","avatarUrl"],keyword:e});return fetch(`/portal/rest/space/user/searchSpace?${t}`,{credentials:"include"}).then((e=>e.ok?e.json():null)).then((e=>{const t=[];return e.forEach((e=>{t.push({avatar:e.avatarUrl?e.avatarUrl:`/portal/rest/v1/social/spaces/${e.prettyName}/avatar`,name:e.displayName,id:e.prettyName,id_type:`space_${e.prettyName}`})})),t}))}function a(e,t,s,o,a,i,r,n){var l,d="function"==typeof e?e.options:e;if(t&&(d.render=t,d.staticRenderFns=s,d._compiled=!0),o&&(d.functional=!0),i&&(d._scopeId="data-v-"+i),r?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),a&&a.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(r)},d._ssrRegister=l):a&&(l=n?function(){a.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:a),l)if(d.functional){d._injectStyles=l;var c=d.render;d.render=function(e,t){return l.call(t),c(e,t)}}else{var u=d.beforeCreate;d.beforeCreate=u?[].concat(u,l):[l]}return{exports:e,options:d}}s._withStripped=!0;const i=a({data:()=>({loading:!1,selectedTab:"general",error:null,accessPermission:null,accessPermissionOptions:[],accessPermissionSearchTerm:null,kudosPeriodType:null,isLoadingSuggestions:!1}),computed:{periods(){return[{text:this.$t("exoplatform.kudos.label.week"),value:"WEEK"},{text:this.$t("exoplatform.kudos.label.month"),value:"MONTH"},{text:this.$t("exoplatform.kudos.label.quarter"),value:"QUARTER"},{text:this.$t("exoplatform.kudos.label.semester"),value:"SEMESTER"},{text:this.$t("exoplatform.kudos.label.year"),value:"YEAR"}]},selectedPeriodTypeText(){let e=this.periods.find((e=>e.value===this.kudosPeriodType));return e=e?e.value:this.kudosPeriodType,e?this.$t(`exoplatform.kudos.label.${e.toLowerCase()}`):""}},watch:{accessPermissionSearchTerm(){this.isLoadingSuggestions=!0,o(this.accessPermissionSearchTerm).then((e=>{this.accessPermissionOptions=e||[],this.isLoadingSuggestions=!1})).catch((e=>{console.error("searchSpaces method - error",e),this.isLoadingSuggestions=!1}))},accessPermission(e,t){t&&(this.accessPermissionSearchTerm=null,this.$refs.accessPermissionAutoComplete.isFocused=!1)}},created(){this.init()},methods:{search(e){this.accessPermissionSearchTerm=e},init(){return fetch("/portal/rest/kudos/api/account/settings",{credentials:"include"}).then((e=>e&&e.ok&&e.json())).then((e=>window.kudosSettings=e||{})).then((()=>fetch("/portal/rest/kudos/api/settings",{credentials:"include"}).then((e=>e&&e.ok&&e.json())))).then((e=>{e&&(window.kudosSettings={...window.kudosSettings,...e})})).then((()=>{this.accessPermission=window.kudosSettings&&window.kudosSettings.accessPermission,this.kudosPerPeriod=window.kudosSettings&&window.kudosSettings.kudosPerPeriod,this.kudosPeriodType=window.kudosSettings&&window.kudosSettings.kudosPeriodType,this.accessPermission&&o(this.accessPermission).then((e=>{this.accessPermissionOptions=e||[],this.accessPermissionOptions.find((e=>e.id===this.accessPermission))||this.accessPermissionOptions.push({id:this.accessPermission,name:this.accessPermission,error:!0})}))})).catch((e=>{this.error=e}))},saveGlobalSettings(){var e;this.loading=!0,this.error=null,(e={accessPermission:this.accessPermission,kudosPerPeriod:this.kudosPerPeriod,kudosPeriodType:this.kudosPeriodType},e?fetch("/portal/rest/kudos/api/settings/save",{credentials:"include",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e&&e.ok)):Promise.resolve(null)).then((e=>{if(!e)throw new Error(this.$t("exoplatform.kudos.error.errorSavingKudosSettings"));return this.init()})).catch((e=>{throw console.error("Error saving kudo",e),this.error=String(e),e})).finally((()=>{this.loading=!1}))}}},s,[],!1,null,null,null).exports;var r=function(){var e=this,t=e._self._c;return t("v-layout",{staticClass:"mx-4",attrs:{wrap:""}},[t("v-flex",{staticClass:"text-center",attrs:{id:"selectedDateMenu",xs2:""}},[t("v-combobox",{staticClass:"kudosPeriodTypeInput",attrs:{items:e.periods,"return-object":!1,label:e.$t("exoplatform.kudos.label.periodType"),"hide-no-data":"","hide-selected":"","small-chips":""},scopedSlots:e._u([{key:"selection",fn:function(t){return[e._v("\n        "+e._s(e.selectedPeriodType)+"\n      ")]}}]),model:{value:e.kudosPeriodType,callback:function(t){e.kudosPeriodType=t},expression:"kudosPeriodType"}})],1),e._v(" "),t("v-flex",{attrs:{xs10:""}},[t("v-text-field",{attrs:{label:e.$t("exoplatform.kudos.label.selectPeriodDate"),"prepend-icon":"event"},on:{click:function(t){e.selectedDateMenu=!0}},model:{value:e.periodDatesDisplay,callback:function(t){e.periodDatesDisplay=t},expression:"periodDatesDisplay"}}),e._v(" "),t("v-menu",{ref:"selectedDateMenu",staticClass:"kudosDateSelector",attrs:{"nudge-right":e.$vuetify.rtl,attach:"#selectedDateMenu",transition:"scale-transition","offset-y":"","offset-x":"",eager:""},model:{value:e.selectedDateMenu,callback:function(t){e.selectedDateMenu=t},expression:"selectedDateMenu"}},[t("v-date-picker",{staticClass:"border-box-sizing",attrs:{"first-day-of-week":1,type:e.periodType&&"WEEK"!==e.periodType?"month":"date",locale:e.lang},on:{input:function(t){e.selectedDateMenu=!1}},model:{value:e.selectedDate,callback:function(t){e.selectedDate=t},expression:"selectedDate"}})],1)],1),e._v(" "),t("v-flex",{attrs:{xs12:""}},[t("v-data-table",{staticClass:"elevation-1 me-3 mb-2",attrs:{headers:e.kudosIdentitiesHeaders,items:e.kudosIdentitiesList,"items-per-page":1e3,loading:e.loading,sortable:!0,"hide-default-footer":""},scopedSlots:e._u([{key:"item",fn:function(s){return[t("tr",[t("td",[t("v-avatar",{attrs:{size:"36px"}},[t("img",{attrs:{src:s.item.avatar,onerror:"this.src = '/eXoSkin/skin/images/system/SpaceAvtDefault.png'"}})])],1),e._v(" "),t("td",{staticClass:"text-start"},[t("a",{attrs:{href:s.item.url,rel:"nofollow",target:"_blank"}},[e._v("\n              "+e._s(s.item.name)+"\n            ")])]),e._v(" "),t("td",{domProps:{textContent:e._s(s.item.received)}}),e._v(" "),t("td",{domProps:{textContent:e._s(s.item.sent)}})])]}}])})],1)],1)};r._withStripped=!0;const n={"kudos-admin":i,"kudos-list":a({props:{defaultKudosPeriodType:{type:String,default:function(){return null}}},data:()=>({loading:!1,error:null,selectedDate:null,selectedDateMenu:!1,kudosPeriodType:null,kudosIdentitiesList:[],selectedStartDateInSeconds:null,selectedEndDateInSeconds:null,lang:"en"}),computed:{kudosIdentitiesHeaders(){return[{text:"",sortable:!1,value:"avatar",width:"36px"},{text:this.$t("exoplatform.kudos.label.name"),sortable:!1,value:"name"},{text:this.$t("exoplatform.kudos.label.received"),align:"center",sortable:!0,value:"received"},{text:this.$t("exoplatform.kudos.label.sent"),align:"center",sortable:!0,value:"sent"}]},periods(){return[{text:this.$t("exoplatform.kudos.label.week"),value:"WEEK"},{text:this.$t("exoplatform.kudos.label.month"),value:"MONTH"},{text:this.$t("exoplatform.kudos.label.quarter"),value:"QUARTER"},{text:this.$t("exoplatform.kudos.label.semester"),value:"SEMESTER"},{text:this.$t("exoplatform.kudos.label.year"),value:"YEAR"}]},selectedStartDate(){return this.selectedStartDateInSeconds&&this.formatDate(new Date(1e3*this.selectedStartDateInSeconds),this.lang)||0},selectedEndDate(){return this.selectedEndDateInSeconds&&this.formatDate(new Date(1e3*this.selectedEndDateInSeconds),this.lang)||0},periodDatesDisplay(){return this.selectedStartDate&&this.selectedEndDate?`${this.selectedStartDate} ${this.$t("exoplatform.kudos.label.to")} ${this.selectedEndDate}`:this.selectedStartDate?this.selectedStartDate:""},selectedPeriodType(){const e=this.periods.find((e=>e.value===this.kudosPeriodType));return e?e.text:this.kudosPeriodType}},watch:{selectedDate(){this.loadAll()},kudosPeriodType(){this.loadAll()},defaultKudosPeriodType(){!this.kudosPeriodType&&this.defaultKudosPeriodType&&(this.selectedDate=(new Date).toISOString().substr(0,10)),this.kudosPeriodType=this.defaultKudosPeriodType}},created(){document.addEventListener("exo-kudos-get-kudos-list-loading",(()=>this.loading=!0)),document.addEventListener("exo-kudos-get-kudos-list-result",this.loadKudosList),document.addEventListener("exo-kudos-get-period-result",this.loadPeriodDates),this.lang=eXo&&eXo.env&&eXo.env.portal&&eXo.env.portal.language},methods:{loadAll(){this.selectedDate&&this.kudosPeriodType&&(this.selectedStartDateInSeconds=new Date(this.selectedDate).getTime()/1e3,this.selectedEndDateInSeconds=null,document.dispatchEvent(new CustomEvent("exo-kudos-get-period",{detail:{date:new Date(this.selectedDate),periodType:this.kudosPeriodType}})))},loadPeriodDates(e){e&&e.detail&&e.detail.period?(this.selectedStartDateInSeconds=e.detail.period.startDateInSeconds,this.selectedEndDateInSeconds=e.detail.period.endDateInSeconds,document.dispatchEvent(new CustomEvent("exo-kudos-get-kudos-list",{detail:{startDate:new Date(1e3*this.selectedStartDateInSeconds),endDate:new Date(1e3*this.selectedEndDateInSeconds)}}))):console.error("Retrieved event detail doesn't have the period as result")},loadKudosList(e){this.error=null,this.kudosIdentitiesList=[],e&&e.detail?e.detail.error?(console.error(e.detail.error),this.error=e.detail.error):e.detail.list?this.kudosIdentitiesList=e.detail.list:this.error=this.$t("exoplatform.kudos.warning.emptyKudosList"):this.error=this.$t("exoplatform.kudos.warning.emptyKudosList"),this.loading=!1},formatDate:e=>e?e.toLocaleDateString(eXo.env.portal.language):null}},r,[],!1,null,null,null).exports};for(const e in n)Vue.component(e,n[e]);if(extensionRegistry){const e=extensionRegistry.loadComponents("KudosAdmin");e&&e.length>0&&e.forEach((e=>{Vue.component(e.componentName,e.componentOptions)}))}document.dispatchEvent(new CustomEvent("displayTopBarLoading")),Vue.use(Vuetify);const l=new Vuetify(eXo.env.portal.vuetifyPreset),d=eXo&&eXo.env.portal.language||"en",c="KudosAdminApp",u=`${eXo.env.portal.context}/${eXo.env.portal.rest}/i18n/bundle/locale.addon.Kudos-${d}.json`;function p(){exoi18n.loadLanguageAsync(d,u).then((e=>{new Vue({mounted(){document.dispatchEvent(new CustomEvent("hideTopBarLoading"))},template:`<kudos-admin id="${c}" />`,i18n:e,vuetify:l}).$mount(`#${c}`)}))}return t})()));